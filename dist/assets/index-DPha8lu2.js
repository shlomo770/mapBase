(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))m(_);new MutationObserver(_=>{for(const k of _)if(k.type==="childList")for(const w of k.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&m(w)}).observe(document,{childList:!0,subtree:!0});function l(_){const k={};return _.integrity&&(k.integrity=_.integrity),_.referrerPolicy&&(k.referrerPolicy=_.referrerPolicy),_.crossOrigin==="use-credentials"?k.credentials="include":_.crossOrigin==="anonymous"?k.credentials="omit":k.credentials="same-origin",k}function m(_){if(_.ep)return;_.ep=!0;const k=l(_);fetch(_.href,k)}})();var x2=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function qx(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Gx={exports:{}},Cp={},Hx={exports:{}},Mt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hh=Symbol.for("react.element"),w2=Symbol.for("react.portal"),b2=Symbol.for("react.fragment"),S2=Symbol.for("react.strict_mode"),k2=Symbol.for("react.profiler"),T2=Symbol.for("react.provider"),I2=Symbol.for("react.context"),C2=Symbol.for("react.forward_ref"),E2=Symbol.for("react.suspense"),P2=Symbol.for("react.memo"),M2=Symbol.for("react.lazy"),xv=Symbol.iterator;function z2(r){return r===null||typeof r!="object"?null:(r=xv&&r[xv]||r["@@iterator"],typeof r=="function"?r:null)}var Wx={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Xx=Object.assign,Kx={};function du(r,s,l){this.props=r,this.context=s,this.refs=Kx,this.updater=l||Wx}du.prototype.isReactComponent={};du.prototype.setState=function(r,s){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,s,"setState")};du.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function Jx(){}Jx.prototype=du.prototype;function Ng(r,s,l){this.props=r,this.context=s,this.refs=Kx,this.updater=l||Wx}var jg=Ng.prototype=new Jx;jg.constructor=Ng;Xx(jg,du.prototype);jg.isPureReactComponent=!0;var wv=Array.isArray,Yx=Object.prototype.hasOwnProperty,Vg={current:null},Qx={key:!0,ref:!0,__self:!0,__source:!0};function e0(r,s,l){var m,_={},k=null,w=null;if(s!=null)for(m in s.ref!==void 0&&(w=s.ref),s.key!==void 0&&(k=""+s.key),s)Yx.call(s,m)&&!Qx.hasOwnProperty(m)&&(_[m]=s[m]);var d=arguments.length-2;if(d===1)_.children=l;else if(1<d){for(var B=Array(d),K=0;K<d;K++)B[K]=arguments[K+2];_.children=B}if(r&&r.defaultProps)for(m in d=r.defaultProps,d)_[m]===void 0&&(_[m]=d[m]);return{$$typeof:hh,type:r,key:k,ref:w,props:_,_owner:Vg.current}}function A2(r,s){return{$$typeof:hh,type:r.type,key:s,ref:r.ref,props:r.props,_owner:r._owner}}function Ug(r){return typeof r=="object"&&r!==null&&r.$$typeof===hh}function D2(r){var s={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(l){return s[l]})}var bv=/\/+/g;function lm(r,s){return typeof r=="object"&&r!==null&&r.key!=null?D2(""+r.key):s.toString(36)}function jd(r,s,l,m,_){var k=typeof r;(k==="undefined"||k==="boolean")&&(r=null);var w=!1;if(r===null)w=!0;else switch(k){case"string":case"number":w=!0;break;case"object":switch(r.$$typeof){case hh:case w2:w=!0}}if(w)return w=r,_=_(w),r=m===""?"."+lm(w,0):m,wv(_)?(l="",r!=null&&(l=r.replace(bv,"$&/")+"/"),jd(_,s,l,"",function(K){return K})):_!=null&&(Ug(_)&&(_=A2(_,l+(!_.key||w&&w.key===_.key?"":(""+_.key).replace(bv,"$&/")+"/")+r)),s.push(_)),1;if(w=0,m=m===""?".":m+":",wv(r))for(var d=0;d<r.length;d++){k=r[d];var B=m+lm(k,d);w+=jd(k,s,l,B,_)}else if(B=z2(r),typeof B=="function")for(r=B.call(r),d=0;!(k=r.next()).done;)k=k.value,B=m+lm(k,d++),w+=jd(k,s,l,B,_);else if(k==="object")throw s=String(r),Error("Objects are not valid as a React child (found: "+(s==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":s)+"). If you meant to render a collection of children, use an array instead.");return w}function xd(r,s,l){if(r==null)return r;var m=[],_=0;return jd(r,m,"","",function(k){return s.call(l,k,_++)}),m}function L2(r){if(r._status===-1){var s=r._result;s=s(),s.then(function(l){(r._status===0||r._status===-1)&&(r._status=1,r._result=l)},function(l){(r._status===0||r._status===-1)&&(r._status=2,r._result=l)}),r._status===-1&&(r._status=0,r._result=s)}if(r._status===1)return r._result.default;throw r._result}var zn={current:null},Vd={transition:null},R2={ReactCurrentDispatcher:zn,ReactCurrentBatchConfig:Vd,ReactCurrentOwner:Vg};function t0(){throw Error("act(...) is not supported in production builds of React.")}Mt.Children={map:xd,forEach:function(r,s,l){xd(r,function(){s.apply(this,arguments)},l)},count:function(r){var s=0;return xd(r,function(){s++}),s},toArray:function(r){return xd(r,function(s){return s})||[]},only:function(r){if(!Ug(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};Mt.Component=du;Mt.Fragment=b2;Mt.Profiler=k2;Mt.PureComponent=Ng;Mt.StrictMode=S2;Mt.Suspense=E2;Mt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=R2;Mt.act=t0;Mt.cloneElement=function(r,s,l){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var m=Xx({},r.props),_=r.key,k=r.ref,w=r._owner;if(s!=null){if(s.ref!==void 0&&(k=s.ref,w=Vg.current),s.key!==void 0&&(_=""+s.key),r.type&&r.type.defaultProps)var d=r.type.defaultProps;for(B in s)Yx.call(s,B)&&!Qx.hasOwnProperty(B)&&(m[B]=s[B]===void 0&&d!==void 0?d[B]:s[B])}var B=arguments.length-2;if(B===1)m.children=l;else if(1<B){d=Array(B);for(var K=0;K<B;K++)d[K]=arguments[K+2];m.children=d}return{$$typeof:hh,type:r.type,key:_,ref:k,props:m,_owner:w}};Mt.createContext=function(r){return r={$$typeof:I2,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:T2,_context:r},r.Consumer=r};Mt.createElement=e0;Mt.createFactory=function(r){var s=e0.bind(null,r);return s.type=r,s};Mt.createRef=function(){return{current:null}};Mt.forwardRef=function(r){return{$$typeof:C2,render:r}};Mt.isValidElement=Ug;Mt.lazy=function(r){return{$$typeof:M2,_payload:{_status:-1,_result:r},_init:L2}};Mt.memo=function(r,s){return{$$typeof:P2,type:r,compare:s===void 0?null:s}};Mt.startTransition=function(r){var s=Vd.transition;Vd.transition={};try{r()}finally{Vd.transition=s}};Mt.unstable_act=t0;Mt.useCallback=function(r,s){return zn.current.useCallback(r,s)};Mt.useContext=function(r){return zn.current.useContext(r)};Mt.useDebugValue=function(){};Mt.useDeferredValue=function(r){return zn.current.useDeferredValue(r)};Mt.useEffect=function(r,s){return zn.current.useEffect(r,s)};Mt.useId=function(){return zn.current.useId()};Mt.useImperativeHandle=function(r,s,l){return zn.current.useImperativeHandle(r,s,l)};Mt.useInsertionEffect=function(r,s){return zn.current.useInsertionEffect(r,s)};Mt.useLayoutEffect=function(r,s){return zn.current.useLayoutEffect(r,s)};Mt.useMemo=function(r,s){return zn.current.useMemo(r,s)};Mt.useReducer=function(r,s,l){return zn.current.useReducer(r,s,l)};Mt.useRef=function(r){return zn.current.useRef(r)};Mt.useState=function(r){return zn.current.useState(r)};Mt.useSyncExternalStore=function(r,s,l){return zn.current.useSyncExternalStore(r,s,l)};Mt.useTransition=function(){return zn.current.useTransition()};Mt.version="18.3.1";Hx.exports=Mt;var ft=Hx.exports;const F2=qx(ft);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B2=ft,O2=Symbol.for("react.element"),N2=Symbol.for("react.fragment"),j2=Object.prototype.hasOwnProperty,V2=B2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,U2={key:!0,ref:!0,__self:!0,__source:!0};function r0(r,s,l){var m,_={},k=null,w=null;l!==void 0&&(k=""+l),s.key!==void 0&&(k=""+s.key),s.ref!==void 0&&(w=s.ref);for(m in s)j2.call(s,m)&&!U2.hasOwnProperty(m)&&(_[m]=s[m]);if(r&&r.defaultProps)for(m in s=r.defaultProps,s)_[m]===void 0&&(_[m]=s[m]);return{$$typeof:O2,type:r,key:k,ref:w,props:_,_owner:V2.current}}Cp.Fragment=N2;Cp.jsx=r0;Cp.jsxs=r0;Gx.exports=Cp;var ge=Gx.exports,Nm={},n0={exports:{}},pi={},i0={exports:{}},s0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function s(Ke,mt){var gt=Ke.length;Ke.push(mt);e:for(;0<gt;){var Ct=gt-1>>>1,Bt=Ke[Ct];if(0<_(Bt,mt))Ke[Ct]=mt,Ke[gt]=Bt,gt=Ct;else break e}}function l(Ke){return Ke.length===0?null:Ke[0]}function m(Ke){if(Ke.length===0)return null;var mt=Ke[0],gt=Ke.pop();if(gt!==mt){Ke[0]=gt;e:for(var Ct=0,Bt=Ke.length,Hn=Bt>>>1;Ct<Hn;){var Fr=2*(Ct+1)-1,sn=Ke[Fr],on=Fr+1,kr=Ke[on];if(0>_(sn,gt))on<Bt&&0>_(kr,sn)?(Ke[Ct]=kr,Ke[on]=gt,Ct=on):(Ke[Ct]=sn,Ke[Fr]=gt,Ct=Fr);else if(on<Bt&&0>_(kr,gt))Ke[Ct]=kr,Ke[on]=gt,Ct=on;else break e}}return mt}function _(Ke,mt){var gt=Ke.sortIndex-mt.sortIndex;return gt!==0?gt:Ke.id-mt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var k=performance;r.unstable_now=function(){return k.now()}}else{var w=Date,d=w.now();r.unstable_now=function(){return w.now()-d}}var B=[],K=[],te=1,Z=null,U=3,Se=!1,be=!1,ke=!1,Pe=typeof setTimeout=="function"?setTimeout:null,ne=typeof clearTimeout=="function"?clearTimeout:null,q=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function re(Ke){for(var mt=l(K);mt!==null;){if(mt.callback===null)m(K);else if(mt.startTime<=Ke)m(K),mt.sortIndex=mt.expirationTime,s(B,mt);else break;mt=l(K)}}function de(Ke){if(ke=!1,re(Ke),!be)if(l(B)!==null)be=!0,mi(ye);else{var mt=l(K);mt!==null&&nn(de,mt.startTime-Ke)}}function ye(Ke,mt){be=!1,ke&&(ke=!1,ne(Ue),Ue=-1),Se=!0;var gt=U;try{for(re(mt),Z=l(B);Z!==null&&(!(Z.expirationTime>mt)||Ke&&!ot());){var Ct=Z.callback;if(typeof Ct=="function"){Z.callback=null,U=Z.priorityLevel;var Bt=Ct(Z.expirationTime<=mt);mt=r.unstable_now(),typeof Bt=="function"?Z.callback=Bt:Z===l(B)&&m(B),re(mt)}else m(B);Z=l(B)}if(Z!==null)var Hn=!0;else{var Fr=l(K);Fr!==null&&nn(de,Fr.startTime-mt),Hn=!1}return Hn}finally{Z=null,U=gt,Se=!1}}var Ce=!1,ze=null,Ue=-1,tt=5,ut=-1;function ot(){return!(r.unstable_now()-ut<tt)}function wr(){if(ze!==null){var Ke=r.unstable_now();ut=Ke;var mt=!0;try{mt=ze(!0,Ke)}finally{mt?Zt():(Ce=!1,ze=null)}}else Ce=!1}var Zt;if(typeof q=="function")Zt=function(){q(wr)};else if(typeof MessageChannel<"u"){var gr=new MessageChannel,xn=gr.port2;gr.port1.onmessage=wr,Zt=function(){xn.postMessage(null)}}else Zt=function(){Pe(wr,0)};function mi(Ke){ze=Ke,Ce||(Ce=!0,Zt())}function nn(Ke,mt){Ue=Pe(function(){Ke(r.unstable_now())},mt)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(Ke){Ke.callback=null},r.unstable_continueExecution=function(){be||Se||(be=!0,mi(ye))},r.unstable_forceFrameRate=function(Ke){0>Ke||125<Ke?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):tt=0<Ke?Math.floor(1e3/Ke):5},r.unstable_getCurrentPriorityLevel=function(){return U},r.unstable_getFirstCallbackNode=function(){return l(B)},r.unstable_next=function(Ke){switch(U){case 1:case 2:case 3:var mt=3;break;default:mt=U}var gt=U;U=mt;try{return Ke()}finally{U=gt}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(Ke,mt){switch(Ke){case 1:case 2:case 3:case 4:case 5:break;default:Ke=3}var gt=U;U=Ke;try{return mt()}finally{U=gt}},r.unstable_scheduleCallback=function(Ke,mt,gt){var Ct=r.unstable_now();switch(typeof gt=="object"&&gt!==null?(gt=gt.delay,gt=typeof gt=="number"&&0<gt?Ct+gt:Ct):gt=Ct,Ke){case 1:var Bt=-1;break;case 2:Bt=250;break;case 5:Bt=1073741823;break;case 4:Bt=1e4;break;default:Bt=5e3}return Bt=gt+Bt,Ke={id:te++,callback:mt,priorityLevel:Ke,startTime:gt,expirationTime:Bt,sortIndex:-1},gt>Ct?(Ke.sortIndex=gt,s(K,Ke),l(B)===null&&Ke===l(K)&&(ke?(ne(Ue),Ue=-1):ke=!0,nn(de,gt-Ct))):(Ke.sortIndex=Bt,s(B,Ke),be||Se||(be=!0,mi(ye))),Ke},r.unstable_shouldYield=ot,r.unstable_wrapCallback=function(Ke){var mt=U;return function(){var gt=U;U=mt;try{return Ke.apply(this,arguments)}finally{U=gt}}}})(s0);i0.exports=s0;var $2=i0.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Z2=ft,hi=$2;function Le(r){for(var s="https://reactjs.org/docs/error-decoder.html?invariant="+r,l=1;l<arguments.length;l++)s+="&args[]="+encodeURIComponent(arguments[l]);return"Minified React error #"+r+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o0=new Set,qc={};function $a(r,s){su(r,s),su(r+"Capture",s)}function su(r,s){for(qc[r]=s,r=0;r<s.length;r++)o0.add(s[r])}var Vs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),jm=Object.prototype.hasOwnProperty,q2=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Sv={},kv={};function G2(r){return jm.call(kv,r)?!0:jm.call(Sv,r)?!1:q2.test(r)?kv[r]=!0:(Sv[r]=!0,!1)}function H2(r,s,l,m){if(l!==null&&l.type===0)return!1;switch(typeof s){case"function":case"symbol":return!0;case"boolean":return m?!1:l!==null?!l.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function W2(r,s,l,m){if(s===null||typeof s>"u"||H2(r,s,l,m))return!0;if(m)return!1;if(l!==null)switch(l.type){case 3:return!s;case 4:return s===!1;case 5:return isNaN(s);case 6:return isNaN(s)||1>s}return!1}function An(r,s,l,m,_,k,w){this.acceptsBooleans=s===2||s===3||s===4,this.attributeName=m,this.attributeNamespace=_,this.mustUseProperty=l,this.propertyName=r,this.type=s,this.sanitizeURL=k,this.removeEmptyString=w}var rn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){rn[r]=new An(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var s=r[0];rn[s]=new An(s,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){rn[r]=new An(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){rn[r]=new An(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){rn[r]=new An(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){rn[r]=new An(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){rn[r]=new An(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){rn[r]=new An(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){rn[r]=new An(r,5,!1,r.toLowerCase(),null,!1,!1)});var $g=/[\-:]([a-z])/g;function Zg(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var s=r.replace($g,Zg);rn[s]=new An(s,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var s=r.replace($g,Zg);rn[s]=new An(s,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var s=r.replace($g,Zg);rn[s]=new An(s,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){rn[r]=new An(r,1,!1,r.toLowerCase(),null,!1,!1)});rn.xlinkHref=new An("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){rn[r]=new An(r,1,!1,r.toLowerCase(),null,!0,!0)});function qg(r,s,l,m){var _=rn.hasOwnProperty(s)?rn[s]:null;(_!==null?_.type!==0:m||!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(W2(s,l,_,m)&&(l=null),m||_===null?G2(s)&&(l===null?r.removeAttribute(s):r.setAttribute(s,""+l)):_.mustUseProperty?r[_.propertyName]=l===null?_.type===3?!1:"":l:(s=_.attributeName,m=_.attributeNamespace,l===null?r.removeAttribute(s):(_=_.type,l=_===3||_===4&&l===!0?"":""+l,m?r.setAttributeNS(m,s,l):r.setAttribute(s,l))))}var Gs=Z2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,wd=Symbol.for("react.element"),Vl=Symbol.for("react.portal"),Ul=Symbol.for("react.fragment"),Gg=Symbol.for("react.strict_mode"),Vm=Symbol.for("react.profiler"),a0=Symbol.for("react.provider"),l0=Symbol.for("react.context"),Hg=Symbol.for("react.forward_ref"),Um=Symbol.for("react.suspense"),$m=Symbol.for("react.suspense_list"),Wg=Symbol.for("react.memo"),Mo=Symbol.for("react.lazy"),u0=Symbol.for("react.offscreen"),Tv=Symbol.iterator;function Sc(r){return r===null||typeof r!="object"?null:(r=Tv&&r[Tv]||r["@@iterator"],typeof r=="function"?r:null)}var mr=Object.assign,um;function zc(r){if(um===void 0)try{throw Error()}catch(l){var s=l.stack.trim().match(/\n( *(at )?)/);um=s&&s[1]||""}return`
`+um+r}var cm=!1;function hm(r,s){if(!r||cm)return"";cm=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(s)if(s=function(){throw Error()},Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(s,[])}catch(K){var m=K}Reflect.construct(r,[],s)}else{try{s.call()}catch(K){m=K}r.call(s.prototype)}else{try{throw Error()}catch(K){m=K}r()}}catch(K){if(K&&m&&typeof K.stack=="string"){for(var _=K.stack.split(`
`),k=m.stack.split(`
`),w=_.length-1,d=k.length-1;1<=w&&0<=d&&_[w]!==k[d];)d--;for(;1<=w&&0<=d;w--,d--)if(_[w]!==k[d]){if(w!==1||d!==1)do if(w--,d--,0>d||_[w]!==k[d]){var B=`
`+_[w].replace(" at new "," at ");return r.displayName&&B.includes("<anonymous>")&&(B=B.replace("<anonymous>",r.displayName)),B}while(1<=w&&0<=d);break}}}finally{cm=!1,Error.prepareStackTrace=l}return(r=r?r.displayName||r.name:"")?zc(r):""}function X2(r){switch(r.tag){case 5:return zc(r.type);case 16:return zc("Lazy");case 13:return zc("Suspense");case 19:return zc("SuspenseList");case 0:case 2:case 15:return r=hm(r.type,!1),r;case 11:return r=hm(r.type.render,!1),r;case 1:return r=hm(r.type,!0),r;default:return""}}function Zm(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case Ul:return"Fragment";case Vl:return"Portal";case Vm:return"Profiler";case Gg:return"StrictMode";case Um:return"Suspense";case $m:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case l0:return(r.displayName||"Context")+".Consumer";case a0:return(r._context.displayName||"Context")+".Provider";case Hg:var s=r.render;return r=r.displayName,r||(r=s.displayName||s.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case Wg:return s=r.displayName||null,s!==null?s:Zm(r.type)||"Memo";case Mo:s=r._payload,r=r._init;try{return Zm(r(s))}catch{}}return null}function K2(r){var s=r.type;switch(r.tag){case 24:return"Cache";case 9:return(s.displayName||"Context")+".Consumer";case 10:return(s._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=s.render,r=r.displayName||r.name||"",s.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return s;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Zm(s);case 8:return s===Gg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s}return null}function Zo(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function c0(r){var s=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function J2(r){var s=c0(r)?"checked":"value",l=Object.getOwnPropertyDescriptor(r.constructor.prototype,s),m=""+r[s];if(!r.hasOwnProperty(s)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var _=l.get,k=l.set;return Object.defineProperty(r,s,{configurable:!0,get:function(){return _.call(this)},set:function(w){m=""+w,k.call(this,w)}}),Object.defineProperty(r,s,{enumerable:l.enumerable}),{getValue:function(){return m},setValue:function(w){m=""+w},stopTracking:function(){r._valueTracker=null,delete r[s]}}}}function bd(r){r._valueTracker||(r._valueTracker=J2(r))}function h0(r){if(!r)return!1;var s=r._valueTracker;if(!s)return!0;var l=s.getValue(),m="";return r&&(m=c0(r)?r.checked?"true":"false":r.value),r=m,r!==l?(s.setValue(r),!0):!1}function Yd(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function qm(r,s){var l=s.checked;return mr({},s,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:l??r._wrapperState.initialChecked})}function Iv(r,s){var l=s.defaultValue==null?"":s.defaultValue,m=s.checked!=null?s.checked:s.defaultChecked;l=Zo(s.value!=null?s.value:l),r._wrapperState={initialChecked:m,initialValue:l,controlled:s.type==="checkbox"||s.type==="radio"?s.checked!=null:s.value!=null}}function d0(r,s){s=s.checked,s!=null&&qg(r,"checked",s,!1)}function Gm(r,s){d0(r,s);var l=Zo(s.value),m=s.type;if(l!=null)m==="number"?(l===0&&r.value===""||r.value!=l)&&(r.value=""+l):r.value!==""+l&&(r.value=""+l);else if(m==="submit"||m==="reset"){r.removeAttribute("value");return}s.hasOwnProperty("value")?Hm(r,s.type,l):s.hasOwnProperty("defaultValue")&&Hm(r,s.type,Zo(s.defaultValue)),s.checked==null&&s.defaultChecked!=null&&(r.defaultChecked=!!s.defaultChecked)}function Cv(r,s,l){if(s.hasOwnProperty("value")||s.hasOwnProperty("defaultValue")){var m=s.type;if(!(m!=="submit"&&m!=="reset"||s.value!==void 0&&s.value!==null))return;s=""+r._wrapperState.initialValue,l||s===r.value||(r.value=s),r.defaultValue=s}l=r.name,l!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,l!==""&&(r.name=l)}function Hm(r,s,l){(s!=="number"||Yd(r.ownerDocument)!==r)&&(l==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+l&&(r.defaultValue=""+l))}var Ac=Array.isArray;function Ql(r,s,l,m){if(r=r.options,s){s={};for(var _=0;_<l.length;_++)s["$"+l[_]]=!0;for(l=0;l<r.length;l++)_=s.hasOwnProperty("$"+r[l].value),r[l].selected!==_&&(r[l].selected=_),_&&m&&(r[l].defaultSelected=!0)}else{for(l=""+Zo(l),s=null,_=0;_<r.length;_++){if(r[_].value===l){r[_].selected=!0,m&&(r[_].defaultSelected=!0);return}s!==null||r[_].disabled||(s=r[_])}s!==null&&(s.selected=!0)}}function Wm(r,s){if(s.dangerouslySetInnerHTML!=null)throw Error(Le(91));return mr({},s,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function Ev(r,s){var l=s.value;if(l==null){if(l=s.children,s=s.defaultValue,l!=null){if(s!=null)throw Error(Le(92));if(Ac(l)){if(1<l.length)throw Error(Le(93));l=l[0]}s=l}s==null&&(s=""),l=s}r._wrapperState={initialValue:Zo(l)}}function p0(r,s){var l=Zo(s.value),m=Zo(s.defaultValue);l!=null&&(l=""+l,l!==r.value&&(r.value=l),s.defaultValue==null&&r.defaultValue!==l&&(r.defaultValue=l)),m!=null&&(r.defaultValue=""+m)}function Pv(r){var s=r.textContent;s===r._wrapperState.initialValue&&s!==""&&s!==null&&(r.value=s)}function f0(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Xm(r,s){return r==null||r==="http://www.w3.org/1999/xhtml"?f0(s):r==="http://www.w3.org/2000/svg"&&s==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var Sd,m0=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(s,l,m,_){MSApp.execUnsafeLocalFunction(function(){return r(s,l,m,_)})}:r}(function(r,s){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=s;else{for(Sd=Sd||document.createElement("div"),Sd.innerHTML="<svg>"+s.valueOf().toString()+"</svg>",s=Sd.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;s.firstChild;)r.appendChild(s.firstChild)}});function Gc(r,s){if(s){var l=r.firstChild;if(l&&l===r.lastChild&&l.nodeType===3){l.nodeValue=s;return}}r.textContent=s}var Fc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Y2=["Webkit","ms","Moz","O"];Object.keys(Fc).forEach(function(r){Y2.forEach(function(s){s=s+r.charAt(0).toUpperCase()+r.substring(1),Fc[s]=Fc[r]})});function g0(r,s,l){return s==null||typeof s=="boolean"||s===""?"":l||typeof s!="number"||s===0||Fc.hasOwnProperty(r)&&Fc[r]?(""+s).trim():s+"px"}function y0(r,s){r=r.style;for(var l in s)if(s.hasOwnProperty(l)){var m=l.indexOf("--")===0,_=g0(l,s[l],m);l==="float"&&(l="cssFloat"),m?r.setProperty(l,_):r[l]=_}}var Q2=mr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Km(r,s){if(s){if(Q2[r]&&(s.children!=null||s.dangerouslySetInnerHTML!=null))throw Error(Le(137,r));if(s.dangerouslySetInnerHTML!=null){if(s.children!=null)throw Error(Le(60));if(typeof s.dangerouslySetInnerHTML!="object"||!("__html"in s.dangerouslySetInnerHTML))throw Error(Le(61))}if(s.style!=null&&typeof s.style!="object")throw Error(Le(62))}}function Jm(r,s){if(r.indexOf("-")===-1)return typeof s.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ym=null;function Xg(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Qm=null,eu=null,tu=null;function Mv(r){if(r=fh(r)){if(typeof Qm!="function")throw Error(Le(280));var s=r.stateNode;s&&(s=Ap(s),Qm(r.stateNode,r.type,s))}}function _0(r){eu?tu?tu.push(r):tu=[r]:eu=r}function v0(){if(eu){var r=eu,s=tu;if(tu=eu=null,Mv(r),s)for(r=0;r<s.length;r++)Mv(s[r])}}function x0(r,s){return r(s)}function w0(){}var dm=!1;function b0(r,s,l){if(dm)return r(s,l);dm=!0;try{return x0(r,s,l)}finally{dm=!1,(eu!==null||tu!==null)&&(w0(),v0())}}function Hc(r,s){var l=r.stateNode;if(l===null)return null;var m=Ap(l);if(m===null)return null;l=m[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(r=r.type,m=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!m;break e;default:r=!1}if(r)return null;if(l&&typeof l!="function")throw Error(Le(231,s,typeof l));return l}var eg=!1;if(Vs)try{var kc={};Object.defineProperty(kc,"passive",{get:function(){eg=!0}}),window.addEventListener("test",kc,kc),window.removeEventListener("test",kc,kc)}catch{eg=!1}function eS(r,s,l,m,_,k,w,d,B){var K=Array.prototype.slice.call(arguments,3);try{s.apply(l,K)}catch(te){this.onError(te)}}var Bc=!1,Qd=null,ep=!1,tg=null,tS={onError:function(r){Bc=!0,Qd=r}};function rS(r,s,l,m,_,k,w,d,B){Bc=!1,Qd=null,eS.apply(tS,arguments)}function nS(r,s,l,m,_,k,w,d,B){if(rS.apply(this,arguments),Bc){if(Bc){var K=Qd;Bc=!1,Qd=null}else throw Error(Le(198));ep||(ep=!0,tg=K)}}function Za(r){var s=r,l=r;if(r.alternate)for(;s.return;)s=s.return;else{r=s;do s=r,s.flags&4098&&(l=s.return),r=s.return;while(r)}return s.tag===3?l:null}function S0(r){if(r.tag===13){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function zv(r){if(Za(r)!==r)throw Error(Le(188))}function iS(r){var s=r.alternate;if(!s){if(s=Za(r),s===null)throw Error(Le(188));return s!==r?null:r}for(var l=r,m=s;;){var _=l.return;if(_===null)break;var k=_.alternate;if(k===null){if(m=_.return,m!==null){l=m;continue}break}if(_.child===k.child){for(k=_.child;k;){if(k===l)return zv(_),r;if(k===m)return zv(_),s;k=k.sibling}throw Error(Le(188))}if(l.return!==m.return)l=_,m=k;else{for(var w=!1,d=_.child;d;){if(d===l){w=!0,l=_,m=k;break}if(d===m){w=!0,m=_,l=k;break}d=d.sibling}if(!w){for(d=k.child;d;){if(d===l){w=!0,l=k,m=_;break}if(d===m){w=!0,m=k,l=_;break}d=d.sibling}if(!w)throw Error(Le(189))}}if(l.alternate!==m)throw Error(Le(190))}if(l.tag!==3)throw Error(Le(188));return l.stateNode.current===l?r:s}function k0(r){return r=iS(r),r!==null?T0(r):null}function T0(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var s=T0(r);if(s!==null)return s;r=r.sibling}return null}var I0=hi.unstable_scheduleCallback,Av=hi.unstable_cancelCallback,sS=hi.unstable_shouldYield,oS=hi.unstable_requestPaint,Sr=hi.unstable_now,aS=hi.unstable_getCurrentPriorityLevel,Kg=hi.unstable_ImmediatePriority,C0=hi.unstable_UserBlockingPriority,tp=hi.unstable_NormalPriority,lS=hi.unstable_LowPriority,E0=hi.unstable_IdlePriority,Ep=null,hs=null;function uS(r){if(hs&&typeof hs.onCommitFiberRoot=="function")try{hs.onCommitFiberRoot(Ep,r,void 0,(r.current.flags&128)===128)}catch{}}var qi=Math.clz32?Math.clz32:dS,cS=Math.log,hS=Math.LN2;function dS(r){return r>>>=0,r===0?32:31-(cS(r)/hS|0)|0}var kd=64,Td=4194304;function Dc(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function rp(r,s){var l=r.pendingLanes;if(l===0)return 0;var m=0,_=r.suspendedLanes,k=r.pingedLanes,w=l&268435455;if(w!==0){var d=w&~_;d!==0?m=Dc(d):(k&=w,k!==0&&(m=Dc(k)))}else w=l&~_,w!==0?m=Dc(w):k!==0&&(m=Dc(k));if(m===0)return 0;if(s!==0&&s!==m&&!(s&_)&&(_=m&-m,k=s&-s,_>=k||_===16&&(k&4194240)!==0))return s;if(m&4&&(m|=l&16),s=r.entangledLanes,s!==0)for(r=r.entanglements,s&=m;0<s;)l=31-qi(s),_=1<<l,m|=r[l],s&=~_;return m}function pS(r,s){switch(r){case 1:case 2:case 4:return s+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function fS(r,s){for(var l=r.suspendedLanes,m=r.pingedLanes,_=r.expirationTimes,k=r.pendingLanes;0<k;){var w=31-qi(k),d=1<<w,B=_[w];B===-1?(!(d&l)||d&m)&&(_[w]=pS(d,s)):B<=s&&(r.expiredLanes|=d),k&=~d}}function rg(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function P0(){var r=kd;return kd<<=1,!(kd&4194240)&&(kd=64),r}function pm(r){for(var s=[],l=0;31>l;l++)s.push(r);return s}function dh(r,s,l){r.pendingLanes|=s,s!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,s=31-qi(s),r[s]=l}function mS(r,s){var l=r.pendingLanes&~s;r.pendingLanes=s,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=s,r.mutableReadLanes&=s,r.entangledLanes&=s,s=r.entanglements;var m=r.eventTimes;for(r=r.expirationTimes;0<l;){var _=31-qi(l),k=1<<_;s[_]=0,m[_]=-1,r[_]=-1,l&=~k}}function Jg(r,s){var l=r.entangledLanes|=s;for(r=r.entanglements;l;){var m=31-qi(l),_=1<<m;_&s|r[m]&s&&(r[m]|=s),l&=~_}}var Ht=0;function M0(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var z0,Yg,A0,D0,L0,ng=!1,Id=[],Fo=null,Bo=null,Oo=null,Wc=new Map,Xc=new Map,Ao=[],gS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Dv(r,s){switch(r){case"focusin":case"focusout":Fo=null;break;case"dragenter":case"dragleave":Bo=null;break;case"mouseover":case"mouseout":Oo=null;break;case"pointerover":case"pointerout":Wc.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":Xc.delete(s.pointerId)}}function Tc(r,s,l,m,_,k){return r===null||r.nativeEvent!==k?(r={blockedOn:s,domEventName:l,eventSystemFlags:m,nativeEvent:k,targetContainers:[_]},s!==null&&(s=fh(s),s!==null&&Yg(s)),r):(r.eventSystemFlags|=m,s=r.targetContainers,_!==null&&s.indexOf(_)===-1&&s.push(_),r)}function yS(r,s,l,m,_){switch(s){case"focusin":return Fo=Tc(Fo,r,s,l,m,_),!0;case"dragenter":return Bo=Tc(Bo,r,s,l,m,_),!0;case"mouseover":return Oo=Tc(Oo,r,s,l,m,_),!0;case"pointerover":var k=_.pointerId;return Wc.set(k,Tc(Wc.get(k)||null,r,s,l,m,_)),!0;case"gotpointercapture":return k=_.pointerId,Xc.set(k,Tc(Xc.get(k)||null,r,s,l,m,_)),!0}return!1}function R0(r){var s=za(r.target);if(s!==null){var l=Za(s);if(l!==null){if(s=l.tag,s===13){if(s=S0(l),s!==null){r.blockedOn=s,L0(r.priority,function(){A0(l)});return}}else if(s===3&&l.stateNode.current.memoizedState.isDehydrated){r.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Ud(r){if(r.blockedOn!==null)return!1;for(var s=r.targetContainers;0<s.length;){var l=ig(r.domEventName,r.eventSystemFlags,s[0],r.nativeEvent);if(l===null){l=r.nativeEvent;var m=new l.constructor(l.type,l);Ym=m,l.target.dispatchEvent(m),Ym=null}else return s=fh(l),s!==null&&Yg(s),r.blockedOn=l,!1;s.shift()}return!0}function Lv(r,s,l){Ud(r)&&l.delete(s)}function _S(){ng=!1,Fo!==null&&Ud(Fo)&&(Fo=null),Bo!==null&&Ud(Bo)&&(Bo=null),Oo!==null&&Ud(Oo)&&(Oo=null),Wc.forEach(Lv),Xc.forEach(Lv)}function Ic(r,s){r.blockedOn===s&&(r.blockedOn=null,ng||(ng=!0,hi.unstable_scheduleCallback(hi.unstable_NormalPriority,_S)))}function Kc(r){function s(_){return Ic(_,r)}if(0<Id.length){Ic(Id[0],r);for(var l=1;l<Id.length;l++){var m=Id[l];m.blockedOn===r&&(m.blockedOn=null)}}for(Fo!==null&&Ic(Fo,r),Bo!==null&&Ic(Bo,r),Oo!==null&&Ic(Oo,r),Wc.forEach(s),Xc.forEach(s),l=0;l<Ao.length;l++)m=Ao[l],m.blockedOn===r&&(m.blockedOn=null);for(;0<Ao.length&&(l=Ao[0],l.blockedOn===null);)R0(l),l.blockedOn===null&&Ao.shift()}var ru=Gs.ReactCurrentBatchConfig,np=!0;function vS(r,s,l,m){var _=Ht,k=ru.transition;ru.transition=null;try{Ht=1,Qg(r,s,l,m)}finally{Ht=_,ru.transition=k}}function xS(r,s,l,m){var _=Ht,k=ru.transition;ru.transition=null;try{Ht=4,Qg(r,s,l,m)}finally{Ht=_,ru.transition=k}}function Qg(r,s,l,m){if(np){var _=ig(r,s,l,m);if(_===null)Sm(r,s,m,ip,l),Dv(r,m);else if(yS(_,r,s,l,m))m.stopPropagation();else if(Dv(r,m),s&4&&-1<gS.indexOf(r)){for(;_!==null;){var k=fh(_);if(k!==null&&z0(k),k=ig(r,s,l,m),k===null&&Sm(r,s,m,ip,l),k===_)break;_=k}_!==null&&m.stopPropagation()}else Sm(r,s,m,null,l)}}var ip=null;function ig(r,s,l,m){if(ip=null,r=Xg(m),r=za(r),r!==null)if(s=Za(r),s===null)r=null;else if(l=s.tag,l===13){if(r=S0(s),r!==null)return r;r=null}else if(l===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;r=null}else s!==r&&(r=null);return ip=r,null}function F0(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(aS()){case Kg:return 1;case C0:return 4;case tp:case lS:return 16;case E0:return 536870912;default:return 16}default:return 16}}var Lo=null,ey=null,$d=null;function B0(){if($d)return $d;var r,s=ey,l=s.length,m,_="value"in Lo?Lo.value:Lo.textContent,k=_.length;for(r=0;r<l&&s[r]===_[r];r++);var w=l-r;for(m=1;m<=w&&s[l-m]===_[k-m];m++);return $d=_.slice(r,1<m?1-m:void 0)}function Zd(r){var s=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&s===13&&(r=13)):r=s,r===10&&(r=13),32<=r||r===13?r:0}function Cd(){return!0}function Rv(){return!1}function fi(r){function s(l,m,_,k,w){this._reactName=l,this._targetInst=_,this.type=m,this.nativeEvent=k,this.target=w,this.currentTarget=null;for(var d in r)r.hasOwnProperty(d)&&(l=r[d],this[d]=l?l(k):k[d]);return this.isDefaultPrevented=(k.defaultPrevented!=null?k.defaultPrevented:k.returnValue===!1)?Cd:Rv,this.isPropagationStopped=Rv,this}return mr(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Cd)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Cd)},persist:function(){},isPersistent:Cd}),s}var pu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ty=fi(pu),ph=mr({},pu,{view:0,detail:0}),wS=fi(ph),fm,mm,Cc,Pp=mr({},ph,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ry,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Cc&&(Cc&&r.type==="mousemove"?(fm=r.screenX-Cc.screenX,mm=r.screenY-Cc.screenY):mm=fm=0,Cc=r),fm)},movementY:function(r){return"movementY"in r?r.movementY:mm}}),Fv=fi(Pp),bS=mr({},Pp,{dataTransfer:0}),SS=fi(bS),kS=mr({},ph,{relatedTarget:0}),gm=fi(kS),TS=mr({},pu,{animationName:0,elapsedTime:0,pseudoElement:0}),IS=fi(TS),CS=mr({},pu,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),ES=fi(CS),PS=mr({},pu,{data:0}),Bv=fi(PS),MS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},zS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},AS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function DS(r){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(r):(r=AS[r])?!!s[r]:!1}function ry(){return DS}var LS=mr({},ph,{key:function(r){if(r.key){var s=MS[r.key]||r.key;if(s!=="Unidentified")return s}return r.type==="keypress"?(r=Zd(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?zS[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ry,charCode:function(r){return r.type==="keypress"?Zd(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Zd(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),RS=fi(LS),FS=mr({},Pp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ov=fi(FS),BS=mr({},ph,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ry}),OS=fi(BS),NS=mr({},pu,{propertyName:0,elapsedTime:0,pseudoElement:0}),jS=fi(NS),VS=mr({},Pp,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),US=fi(VS),$S=[9,13,27,32],ny=Vs&&"CompositionEvent"in window,Oc=null;Vs&&"documentMode"in document&&(Oc=document.documentMode);var ZS=Vs&&"TextEvent"in window&&!Oc,O0=Vs&&(!ny||Oc&&8<Oc&&11>=Oc),Nv=" ",jv=!1;function N0(r,s){switch(r){case"keyup":return $S.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function j0(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var $l=!1;function qS(r,s){switch(r){case"compositionend":return j0(s);case"keypress":return s.which!==32?null:(jv=!0,Nv);case"textInput":return r=s.data,r===Nv&&jv?null:r;default:return null}}function GS(r,s){if($l)return r==="compositionend"||!ny&&N0(r,s)?(r=B0(),$d=ey=Lo=null,$l=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return O0&&s.locale!=="ko"?null:s.data;default:return null}}var HS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vv(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s==="input"?!!HS[r.type]:s==="textarea"}function V0(r,s,l,m){_0(m),s=sp(s,"onChange"),0<s.length&&(l=new ty("onChange","change",null,l,m),r.push({event:l,listeners:s}))}var Nc=null,Jc=null;function WS(r){Y0(r,0)}function Mp(r){var s=Gl(r);if(h0(s))return r}function XS(r,s){if(r==="change")return s}var U0=!1;if(Vs){var ym;if(Vs){var _m="oninput"in document;if(!_m){var Uv=document.createElement("div");Uv.setAttribute("oninput","return;"),_m=typeof Uv.oninput=="function"}ym=_m}else ym=!1;U0=ym&&(!document.documentMode||9<document.documentMode)}function $v(){Nc&&(Nc.detachEvent("onpropertychange",$0),Jc=Nc=null)}function $0(r){if(r.propertyName==="value"&&Mp(Jc)){var s=[];V0(s,Jc,r,Xg(r)),b0(WS,s)}}function KS(r,s,l){r==="focusin"?($v(),Nc=s,Jc=l,Nc.attachEvent("onpropertychange",$0)):r==="focusout"&&$v()}function JS(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Mp(Jc)}function YS(r,s){if(r==="click")return Mp(s)}function QS(r,s){if(r==="input"||r==="change")return Mp(s)}function ek(r,s){return r===s&&(r!==0||1/r===1/s)||r!==r&&s!==s}var Hi=typeof Object.is=="function"?Object.is:ek;function Yc(r,s){if(Hi(r,s))return!0;if(typeof r!="object"||r===null||typeof s!="object"||s===null)return!1;var l=Object.keys(r),m=Object.keys(s);if(l.length!==m.length)return!1;for(m=0;m<l.length;m++){var _=l[m];if(!jm.call(s,_)||!Hi(r[_],s[_]))return!1}return!0}function Zv(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function qv(r,s){var l=Zv(r);r=0;for(var m;l;){if(l.nodeType===3){if(m=r+l.textContent.length,r<=s&&m>=s)return{node:l,offset:s-r};r=m}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=Zv(l)}}function Z0(r,s){return r&&s?r===s?!0:r&&r.nodeType===3?!1:s&&s.nodeType===3?Z0(r,s.parentNode):"contains"in r?r.contains(s):r.compareDocumentPosition?!!(r.compareDocumentPosition(s)&16):!1:!1}function q0(){for(var r=window,s=Yd();s instanceof r.HTMLIFrameElement;){try{var l=typeof s.contentWindow.location.href=="string"}catch{l=!1}if(l)r=s.contentWindow;else break;s=Yd(r.document)}return s}function iy(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s&&(s==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||s==="textarea"||r.contentEditable==="true")}function tk(r){var s=q0(),l=r.focusedElem,m=r.selectionRange;if(s!==l&&l&&l.ownerDocument&&Z0(l.ownerDocument.documentElement,l)){if(m!==null&&iy(l)){if(s=m.start,r=m.end,r===void 0&&(r=s),"selectionStart"in l)l.selectionStart=s,l.selectionEnd=Math.min(r,l.value.length);else if(r=(s=l.ownerDocument||document)&&s.defaultView||window,r.getSelection){r=r.getSelection();var _=l.textContent.length,k=Math.min(m.start,_);m=m.end===void 0?k:Math.min(m.end,_),!r.extend&&k>m&&(_=m,m=k,k=_),_=qv(l,k);var w=qv(l,m);_&&w&&(r.rangeCount!==1||r.anchorNode!==_.node||r.anchorOffset!==_.offset||r.focusNode!==w.node||r.focusOffset!==w.offset)&&(s=s.createRange(),s.setStart(_.node,_.offset),r.removeAllRanges(),k>m?(r.addRange(s),r.extend(w.node,w.offset)):(s.setEnd(w.node,w.offset),r.addRange(s)))}}for(s=[],r=l;r=r.parentNode;)r.nodeType===1&&s.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof l.focus=="function"&&l.focus(),l=0;l<s.length;l++)r=s[l],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var rk=Vs&&"documentMode"in document&&11>=document.documentMode,Zl=null,sg=null,jc=null,og=!1;function Gv(r,s,l){var m=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;og||Zl==null||Zl!==Yd(m)||(m=Zl,"selectionStart"in m&&iy(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),jc&&Yc(jc,m)||(jc=m,m=sp(sg,"onSelect"),0<m.length&&(s=new ty("onSelect","select",null,s,l),r.push({event:s,listeners:m}),s.target=Zl)))}function Ed(r,s){var l={};return l[r.toLowerCase()]=s.toLowerCase(),l["Webkit"+r]="webkit"+s,l["Moz"+r]="moz"+s,l}var ql={animationend:Ed("Animation","AnimationEnd"),animationiteration:Ed("Animation","AnimationIteration"),animationstart:Ed("Animation","AnimationStart"),transitionend:Ed("Transition","TransitionEnd")},vm={},G0={};Vs&&(G0=document.createElement("div").style,"AnimationEvent"in window||(delete ql.animationend.animation,delete ql.animationiteration.animation,delete ql.animationstart.animation),"TransitionEvent"in window||delete ql.transitionend.transition);function zp(r){if(vm[r])return vm[r];if(!ql[r])return r;var s=ql[r],l;for(l in s)if(s.hasOwnProperty(l)&&l in G0)return vm[r]=s[l];return r}var H0=zp("animationend"),W0=zp("animationiteration"),X0=zp("animationstart"),K0=zp("transitionend"),J0=new Map,Hv="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ho(r,s){J0.set(r,s),$a(s,[r])}for(var xm=0;xm<Hv.length;xm++){var wm=Hv[xm],nk=wm.toLowerCase(),ik=wm[0].toUpperCase()+wm.slice(1);Ho(nk,"on"+ik)}Ho(H0,"onAnimationEnd");Ho(W0,"onAnimationIteration");Ho(X0,"onAnimationStart");Ho("dblclick","onDoubleClick");Ho("focusin","onFocus");Ho("focusout","onBlur");Ho(K0,"onTransitionEnd");su("onMouseEnter",["mouseout","mouseover"]);su("onMouseLeave",["mouseout","mouseover"]);su("onPointerEnter",["pointerout","pointerover"]);su("onPointerLeave",["pointerout","pointerover"]);$a("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));$a("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));$a("onBeforeInput",["compositionend","keypress","textInput","paste"]);$a("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));$a("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));$a("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Lc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),sk=new Set("cancel close invalid load scroll toggle".split(" ").concat(Lc));function Wv(r,s,l){var m=r.type||"unknown-event";r.currentTarget=l,nS(m,s,void 0,r),r.currentTarget=null}function Y0(r,s){s=(s&4)!==0;for(var l=0;l<r.length;l++){var m=r[l],_=m.event;m=m.listeners;e:{var k=void 0;if(s)for(var w=m.length-1;0<=w;w--){var d=m[w],B=d.instance,K=d.currentTarget;if(d=d.listener,B!==k&&_.isPropagationStopped())break e;Wv(_,d,K),k=B}else for(w=0;w<m.length;w++){if(d=m[w],B=d.instance,K=d.currentTarget,d=d.listener,B!==k&&_.isPropagationStopped())break e;Wv(_,d,K),k=B}}}if(ep)throw r=tg,ep=!1,tg=null,r}function ir(r,s){var l=s[hg];l===void 0&&(l=s[hg]=new Set);var m=r+"__bubble";l.has(m)||(Q0(s,r,2,!1),l.add(m))}function bm(r,s,l){var m=0;s&&(m|=4),Q0(l,r,m,s)}var Pd="_reactListening"+Math.random().toString(36).slice(2);function Qc(r){if(!r[Pd]){r[Pd]=!0,o0.forEach(function(l){l!=="selectionchange"&&(sk.has(l)||bm(l,!1,r),bm(l,!0,r))});var s=r.nodeType===9?r:r.ownerDocument;s===null||s[Pd]||(s[Pd]=!0,bm("selectionchange",!1,s))}}function Q0(r,s,l,m){switch(F0(s)){case 1:var _=vS;break;case 4:_=xS;break;default:_=Qg}l=_.bind(null,s,l,r),_=void 0,!eg||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(_=!0),m?_!==void 0?r.addEventListener(s,l,{capture:!0,passive:_}):r.addEventListener(s,l,!0):_!==void 0?r.addEventListener(s,l,{passive:_}):r.addEventListener(s,l,!1)}function Sm(r,s,l,m,_){var k=m;if(!(s&1)&&!(s&2)&&m!==null)e:for(;;){if(m===null)return;var w=m.tag;if(w===3||w===4){var d=m.stateNode.containerInfo;if(d===_||d.nodeType===8&&d.parentNode===_)break;if(w===4)for(w=m.return;w!==null;){var B=w.tag;if((B===3||B===4)&&(B=w.stateNode.containerInfo,B===_||B.nodeType===8&&B.parentNode===_))return;w=w.return}for(;d!==null;){if(w=za(d),w===null)return;if(B=w.tag,B===5||B===6){m=k=w;continue e}d=d.parentNode}}m=m.return}b0(function(){var K=k,te=Xg(l),Z=[];e:{var U=J0.get(r);if(U!==void 0){var Se=ty,be=r;switch(r){case"keypress":if(Zd(l)===0)break e;case"keydown":case"keyup":Se=RS;break;case"focusin":be="focus",Se=gm;break;case"focusout":be="blur",Se=gm;break;case"beforeblur":case"afterblur":Se=gm;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Se=Fv;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Se=SS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Se=OS;break;case H0:case W0:case X0:Se=IS;break;case K0:Se=jS;break;case"scroll":Se=wS;break;case"wheel":Se=US;break;case"copy":case"cut":case"paste":Se=ES;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Se=Ov}var ke=(s&4)!==0,Pe=!ke&&r==="scroll",ne=ke?U!==null?U+"Capture":null:U;ke=[];for(var q=K,re;q!==null;){re=q;var de=re.stateNode;if(re.tag===5&&de!==null&&(re=de,ne!==null&&(de=Hc(q,ne),de!=null&&ke.push(eh(q,de,re)))),Pe)break;q=q.return}0<ke.length&&(U=new Se(U,be,null,l,te),Z.push({event:U,listeners:ke}))}}if(!(s&7)){e:{if(U=r==="mouseover"||r==="pointerover",Se=r==="mouseout"||r==="pointerout",U&&l!==Ym&&(be=l.relatedTarget||l.fromElement)&&(za(be)||be[Us]))break e;if((Se||U)&&(U=te.window===te?te:(U=te.ownerDocument)?U.defaultView||U.parentWindow:window,Se?(be=l.relatedTarget||l.toElement,Se=K,be=be?za(be):null,be!==null&&(Pe=Za(be),be!==Pe||be.tag!==5&&be.tag!==6)&&(be=null)):(Se=null,be=K),Se!==be)){if(ke=Fv,de="onMouseLeave",ne="onMouseEnter",q="mouse",(r==="pointerout"||r==="pointerover")&&(ke=Ov,de="onPointerLeave",ne="onPointerEnter",q="pointer"),Pe=Se==null?U:Gl(Se),re=be==null?U:Gl(be),U=new ke(de,q+"leave",Se,l,te),U.target=Pe,U.relatedTarget=re,de=null,za(te)===K&&(ke=new ke(ne,q+"enter",be,l,te),ke.target=re,ke.relatedTarget=Pe,de=ke),Pe=de,Se&&be)t:{for(ke=Se,ne=be,q=0,re=ke;re;re=Nl(re))q++;for(re=0,de=ne;de;de=Nl(de))re++;for(;0<q-re;)ke=Nl(ke),q--;for(;0<re-q;)ne=Nl(ne),re--;for(;q--;){if(ke===ne||ne!==null&&ke===ne.alternate)break t;ke=Nl(ke),ne=Nl(ne)}ke=null}else ke=null;Se!==null&&Xv(Z,U,Se,ke,!1),be!==null&&Pe!==null&&Xv(Z,Pe,be,ke,!0)}}e:{if(U=K?Gl(K):window,Se=U.nodeName&&U.nodeName.toLowerCase(),Se==="select"||Se==="input"&&U.type==="file")var ye=XS;else if(Vv(U))if(U0)ye=QS;else{ye=JS;var Ce=KS}else(Se=U.nodeName)&&Se.toLowerCase()==="input"&&(U.type==="checkbox"||U.type==="radio")&&(ye=YS);if(ye&&(ye=ye(r,K))){V0(Z,ye,l,te);break e}Ce&&Ce(r,U,K),r==="focusout"&&(Ce=U._wrapperState)&&Ce.controlled&&U.type==="number"&&Hm(U,"number",U.value)}switch(Ce=K?Gl(K):window,r){case"focusin":(Vv(Ce)||Ce.contentEditable==="true")&&(Zl=Ce,sg=K,jc=null);break;case"focusout":jc=sg=Zl=null;break;case"mousedown":og=!0;break;case"contextmenu":case"mouseup":case"dragend":og=!1,Gv(Z,l,te);break;case"selectionchange":if(rk)break;case"keydown":case"keyup":Gv(Z,l,te)}var ze;if(ny)e:{switch(r){case"compositionstart":var Ue="onCompositionStart";break e;case"compositionend":Ue="onCompositionEnd";break e;case"compositionupdate":Ue="onCompositionUpdate";break e}Ue=void 0}else $l?N0(r,l)&&(Ue="onCompositionEnd"):r==="keydown"&&l.keyCode===229&&(Ue="onCompositionStart");Ue&&(O0&&l.locale!=="ko"&&($l||Ue!=="onCompositionStart"?Ue==="onCompositionEnd"&&$l&&(ze=B0()):(Lo=te,ey="value"in Lo?Lo.value:Lo.textContent,$l=!0)),Ce=sp(K,Ue),0<Ce.length&&(Ue=new Bv(Ue,r,null,l,te),Z.push({event:Ue,listeners:Ce}),ze?Ue.data=ze:(ze=j0(l),ze!==null&&(Ue.data=ze)))),(ze=ZS?qS(r,l):GS(r,l))&&(K=sp(K,"onBeforeInput"),0<K.length&&(te=new Bv("onBeforeInput","beforeinput",null,l,te),Z.push({event:te,listeners:K}),te.data=ze))}Y0(Z,s)})}function eh(r,s,l){return{instance:r,listener:s,currentTarget:l}}function sp(r,s){for(var l=s+"Capture",m=[];r!==null;){var _=r,k=_.stateNode;_.tag===5&&k!==null&&(_=k,k=Hc(r,l),k!=null&&m.unshift(eh(r,k,_)),k=Hc(r,s),k!=null&&m.push(eh(r,k,_))),r=r.return}return m}function Nl(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function Xv(r,s,l,m,_){for(var k=s._reactName,w=[];l!==null&&l!==m;){var d=l,B=d.alternate,K=d.stateNode;if(B!==null&&B===m)break;d.tag===5&&K!==null&&(d=K,_?(B=Hc(l,k),B!=null&&w.unshift(eh(l,B,d))):_||(B=Hc(l,k),B!=null&&w.push(eh(l,B,d)))),l=l.return}w.length!==0&&r.push({event:s,listeners:w})}var ok=/\r\n?/g,ak=/\u0000|\uFFFD/g;function Kv(r){return(typeof r=="string"?r:""+r).replace(ok,`
`).replace(ak,"")}function Md(r,s,l){if(s=Kv(s),Kv(r)!==s&&l)throw Error(Le(425))}function op(){}var ag=null,lg=null;function ug(r,s){return r==="textarea"||r==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var cg=typeof setTimeout=="function"?setTimeout:void 0,lk=typeof clearTimeout=="function"?clearTimeout:void 0,Jv=typeof Promise=="function"?Promise:void 0,uk=typeof queueMicrotask=="function"?queueMicrotask:typeof Jv<"u"?function(r){return Jv.resolve(null).then(r).catch(ck)}:cg;function ck(r){setTimeout(function(){throw r})}function km(r,s){var l=s,m=0;do{var _=l.nextSibling;if(r.removeChild(l),_&&_.nodeType===8)if(l=_.data,l==="/$"){if(m===0){r.removeChild(_),Kc(s);return}m--}else l!=="$"&&l!=="$?"&&l!=="$!"||m++;l=_}while(l);Kc(s)}function No(r){for(;r!=null;r=r.nextSibling){var s=r.nodeType;if(s===1||s===3)break;if(s===8){if(s=r.data,s==="$"||s==="$!"||s==="$?")break;if(s==="/$")return null}}return r}function Yv(r){r=r.previousSibling;for(var s=0;r;){if(r.nodeType===8){var l=r.data;if(l==="$"||l==="$!"||l==="$?"){if(s===0)return r;s--}else l==="/$"&&s++}r=r.previousSibling}return null}var fu=Math.random().toString(36).slice(2),cs="__reactFiber$"+fu,th="__reactProps$"+fu,Us="__reactContainer$"+fu,hg="__reactEvents$"+fu,hk="__reactListeners$"+fu,dk="__reactHandles$"+fu;function za(r){var s=r[cs];if(s)return s;for(var l=r.parentNode;l;){if(s=l[Us]||l[cs]){if(l=s.alternate,s.child!==null||l!==null&&l.child!==null)for(r=Yv(r);r!==null;){if(l=r[cs])return l;r=Yv(r)}return s}r=l,l=r.parentNode}return null}function fh(r){return r=r[cs]||r[Us],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function Gl(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(Le(33))}function Ap(r){return r[th]||null}var dg=[],Hl=-1;function Wo(r){return{current:r}}function or(r){0>Hl||(r.current=dg[Hl],dg[Hl]=null,Hl--)}function er(r,s){Hl++,dg[Hl]=r.current,r.current=s}var qo={},vn=Wo(qo),Zn=Wo(!1),Fa=qo;function ou(r,s){var l=r.type.contextTypes;if(!l)return qo;var m=r.stateNode;if(m&&m.__reactInternalMemoizedUnmaskedChildContext===s)return m.__reactInternalMemoizedMaskedChildContext;var _={},k;for(k in l)_[k]=s[k];return m&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=s,r.__reactInternalMemoizedMaskedChildContext=_),_}function qn(r){return r=r.childContextTypes,r!=null}function ap(){or(Zn),or(vn)}function Qv(r,s,l){if(vn.current!==qo)throw Error(Le(168));er(vn,s),er(Zn,l)}function e1(r,s,l){var m=r.stateNode;if(s=s.childContextTypes,typeof m.getChildContext!="function")return l;m=m.getChildContext();for(var _ in m)if(!(_ in s))throw Error(Le(108,K2(r)||"Unknown",_));return mr({},l,m)}function lp(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||qo,Fa=vn.current,er(vn,r),er(Zn,Zn.current),!0}function ex(r,s,l){var m=r.stateNode;if(!m)throw Error(Le(169));l?(r=e1(r,s,Fa),m.__reactInternalMemoizedMergedChildContext=r,or(Zn),or(vn),er(vn,r)):or(Zn),er(Zn,l)}var Rs=null,Dp=!1,Tm=!1;function t1(r){Rs===null?Rs=[r]:Rs.push(r)}function pk(r){Dp=!0,t1(r)}function Xo(){if(!Tm&&Rs!==null){Tm=!0;var r=0,s=Ht;try{var l=Rs;for(Ht=1;r<l.length;r++){var m=l[r];do m=m(!0);while(m!==null)}Rs=null,Dp=!1}catch(_){throw Rs!==null&&(Rs=Rs.slice(r+1)),I0(Kg,Xo),_}finally{Ht=s,Tm=!1}}return null}var Wl=[],Xl=0,up=null,cp=0,Ii=[],Ci=0,Ba=null,Bs=1,Os="";function Ea(r,s){Wl[Xl++]=cp,Wl[Xl++]=up,up=r,cp=s}function r1(r,s,l){Ii[Ci++]=Bs,Ii[Ci++]=Os,Ii[Ci++]=Ba,Ba=r;var m=Bs;r=Os;var _=32-qi(m)-1;m&=~(1<<_),l+=1;var k=32-qi(s)+_;if(30<k){var w=_-_%5;k=(m&(1<<w)-1).toString(32),m>>=w,_-=w,Bs=1<<32-qi(s)+_|l<<_|m,Os=k+r}else Bs=1<<k|l<<_|m,Os=r}function sy(r){r.return!==null&&(Ea(r,1),r1(r,1,0))}function oy(r){for(;r===up;)up=Wl[--Xl],Wl[Xl]=null,cp=Wl[--Xl],Wl[Xl]=null;for(;r===Ba;)Ba=Ii[--Ci],Ii[Ci]=null,Os=Ii[--Ci],Ii[Ci]=null,Bs=Ii[--Ci],Ii[Ci]=null}var ci=null,ui=null,cr=!1,$i=null;function n1(r,s){var l=Ei(5,null,null,0);l.elementType="DELETED",l.stateNode=s,l.return=r,s=r.deletions,s===null?(r.deletions=[l],r.flags|=16):s.push(l)}function tx(r,s){switch(r.tag){case 5:var l=r.type;return s=s.nodeType!==1||l.toLowerCase()!==s.nodeName.toLowerCase()?null:s,s!==null?(r.stateNode=s,ci=r,ui=No(s.firstChild),!0):!1;case 6:return s=r.pendingProps===""||s.nodeType!==3?null:s,s!==null?(r.stateNode=s,ci=r,ui=null,!0):!1;case 13:return s=s.nodeType!==8?null:s,s!==null?(l=Ba!==null?{id:Bs,overflow:Os}:null,r.memoizedState={dehydrated:s,treeContext:l,retryLane:1073741824},l=Ei(18,null,null,0),l.stateNode=s,l.return=r,r.child=l,ci=r,ui=null,!0):!1;default:return!1}}function pg(r){return(r.mode&1)!==0&&(r.flags&128)===0}function fg(r){if(cr){var s=ui;if(s){var l=s;if(!tx(r,s)){if(pg(r))throw Error(Le(418));s=No(l.nextSibling);var m=ci;s&&tx(r,s)?n1(m,l):(r.flags=r.flags&-4097|2,cr=!1,ci=r)}}else{if(pg(r))throw Error(Le(418));r.flags=r.flags&-4097|2,cr=!1,ci=r}}}function rx(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;ci=r}function zd(r){if(r!==ci)return!1;if(!cr)return rx(r),cr=!0,!1;var s;if((s=r.tag!==3)&&!(s=r.tag!==5)&&(s=r.type,s=s!=="head"&&s!=="body"&&!ug(r.type,r.memoizedProps)),s&&(s=ui)){if(pg(r))throw i1(),Error(Le(418));for(;s;)n1(r,s),s=No(s.nextSibling)}if(rx(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(Le(317));e:{for(r=r.nextSibling,s=0;r;){if(r.nodeType===8){var l=r.data;if(l==="/$"){if(s===0){ui=No(r.nextSibling);break e}s--}else l!=="$"&&l!=="$!"&&l!=="$?"||s++}r=r.nextSibling}ui=null}}else ui=ci?No(r.stateNode.nextSibling):null;return!0}function i1(){for(var r=ui;r;)r=No(r.nextSibling)}function au(){ui=ci=null,cr=!1}function ay(r){$i===null?$i=[r]:$i.push(r)}var fk=Gs.ReactCurrentBatchConfig;function Ec(r,s,l){if(r=l.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(l._owner){if(l=l._owner,l){if(l.tag!==1)throw Error(Le(309));var m=l.stateNode}if(!m)throw Error(Le(147,r));var _=m,k=""+r;return s!==null&&s.ref!==null&&typeof s.ref=="function"&&s.ref._stringRef===k?s.ref:(s=function(w){var d=_.refs;w===null?delete d[k]:d[k]=w},s._stringRef=k,s)}if(typeof r!="string")throw Error(Le(284));if(!l._owner)throw Error(Le(290,r))}return r}function Ad(r,s){throw r=Object.prototype.toString.call(s),Error(Le(31,r==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":r))}function nx(r){var s=r._init;return s(r._payload)}function s1(r){function s(ne,q){if(r){var re=ne.deletions;re===null?(ne.deletions=[q],ne.flags|=16):re.push(q)}}function l(ne,q){if(!r)return null;for(;q!==null;)s(ne,q),q=q.sibling;return null}function m(ne,q){for(ne=new Map;q!==null;)q.key!==null?ne.set(q.key,q):ne.set(q.index,q),q=q.sibling;return ne}function _(ne,q){return ne=$o(ne,q),ne.index=0,ne.sibling=null,ne}function k(ne,q,re){return ne.index=re,r?(re=ne.alternate,re!==null?(re=re.index,re<q?(ne.flags|=2,q):re):(ne.flags|=2,q)):(ne.flags|=1048576,q)}function w(ne){return r&&ne.alternate===null&&(ne.flags|=2),ne}function d(ne,q,re,de){return q===null||q.tag!==6?(q=Am(re,ne.mode,de),q.return=ne,q):(q=_(q,re),q.return=ne,q)}function B(ne,q,re,de){var ye=re.type;return ye===Ul?te(ne,q,re.props.children,de,re.key):q!==null&&(q.elementType===ye||typeof ye=="object"&&ye!==null&&ye.$$typeof===Mo&&nx(ye)===q.type)?(de=_(q,re.props),de.ref=Ec(ne,q,re),de.return=ne,de):(de=Jd(re.type,re.key,re.props,null,ne.mode,de),de.ref=Ec(ne,q,re),de.return=ne,de)}function K(ne,q,re,de){return q===null||q.tag!==4||q.stateNode.containerInfo!==re.containerInfo||q.stateNode.implementation!==re.implementation?(q=Dm(re,ne.mode,de),q.return=ne,q):(q=_(q,re.children||[]),q.return=ne,q)}function te(ne,q,re,de,ye){return q===null||q.tag!==7?(q=Ra(re,ne.mode,de,ye),q.return=ne,q):(q=_(q,re),q.return=ne,q)}function Z(ne,q,re){if(typeof q=="string"&&q!==""||typeof q=="number")return q=Am(""+q,ne.mode,re),q.return=ne,q;if(typeof q=="object"&&q!==null){switch(q.$$typeof){case wd:return re=Jd(q.type,q.key,q.props,null,ne.mode,re),re.ref=Ec(ne,null,q),re.return=ne,re;case Vl:return q=Dm(q,ne.mode,re),q.return=ne,q;case Mo:var de=q._init;return Z(ne,de(q._payload),re)}if(Ac(q)||Sc(q))return q=Ra(q,ne.mode,re,null),q.return=ne,q;Ad(ne,q)}return null}function U(ne,q,re,de){var ye=q!==null?q.key:null;if(typeof re=="string"&&re!==""||typeof re=="number")return ye!==null?null:d(ne,q,""+re,de);if(typeof re=="object"&&re!==null){switch(re.$$typeof){case wd:return re.key===ye?B(ne,q,re,de):null;case Vl:return re.key===ye?K(ne,q,re,de):null;case Mo:return ye=re._init,U(ne,q,ye(re._payload),de)}if(Ac(re)||Sc(re))return ye!==null?null:te(ne,q,re,de,null);Ad(ne,re)}return null}function Se(ne,q,re,de,ye){if(typeof de=="string"&&de!==""||typeof de=="number")return ne=ne.get(re)||null,d(q,ne,""+de,ye);if(typeof de=="object"&&de!==null){switch(de.$$typeof){case wd:return ne=ne.get(de.key===null?re:de.key)||null,B(q,ne,de,ye);case Vl:return ne=ne.get(de.key===null?re:de.key)||null,K(q,ne,de,ye);case Mo:var Ce=de._init;return Se(ne,q,re,Ce(de._payload),ye)}if(Ac(de)||Sc(de))return ne=ne.get(re)||null,te(q,ne,de,ye,null);Ad(q,de)}return null}function be(ne,q,re,de){for(var ye=null,Ce=null,ze=q,Ue=q=0,tt=null;ze!==null&&Ue<re.length;Ue++){ze.index>Ue?(tt=ze,ze=null):tt=ze.sibling;var ut=U(ne,ze,re[Ue],de);if(ut===null){ze===null&&(ze=tt);break}r&&ze&&ut.alternate===null&&s(ne,ze),q=k(ut,q,Ue),Ce===null?ye=ut:Ce.sibling=ut,Ce=ut,ze=tt}if(Ue===re.length)return l(ne,ze),cr&&Ea(ne,Ue),ye;if(ze===null){for(;Ue<re.length;Ue++)ze=Z(ne,re[Ue],de),ze!==null&&(q=k(ze,q,Ue),Ce===null?ye=ze:Ce.sibling=ze,Ce=ze);return cr&&Ea(ne,Ue),ye}for(ze=m(ne,ze);Ue<re.length;Ue++)tt=Se(ze,ne,Ue,re[Ue],de),tt!==null&&(r&&tt.alternate!==null&&ze.delete(tt.key===null?Ue:tt.key),q=k(tt,q,Ue),Ce===null?ye=tt:Ce.sibling=tt,Ce=tt);return r&&ze.forEach(function(ot){return s(ne,ot)}),cr&&Ea(ne,Ue),ye}function ke(ne,q,re,de){var ye=Sc(re);if(typeof ye!="function")throw Error(Le(150));if(re=ye.call(re),re==null)throw Error(Le(151));for(var Ce=ye=null,ze=q,Ue=q=0,tt=null,ut=re.next();ze!==null&&!ut.done;Ue++,ut=re.next()){ze.index>Ue?(tt=ze,ze=null):tt=ze.sibling;var ot=U(ne,ze,ut.value,de);if(ot===null){ze===null&&(ze=tt);break}r&&ze&&ot.alternate===null&&s(ne,ze),q=k(ot,q,Ue),Ce===null?ye=ot:Ce.sibling=ot,Ce=ot,ze=tt}if(ut.done)return l(ne,ze),cr&&Ea(ne,Ue),ye;if(ze===null){for(;!ut.done;Ue++,ut=re.next())ut=Z(ne,ut.value,de),ut!==null&&(q=k(ut,q,Ue),Ce===null?ye=ut:Ce.sibling=ut,Ce=ut);return cr&&Ea(ne,Ue),ye}for(ze=m(ne,ze);!ut.done;Ue++,ut=re.next())ut=Se(ze,ne,Ue,ut.value,de),ut!==null&&(r&&ut.alternate!==null&&ze.delete(ut.key===null?Ue:ut.key),q=k(ut,q,Ue),Ce===null?ye=ut:Ce.sibling=ut,Ce=ut);return r&&ze.forEach(function(wr){return s(ne,wr)}),cr&&Ea(ne,Ue),ye}function Pe(ne,q,re,de){if(typeof re=="object"&&re!==null&&re.type===Ul&&re.key===null&&(re=re.props.children),typeof re=="object"&&re!==null){switch(re.$$typeof){case wd:e:{for(var ye=re.key,Ce=q;Ce!==null;){if(Ce.key===ye){if(ye=re.type,ye===Ul){if(Ce.tag===7){l(ne,Ce.sibling),q=_(Ce,re.props.children),q.return=ne,ne=q;break e}}else if(Ce.elementType===ye||typeof ye=="object"&&ye!==null&&ye.$$typeof===Mo&&nx(ye)===Ce.type){l(ne,Ce.sibling),q=_(Ce,re.props),q.ref=Ec(ne,Ce,re),q.return=ne,ne=q;break e}l(ne,Ce);break}else s(ne,Ce);Ce=Ce.sibling}re.type===Ul?(q=Ra(re.props.children,ne.mode,de,re.key),q.return=ne,ne=q):(de=Jd(re.type,re.key,re.props,null,ne.mode,de),de.ref=Ec(ne,q,re),de.return=ne,ne=de)}return w(ne);case Vl:e:{for(Ce=re.key;q!==null;){if(q.key===Ce)if(q.tag===4&&q.stateNode.containerInfo===re.containerInfo&&q.stateNode.implementation===re.implementation){l(ne,q.sibling),q=_(q,re.children||[]),q.return=ne,ne=q;break e}else{l(ne,q);break}else s(ne,q);q=q.sibling}q=Dm(re,ne.mode,de),q.return=ne,ne=q}return w(ne);case Mo:return Ce=re._init,Pe(ne,q,Ce(re._payload),de)}if(Ac(re))return be(ne,q,re,de);if(Sc(re))return ke(ne,q,re,de);Ad(ne,re)}return typeof re=="string"&&re!==""||typeof re=="number"?(re=""+re,q!==null&&q.tag===6?(l(ne,q.sibling),q=_(q,re),q.return=ne,ne=q):(l(ne,q),q=Am(re,ne.mode,de),q.return=ne,ne=q),w(ne)):l(ne,q)}return Pe}var lu=s1(!0),o1=s1(!1),hp=Wo(null),dp=null,Kl=null,ly=null;function uy(){ly=Kl=dp=null}function cy(r){var s=hp.current;or(hp),r._currentValue=s}function mg(r,s,l){for(;r!==null;){var m=r.alternate;if((r.childLanes&s)!==s?(r.childLanes|=s,m!==null&&(m.childLanes|=s)):m!==null&&(m.childLanes&s)!==s&&(m.childLanes|=s),r===l)break;r=r.return}}function nu(r,s){dp=r,ly=Kl=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&s&&($n=!0),r.firstContext=null)}function Mi(r){var s=r._currentValue;if(ly!==r)if(r={context:r,memoizedValue:s,next:null},Kl===null){if(dp===null)throw Error(Le(308));Kl=r,dp.dependencies={lanes:0,firstContext:r}}else Kl=Kl.next=r;return s}var Aa=null;function hy(r){Aa===null?Aa=[r]:Aa.push(r)}function a1(r,s,l,m){var _=s.interleaved;return _===null?(l.next=l,hy(s)):(l.next=_.next,_.next=l),s.interleaved=l,$s(r,m)}function $s(r,s){r.lanes|=s;var l=r.alternate;for(l!==null&&(l.lanes|=s),l=r,r=r.return;r!==null;)r.childLanes|=s,l=r.alternate,l!==null&&(l.childLanes|=s),l=r,r=r.return;return l.tag===3?l.stateNode:null}var zo=!1;function dy(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function l1(r,s){r=r.updateQueue,s.updateQueue===r&&(s.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function Ns(r,s){return{eventTime:r,lane:s,tag:0,payload:null,callback:null,next:null}}function jo(r,s,l){var m=r.updateQueue;if(m===null)return null;if(m=m.shared,Ft&2){var _=m.pending;return _===null?s.next=s:(s.next=_.next,_.next=s),m.pending=s,$s(r,l)}return _=m.interleaved,_===null?(s.next=s,hy(m)):(s.next=_.next,_.next=s),m.interleaved=s,$s(r,l)}function qd(r,s,l){if(s=s.updateQueue,s!==null&&(s=s.shared,(l&4194240)!==0)){var m=s.lanes;m&=r.pendingLanes,l|=m,s.lanes=l,Jg(r,l)}}function ix(r,s){var l=r.updateQueue,m=r.alternate;if(m!==null&&(m=m.updateQueue,l===m)){var _=null,k=null;if(l=l.firstBaseUpdate,l!==null){do{var w={eventTime:l.eventTime,lane:l.lane,tag:l.tag,payload:l.payload,callback:l.callback,next:null};k===null?_=k=w:k=k.next=w,l=l.next}while(l!==null);k===null?_=k=s:k=k.next=s}else _=k=s;l={baseState:m.baseState,firstBaseUpdate:_,lastBaseUpdate:k,shared:m.shared,effects:m.effects},r.updateQueue=l;return}r=l.lastBaseUpdate,r===null?l.firstBaseUpdate=s:r.next=s,l.lastBaseUpdate=s}function pp(r,s,l,m){var _=r.updateQueue;zo=!1;var k=_.firstBaseUpdate,w=_.lastBaseUpdate,d=_.shared.pending;if(d!==null){_.shared.pending=null;var B=d,K=B.next;B.next=null,w===null?k=K:w.next=K,w=B;var te=r.alternate;te!==null&&(te=te.updateQueue,d=te.lastBaseUpdate,d!==w&&(d===null?te.firstBaseUpdate=K:d.next=K,te.lastBaseUpdate=B))}if(k!==null){var Z=_.baseState;w=0,te=K=B=null,d=k;do{var U=d.lane,Se=d.eventTime;if((m&U)===U){te!==null&&(te=te.next={eventTime:Se,lane:0,tag:d.tag,payload:d.payload,callback:d.callback,next:null});e:{var be=r,ke=d;switch(U=s,Se=l,ke.tag){case 1:if(be=ke.payload,typeof be=="function"){Z=be.call(Se,Z,U);break e}Z=be;break e;case 3:be.flags=be.flags&-65537|128;case 0:if(be=ke.payload,U=typeof be=="function"?be.call(Se,Z,U):be,U==null)break e;Z=mr({},Z,U);break e;case 2:zo=!0}}d.callback!==null&&d.lane!==0&&(r.flags|=64,U=_.effects,U===null?_.effects=[d]:U.push(d))}else Se={eventTime:Se,lane:U,tag:d.tag,payload:d.payload,callback:d.callback,next:null},te===null?(K=te=Se,B=Z):te=te.next=Se,w|=U;if(d=d.next,d===null){if(d=_.shared.pending,d===null)break;U=d,d=U.next,U.next=null,_.lastBaseUpdate=U,_.shared.pending=null}}while(!0);if(te===null&&(B=Z),_.baseState=B,_.firstBaseUpdate=K,_.lastBaseUpdate=te,s=_.shared.interleaved,s!==null){_=s;do w|=_.lane,_=_.next;while(_!==s)}else k===null&&(_.shared.lanes=0);Na|=w,r.lanes=w,r.memoizedState=Z}}function sx(r,s,l){if(r=s.effects,s.effects=null,r!==null)for(s=0;s<r.length;s++){var m=r[s],_=m.callback;if(_!==null){if(m.callback=null,m=l,typeof _!="function")throw Error(Le(191,_));_.call(m)}}}var mh={},ds=Wo(mh),rh=Wo(mh),nh=Wo(mh);function Da(r){if(r===mh)throw Error(Le(174));return r}function py(r,s){switch(er(nh,s),er(rh,r),er(ds,mh),r=s.nodeType,r){case 9:case 11:s=(s=s.documentElement)?s.namespaceURI:Xm(null,"");break;default:r=r===8?s.parentNode:s,s=r.namespaceURI||null,r=r.tagName,s=Xm(s,r)}or(ds),er(ds,s)}function uu(){or(ds),or(rh),or(nh)}function u1(r){Da(nh.current);var s=Da(ds.current),l=Xm(s,r.type);s!==l&&(er(rh,r),er(ds,l))}function fy(r){rh.current===r&&(or(ds),or(rh))}var pr=Wo(0);function fp(r){for(var s=r;s!==null;){if(s.tag===13){var l=s.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||l.data==="$?"||l.data==="$!"))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if(s.flags&128)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Im=[];function my(){for(var r=0;r<Im.length;r++)Im[r]._workInProgressVersionPrimary=null;Im.length=0}var Gd=Gs.ReactCurrentDispatcher,Cm=Gs.ReactCurrentBatchConfig,Oa=0,fr=null,Lr=null,qr=null,mp=!1,Vc=!1,ih=0,mk=0;function gn(){throw Error(Le(321))}function gy(r,s){if(s===null)return!1;for(var l=0;l<s.length&&l<r.length;l++)if(!Hi(r[l],s[l]))return!1;return!0}function yy(r,s,l,m,_,k){if(Oa=k,fr=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Gd.current=r===null||r.memoizedState===null?vk:xk,r=l(m,_),Vc){k=0;do{if(Vc=!1,ih=0,25<=k)throw Error(Le(301));k+=1,qr=Lr=null,s.updateQueue=null,Gd.current=wk,r=l(m,_)}while(Vc)}if(Gd.current=gp,s=Lr!==null&&Lr.next!==null,Oa=0,qr=Lr=fr=null,mp=!1,s)throw Error(Le(300));return r}function _y(){var r=ih!==0;return ih=0,r}function us(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return qr===null?fr.memoizedState=qr=r:qr=qr.next=r,qr}function zi(){if(Lr===null){var r=fr.alternate;r=r!==null?r.memoizedState:null}else r=Lr.next;var s=qr===null?fr.memoizedState:qr.next;if(s!==null)qr=s,Lr=r;else{if(r===null)throw Error(Le(310));Lr=r,r={memoizedState:Lr.memoizedState,baseState:Lr.baseState,baseQueue:Lr.baseQueue,queue:Lr.queue,next:null},qr===null?fr.memoizedState=qr=r:qr=qr.next=r}return qr}function sh(r,s){return typeof s=="function"?s(r):s}function Em(r){var s=zi(),l=s.queue;if(l===null)throw Error(Le(311));l.lastRenderedReducer=r;var m=Lr,_=m.baseQueue,k=l.pending;if(k!==null){if(_!==null){var w=_.next;_.next=k.next,k.next=w}m.baseQueue=_=k,l.pending=null}if(_!==null){k=_.next,m=m.baseState;var d=w=null,B=null,K=k;do{var te=K.lane;if((Oa&te)===te)B!==null&&(B=B.next={lane:0,action:K.action,hasEagerState:K.hasEagerState,eagerState:K.eagerState,next:null}),m=K.hasEagerState?K.eagerState:r(m,K.action);else{var Z={lane:te,action:K.action,hasEagerState:K.hasEagerState,eagerState:K.eagerState,next:null};B===null?(d=B=Z,w=m):B=B.next=Z,fr.lanes|=te,Na|=te}K=K.next}while(K!==null&&K!==k);B===null?w=m:B.next=d,Hi(m,s.memoizedState)||($n=!0),s.memoizedState=m,s.baseState=w,s.baseQueue=B,l.lastRenderedState=m}if(r=l.interleaved,r!==null){_=r;do k=_.lane,fr.lanes|=k,Na|=k,_=_.next;while(_!==r)}else _===null&&(l.lanes=0);return[s.memoizedState,l.dispatch]}function Pm(r){var s=zi(),l=s.queue;if(l===null)throw Error(Le(311));l.lastRenderedReducer=r;var m=l.dispatch,_=l.pending,k=s.memoizedState;if(_!==null){l.pending=null;var w=_=_.next;do k=r(k,w.action),w=w.next;while(w!==_);Hi(k,s.memoizedState)||($n=!0),s.memoizedState=k,s.baseQueue===null&&(s.baseState=k),l.lastRenderedState=k}return[k,m]}function c1(){}function h1(r,s){var l=fr,m=zi(),_=s(),k=!Hi(m.memoizedState,_);if(k&&(m.memoizedState=_,$n=!0),m=m.queue,vy(f1.bind(null,l,m,r),[r]),m.getSnapshot!==s||k||qr!==null&&qr.memoizedState.tag&1){if(l.flags|=2048,oh(9,p1.bind(null,l,m,_,s),void 0,null),Gr===null)throw Error(Le(349));Oa&30||d1(l,s,_)}return _}function d1(r,s,l){r.flags|=16384,r={getSnapshot:s,value:l},s=fr.updateQueue,s===null?(s={lastEffect:null,stores:null},fr.updateQueue=s,s.stores=[r]):(l=s.stores,l===null?s.stores=[r]:l.push(r))}function p1(r,s,l,m){s.value=l,s.getSnapshot=m,m1(s)&&g1(r)}function f1(r,s,l){return l(function(){m1(s)&&g1(r)})}function m1(r){var s=r.getSnapshot;r=r.value;try{var l=s();return!Hi(r,l)}catch{return!0}}function g1(r){var s=$s(r,1);s!==null&&Gi(s,r,1,-1)}function ox(r){var s=us();return typeof r=="function"&&(r=r()),s.memoizedState=s.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:sh,lastRenderedState:r},s.queue=r,r=r.dispatch=_k.bind(null,fr,r),[s.memoizedState,r]}function oh(r,s,l,m){return r={tag:r,create:s,destroy:l,deps:m,next:null},s=fr.updateQueue,s===null?(s={lastEffect:null,stores:null},fr.updateQueue=s,s.lastEffect=r.next=r):(l=s.lastEffect,l===null?s.lastEffect=r.next=r:(m=l.next,l.next=r,r.next=m,s.lastEffect=r)),r}function y1(){return zi().memoizedState}function Hd(r,s,l,m){var _=us();fr.flags|=r,_.memoizedState=oh(1|s,l,void 0,m===void 0?null:m)}function Lp(r,s,l,m){var _=zi();m=m===void 0?null:m;var k=void 0;if(Lr!==null){var w=Lr.memoizedState;if(k=w.destroy,m!==null&&gy(m,w.deps)){_.memoizedState=oh(s,l,k,m);return}}fr.flags|=r,_.memoizedState=oh(1|s,l,k,m)}function ax(r,s){return Hd(8390656,8,r,s)}function vy(r,s){return Lp(2048,8,r,s)}function _1(r,s){return Lp(4,2,r,s)}function v1(r,s){return Lp(4,4,r,s)}function x1(r,s){if(typeof s=="function")return r=r(),s(r),function(){s(null)};if(s!=null)return r=r(),s.current=r,function(){s.current=null}}function w1(r,s,l){return l=l!=null?l.concat([r]):null,Lp(4,4,x1.bind(null,s,r),l)}function xy(){}function b1(r,s){var l=zi();s=s===void 0?null:s;var m=l.memoizedState;return m!==null&&s!==null&&gy(s,m[1])?m[0]:(l.memoizedState=[r,s],r)}function S1(r,s){var l=zi();s=s===void 0?null:s;var m=l.memoizedState;return m!==null&&s!==null&&gy(s,m[1])?m[0]:(r=r(),l.memoizedState=[r,s],r)}function k1(r,s,l){return Oa&21?(Hi(l,s)||(l=P0(),fr.lanes|=l,Na|=l,r.baseState=!0),s):(r.baseState&&(r.baseState=!1,$n=!0),r.memoizedState=l)}function gk(r,s){var l=Ht;Ht=l!==0&&4>l?l:4,r(!0);var m=Cm.transition;Cm.transition={};try{r(!1),s()}finally{Ht=l,Cm.transition=m}}function T1(){return zi().memoizedState}function yk(r,s,l){var m=Uo(r);if(l={lane:m,action:l,hasEagerState:!1,eagerState:null,next:null},I1(r))C1(s,l);else if(l=a1(r,s,l,m),l!==null){var _=Mn();Gi(l,r,m,_),E1(l,s,m)}}function _k(r,s,l){var m=Uo(r),_={lane:m,action:l,hasEagerState:!1,eagerState:null,next:null};if(I1(r))C1(s,_);else{var k=r.alternate;if(r.lanes===0&&(k===null||k.lanes===0)&&(k=s.lastRenderedReducer,k!==null))try{var w=s.lastRenderedState,d=k(w,l);if(_.hasEagerState=!0,_.eagerState=d,Hi(d,w)){var B=s.interleaved;B===null?(_.next=_,hy(s)):(_.next=B.next,B.next=_),s.interleaved=_;return}}catch{}finally{}l=a1(r,s,_,m),l!==null&&(_=Mn(),Gi(l,r,m,_),E1(l,s,m))}}function I1(r){var s=r.alternate;return r===fr||s!==null&&s===fr}function C1(r,s){Vc=mp=!0;var l=r.pending;l===null?s.next=s:(s.next=l.next,l.next=s),r.pending=s}function E1(r,s,l){if(l&4194240){var m=s.lanes;m&=r.pendingLanes,l|=m,s.lanes=l,Jg(r,l)}}var gp={readContext:Mi,useCallback:gn,useContext:gn,useEffect:gn,useImperativeHandle:gn,useInsertionEffect:gn,useLayoutEffect:gn,useMemo:gn,useReducer:gn,useRef:gn,useState:gn,useDebugValue:gn,useDeferredValue:gn,useTransition:gn,useMutableSource:gn,useSyncExternalStore:gn,useId:gn,unstable_isNewReconciler:!1},vk={readContext:Mi,useCallback:function(r,s){return us().memoizedState=[r,s===void 0?null:s],r},useContext:Mi,useEffect:ax,useImperativeHandle:function(r,s,l){return l=l!=null?l.concat([r]):null,Hd(4194308,4,x1.bind(null,s,r),l)},useLayoutEffect:function(r,s){return Hd(4194308,4,r,s)},useInsertionEffect:function(r,s){return Hd(4,2,r,s)},useMemo:function(r,s){var l=us();return s=s===void 0?null:s,r=r(),l.memoizedState=[r,s],r},useReducer:function(r,s,l){var m=us();return s=l!==void 0?l(s):s,m.memoizedState=m.baseState=s,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:s},m.queue=r,r=r.dispatch=yk.bind(null,fr,r),[m.memoizedState,r]},useRef:function(r){var s=us();return r={current:r},s.memoizedState=r},useState:ox,useDebugValue:xy,useDeferredValue:function(r){return us().memoizedState=r},useTransition:function(){var r=ox(!1),s=r[0];return r=gk.bind(null,r[1]),us().memoizedState=r,[s,r]},useMutableSource:function(){},useSyncExternalStore:function(r,s,l){var m=fr,_=us();if(cr){if(l===void 0)throw Error(Le(407));l=l()}else{if(l=s(),Gr===null)throw Error(Le(349));Oa&30||d1(m,s,l)}_.memoizedState=l;var k={value:l,getSnapshot:s};return _.queue=k,ax(f1.bind(null,m,k,r),[r]),m.flags|=2048,oh(9,p1.bind(null,m,k,l,s),void 0,null),l},useId:function(){var r=us(),s=Gr.identifierPrefix;if(cr){var l=Os,m=Bs;l=(m&~(1<<32-qi(m)-1)).toString(32)+l,s=":"+s+"R"+l,l=ih++,0<l&&(s+="H"+l.toString(32)),s+=":"}else l=mk++,s=":"+s+"r"+l.toString(32)+":";return r.memoizedState=s},unstable_isNewReconciler:!1},xk={readContext:Mi,useCallback:b1,useContext:Mi,useEffect:vy,useImperativeHandle:w1,useInsertionEffect:_1,useLayoutEffect:v1,useMemo:S1,useReducer:Em,useRef:y1,useState:function(){return Em(sh)},useDebugValue:xy,useDeferredValue:function(r){var s=zi();return k1(s,Lr.memoizedState,r)},useTransition:function(){var r=Em(sh)[0],s=zi().memoizedState;return[r,s]},useMutableSource:c1,useSyncExternalStore:h1,useId:T1,unstable_isNewReconciler:!1},wk={readContext:Mi,useCallback:b1,useContext:Mi,useEffect:vy,useImperativeHandle:w1,useInsertionEffect:_1,useLayoutEffect:v1,useMemo:S1,useReducer:Pm,useRef:y1,useState:function(){return Pm(sh)},useDebugValue:xy,useDeferredValue:function(r){var s=zi();return Lr===null?s.memoizedState=r:k1(s,Lr.memoizedState,r)},useTransition:function(){var r=Pm(sh)[0],s=zi().memoizedState;return[r,s]},useMutableSource:c1,useSyncExternalStore:h1,useId:T1,unstable_isNewReconciler:!1};function Vi(r,s){if(r&&r.defaultProps){s=mr({},s),r=r.defaultProps;for(var l in r)s[l]===void 0&&(s[l]=r[l]);return s}return s}function gg(r,s,l,m){s=r.memoizedState,l=l(m,s),l=l==null?s:mr({},s,l),r.memoizedState=l,r.lanes===0&&(r.updateQueue.baseState=l)}var Rp={isMounted:function(r){return(r=r._reactInternals)?Za(r)===r:!1},enqueueSetState:function(r,s,l){r=r._reactInternals;var m=Mn(),_=Uo(r),k=Ns(m,_);k.payload=s,l!=null&&(k.callback=l),s=jo(r,k,_),s!==null&&(Gi(s,r,_,m),qd(s,r,_))},enqueueReplaceState:function(r,s,l){r=r._reactInternals;var m=Mn(),_=Uo(r),k=Ns(m,_);k.tag=1,k.payload=s,l!=null&&(k.callback=l),s=jo(r,k,_),s!==null&&(Gi(s,r,_,m),qd(s,r,_))},enqueueForceUpdate:function(r,s){r=r._reactInternals;var l=Mn(),m=Uo(r),_=Ns(l,m);_.tag=2,s!=null&&(_.callback=s),s=jo(r,_,m),s!==null&&(Gi(s,r,m,l),qd(s,r,m))}};function lx(r,s,l,m,_,k,w){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(m,k,w):s.prototype&&s.prototype.isPureReactComponent?!Yc(l,m)||!Yc(_,k):!0}function P1(r,s,l){var m=!1,_=qo,k=s.contextType;return typeof k=="object"&&k!==null?k=Mi(k):(_=qn(s)?Fa:vn.current,m=s.contextTypes,k=(m=m!=null)?ou(r,_):qo),s=new s(l,k),r.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=Rp,r.stateNode=s,s._reactInternals=r,m&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=_,r.__reactInternalMemoizedMaskedChildContext=k),s}function ux(r,s,l,m){r=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(l,m),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(l,m),s.state!==r&&Rp.enqueueReplaceState(s,s.state,null)}function yg(r,s,l,m){var _=r.stateNode;_.props=l,_.state=r.memoizedState,_.refs={},dy(r);var k=s.contextType;typeof k=="object"&&k!==null?_.context=Mi(k):(k=qn(s)?Fa:vn.current,_.context=ou(r,k)),_.state=r.memoizedState,k=s.getDerivedStateFromProps,typeof k=="function"&&(gg(r,s,k,l),_.state=r.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(s=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),s!==_.state&&Rp.enqueueReplaceState(_,_.state,null),pp(r,l,_,m),_.state=r.memoizedState),typeof _.componentDidMount=="function"&&(r.flags|=4194308)}function cu(r,s){try{var l="",m=s;do l+=X2(m),m=m.return;while(m);var _=l}catch(k){_=`
Error generating stack: `+k.message+`
`+k.stack}return{value:r,source:s,stack:_,digest:null}}function Mm(r,s,l){return{value:r,source:null,stack:l??null,digest:s??null}}function _g(r,s){try{console.error(s.value)}catch(l){setTimeout(function(){throw l})}}var bk=typeof WeakMap=="function"?WeakMap:Map;function M1(r,s,l){l=Ns(-1,l),l.tag=3,l.payload={element:null};var m=s.value;return l.callback=function(){_p||(_p=!0,Eg=m),_g(r,s)},l}function z1(r,s,l){l=Ns(-1,l),l.tag=3;var m=r.type.getDerivedStateFromError;if(typeof m=="function"){var _=s.value;l.payload=function(){return m(_)},l.callback=function(){_g(r,s)}}var k=r.stateNode;return k!==null&&typeof k.componentDidCatch=="function"&&(l.callback=function(){_g(r,s),typeof m!="function"&&(Vo===null?Vo=new Set([this]):Vo.add(this));var w=s.stack;this.componentDidCatch(s.value,{componentStack:w!==null?w:""})}),l}function cx(r,s,l){var m=r.pingCache;if(m===null){m=r.pingCache=new bk;var _=new Set;m.set(s,_)}else _=m.get(s),_===void 0&&(_=new Set,m.set(s,_));_.has(l)||(_.add(l),r=Fk.bind(null,r,s,l),s.then(r,r))}function hx(r){do{var s;if((s=r.tag===13)&&(s=r.memoizedState,s=s!==null?s.dehydrated!==null:!0),s)return r;r=r.return}while(r!==null);return null}function dx(r,s,l,m,_){return r.mode&1?(r.flags|=65536,r.lanes=_,r):(r===s?r.flags|=65536:(r.flags|=128,l.flags|=131072,l.flags&=-52805,l.tag===1&&(l.alternate===null?l.tag=17:(s=Ns(-1,1),s.tag=2,jo(l,s,1))),l.lanes|=1),r)}var Sk=Gs.ReactCurrentOwner,$n=!1;function Pn(r,s,l,m){s.child=r===null?o1(s,null,l,m):lu(s,r.child,l,m)}function px(r,s,l,m,_){l=l.render;var k=s.ref;return nu(s,_),m=yy(r,s,l,m,k,_),l=_y(),r!==null&&!$n?(s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~_,Zs(r,s,_)):(cr&&l&&sy(s),s.flags|=1,Pn(r,s,m,_),s.child)}function fx(r,s,l,m,_){if(r===null){var k=l.type;return typeof k=="function"&&!Ey(k)&&k.defaultProps===void 0&&l.compare===null&&l.defaultProps===void 0?(s.tag=15,s.type=k,A1(r,s,k,m,_)):(r=Jd(l.type,null,m,s,s.mode,_),r.ref=s.ref,r.return=s,s.child=r)}if(k=r.child,!(r.lanes&_)){var w=k.memoizedProps;if(l=l.compare,l=l!==null?l:Yc,l(w,m)&&r.ref===s.ref)return Zs(r,s,_)}return s.flags|=1,r=$o(k,m),r.ref=s.ref,r.return=s,s.child=r}function A1(r,s,l,m,_){if(r!==null){var k=r.memoizedProps;if(Yc(k,m)&&r.ref===s.ref)if($n=!1,s.pendingProps=m=k,(r.lanes&_)!==0)r.flags&131072&&($n=!0);else return s.lanes=r.lanes,Zs(r,s,_)}return vg(r,s,l,m,_)}function D1(r,s,l){var m=s.pendingProps,_=m.children,k=r!==null?r.memoizedState:null;if(m.mode==="hidden")if(!(s.mode&1))s.memoizedState={baseLanes:0,cachePool:null,transitions:null},er(Yl,li),li|=l;else{if(!(l&1073741824))return r=k!==null?k.baseLanes|l:l,s.lanes=s.childLanes=1073741824,s.memoizedState={baseLanes:r,cachePool:null,transitions:null},s.updateQueue=null,er(Yl,li),li|=r,null;s.memoizedState={baseLanes:0,cachePool:null,transitions:null},m=k!==null?k.baseLanes:l,er(Yl,li),li|=m}else k!==null?(m=k.baseLanes|l,s.memoizedState=null):m=l,er(Yl,li),li|=m;return Pn(r,s,_,l),s.child}function L1(r,s){var l=s.ref;(r===null&&l!==null||r!==null&&r.ref!==l)&&(s.flags|=512,s.flags|=2097152)}function vg(r,s,l,m,_){var k=qn(l)?Fa:vn.current;return k=ou(s,k),nu(s,_),l=yy(r,s,l,m,k,_),m=_y(),r!==null&&!$n?(s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~_,Zs(r,s,_)):(cr&&m&&sy(s),s.flags|=1,Pn(r,s,l,_),s.child)}function mx(r,s,l,m,_){if(qn(l)){var k=!0;lp(s)}else k=!1;if(nu(s,_),s.stateNode===null)Wd(r,s),P1(s,l,m),yg(s,l,m,_),m=!0;else if(r===null){var w=s.stateNode,d=s.memoizedProps;w.props=d;var B=w.context,K=l.contextType;typeof K=="object"&&K!==null?K=Mi(K):(K=qn(l)?Fa:vn.current,K=ou(s,K));var te=l.getDerivedStateFromProps,Z=typeof te=="function"||typeof w.getSnapshotBeforeUpdate=="function";Z||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(d!==m||B!==K)&&ux(s,w,m,K),zo=!1;var U=s.memoizedState;w.state=U,pp(s,m,w,_),B=s.memoizedState,d!==m||U!==B||Zn.current||zo?(typeof te=="function"&&(gg(s,l,te,m),B=s.memoizedState),(d=zo||lx(s,l,d,m,U,B,K))?(Z||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(s.flags|=4194308)):(typeof w.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=m,s.memoizedState=B),w.props=m,w.state=B,w.context=K,m=d):(typeof w.componentDidMount=="function"&&(s.flags|=4194308),m=!1)}else{w=s.stateNode,l1(r,s),d=s.memoizedProps,K=s.type===s.elementType?d:Vi(s.type,d),w.props=K,Z=s.pendingProps,U=w.context,B=l.contextType,typeof B=="object"&&B!==null?B=Mi(B):(B=qn(l)?Fa:vn.current,B=ou(s,B));var Se=l.getDerivedStateFromProps;(te=typeof Se=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(d!==Z||U!==B)&&ux(s,w,m,B),zo=!1,U=s.memoizedState,w.state=U,pp(s,m,w,_);var be=s.memoizedState;d!==Z||U!==be||Zn.current||zo?(typeof Se=="function"&&(gg(s,l,Se,m),be=s.memoizedState),(K=zo||lx(s,l,K,m,U,be,B)||!1)?(te||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(m,be,B),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(m,be,B)),typeof w.componentDidUpdate=="function"&&(s.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof w.componentDidUpdate!="function"||d===r.memoizedProps&&U===r.memoizedState||(s.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||d===r.memoizedProps&&U===r.memoizedState||(s.flags|=1024),s.memoizedProps=m,s.memoizedState=be),w.props=m,w.state=be,w.context=B,m=K):(typeof w.componentDidUpdate!="function"||d===r.memoizedProps&&U===r.memoizedState||(s.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||d===r.memoizedProps&&U===r.memoizedState||(s.flags|=1024),m=!1)}return xg(r,s,l,m,k,_)}function xg(r,s,l,m,_,k){L1(r,s);var w=(s.flags&128)!==0;if(!m&&!w)return _&&ex(s,l,!1),Zs(r,s,k);m=s.stateNode,Sk.current=s;var d=w&&typeof l.getDerivedStateFromError!="function"?null:m.render();return s.flags|=1,r!==null&&w?(s.child=lu(s,r.child,null,k),s.child=lu(s,null,d,k)):Pn(r,s,d,k),s.memoizedState=m.state,_&&ex(s,l,!0),s.child}function R1(r){var s=r.stateNode;s.pendingContext?Qv(r,s.pendingContext,s.pendingContext!==s.context):s.context&&Qv(r,s.context,!1),py(r,s.containerInfo)}function gx(r,s,l,m,_){return au(),ay(_),s.flags|=256,Pn(r,s,l,m),s.child}var wg={dehydrated:null,treeContext:null,retryLane:0};function bg(r){return{baseLanes:r,cachePool:null,transitions:null}}function F1(r,s,l){var m=s.pendingProps,_=pr.current,k=!1,w=(s.flags&128)!==0,d;if((d=w)||(d=r!==null&&r.memoizedState===null?!1:(_&2)!==0),d?(k=!0,s.flags&=-129):(r===null||r.memoizedState!==null)&&(_|=1),er(pr,_&1),r===null)return fg(s),r=s.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(s.mode&1?r.data==="$!"?s.lanes=8:s.lanes=1073741824:s.lanes=1,null):(w=m.children,r=m.fallback,k?(m=s.mode,k=s.child,w={mode:"hidden",children:w},!(m&1)&&k!==null?(k.childLanes=0,k.pendingProps=w):k=Op(w,m,0,null),r=Ra(r,m,l,null),k.return=s,r.return=s,k.sibling=r,s.child=k,s.child.memoizedState=bg(l),s.memoizedState=wg,r):wy(s,w));if(_=r.memoizedState,_!==null&&(d=_.dehydrated,d!==null))return kk(r,s,w,m,d,_,l);if(k){k=m.fallback,w=s.mode,_=r.child,d=_.sibling;var B={mode:"hidden",children:m.children};return!(w&1)&&s.child!==_?(m=s.child,m.childLanes=0,m.pendingProps=B,s.deletions=null):(m=$o(_,B),m.subtreeFlags=_.subtreeFlags&14680064),d!==null?k=$o(d,k):(k=Ra(k,w,l,null),k.flags|=2),k.return=s,m.return=s,m.sibling=k,s.child=m,m=k,k=s.child,w=r.child.memoizedState,w=w===null?bg(l):{baseLanes:w.baseLanes|l,cachePool:null,transitions:w.transitions},k.memoizedState=w,k.childLanes=r.childLanes&~l,s.memoizedState=wg,m}return k=r.child,r=k.sibling,m=$o(k,{mode:"visible",children:m.children}),!(s.mode&1)&&(m.lanes=l),m.return=s,m.sibling=null,r!==null&&(l=s.deletions,l===null?(s.deletions=[r],s.flags|=16):l.push(r)),s.child=m,s.memoizedState=null,m}function wy(r,s){return s=Op({mode:"visible",children:s},r.mode,0,null),s.return=r,r.child=s}function Dd(r,s,l,m){return m!==null&&ay(m),lu(s,r.child,null,l),r=wy(s,s.pendingProps.children),r.flags|=2,s.memoizedState=null,r}function kk(r,s,l,m,_,k,w){if(l)return s.flags&256?(s.flags&=-257,m=Mm(Error(Le(422))),Dd(r,s,w,m)):s.memoizedState!==null?(s.child=r.child,s.flags|=128,null):(k=m.fallback,_=s.mode,m=Op({mode:"visible",children:m.children},_,0,null),k=Ra(k,_,w,null),k.flags|=2,m.return=s,k.return=s,m.sibling=k,s.child=m,s.mode&1&&lu(s,r.child,null,w),s.child.memoizedState=bg(w),s.memoizedState=wg,k);if(!(s.mode&1))return Dd(r,s,w,null);if(_.data==="$!"){if(m=_.nextSibling&&_.nextSibling.dataset,m)var d=m.dgst;return m=d,k=Error(Le(419)),m=Mm(k,m,void 0),Dd(r,s,w,m)}if(d=(w&r.childLanes)!==0,$n||d){if(m=Gr,m!==null){switch(w&-w){case 4:_=2;break;case 16:_=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:_=32;break;case 536870912:_=268435456;break;default:_=0}_=_&(m.suspendedLanes|w)?0:_,_!==0&&_!==k.retryLane&&(k.retryLane=_,$s(r,_),Gi(m,r,_,-1))}return Cy(),m=Mm(Error(Le(421))),Dd(r,s,w,m)}return _.data==="$?"?(s.flags|=128,s.child=r.child,s=Bk.bind(null,r),_._reactRetry=s,null):(r=k.treeContext,ui=No(_.nextSibling),ci=s,cr=!0,$i=null,r!==null&&(Ii[Ci++]=Bs,Ii[Ci++]=Os,Ii[Ci++]=Ba,Bs=r.id,Os=r.overflow,Ba=s),s=wy(s,m.children),s.flags|=4096,s)}function yx(r,s,l){r.lanes|=s;var m=r.alternate;m!==null&&(m.lanes|=s),mg(r.return,s,l)}function zm(r,s,l,m,_){var k=r.memoizedState;k===null?r.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:m,tail:l,tailMode:_}:(k.isBackwards=s,k.rendering=null,k.renderingStartTime=0,k.last=m,k.tail=l,k.tailMode=_)}function B1(r,s,l){var m=s.pendingProps,_=m.revealOrder,k=m.tail;if(Pn(r,s,m.children,l),m=pr.current,m&2)m=m&1|2,s.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=s.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&yx(r,l,s);else if(r.tag===19)yx(r,l,s);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break e;for(;r.sibling===null;){if(r.return===null||r.return===s)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}m&=1}if(er(pr,m),!(s.mode&1))s.memoizedState=null;else switch(_){case"forwards":for(l=s.child,_=null;l!==null;)r=l.alternate,r!==null&&fp(r)===null&&(_=l),l=l.sibling;l=_,l===null?(_=s.child,s.child=null):(_=l.sibling,l.sibling=null),zm(s,!1,_,l,k);break;case"backwards":for(l=null,_=s.child,s.child=null;_!==null;){if(r=_.alternate,r!==null&&fp(r)===null){s.child=_;break}r=_.sibling,_.sibling=l,l=_,_=r}zm(s,!0,l,null,k);break;case"together":zm(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function Wd(r,s){!(s.mode&1)&&r!==null&&(r.alternate=null,s.alternate=null,s.flags|=2)}function Zs(r,s,l){if(r!==null&&(s.dependencies=r.dependencies),Na|=s.lanes,!(l&s.childLanes))return null;if(r!==null&&s.child!==r.child)throw Error(Le(153));if(s.child!==null){for(r=s.child,l=$o(r,r.pendingProps),s.child=l,l.return=s;r.sibling!==null;)r=r.sibling,l=l.sibling=$o(r,r.pendingProps),l.return=s;l.sibling=null}return s.child}function Tk(r,s,l){switch(s.tag){case 3:R1(s),au();break;case 5:u1(s);break;case 1:qn(s.type)&&lp(s);break;case 4:py(s,s.stateNode.containerInfo);break;case 10:var m=s.type._context,_=s.memoizedProps.value;er(hp,m._currentValue),m._currentValue=_;break;case 13:if(m=s.memoizedState,m!==null)return m.dehydrated!==null?(er(pr,pr.current&1),s.flags|=128,null):l&s.child.childLanes?F1(r,s,l):(er(pr,pr.current&1),r=Zs(r,s,l),r!==null?r.sibling:null);er(pr,pr.current&1);break;case 19:if(m=(l&s.childLanes)!==0,r.flags&128){if(m)return B1(r,s,l);s.flags|=128}if(_=s.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),er(pr,pr.current),m)break;return null;case 22:case 23:return s.lanes=0,D1(r,s,l)}return Zs(r,s,l)}var O1,Sg,N1,j1;O1=function(r,s){for(var l=s.child;l!==null;){if(l.tag===5||l.tag===6)r.appendChild(l.stateNode);else if(l.tag!==4&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===s)break;for(;l.sibling===null;){if(l.return===null||l.return===s)return;l=l.return}l.sibling.return=l.return,l=l.sibling}};Sg=function(){};N1=function(r,s,l,m){var _=r.memoizedProps;if(_!==m){r=s.stateNode,Da(ds.current);var k=null;switch(l){case"input":_=qm(r,_),m=qm(r,m),k=[];break;case"select":_=mr({},_,{value:void 0}),m=mr({},m,{value:void 0}),k=[];break;case"textarea":_=Wm(r,_),m=Wm(r,m),k=[];break;default:typeof _.onClick!="function"&&typeof m.onClick=="function"&&(r.onclick=op)}Km(l,m);var w;l=null;for(K in _)if(!m.hasOwnProperty(K)&&_.hasOwnProperty(K)&&_[K]!=null)if(K==="style"){var d=_[K];for(w in d)d.hasOwnProperty(w)&&(l||(l={}),l[w]="")}else K!=="dangerouslySetInnerHTML"&&K!=="children"&&K!=="suppressContentEditableWarning"&&K!=="suppressHydrationWarning"&&K!=="autoFocus"&&(qc.hasOwnProperty(K)?k||(k=[]):(k=k||[]).push(K,null));for(K in m){var B=m[K];if(d=_!=null?_[K]:void 0,m.hasOwnProperty(K)&&B!==d&&(B!=null||d!=null))if(K==="style")if(d){for(w in d)!d.hasOwnProperty(w)||B&&B.hasOwnProperty(w)||(l||(l={}),l[w]="");for(w in B)B.hasOwnProperty(w)&&d[w]!==B[w]&&(l||(l={}),l[w]=B[w])}else l||(k||(k=[]),k.push(K,l)),l=B;else K==="dangerouslySetInnerHTML"?(B=B?B.__html:void 0,d=d?d.__html:void 0,B!=null&&d!==B&&(k=k||[]).push(K,B)):K==="children"?typeof B!="string"&&typeof B!="number"||(k=k||[]).push(K,""+B):K!=="suppressContentEditableWarning"&&K!=="suppressHydrationWarning"&&(qc.hasOwnProperty(K)?(B!=null&&K==="onScroll"&&ir("scroll",r),k||d===B||(k=[])):(k=k||[]).push(K,B))}l&&(k=k||[]).push("style",l);var K=k;(s.updateQueue=K)&&(s.flags|=4)}};j1=function(r,s,l,m){l!==m&&(s.flags|=4)};function Pc(r,s){if(!cr)switch(r.tailMode){case"hidden":s=r.tail;for(var l=null;s!==null;)s.alternate!==null&&(l=s),s=s.sibling;l===null?r.tail=null:l.sibling=null;break;case"collapsed":l=r.tail;for(var m=null;l!==null;)l.alternate!==null&&(m=l),l=l.sibling;m===null?s||r.tail===null?r.tail=null:r.tail.sibling=null:m.sibling=null}}function yn(r){var s=r.alternate!==null&&r.alternate.child===r.child,l=0,m=0;if(s)for(var _=r.child;_!==null;)l|=_.lanes|_.childLanes,m|=_.subtreeFlags&14680064,m|=_.flags&14680064,_.return=r,_=_.sibling;else for(_=r.child;_!==null;)l|=_.lanes|_.childLanes,m|=_.subtreeFlags,m|=_.flags,_.return=r,_=_.sibling;return r.subtreeFlags|=m,r.childLanes=l,s}function Ik(r,s,l){var m=s.pendingProps;switch(oy(s),s.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return yn(s),null;case 1:return qn(s.type)&&ap(),yn(s),null;case 3:return m=s.stateNode,uu(),or(Zn),or(vn),my(),m.pendingContext&&(m.context=m.pendingContext,m.pendingContext=null),(r===null||r.child===null)&&(zd(s)?s.flags|=4:r===null||r.memoizedState.isDehydrated&&!(s.flags&256)||(s.flags|=1024,$i!==null&&(zg($i),$i=null))),Sg(r,s),yn(s),null;case 5:fy(s);var _=Da(nh.current);if(l=s.type,r!==null&&s.stateNode!=null)N1(r,s,l,m,_),r.ref!==s.ref&&(s.flags|=512,s.flags|=2097152);else{if(!m){if(s.stateNode===null)throw Error(Le(166));return yn(s),null}if(r=Da(ds.current),zd(s)){m=s.stateNode,l=s.type;var k=s.memoizedProps;switch(m[cs]=s,m[th]=k,r=(s.mode&1)!==0,l){case"dialog":ir("cancel",m),ir("close",m);break;case"iframe":case"object":case"embed":ir("load",m);break;case"video":case"audio":for(_=0;_<Lc.length;_++)ir(Lc[_],m);break;case"source":ir("error",m);break;case"img":case"image":case"link":ir("error",m),ir("load",m);break;case"details":ir("toggle",m);break;case"input":Iv(m,k),ir("invalid",m);break;case"select":m._wrapperState={wasMultiple:!!k.multiple},ir("invalid",m);break;case"textarea":Ev(m,k),ir("invalid",m)}Km(l,k),_=null;for(var w in k)if(k.hasOwnProperty(w)){var d=k[w];w==="children"?typeof d=="string"?m.textContent!==d&&(k.suppressHydrationWarning!==!0&&Md(m.textContent,d,r),_=["children",d]):typeof d=="number"&&m.textContent!==""+d&&(k.suppressHydrationWarning!==!0&&Md(m.textContent,d,r),_=["children",""+d]):qc.hasOwnProperty(w)&&d!=null&&w==="onScroll"&&ir("scroll",m)}switch(l){case"input":bd(m),Cv(m,k,!0);break;case"textarea":bd(m),Pv(m);break;case"select":case"option":break;default:typeof k.onClick=="function"&&(m.onclick=op)}m=_,s.updateQueue=m,m!==null&&(s.flags|=4)}else{w=_.nodeType===9?_:_.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=f0(l)),r==="http://www.w3.org/1999/xhtml"?l==="script"?(r=w.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof m.is=="string"?r=w.createElement(l,{is:m.is}):(r=w.createElement(l),l==="select"&&(w=r,m.multiple?w.multiple=!0:m.size&&(w.size=m.size))):r=w.createElementNS(r,l),r[cs]=s,r[th]=m,O1(r,s,!1,!1),s.stateNode=r;e:{switch(w=Jm(l,m),l){case"dialog":ir("cancel",r),ir("close",r),_=m;break;case"iframe":case"object":case"embed":ir("load",r),_=m;break;case"video":case"audio":for(_=0;_<Lc.length;_++)ir(Lc[_],r);_=m;break;case"source":ir("error",r),_=m;break;case"img":case"image":case"link":ir("error",r),ir("load",r),_=m;break;case"details":ir("toggle",r),_=m;break;case"input":Iv(r,m),_=qm(r,m),ir("invalid",r);break;case"option":_=m;break;case"select":r._wrapperState={wasMultiple:!!m.multiple},_=mr({},m,{value:void 0}),ir("invalid",r);break;case"textarea":Ev(r,m),_=Wm(r,m),ir("invalid",r);break;default:_=m}Km(l,_),d=_;for(k in d)if(d.hasOwnProperty(k)){var B=d[k];k==="style"?y0(r,B):k==="dangerouslySetInnerHTML"?(B=B?B.__html:void 0,B!=null&&m0(r,B)):k==="children"?typeof B=="string"?(l!=="textarea"||B!=="")&&Gc(r,B):typeof B=="number"&&Gc(r,""+B):k!=="suppressContentEditableWarning"&&k!=="suppressHydrationWarning"&&k!=="autoFocus"&&(qc.hasOwnProperty(k)?B!=null&&k==="onScroll"&&ir("scroll",r):B!=null&&qg(r,k,B,w))}switch(l){case"input":bd(r),Cv(r,m,!1);break;case"textarea":bd(r),Pv(r);break;case"option":m.value!=null&&r.setAttribute("value",""+Zo(m.value));break;case"select":r.multiple=!!m.multiple,k=m.value,k!=null?Ql(r,!!m.multiple,k,!1):m.defaultValue!=null&&Ql(r,!!m.multiple,m.defaultValue,!0);break;default:typeof _.onClick=="function"&&(r.onclick=op)}switch(l){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}}m&&(s.flags|=4)}s.ref!==null&&(s.flags|=512,s.flags|=2097152)}return yn(s),null;case 6:if(r&&s.stateNode!=null)j1(r,s,r.memoizedProps,m);else{if(typeof m!="string"&&s.stateNode===null)throw Error(Le(166));if(l=Da(nh.current),Da(ds.current),zd(s)){if(m=s.stateNode,l=s.memoizedProps,m[cs]=s,(k=m.nodeValue!==l)&&(r=ci,r!==null))switch(r.tag){case 3:Md(m.nodeValue,l,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&Md(m.nodeValue,l,(r.mode&1)!==0)}k&&(s.flags|=4)}else m=(l.nodeType===9?l:l.ownerDocument).createTextNode(m),m[cs]=s,s.stateNode=m}return yn(s),null;case 13:if(or(pr),m=s.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(cr&&ui!==null&&s.mode&1&&!(s.flags&128))i1(),au(),s.flags|=98560,k=!1;else if(k=zd(s),m!==null&&m.dehydrated!==null){if(r===null){if(!k)throw Error(Le(318));if(k=s.memoizedState,k=k!==null?k.dehydrated:null,!k)throw Error(Le(317));k[cs]=s}else au(),!(s.flags&128)&&(s.memoizedState=null),s.flags|=4;yn(s),k=!1}else $i!==null&&(zg($i),$i=null),k=!0;if(!k)return s.flags&65536?s:null}return s.flags&128?(s.lanes=l,s):(m=m!==null,m!==(r!==null&&r.memoizedState!==null)&&m&&(s.child.flags|=8192,s.mode&1&&(r===null||pr.current&1?Rr===0&&(Rr=3):Cy())),s.updateQueue!==null&&(s.flags|=4),yn(s),null);case 4:return uu(),Sg(r,s),r===null&&Qc(s.stateNode.containerInfo),yn(s),null;case 10:return cy(s.type._context),yn(s),null;case 17:return qn(s.type)&&ap(),yn(s),null;case 19:if(or(pr),k=s.memoizedState,k===null)return yn(s),null;if(m=(s.flags&128)!==0,w=k.rendering,w===null)if(m)Pc(k,!1);else{if(Rr!==0||r!==null&&r.flags&128)for(r=s.child;r!==null;){if(w=fp(r),w!==null){for(s.flags|=128,Pc(k,!1),m=w.updateQueue,m!==null&&(s.updateQueue=m,s.flags|=4),s.subtreeFlags=0,m=l,l=s.child;l!==null;)k=l,r=m,k.flags&=14680066,w=k.alternate,w===null?(k.childLanes=0,k.lanes=r,k.child=null,k.subtreeFlags=0,k.memoizedProps=null,k.memoizedState=null,k.updateQueue=null,k.dependencies=null,k.stateNode=null):(k.childLanes=w.childLanes,k.lanes=w.lanes,k.child=w.child,k.subtreeFlags=0,k.deletions=null,k.memoizedProps=w.memoizedProps,k.memoizedState=w.memoizedState,k.updateQueue=w.updateQueue,k.type=w.type,r=w.dependencies,k.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),l=l.sibling;return er(pr,pr.current&1|2),s.child}r=r.sibling}k.tail!==null&&Sr()>hu&&(s.flags|=128,m=!0,Pc(k,!1),s.lanes=4194304)}else{if(!m)if(r=fp(w),r!==null){if(s.flags|=128,m=!0,l=r.updateQueue,l!==null&&(s.updateQueue=l,s.flags|=4),Pc(k,!0),k.tail===null&&k.tailMode==="hidden"&&!w.alternate&&!cr)return yn(s),null}else 2*Sr()-k.renderingStartTime>hu&&l!==1073741824&&(s.flags|=128,m=!0,Pc(k,!1),s.lanes=4194304);k.isBackwards?(w.sibling=s.child,s.child=w):(l=k.last,l!==null?l.sibling=w:s.child=w,k.last=w)}return k.tail!==null?(s=k.tail,k.rendering=s,k.tail=s.sibling,k.renderingStartTime=Sr(),s.sibling=null,l=pr.current,er(pr,m?l&1|2:l&1),s):(yn(s),null);case 22:case 23:return Iy(),m=s.memoizedState!==null,r!==null&&r.memoizedState!==null!==m&&(s.flags|=8192),m&&s.mode&1?li&1073741824&&(yn(s),s.subtreeFlags&6&&(s.flags|=8192)):yn(s),null;case 24:return null;case 25:return null}throw Error(Le(156,s.tag))}function Ck(r,s){switch(oy(s),s.tag){case 1:return qn(s.type)&&ap(),r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 3:return uu(),or(Zn),or(vn),my(),r=s.flags,r&65536&&!(r&128)?(s.flags=r&-65537|128,s):null;case 5:return fy(s),null;case 13:if(or(pr),r=s.memoizedState,r!==null&&r.dehydrated!==null){if(s.alternate===null)throw Error(Le(340));au()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 19:return or(pr),null;case 4:return uu(),null;case 10:return cy(s.type._context),null;case 22:case 23:return Iy(),null;case 24:return null;default:return null}}var Ld=!1,_n=!1,Ek=typeof WeakSet=="function"?WeakSet:Set,it=null;function Jl(r,s){var l=r.ref;if(l!==null)if(typeof l=="function")try{l(null)}catch(m){xr(r,s,m)}else l.current=null}function kg(r,s,l){try{l()}catch(m){xr(r,s,m)}}var _x=!1;function Pk(r,s){if(ag=np,r=q0(),iy(r)){if("selectionStart"in r)var l={start:r.selectionStart,end:r.selectionEnd};else e:{l=(l=r.ownerDocument)&&l.defaultView||window;var m=l.getSelection&&l.getSelection();if(m&&m.rangeCount!==0){l=m.anchorNode;var _=m.anchorOffset,k=m.focusNode;m=m.focusOffset;try{l.nodeType,k.nodeType}catch{l=null;break e}var w=0,d=-1,B=-1,K=0,te=0,Z=r,U=null;t:for(;;){for(var Se;Z!==l||_!==0&&Z.nodeType!==3||(d=w+_),Z!==k||m!==0&&Z.nodeType!==3||(B=w+m),Z.nodeType===3&&(w+=Z.nodeValue.length),(Se=Z.firstChild)!==null;)U=Z,Z=Se;for(;;){if(Z===r)break t;if(U===l&&++K===_&&(d=w),U===k&&++te===m&&(B=w),(Se=Z.nextSibling)!==null)break;Z=U,U=Z.parentNode}Z=Se}l=d===-1||B===-1?null:{start:d,end:B}}else l=null}l=l||{start:0,end:0}}else l=null;for(lg={focusedElem:r,selectionRange:l},np=!1,it=s;it!==null;)if(s=it,r=s.child,(s.subtreeFlags&1028)!==0&&r!==null)r.return=s,it=r;else for(;it!==null;){s=it;try{var be=s.alternate;if(s.flags&1024)switch(s.tag){case 0:case 11:case 15:break;case 1:if(be!==null){var ke=be.memoizedProps,Pe=be.memoizedState,ne=s.stateNode,q=ne.getSnapshotBeforeUpdate(s.elementType===s.type?ke:Vi(s.type,ke),Pe);ne.__reactInternalSnapshotBeforeUpdate=q}break;case 3:var re=s.stateNode.containerInfo;re.nodeType===1?re.textContent="":re.nodeType===9&&re.documentElement&&re.removeChild(re.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Le(163))}}catch(de){xr(s,s.return,de)}if(r=s.sibling,r!==null){r.return=s.return,it=r;break}it=s.return}return be=_x,_x=!1,be}function Uc(r,s,l){var m=s.updateQueue;if(m=m!==null?m.lastEffect:null,m!==null){var _=m=m.next;do{if((_.tag&r)===r){var k=_.destroy;_.destroy=void 0,k!==void 0&&kg(s,l,k)}_=_.next}while(_!==m)}}function Fp(r,s){if(s=s.updateQueue,s=s!==null?s.lastEffect:null,s!==null){var l=s=s.next;do{if((l.tag&r)===r){var m=l.create;l.destroy=m()}l=l.next}while(l!==s)}}function Tg(r){var s=r.ref;if(s!==null){var l=r.stateNode;switch(r.tag){case 5:r=l;break;default:r=l}typeof s=="function"?s(r):s.current=r}}function V1(r){var s=r.alternate;s!==null&&(r.alternate=null,V1(s)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(s=r.stateNode,s!==null&&(delete s[cs],delete s[th],delete s[hg],delete s[hk],delete s[dk])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function U1(r){return r.tag===5||r.tag===3||r.tag===4}function vx(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||U1(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Ig(r,s,l){var m=r.tag;if(m===5||m===6)r=r.stateNode,s?l.nodeType===8?l.parentNode.insertBefore(r,s):l.insertBefore(r,s):(l.nodeType===8?(s=l.parentNode,s.insertBefore(r,l)):(s=l,s.appendChild(r)),l=l._reactRootContainer,l!=null||s.onclick!==null||(s.onclick=op));else if(m!==4&&(r=r.child,r!==null))for(Ig(r,s,l),r=r.sibling;r!==null;)Ig(r,s,l),r=r.sibling}function Cg(r,s,l){var m=r.tag;if(m===5||m===6)r=r.stateNode,s?l.insertBefore(r,s):l.appendChild(r);else if(m!==4&&(r=r.child,r!==null))for(Cg(r,s,l),r=r.sibling;r!==null;)Cg(r,s,l),r=r.sibling}var en=null,Ui=!1;function Po(r,s,l){for(l=l.child;l!==null;)$1(r,s,l),l=l.sibling}function $1(r,s,l){if(hs&&typeof hs.onCommitFiberUnmount=="function")try{hs.onCommitFiberUnmount(Ep,l)}catch{}switch(l.tag){case 5:_n||Jl(l,s);case 6:var m=en,_=Ui;en=null,Po(r,s,l),en=m,Ui=_,en!==null&&(Ui?(r=en,l=l.stateNode,r.nodeType===8?r.parentNode.removeChild(l):r.removeChild(l)):en.removeChild(l.stateNode));break;case 18:en!==null&&(Ui?(r=en,l=l.stateNode,r.nodeType===8?km(r.parentNode,l):r.nodeType===1&&km(r,l),Kc(r)):km(en,l.stateNode));break;case 4:m=en,_=Ui,en=l.stateNode.containerInfo,Ui=!0,Po(r,s,l),en=m,Ui=_;break;case 0:case 11:case 14:case 15:if(!_n&&(m=l.updateQueue,m!==null&&(m=m.lastEffect,m!==null))){_=m=m.next;do{var k=_,w=k.destroy;k=k.tag,w!==void 0&&(k&2||k&4)&&kg(l,s,w),_=_.next}while(_!==m)}Po(r,s,l);break;case 1:if(!_n&&(Jl(l,s),m=l.stateNode,typeof m.componentWillUnmount=="function"))try{m.props=l.memoizedProps,m.state=l.memoizedState,m.componentWillUnmount()}catch(d){xr(l,s,d)}Po(r,s,l);break;case 21:Po(r,s,l);break;case 22:l.mode&1?(_n=(m=_n)||l.memoizedState!==null,Po(r,s,l),_n=m):Po(r,s,l);break;default:Po(r,s,l)}}function xx(r){var s=r.updateQueue;if(s!==null){r.updateQueue=null;var l=r.stateNode;l===null&&(l=r.stateNode=new Ek),s.forEach(function(m){var _=Ok.bind(null,r,m);l.has(m)||(l.add(m),m.then(_,_))})}}function ji(r,s){var l=s.deletions;if(l!==null)for(var m=0;m<l.length;m++){var _=l[m];try{var k=r,w=s,d=w;e:for(;d!==null;){switch(d.tag){case 5:en=d.stateNode,Ui=!1;break e;case 3:en=d.stateNode.containerInfo,Ui=!0;break e;case 4:en=d.stateNode.containerInfo,Ui=!0;break e}d=d.return}if(en===null)throw Error(Le(160));$1(k,w,_),en=null,Ui=!1;var B=_.alternate;B!==null&&(B.return=null),_.return=null}catch(K){xr(_,s,K)}}if(s.subtreeFlags&12854)for(s=s.child;s!==null;)Z1(s,r),s=s.sibling}function Z1(r,s){var l=r.alternate,m=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(ji(s,r),ls(r),m&4){try{Uc(3,r,r.return),Fp(3,r)}catch(ke){xr(r,r.return,ke)}try{Uc(5,r,r.return)}catch(ke){xr(r,r.return,ke)}}break;case 1:ji(s,r),ls(r),m&512&&l!==null&&Jl(l,l.return);break;case 5:if(ji(s,r),ls(r),m&512&&l!==null&&Jl(l,l.return),r.flags&32){var _=r.stateNode;try{Gc(_,"")}catch(ke){xr(r,r.return,ke)}}if(m&4&&(_=r.stateNode,_!=null)){var k=r.memoizedProps,w=l!==null?l.memoizedProps:k,d=r.type,B=r.updateQueue;if(r.updateQueue=null,B!==null)try{d==="input"&&k.type==="radio"&&k.name!=null&&d0(_,k),Jm(d,w);var K=Jm(d,k);for(w=0;w<B.length;w+=2){var te=B[w],Z=B[w+1];te==="style"?y0(_,Z):te==="dangerouslySetInnerHTML"?m0(_,Z):te==="children"?Gc(_,Z):qg(_,te,Z,K)}switch(d){case"input":Gm(_,k);break;case"textarea":p0(_,k);break;case"select":var U=_._wrapperState.wasMultiple;_._wrapperState.wasMultiple=!!k.multiple;var Se=k.value;Se!=null?Ql(_,!!k.multiple,Se,!1):U!==!!k.multiple&&(k.defaultValue!=null?Ql(_,!!k.multiple,k.defaultValue,!0):Ql(_,!!k.multiple,k.multiple?[]:"",!1))}_[th]=k}catch(ke){xr(r,r.return,ke)}}break;case 6:if(ji(s,r),ls(r),m&4){if(r.stateNode===null)throw Error(Le(162));_=r.stateNode,k=r.memoizedProps;try{_.nodeValue=k}catch(ke){xr(r,r.return,ke)}}break;case 3:if(ji(s,r),ls(r),m&4&&l!==null&&l.memoizedState.isDehydrated)try{Kc(s.containerInfo)}catch(ke){xr(r,r.return,ke)}break;case 4:ji(s,r),ls(r);break;case 13:ji(s,r),ls(r),_=r.child,_.flags&8192&&(k=_.memoizedState!==null,_.stateNode.isHidden=k,!k||_.alternate!==null&&_.alternate.memoizedState!==null||(ky=Sr())),m&4&&xx(r);break;case 22:if(te=l!==null&&l.memoizedState!==null,r.mode&1?(_n=(K=_n)||te,ji(s,r),_n=K):ji(s,r),ls(r),m&8192){if(K=r.memoizedState!==null,(r.stateNode.isHidden=K)&&!te&&r.mode&1)for(it=r,te=r.child;te!==null;){for(Z=it=te;it!==null;){switch(U=it,Se=U.child,U.tag){case 0:case 11:case 14:case 15:Uc(4,U,U.return);break;case 1:Jl(U,U.return);var be=U.stateNode;if(typeof be.componentWillUnmount=="function"){m=U,l=U.return;try{s=m,be.props=s.memoizedProps,be.state=s.memoizedState,be.componentWillUnmount()}catch(ke){xr(m,l,ke)}}break;case 5:Jl(U,U.return);break;case 22:if(U.memoizedState!==null){bx(Z);continue}}Se!==null?(Se.return=U,it=Se):bx(Z)}te=te.sibling}e:for(te=null,Z=r;;){if(Z.tag===5){if(te===null){te=Z;try{_=Z.stateNode,K?(k=_.style,typeof k.setProperty=="function"?k.setProperty("display","none","important"):k.display="none"):(d=Z.stateNode,B=Z.memoizedProps.style,w=B!=null&&B.hasOwnProperty("display")?B.display:null,d.style.display=g0("display",w))}catch(ke){xr(r,r.return,ke)}}}else if(Z.tag===6){if(te===null)try{Z.stateNode.nodeValue=K?"":Z.memoizedProps}catch(ke){xr(r,r.return,ke)}}else if((Z.tag!==22&&Z.tag!==23||Z.memoizedState===null||Z===r)&&Z.child!==null){Z.child.return=Z,Z=Z.child;continue}if(Z===r)break e;for(;Z.sibling===null;){if(Z.return===null||Z.return===r)break e;te===Z&&(te=null),Z=Z.return}te===Z&&(te=null),Z.sibling.return=Z.return,Z=Z.sibling}}break;case 19:ji(s,r),ls(r),m&4&&xx(r);break;case 21:break;default:ji(s,r),ls(r)}}function ls(r){var s=r.flags;if(s&2){try{e:{for(var l=r.return;l!==null;){if(U1(l)){var m=l;break e}l=l.return}throw Error(Le(160))}switch(m.tag){case 5:var _=m.stateNode;m.flags&32&&(Gc(_,""),m.flags&=-33);var k=vx(r);Cg(r,k,_);break;case 3:case 4:var w=m.stateNode.containerInfo,d=vx(r);Ig(r,d,w);break;default:throw Error(Le(161))}}catch(B){xr(r,r.return,B)}r.flags&=-3}s&4096&&(r.flags&=-4097)}function Mk(r,s,l){it=r,q1(r)}function q1(r,s,l){for(var m=(r.mode&1)!==0;it!==null;){var _=it,k=_.child;if(_.tag===22&&m){var w=_.memoizedState!==null||Ld;if(!w){var d=_.alternate,B=d!==null&&d.memoizedState!==null||_n;d=Ld;var K=_n;if(Ld=w,(_n=B)&&!K)for(it=_;it!==null;)w=it,B=w.child,w.tag===22&&w.memoizedState!==null?Sx(_):B!==null?(B.return=w,it=B):Sx(_);for(;k!==null;)it=k,q1(k),k=k.sibling;it=_,Ld=d,_n=K}wx(r)}else _.subtreeFlags&8772&&k!==null?(k.return=_,it=k):wx(r)}}function wx(r){for(;it!==null;){var s=it;if(s.flags&8772){var l=s.alternate;try{if(s.flags&8772)switch(s.tag){case 0:case 11:case 15:_n||Fp(5,s);break;case 1:var m=s.stateNode;if(s.flags&4&&!_n)if(l===null)m.componentDidMount();else{var _=s.elementType===s.type?l.memoizedProps:Vi(s.type,l.memoizedProps);m.componentDidUpdate(_,l.memoizedState,m.__reactInternalSnapshotBeforeUpdate)}var k=s.updateQueue;k!==null&&sx(s,k,m);break;case 3:var w=s.updateQueue;if(w!==null){if(l=null,s.child!==null)switch(s.child.tag){case 5:l=s.child.stateNode;break;case 1:l=s.child.stateNode}sx(s,w,l)}break;case 5:var d=s.stateNode;if(l===null&&s.flags&4){l=d;var B=s.memoizedProps;switch(s.type){case"button":case"input":case"select":case"textarea":B.autoFocus&&l.focus();break;case"img":B.src&&(l.src=B.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(s.memoizedState===null){var K=s.alternate;if(K!==null){var te=K.memoizedState;if(te!==null){var Z=te.dehydrated;Z!==null&&Kc(Z)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Le(163))}_n||s.flags&512&&Tg(s)}catch(U){xr(s,s.return,U)}}if(s===r){it=null;break}if(l=s.sibling,l!==null){l.return=s.return,it=l;break}it=s.return}}function bx(r){for(;it!==null;){var s=it;if(s===r){it=null;break}var l=s.sibling;if(l!==null){l.return=s.return,it=l;break}it=s.return}}function Sx(r){for(;it!==null;){var s=it;try{switch(s.tag){case 0:case 11:case 15:var l=s.return;try{Fp(4,s)}catch(B){xr(s,l,B)}break;case 1:var m=s.stateNode;if(typeof m.componentDidMount=="function"){var _=s.return;try{m.componentDidMount()}catch(B){xr(s,_,B)}}var k=s.return;try{Tg(s)}catch(B){xr(s,k,B)}break;case 5:var w=s.return;try{Tg(s)}catch(B){xr(s,w,B)}}}catch(B){xr(s,s.return,B)}if(s===r){it=null;break}var d=s.sibling;if(d!==null){d.return=s.return,it=d;break}it=s.return}}var zk=Math.ceil,yp=Gs.ReactCurrentDispatcher,by=Gs.ReactCurrentOwner,Pi=Gs.ReactCurrentBatchConfig,Ft=0,Gr=null,Pr=null,tn=0,li=0,Yl=Wo(0),Rr=0,ah=null,Na=0,Bp=0,Sy=0,$c=null,Un=null,ky=0,hu=1/0,Ls=null,_p=!1,Eg=null,Vo=null,Rd=!1,Ro=null,vp=0,Zc=0,Pg=null,Xd=-1,Kd=0;function Mn(){return Ft&6?Sr():Xd!==-1?Xd:Xd=Sr()}function Uo(r){return r.mode&1?Ft&2&&tn!==0?tn&-tn:fk.transition!==null?(Kd===0&&(Kd=P0()),Kd):(r=Ht,r!==0||(r=window.event,r=r===void 0?16:F0(r.type)),r):1}function Gi(r,s,l,m){if(50<Zc)throw Zc=0,Pg=null,Error(Le(185));dh(r,l,m),(!(Ft&2)||r!==Gr)&&(r===Gr&&(!(Ft&2)&&(Bp|=l),Rr===4&&Do(r,tn)),Gn(r,m),l===1&&Ft===0&&!(s.mode&1)&&(hu=Sr()+500,Dp&&Xo()))}function Gn(r,s){var l=r.callbackNode;fS(r,s);var m=rp(r,r===Gr?tn:0);if(m===0)l!==null&&Av(l),r.callbackNode=null,r.callbackPriority=0;else if(s=m&-m,r.callbackPriority!==s){if(l!=null&&Av(l),s===1)r.tag===0?pk(kx.bind(null,r)):t1(kx.bind(null,r)),uk(function(){!(Ft&6)&&Xo()}),l=null;else{switch(M0(m)){case 1:l=Kg;break;case 4:l=C0;break;case 16:l=tp;break;case 536870912:l=E0;break;default:l=tp}l=Q1(l,G1.bind(null,r))}r.callbackPriority=s,r.callbackNode=l}}function G1(r,s){if(Xd=-1,Kd=0,Ft&6)throw Error(Le(327));var l=r.callbackNode;if(iu()&&r.callbackNode!==l)return null;var m=rp(r,r===Gr?tn:0);if(m===0)return null;if(m&30||m&r.expiredLanes||s)s=xp(r,m);else{s=m;var _=Ft;Ft|=2;var k=W1();(Gr!==r||tn!==s)&&(Ls=null,hu=Sr()+500,La(r,s));do try{Lk();break}catch(d){H1(r,d)}while(!0);uy(),yp.current=k,Ft=_,Pr!==null?s=0:(Gr=null,tn=0,s=Rr)}if(s!==0){if(s===2&&(_=rg(r),_!==0&&(m=_,s=Mg(r,_))),s===1)throw l=ah,La(r,0),Do(r,m),Gn(r,Sr()),l;if(s===6)Do(r,m);else{if(_=r.current.alternate,!(m&30)&&!Ak(_)&&(s=xp(r,m),s===2&&(k=rg(r),k!==0&&(m=k,s=Mg(r,k))),s===1))throw l=ah,La(r,0),Do(r,m),Gn(r,Sr()),l;switch(r.finishedWork=_,r.finishedLanes=m,s){case 0:case 1:throw Error(Le(345));case 2:Pa(r,Un,Ls);break;case 3:if(Do(r,m),(m&130023424)===m&&(s=ky+500-Sr(),10<s)){if(rp(r,0)!==0)break;if(_=r.suspendedLanes,(_&m)!==m){Mn(),r.pingedLanes|=r.suspendedLanes&_;break}r.timeoutHandle=cg(Pa.bind(null,r,Un,Ls),s);break}Pa(r,Un,Ls);break;case 4:if(Do(r,m),(m&4194240)===m)break;for(s=r.eventTimes,_=-1;0<m;){var w=31-qi(m);k=1<<w,w=s[w],w>_&&(_=w),m&=~k}if(m=_,m=Sr()-m,m=(120>m?120:480>m?480:1080>m?1080:1920>m?1920:3e3>m?3e3:4320>m?4320:1960*zk(m/1960))-m,10<m){r.timeoutHandle=cg(Pa.bind(null,r,Un,Ls),m);break}Pa(r,Un,Ls);break;case 5:Pa(r,Un,Ls);break;default:throw Error(Le(329))}}}return Gn(r,Sr()),r.callbackNode===l?G1.bind(null,r):null}function Mg(r,s){var l=$c;return r.current.memoizedState.isDehydrated&&(La(r,s).flags|=256),r=xp(r,s),r!==2&&(s=Un,Un=l,s!==null&&zg(s)),r}function zg(r){Un===null?Un=r:Un.push.apply(Un,r)}function Ak(r){for(var s=r;;){if(s.flags&16384){var l=s.updateQueue;if(l!==null&&(l=l.stores,l!==null))for(var m=0;m<l.length;m++){var _=l[m],k=_.getSnapshot;_=_.value;try{if(!Hi(k(),_))return!1}catch{return!1}}}if(l=s.child,s.subtreeFlags&16384&&l!==null)l.return=s,s=l;else{if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Do(r,s){for(s&=~Sy,s&=~Bp,r.suspendedLanes|=s,r.pingedLanes&=~s,r=r.expirationTimes;0<s;){var l=31-qi(s),m=1<<l;r[l]=-1,s&=~m}}function kx(r){if(Ft&6)throw Error(Le(327));iu();var s=rp(r,0);if(!(s&1))return Gn(r,Sr()),null;var l=xp(r,s);if(r.tag!==0&&l===2){var m=rg(r);m!==0&&(s=m,l=Mg(r,m))}if(l===1)throw l=ah,La(r,0),Do(r,s),Gn(r,Sr()),l;if(l===6)throw Error(Le(345));return r.finishedWork=r.current.alternate,r.finishedLanes=s,Pa(r,Un,Ls),Gn(r,Sr()),null}function Ty(r,s){var l=Ft;Ft|=1;try{return r(s)}finally{Ft=l,Ft===0&&(hu=Sr()+500,Dp&&Xo())}}function ja(r){Ro!==null&&Ro.tag===0&&!(Ft&6)&&iu();var s=Ft;Ft|=1;var l=Pi.transition,m=Ht;try{if(Pi.transition=null,Ht=1,r)return r()}finally{Ht=m,Pi.transition=l,Ft=s,!(Ft&6)&&Xo()}}function Iy(){li=Yl.current,or(Yl)}function La(r,s){r.finishedWork=null,r.finishedLanes=0;var l=r.timeoutHandle;if(l!==-1&&(r.timeoutHandle=-1,lk(l)),Pr!==null)for(l=Pr.return;l!==null;){var m=l;switch(oy(m),m.tag){case 1:m=m.type.childContextTypes,m!=null&&ap();break;case 3:uu(),or(Zn),or(vn),my();break;case 5:fy(m);break;case 4:uu();break;case 13:or(pr);break;case 19:or(pr);break;case 10:cy(m.type._context);break;case 22:case 23:Iy()}l=l.return}if(Gr=r,Pr=r=$o(r.current,null),tn=li=s,Rr=0,ah=null,Sy=Bp=Na=0,Un=$c=null,Aa!==null){for(s=0;s<Aa.length;s++)if(l=Aa[s],m=l.interleaved,m!==null){l.interleaved=null;var _=m.next,k=l.pending;if(k!==null){var w=k.next;k.next=_,m.next=w}l.pending=m}Aa=null}return r}function H1(r,s){do{var l=Pr;try{if(uy(),Gd.current=gp,mp){for(var m=fr.memoizedState;m!==null;){var _=m.queue;_!==null&&(_.pending=null),m=m.next}mp=!1}if(Oa=0,qr=Lr=fr=null,Vc=!1,ih=0,by.current=null,l===null||l.return===null){Rr=1,ah=s,Pr=null;break}e:{var k=r,w=l.return,d=l,B=s;if(s=tn,d.flags|=32768,B!==null&&typeof B=="object"&&typeof B.then=="function"){var K=B,te=d,Z=te.tag;if(!(te.mode&1)&&(Z===0||Z===11||Z===15)){var U=te.alternate;U?(te.updateQueue=U.updateQueue,te.memoizedState=U.memoizedState,te.lanes=U.lanes):(te.updateQueue=null,te.memoizedState=null)}var Se=hx(w);if(Se!==null){Se.flags&=-257,dx(Se,w,d,k,s),Se.mode&1&&cx(k,K,s),s=Se,B=K;var be=s.updateQueue;if(be===null){var ke=new Set;ke.add(B),s.updateQueue=ke}else be.add(B);break e}else{if(!(s&1)){cx(k,K,s),Cy();break e}B=Error(Le(426))}}else if(cr&&d.mode&1){var Pe=hx(w);if(Pe!==null){!(Pe.flags&65536)&&(Pe.flags|=256),dx(Pe,w,d,k,s),ay(cu(B,d));break e}}k=B=cu(B,d),Rr!==4&&(Rr=2),$c===null?$c=[k]:$c.push(k),k=w;do{switch(k.tag){case 3:k.flags|=65536,s&=-s,k.lanes|=s;var ne=M1(k,B,s);ix(k,ne);break e;case 1:d=B;var q=k.type,re=k.stateNode;if(!(k.flags&128)&&(typeof q.getDerivedStateFromError=="function"||re!==null&&typeof re.componentDidCatch=="function"&&(Vo===null||!Vo.has(re)))){k.flags|=65536,s&=-s,k.lanes|=s;var de=z1(k,d,s);ix(k,de);break e}}k=k.return}while(k!==null)}K1(l)}catch(ye){s=ye,Pr===l&&l!==null&&(Pr=l=l.return);continue}break}while(!0)}function W1(){var r=yp.current;return yp.current=gp,r===null?gp:r}function Cy(){(Rr===0||Rr===3||Rr===2)&&(Rr=4),Gr===null||!(Na&268435455)&&!(Bp&268435455)||Do(Gr,tn)}function xp(r,s){var l=Ft;Ft|=2;var m=W1();(Gr!==r||tn!==s)&&(Ls=null,La(r,s));do try{Dk();break}catch(_){H1(r,_)}while(!0);if(uy(),Ft=l,yp.current=m,Pr!==null)throw Error(Le(261));return Gr=null,tn=0,Rr}function Dk(){for(;Pr!==null;)X1(Pr)}function Lk(){for(;Pr!==null&&!sS();)X1(Pr)}function X1(r){var s=Y1(r.alternate,r,li);r.memoizedProps=r.pendingProps,s===null?K1(r):Pr=s,by.current=null}function K1(r){var s=r;do{var l=s.alternate;if(r=s.return,s.flags&32768){if(l=Ck(l,s),l!==null){l.flags&=32767,Pr=l;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{Rr=6,Pr=null;return}}else if(l=Ik(l,s,li),l!==null){Pr=l;return}if(s=s.sibling,s!==null){Pr=s;return}Pr=s=r}while(s!==null);Rr===0&&(Rr=5)}function Pa(r,s,l){var m=Ht,_=Pi.transition;try{Pi.transition=null,Ht=1,Rk(r,s,l,m)}finally{Pi.transition=_,Ht=m}return null}function Rk(r,s,l,m){do iu();while(Ro!==null);if(Ft&6)throw Error(Le(327));l=r.finishedWork;var _=r.finishedLanes;if(l===null)return null;if(r.finishedWork=null,r.finishedLanes=0,l===r.current)throw Error(Le(177));r.callbackNode=null,r.callbackPriority=0;var k=l.lanes|l.childLanes;if(mS(r,k),r===Gr&&(Pr=Gr=null,tn=0),!(l.subtreeFlags&2064)&&!(l.flags&2064)||Rd||(Rd=!0,Q1(tp,function(){return iu(),null})),k=(l.flags&15990)!==0,l.subtreeFlags&15990||k){k=Pi.transition,Pi.transition=null;var w=Ht;Ht=1;var d=Ft;Ft|=4,by.current=null,Pk(r,l),Z1(l,r),tk(lg),np=!!ag,lg=ag=null,r.current=l,Mk(l),oS(),Ft=d,Ht=w,Pi.transition=k}else r.current=l;if(Rd&&(Rd=!1,Ro=r,vp=_),k=r.pendingLanes,k===0&&(Vo=null),uS(l.stateNode),Gn(r,Sr()),s!==null)for(m=r.onRecoverableError,l=0;l<s.length;l++)_=s[l],m(_.value,{componentStack:_.stack,digest:_.digest});if(_p)throw _p=!1,r=Eg,Eg=null,r;return vp&1&&r.tag!==0&&iu(),k=r.pendingLanes,k&1?r===Pg?Zc++:(Zc=0,Pg=r):Zc=0,Xo(),null}function iu(){if(Ro!==null){var r=M0(vp),s=Pi.transition,l=Ht;try{if(Pi.transition=null,Ht=16>r?16:r,Ro===null)var m=!1;else{if(r=Ro,Ro=null,vp=0,Ft&6)throw Error(Le(331));var _=Ft;for(Ft|=4,it=r.current;it!==null;){var k=it,w=k.child;if(it.flags&16){var d=k.deletions;if(d!==null){for(var B=0;B<d.length;B++){var K=d[B];for(it=K;it!==null;){var te=it;switch(te.tag){case 0:case 11:case 15:Uc(8,te,k)}var Z=te.child;if(Z!==null)Z.return=te,it=Z;else for(;it!==null;){te=it;var U=te.sibling,Se=te.return;if(V1(te),te===K){it=null;break}if(U!==null){U.return=Se,it=U;break}it=Se}}}var be=k.alternate;if(be!==null){var ke=be.child;if(ke!==null){be.child=null;do{var Pe=ke.sibling;ke.sibling=null,ke=Pe}while(ke!==null)}}it=k}}if(k.subtreeFlags&2064&&w!==null)w.return=k,it=w;else e:for(;it!==null;){if(k=it,k.flags&2048)switch(k.tag){case 0:case 11:case 15:Uc(9,k,k.return)}var ne=k.sibling;if(ne!==null){ne.return=k.return,it=ne;break e}it=k.return}}var q=r.current;for(it=q;it!==null;){w=it;var re=w.child;if(w.subtreeFlags&2064&&re!==null)re.return=w,it=re;else e:for(w=q;it!==null;){if(d=it,d.flags&2048)try{switch(d.tag){case 0:case 11:case 15:Fp(9,d)}}catch(ye){xr(d,d.return,ye)}if(d===w){it=null;break e}var de=d.sibling;if(de!==null){de.return=d.return,it=de;break e}it=d.return}}if(Ft=_,Xo(),hs&&typeof hs.onPostCommitFiberRoot=="function")try{hs.onPostCommitFiberRoot(Ep,r)}catch{}m=!0}return m}finally{Ht=l,Pi.transition=s}}return!1}function Tx(r,s,l){s=cu(l,s),s=M1(r,s,1),r=jo(r,s,1),s=Mn(),r!==null&&(dh(r,1,s),Gn(r,s))}function xr(r,s,l){if(r.tag===3)Tx(r,r,l);else for(;s!==null;){if(s.tag===3){Tx(s,r,l);break}else if(s.tag===1){var m=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(Vo===null||!Vo.has(m))){r=cu(l,r),r=z1(s,r,1),s=jo(s,r,1),r=Mn(),s!==null&&(dh(s,1,r),Gn(s,r));break}}s=s.return}}function Fk(r,s,l){var m=r.pingCache;m!==null&&m.delete(s),s=Mn(),r.pingedLanes|=r.suspendedLanes&l,Gr===r&&(tn&l)===l&&(Rr===4||Rr===3&&(tn&130023424)===tn&&500>Sr()-ky?La(r,0):Sy|=l),Gn(r,s)}function J1(r,s){s===0&&(r.mode&1?(s=Td,Td<<=1,!(Td&130023424)&&(Td=4194304)):s=1);var l=Mn();r=$s(r,s),r!==null&&(dh(r,s,l),Gn(r,l))}function Bk(r){var s=r.memoizedState,l=0;s!==null&&(l=s.retryLane),J1(r,l)}function Ok(r,s){var l=0;switch(r.tag){case 13:var m=r.stateNode,_=r.memoizedState;_!==null&&(l=_.retryLane);break;case 19:m=r.stateNode;break;default:throw Error(Le(314))}m!==null&&m.delete(s),J1(r,l)}var Y1;Y1=function(r,s,l){if(r!==null)if(r.memoizedProps!==s.pendingProps||Zn.current)$n=!0;else{if(!(r.lanes&l)&&!(s.flags&128))return $n=!1,Tk(r,s,l);$n=!!(r.flags&131072)}else $n=!1,cr&&s.flags&1048576&&r1(s,cp,s.index);switch(s.lanes=0,s.tag){case 2:var m=s.type;Wd(r,s),r=s.pendingProps;var _=ou(s,vn.current);nu(s,l),_=yy(null,s,m,r,_,l);var k=_y();return s.flags|=1,typeof _=="object"&&_!==null&&typeof _.render=="function"&&_.$$typeof===void 0?(s.tag=1,s.memoizedState=null,s.updateQueue=null,qn(m)?(k=!0,lp(s)):k=!1,s.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,dy(s),_.updater=Rp,s.stateNode=_,_._reactInternals=s,yg(s,m,r,l),s=xg(null,s,m,!0,k,l)):(s.tag=0,cr&&k&&sy(s),Pn(null,s,_,l),s=s.child),s;case 16:m=s.elementType;e:{switch(Wd(r,s),r=s.pendingProps,_=m._init,m=_(m._payload),s.type=m,_=s.tag=jk(m),r=Vi(m,r),_){case 0:s=vg(null,s,m,r,l);break e;case 1:s=mx(null,s,m,r,l);break e;case 11:s=px(null,s,m,r,l);break e;case 14:s=fx(null,s,m,Vi(m.type,r),l);break e}throw Error(Le(306,m,""))}return s;case 0:return m=s.type,_=s.pendingProps,_=s.elementType===m?_:Vi(m,_),vg(r,s,m,_,l);case 1:return m=s.type,_=s.pendingProps,_=s.elementType===m?_:Vi(m,_),mx(r,s,m,_,l);case 3:e:{if(R1(s),r===null)throw Error(Le(387));m=s.pendingProps,k=s.memoizedState,_=k.element,l1(r,s),pp(s,m,null,l);var w=s.memoizedState;if(m=w.element,k.isDehydrated)if(k={element:m,isDehydrated:!1,cache:w.cache,pendingSuspenseBoundaries:w.pendingSuspenseBoundaries,transitions:w.transitions},s.updateQueue.baseState=k,s.memoizedState=k,s.flags&256){_=cu(Error(Le(423)),s),s=gx(r,s,m,l,_);break e}else if(m!==_){_=cu(Error(Le(424)),s),s=gx(r,s,m,l,_);break e}else for(ui=No(s.stateNode.containerInfo.firstChild),ci=s,cr=!0,$i=null,l=o1(s,null,m,l),s.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(au(),m===_){s=Zs(r,s,l);break e}Pn(r,s,m,l)}s=s.child}return s;case 5:return u1(s),r===null&&fg(s),m=s.type,_=s.pendingProps,k=r!==null?r.memoizedProps:null,w=_.children,ug(m,_)?w=null:k!==null&&ug(m,k)&&(s.flags|=32),L1(r,s),Pn(r,s,w,l),s.child;case 6:return r===null&&fg(s),null;case 13:return F1(r,s,l);case 4:return py(s,s.stateNode.containerInfo),m=s.pendingProps,r===null?s.child=lu(s,null,m,l):Pn(r,s,m,l),s.child;case 11:return m=s.type,_=s.pendingProps,_=s.elementType===m?_:Vi(m,_),px(r,s,m,_,l);case 7:return Pn(r,s,s.pendingProps,l),s.child;case 8:return Pn(r,s,s.pendingProps.children,l),s.child;case 12:return Pn(r,s,s.pendingProps.children,l),s.child;case 10:e:{if(m=s.type._context,_=s.pendingProps,k=s.memoizedProps,w=_.value,er(hp,m._currentValue),m._currentValue=w,k!==null)if(Hi(k.value,w)){if(k.children===_.children&&!Zn.current){s=Zs(r,s,l);break e}}else for(k=s.child,k!==null&&(k.return=s);k!==null;){var d=k.dependencies;if(d!==null){w=k.child;for(var B=d.firstContext;B!==null;){if(B.context===m){if(k.tag===1){B=Ns(-1,l&-l),B.tag=2;var K=k.updateQueue;if(K!==null){K=K.shared;var te=K.pending;te===null?B.next=B:(B.next=te.next,te.next=B),K.pending=B}}k.lanes|=l,B=k.alternate,B!==null&&(B.lanes|=l),mg(k.return,l,s),d.lanes|=l;break}B=B.next}}else if(k.tag===10)w=k.type===s.type?null:k.child;else if(k.tag===18){if(w=k.return,w===null)throw Error(Le(341));w.lanes|=l,d=w.alternate,d!==null&&(d.lanes|=l),mg(w,l,s),w=k.sibling}else w=k.child;if(w!==null)w.return=k;else for(w=k;w!==null;){if(w===s){w=null;break}if(k=w.sibling,k!==null){k.return=w.return,w=k;break}w=w.return}k=w}Pn(r,s,_.children,l),s=s.child}return s;case 9:return _=s.type,m=s.pendingProps.children,nu(s,l),_=Mi(_),m=m(_),s.flags|=1,Pn(r,s,m,l),s.child;case 14:return m=s.type,_=Vi(m,s.pendingProps),_=Vi(m.type,_),fx(r,s,m,_,l);case 15:return A1(r,s,s.type,s.pendingProps,l);case 17:return m=s.type,_=s.pendingProps,_=s.elementType===m?_:Vi(m,_),Wd(r,s),s.tag=1,qn(m)?(r=!0,lp(s)):r=!1,nu(s,l),P1(s,m,_),yg(s,m,_,l),xg(null,s,m,!0,r,l);case 19:return B1(r,s,l);case 22:return D1(r,s,l)}throw Error(Le(156,s.tag))};function Q1(r,s){return I0(r,s)}function Nk(r,s,l,m){this.tag=r,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ei(r,s,l,m){return new Nk(r,s,l,m)}function Ey(r){return r=r.prototype,!(!r||!r.isReactComponent)}function jk(r){if(typeof r=="function")return Ey(r)?1:0;if(r!=null){if(r=r.$$typeof,r===Hg)return 11;if(r===Wg)return 14}return 2}function $o(r,s){var l=r.alternate;return l===null?(l=Ei(r.tag,s,r.key,r.mode),l.elementType=r.elementType,l.type=r.type,l.stateNode=r.stateNode,l.alternate=r,r.alternate=l):(l.pendingProps=s,l.type=r.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=r.flags&14680064,l.childLanes=r.childLanes,l.lanes=r.lanes,l.child=r.child,l.memoizedProps=r.memoizedProps,l.memoizedState=r.memoizedState,l.updateQueue=r.updateQueue,s=r.dependencies,l.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},l.sibling=r.sibling,l.index=r.index,l.ref=r.ref,l}function Jd(r,s,l,m,_,k){var w=2;if(m=r,typeof r=="function")Ey(r)&&(w=1);else if(typeof r=="string")w=5;else e:switch(r){case Ul:return Ra(l.children,_,k,s);case Gg:w=8,_|=8;break;case Vm:return r=Ei(12,l,s,_|2),r.elementType=Vm,r.lanes=k,r;case Um:return r=Ei(13,l,s,_),r.elementType=Um,r.lanes=k,r;case $m:return r=Ei(19,l,s,_),r.elementType=$m,r.lanes=k,r;case u0:return Op(l,_,k,s);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case a0:w=10;break e;case l0:w=9;break e;case Hg:w=11;break e;case Wg:w=14;break e;case Mo:w=16,m=null;break e}throw Error(Le(130,r==null?r:typeof r,""))}return s=Ei(w,l,s,_),s.elementType=r,s.type=m,s.lanes=k,s}function Ra(r,s,l,m){return r=Ei(7,r,m,s),r.lanes=l,r}function Op(r,s,l,m){return r=Ei(22,r,m,s),r.elementType=u0,r.lanes=l,r.stateNode={isHidden:!1},r}function Am(r,s,l){return r=Ei(6,r,null,s),r.lanes=l,r}function Dm(r,s,l){return s=Ei(4,r.children!==null?r.children:[],r.key,s),s.lanes=l,s.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},s}function Vk(r,s,l,m,_){this.tag=s,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=pm(0),this.expirationTimes=pm(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=pm(0),this.identifierPrefix=m,this.onRecoverableError=_,this.mutableSourceEagerHydrationData=null}function Py(r,s,l,m,_,k,w,d,B){return r=new Vk(r,s,l,d,B),s===1?(s=1,k===!0&&(s|=8)):s=0,k=Ei(3,null,null,s),r.current=k,k.stateNode=r,k.memoizedState={element:m,isDehydrated:l,cache:null,transitions:null,pendingSuspenseBoundaries:null},dy(k),r}function Uk(r,s,l){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Vl,key:m==null?null:""+m,children:r,containerInfo:s,implementation:l}}function ew(r){if(!r)return qo;r=r._reactInternals;e:{if(Za(r)!==r||r.tag!==1)throw Error(Le(170));var s=r;do{switch(s.tag){case 3:s=s.stateNode.context;break e;case 1:if(qn(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break e}}s=s.return}while(s!==null);throw Error(Le(171))}if(r.tag===1){var l=r.type;if(qn(l))return e1(r,l,s)}return s}function tw(r,s,l,m,_,k,w,d,B){return r=Py(l,m,!0,r,_,k,w,d,B),r.context=ew(null),l=r.current,m=Mn(),_=Uo(l),k=Ns(m,_),k.callback=s??null,jo(l,k,_),r.current.lanes=_,dh(r,_,m),Gn(r,m),r}function Np(r,s,l,m){var _=s.current,k=Mn(),w=Uo(_);return l=ew(l),s.context===null?s.context=l:s.pendingContext=l,s=Ns(k,w),s.payload={element:r},m=m===void 0?null:m,m!==null&&(s.callback=m),r=jo(_,s,w),r!==null&&(Gi(r,_,w,k),qd(r,_,w)),w}function wp(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function Ix(r,s){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var l=r.retryLane;r.retryLane=l!==0&&l<s?l:s}}function My(r,s){Ix(r,s),(r=r.alternate)&&Ix(r,s)}function $k(){return null}var rw=typeof reportError=="function"?reportError:function(r){console.error(r)};function zy(r){this._internalRoot=r}jp.prototype.render=zy.prototype.render=function(r){var s=this._internalRoot;if(s===null)throw Error(Le(409));Np(r,s,null,null)};jp.prototype.unmount=zy.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var s=r.containerInfo;ja(function(){Np(null,r,null,null)}),s[Us]=null}};function jp(r){this._internalRoot=r}jp.prototype.unstable_scheduleHydration=function(r){if(r){var s=D0();r={blockedOn:null,target:r,priority:s};for(var l=0;l<Ao.length&&s!==0&&s<Ao[l].priority;l++);Ao.splice(l,0,r),l===0&&R0(r)}};function Ay(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function Vp(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function Cx(){}function Zk(r,s,l,m,_){if(_){if(typeof m=="function"){var k=m;m=function(){var K=wp(w);k.call(K)}}var w=tw(s,m,r,0,null,!1,!1,"",Cx);return r._reactRootContainer=w,r[Us]=w.current,Qc(r.nodeType===8?r.parentNode:r),ja(),w}for(;_=r.lastChild;)r.removeChild(_);if(typeof m=="function"){var d=m;m=function(){var K=wp(B);d.call(K)}}var B=Py(r,0,!1,null,null,!1,!1,"",Cx);return r._reactRootContainer=B,r[Us]=B.current,Qc(r.nodeType===8?r.parentNode:r),ja(function(){Np(s,B,l,m)}),B}function Up(r,s,l,m,_){var k=l._reactRootContainer;if(k){var w=k;if(typeof _=="function"){var d=_;_=function(){var B=wp(w);d.call(B)}}Np(s,w,r,_)}else w=Zk(l,s,r,_,m);return wp(w)}z0=function(r){switch(r.tag){case 3:var s=r.stateNode;if(s.current.memoizedState.isDehydrated){var l=Dc(s.pendingLanes);l!==0&&(Jg(s,l|1),Gn(s,Sr()),!(Ft&6)&&(hu=Sr()+500,Xo()))}break;case 13:ja(function(){var m=$s(r,1);if(m!==null){var _=Mn();Gi(m,r,1,_)}}),My(r,1)}};Yg=function(r){if(r.tag===13){var s=$s(r,134217728);if(s!==null){var l=Mn();Gi(s,r,134217728,l)}My(r,134217728)}};A0=function(r){if(r.tag===13){var s=Uo(r),l=$s(r,s);if(l!==null){var m=Mn();Gi(l,r,s,m)}My(r,s)}};D0=function(){return Ht};L0=function(r,s){var l=Ht;try{return Ht=r,s()}finally{Ht=l}};Qm=function(r,s,l){switch(s){case"input":if(Gm(r,l),s=l.name,l.type==="radio"&&s!=null){for(l=r;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll("input[name="+JSON.stringify(""+s)+'][type="radio"]'),s=0;s<l.length;s++){var m=l[s];if(m!==r&&m.form===r.form){var _=Ap(m);if(!_)throw Error(Le(90));h0(m),Gm(m,_)}}}break;case"textarea":p0(r,l);break;case"select":s=l.value,s!=null&&Ql(r,!!l.multiple,s,!1)}};x0=Ty;w0=ja;var qk={usingClientEntryPoint:!1,Events:[fh,Gl,Ap,_0,v0,Ty]},Mc={findFiberByHostInstance:za,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Gk={bundleType:Mc.bundleType,version:Mc.version,rendererPackageName:Mc.rendererPackageName,rendererConfig:Mc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Gs.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=k0(r),r===null?null:r.stateNode},findFiberByHostInstance:Mc.findFiberByHostInstance||$k,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Fd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Fd.isDisabled&&Fd.supportsFiber)try{Ep=Fd.inject(Gk),hs=Fd}catch{}}pi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=qk;pi.createPortal=function(r,s){var l=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ay(s))throw Error(Le(200));return Uk(r,s,null,l)};pi.createRoot=function(r,s){if(!Ay(r))throw Error(Le(299));var l=!1,m="",_=rw;return s!=null&&(s.unstable_strictMode===!0&&(l=!0),s.identifierPrefix!==void 0&&(m=s.identifierPrefix),s.onRecoverableError!==void 0&&(_=s.onRecoverableError)),s=Py(r,1,!1,null,null,l,!1,m,_),r[Us]=s.current,Qc(r.nodeType===8?r.parentNode:r),new zy(s)};pi.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var s=r._reactInternals;if(s===void 0)throw typeof r.render=="function"?Error(Le(188)):(r=Object.keys(r).join(","),Error(Le(268,r)));return r=k0(s),r=r===null?null:r.stateNode,r};pi.flushSync=function(r){return ja(r)};pi.hydrate=function(r,s,l){if(!Vp(s))throw Error(Le(200));return Up(null,r,s,!0,l)};pi.hydrateRoot=function(r,s,l){if(!Ay(r))throw Error(Le(405));var m=l!=null&&l.hydratedSources||null,_=!1,k="",w=rw;if(l!=null&&(l.unstable_strictMode===!0&&(_=!0),l.identifierPrefix!==void 0&&(k=l.identifierPrefix),l.onRecoverableError!==void 0&&(w=l.onRecoverableError)),s=tw(s,null,r,1,l??null,_,!1,k,w),r[Us]=s.current,Qc(r),m)for(r=0;r<m.length;r++)l=m[r],_=l._getVersion,_=_(l._source),s.mutableSourceEagerHydrationData==null?s.mutableSourceEagerHydrationData=[l,_]:s.mutableSourceEagerHydrationData.push(l,_);return new jp(s)};pi.render=function(r,s,l){if(!Vp(s))throw Error(Le(200));return Up(null,r,s,!1,l)};pi.unmountComponentAtNode=function(r){if(!Vp(r))throw Error(Le(40));return r._reactRootContainer?(ja(function(){Up(null,null,r,!1,function(){r._reactRootContainer=null,r[Us]=null})}),!0):!1};pi.unstable_batchedUpdates=Ty;pi.unstable_renderSubtreeIntoContainer=function(r,s,l,m){if(!Vp(l))throw Error(Le(200));if(r==null||r._reactInternals===void 0)throw Error(Le(38));return Up(r,s,l,!1,m)};pi.version="18.3.1-next-f1338f8080-20240426";function nw(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(nw)}catch(r){console.error(r)}}nw(),n0.exports=pi;var Hk=n0.exports,Ex=Hk;Nm.createRoot=Ex.createRoot,Nm.hydrateRoot=Ex.hydrateRoot;var iw={exports:{}},sw={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gh=ft;function Wk(r,s){return r===s&&(r!==0||1/r===1/s)||r!==r&&s!==s}var Xk=typeof Object.is=="function"?Object.is:Wk,Kk=gh.useSyncExternalStore,Jk=gh.useRef,Yk=gh.useEffect,Qk=gh.useMemo,eT=gh.useDebugValue;sw.useSyncExternalStoreWithSelector=function(r,s,l,m,_){var k=Jk(null);if(k.current===null){var w={hasValue:!1,value:null};k.current=w}else w=k.current;k=Qk(function(){function B(Se){if(!K){if(K=!0,te=Se,Se=m(Se),_!==void 0&&w.hasValue){var be=w.value;if(_(be,Se))return Z=be}return Z=Se}if(be=Z,Xk(te,Se))return be;var ke=m(Se);return _!==void 0&&_(be,ke)?(te=Se,be):(te=Se,Z=ke)}var K=!1,te,Z,U=l===void 0?null:l;return[function(){return B(s())},U===null?void 0:function(){return B(U())}]},[s,l,m,_]);var d=Kk(r,k[0],k[1]);return Yk(function(){w.hasValue=!0,w.value=d},[d]),eT(d),d};iw.exports=sw;var tT=iw.exports;function rT(r){r()}function nT(){let r=null,s=null;return{clear(){r=null,s=null},notify(){rT(()=>{let l=r;for(;l;)l.callback(),l=l.next})},get(){const l=[];let m=r;for(;m;)l.push(m),m=m.next;return l},subscribe(l){let m=!0;const _=s={callback:l,next:null,prev:s};return _.prev?_.prev.next=_:r=_,function(){!m||r===null||(m=!1,_.next?_.next.prev=_.prev:s=_.prev,_.prev?_.prev.next=_.next:r=_.next)}}}}var Px={notify(){},get:()=>[]};function iT(r,s){let l,m=Px,_=0,k=!1;function w(ke){te();const Pe=m.subscribe(ke);let ne=!1;return()=>{ne||(ne=!0,Pe(),Z())}}function d(){m.notify()}function B(){be.onStateChange&&be.onStateChange()}function K(){return k}function te(){_++,l||(l=r.subscribe(B),m=nT())}function Z(){_--,l&&_===0&&(l(),l=void 0,m.clear(),m=Px)}function U(){k||(k=!0,te())}function Se(){k&&(k=!1,Z())}const be={addNestedSub:w,notifyNestedSubs:d,handleChangeWrapper:B,isSubscribed:K,trySubscribe:U,tryUnsubscribe:Se,getListeners:()=>m};return be}var sT=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",oT=sT(),aT=()=>typeof navigator<"u"&&navigator.product==="ReactNative",lT=aT(),uT=()=>oT||lT?ft.useLayoutEffect:ft.useEffect,cT=uT(),Lm=Symbol.for("react-redux-context"),Rm=typeof globalThis<"u"?globalThis:{};function hT(){if(!ft.createContext)return{};const r=Rm[Lm]??(Rm[Lm]=new Map);let s=r.get(ft.createContext);return s||(s=ft.createContext(null),r.set(ft.createContext,s)),s}var Go=hT();function dT(r){const{children:s,context:l,serverState:m,store:_}=r,k=ft.useMemo(()=>{const B=iT(_);return{store:_,subscription:B,getServerState:m?()=>m:void 0}},[_,m]),w=ft.useMemo(()=>_.getState(),[_]);cT(()=>{const{subscription:B}=k;return B.onStateChange=B.notifyNestedSubs,B.trySubscribe(),w!==_.getState()&&B.notifyNestedSubs(),()=>{B.tryUnsubscribe(),B.onStateChange=void 0}},[k,w]);const d=l||Go;return ft.createElement(d.Provider,{value:k},s)}var pT=dT;function Dy(r=Go){return function(){return ft.useContext(r)}}var ow=Dy();function aw(r=Go){const s=r===Go?ow:Dy(r),l=()=>{const{store:m}=s();return m};return Object.assign(l,{withTypes:()=>l}),l}var fT=aw();function mT(r=Go){const s=r===Go?fT:aw(r),l=()=>s().dispatch;return Object.assign(l,{withTypes:()=>l}),l}var Wi=mT(),gT=(r,s)=>r===s;function yT(r=Go){const s=r===Go?ow:Dy(r),l=(m,_={})=>{const{equalityFn:k=gT}=typeof _=="function"?{equalityFn:_}:_,w=s(),{store:d,subscription:B,getServerState:K}=w;ft.useRef(!0);const te=ft.useCallback({[m.name](U){return m(U)}}[m.name],[m]),Z=tT.useSyncExternalStoreWithSelector(B.addNestedSub,d.getState,K||d.getState,te,k);return ft.useDebugValue(Z),Z};return Object.assign(l,{withTypes:()=>l}),l}var sr=yT();function Qr(r){return`Minified Redux error #${r}; visit https://redux.js.org/Errors?code=${r} for the full message or use the non-minified dev environment for full errors. `}var _T=typeof Symbol=="function"&&Symbol.observable||"@@observable",Mx=_T,Fm=()=>Math.random().toString(36).substring(7).split("").join("."),vT={INIT:`@@redux/INIT${Fm()}`,REPLACE:`@@redux/REPLACE${Fm()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${Fm()}`},bp=vT;function Ly(r){if(typeof r!="object"||r===null)return!1;let s=r;for(;Object.getPrototypeOf(s)!==null;)s=Object.getPrototypeOf(s);return Object.getPrototypeOf(r)===s||Object.getPrototypeOf(r)===null}function lw(r,s,l){if(typeof r!="function")throw new Error(Qr(2));if(typeof s=="function"&&typeof l=="function"||typeof l=="function"&&typeof arguments[3]=="function")throw new Error(Qr(0));if(typeof s=="function"&&typeof l>"u"&&(l=s,s=void 0),typeof l<"u"){if(typeof l!="function")throw new Error(Qr(1));return l(lw)(r,s)}let m=r,_=s,k=new Map,w=k,d=0,B=!1;function K(){w===k&&(w=new Map,k.forEach((Pe,ne)=>{w.set(ne,Pe)}))}function te(){if(B)throw new Error(Qr(3));return _}function Z(Pe){if(typeof Pe!="function")throw new Error(Qr(4));if(B)throw new Error(Qr(5));let ne=!0;K();const q=d++;return w.set(q,Pe),function(){if(ne){if(B)throw new Error(Qr(6));ne=!1,K(),w.delete(q),k=null}}}function U(Pe){if(!Ly(Pe))throw new Error(Qr(7));if(typeof Pe.type>"u")throw new Error(Qr(8));if(typeof Pe.type!="string")throw new Error(Qr(17));if(B)throw new Error(Qr(9));try{B=!0,_=m(_,Pe)}finally{B=!1}return(k=w).forEach(q=>{q()}),Pe}function Se(Pe){if(typeof Pe!="function")throw new Error(Qr(10));m=Pe,U({type:bp.REPLACE})}function be(){const Pe=Z;return{subscribe(ne){if(typeof ne!="object"||ne===null)throw new Error(Qr(11));function q(){const de=ne;de.next&&de.next(te())}return q(),{unsubscribe:Pe(q)}},[Mx](){return this}}}return U({type:bp.INIT}),{dispatch:U,subscribe:Z,getState:te,replaceReducer:Se,[Mx]:be}}function xT(r){Object.keys(r).forEach(s=>{const l=r[s];if(typeof l(void 0,{type:bp.INIT})>"u")throw new Error(Qr(12));if(typeof l(void 0,{type:bp.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(Qr(13))})}function wT(r){const s=Object.keys(r),l={};for(let k=0;k<s.length;k++){const w=s[k];typeof r[w]=="function"&&(l[w]=r[w])}const m=Object.keys(l);let _;try{xT(l)}catch(k){_=k}return function(w={},d){if(_)throw _;let B=!1;const K={};for(let te=0;te<m.length;te++){const Z=m[te],U=l[Z],Se=w[Z],be=U(Se,d);if(typeof be>"u")throw d&&d.type,new Error(Qr(14));K[Z]=be,B=B||be!==Se}return B=B||m.length!==Object.keys(w).length,B?K:w}}function Sp(...r){return r.length===0?s=>s:r.length===1?r[0]:r.reduce((s,l)=>(...m)=>s(l(...m)))}function bT(...r){return s=>(l,m)=>{const _=s(l,m);let k=()=>{throw new Error(Qr(15))};const w={getState:_.getState,dispatch:(B,...K)=>k(B,...K)},d=r.map(B=>B(w));return k=Sp(...d)(_.dispatch),{..._,dispatch:k}}}function ST(r){return Ly(r)&&"type"in r&&typeof r.type=="string"}var uw=Symbol.for("immer-nothing"),zx=Symbol.for("immer-draftable"),di=Symbol.for("immer-state");function Zi(r,...s){throw new Error(`[Immer] minified error nr: ${r}. Full error at: https://bit.ly/3cXEKWf`)}var lh=Object.getPrototypeOf;function Va(r){return!!r&&!!r[di]}function qs(r){var s;return r?cw(r)||Array.isArray(r)||!!r[zx]||!!((s=r.constructor)!=null&&s[zx])||yh(r)||Zp(r):!1}var kT=Object.prototype.constructor.toString(),Ax=new WeakMap;function cw(r){if(!r||typeof r!="object")return!1;const s=Object.getPrototypeOf(r);if(s===null||s===Object.prototype)return!0;const l=Object.hasOwnProperty.call(s,"constructor")&&s.constructor;if(l===Object)return!0;if(typeof l!="function")return!1;let m=Ax.get(l);return m===void 0&&(m=Function.toString.call(l),Ax.set(l,m)),m===kT}function kp(r,s,l=!0){$p(r)===0?(l?Reflect.ownKeys(r):Object.keys(r)).forEach(_=>{s(_,r[_],r)}):r.forEach((m,_)=>s(_,m,r))}function $p(r){const s=r[di];return s?s.type_:Array.isArray(r)?1:yh(r)?2:Zp(r)?3:0}function Ag(r,s){return $p(r)===2?r.has(s):Object.prototype.hasOwnProperty.call(r,s)}function hw(r,s,l){const m=$p(r);m===2?r.set(s,l):m===3?r.add(l):r[s]=l}function TT(r,s){return r===s?r!==0||1/r===1/s:r!==r&&s!==s}function yh(r){return r instanceof Map}function Zp(r){return r instanceof Set}function Ma(r){return r.copy_||r.base_}function Dg(r,s){if(yh(r))return new Map(r);if(Zp(r))return new Set(r);if(Array.isArray(r))return Array.prototype.slice.call(r);const l=cw(r);if(s===!0||s==="class_only"&&!l){const m=Object.getOwnPropertyDescriptors(r);delete m[di];let _=Reflect.ownKeys(m);for(let k=0;k<_.length;k++){const w=_[k],d=m[w];d.writable===!1&&(d.writable=!0,d.configurable=!0),(d.get||d.set)&&(m[w]={configurable:!0,writable:!0,enumerable:d.enumerable,value:r[w]})}return Object.create(lh(r),m)}else{const m=lh(r);if(m!==null&&l)return{...r};const _=Object.create(m);return Object.assign(_,r)}}function Ry(r,s=!1){return qp(r)||Va(r)||!qs(r)||($p(r)>1&&Object.defineProperties(r,{set:Bd,add:Bd,clear:Bd,delete:Bd}),Object.freeze(r),s&&Object.values(r).forEach(l=>Ry(l,!0))),r}function IT(){Zi(2)}var Bd={value:IT};function qp(r){return r===null||typeof r!="object"?!0:Object.isFrozen(r)}var CT={};function Ua(r){const s=CT[r];return s||Zi(0,r),s}var uh;function dw(){return uh}function ET(r,s){return{drafts_:[],parent_:r,immer_:s,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Dx(r,s){s&&(Ua("Patches"),r.patches_=[],r.inversePatches_=[],r.patchListener_=s)}function Lg(r){Rg(r),r.drafts_.forEach(PT),r.drafts_=null}function Rg(r){r===uh&&(uh=r.parent_)}function Lx(r){return uh=ET(uh,r)}function PT(r){const s=r[di];s.type_===0||s.type_===1?s.revoke_():s.revoked_=!0}function Rx(r,s){s.unfinalizedDrafts_=s.drafts_.length;const l=s.drafts_[0];return r!==void 0&&r!==l?(l[di].modified_&&(Lg(s),Zi(4)),qs(r)&&(r=Tp(s,r),s.parent_||Ip(s,r)),s.patches_&&Ua("Patches").generateReplacementPatches_(l[di].base_,r,s.patches_,s.inversePatches_)):r=Tp(s,l,[]),Lg(s),s.patches_&&s.patchListener_(s.patches_,s.inversePatches_),r!==uw?r:void 0}function Tp(r,s,l){if(qp(s))return s;const m=r.immer_.shouldUseStrictIteration(),_=s[di];if(!_)return kp(s,(k,w)=>Fx(r,_,s,k,w,l),m),s;if(_.scope_!==r)return s;if(!_.modified_)return Ip(r,_.base_,!0),_.base_;if(!_.finalized_){_.finalized_=!0,_.scope_.unfinalizedDrafts_--;const k=_.copy_;let w=k,d=!1;_.type_===3&&(w=new Set(k),k.clear(),d=!0),kp(w,(B,K)=>Fx(r,_,k,B,K,l,d),m),Ip(r,k,!1),l&&r.patches_&&Ua("Patches").generatePatches_(_,l,r.patches_,r.inversePatches_)}return _.copy_}function Fx(r,s,l,m,_,k,w){if(_==null||typeof _!="object"&&!w)return;const d=qp(_);if(!(d&&!w)){if(Va(_)){const B=k&&s&&s.type_!==3&&!Ag(s.assigned_,m)?k.concat(m):void 0,K=Tp(r,_,B);if(hw(l,m,K),Va(K))r.canAutoFreeze_=!1;else return}else w&&l.add(_);if(qs(_)&&!d){if(!r.immer_.autoFreeze_&&r.unfinalizedDrafts_<1||s&&s.base_&&s.base_[m]===_&&d)return;Tp(r,_),(!s||!s.scope_.parent_)&&typeof m!="symbol"&&(yh(l)?l.has(m):Object.prototype.propertyIsEnumerable.call(l,m))&&Ip(r,_)}}}function Ip(r,s,l=!1){!r.parent_&&r.immer_.autoFreeze_&&r.canAutoFreeze_&&Ry(s,l)}function MT(r,s){const l=Array.isArray(r),m={type_:l?1:0,scope_:s?s.scope_:dw(),modified_:!1,finalized_:!1,assigned_:{},parent_:s,base_:r,draft_:null,copy_:null,revoke_:null,isManual_:!1};let _=m,k=Fy;l&&(_=[m],k=ch);const{revoke:w,proxy:d}=Proxy.revocable(_,k);return m.draft_=d,m.revoke_=w,d}var Fy={get(r,s){if(s===di)return r;const l=Ma(r);if(!Ag(l,s))return zT(r,l,s);const m=l[s];return r.finalized_||!qs(m)?m:m===Bm(r.base_,s)?(Om(r),r.copy_[s]=Bg(m,r)):m},has(r,s){return s in Ma(r)},ownKeys(r){return Reflect.ownKeys(Ma(r))},set(r,s,l){const m=pw(Ma(r),s);if(m!=null&&m.set)return m.set.call(r.draft_,l),!0;if(!r.modified_){const _=Bm(Ma(r),s),k=_==null?void 0:_[di];if(k&&k.base_===l)return r.copy_[s]=l,r.assigned_[s]=!1,!0;if(TT(l,_)&&(l!==void 0||Ag(r.base_,s)))return!0;Om(r),Fg(r)}return r.copy_[s]===l&&(l!==void 0||s in r.copy_)||Number.isNaN(l)&&Number.isNaN(r.copy_[s])||(r.copy_[s]=l,r.assigned_[s]=!0),!0},deleteProperty(r,s){return Bm(r.base_,s)!==void 0||s in r.base_?(r.assigned_[s]=!1,Om(r),Fg(r)):delete r.assigned_[s],r.copy_&&delete r.copy_[s],!0},getOwnPropertyDescriptor(r,s){const l=Ma(r),m=Reflect.getOwnPropertyDescriptor(l,s);return m&&{writable:!0,configurable:r.type_!==1||s!=="length",enumerable:m.enumerable,value:l[s]}},defineProperty(){Zi(11)},getPrototypeOf(r){return lh(r.base_)},setPrototypeOf(){Zi(12)}},ch={};kp(Fy,(r,s)=>{ch[r]=function(){return arguments[0]=arguments[0][0],s.apply(this,arguments)}});ch.deleteProperty=function(r,s){return ch.set.call(this,r,s,void 0)};ch.set=function(r,s,l){return Fy.set.call(this,r[0],s,l,r[0])};function Bm(r,s){const l=r[di];return(l?Ma(l):r)[s]}function zT(r,s,l){var _;const m=pw(s,l);return m?"value"in m?m.value:(_=m.get)==null?void 0:_.call(r.draft_):void 0}function pw(r,s){if(!(s in r))return;let l=lh(r);for(;l;){const m=Object.getOwnPropertyDescriptor(l,s);if(m)return m;l=lh(l)}}function Fg(r){r.modified_||(r.modified_=!0,r.parent_&&Fg(r.parent_))}function Om(r){r.copy_||(r.copy_=Dg(r.base_,r.scope_.immer_.useStrictShallowCopy_))}var AT=class{constructor(r){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!0,this.produce=(s,l,m)=>{if(typeof s=="function"&&typeof l!="function"){const k=l;l=s;const w=this;return function(B=k,...K){return w.produce(B,te=>l.call(this,te,...K))}}typeof l!="function"&&Zi(6),m!==void 0&&typeof m!="function"&&Zi(7);let _;if(qs(s)){const k=Lx(this),w=Bg(s,void 0);let d=!0;try{_=l(w),d=!1}finally{d?Lg(k):Rg(k)}return Dx(k,m),Rx(_,k)}else if(!s||typeof s!="object"){if(_=l(s),_===void 0&&(_=s),_===uw&&(_=void 0),this.autoFreeze_&&Ry(_,!0),m){const k=[],w=[];Ua("Patches").generateReplacementPatches_(s,_,k,w),m(k,w)}return _}else Zi(1,s)},this.produceWithPatches=(s,l)=>{if(typeof s=="function")return(w,...d)=>this.produceWithPatches(w,B=>s(B,...d));let m,_;return[this.produce(s,l,(w,d)=>{m=w,_=d}),m,_]},typeof(r==null?void 0:r.autoFreeze)=="boolean"&&this.setAutoFreeze(r.autoFreeze),typeof(r==null?void 0:r.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(r.useStrictShallowCopy),typeof(r==null?void 0:r.useStrictIteration)=="boolean"&&this.setUseStrictIteration(r.useStrictIteration)}createDraft(r){qs(r)||Zi(8),Va(r)&&(r=DT(r));const s=Lx(this),l=Bg(r,void 0);return l[di].isManual_=!0,Rg(s),l}finishDraft(r,s){const l=r&&r[di];(!l||!l.isManual_)&&Zi(9);const{scope_:m}=l;return Dx(m,s),Rx(void 0,m)}setAutoFreeze(r){this.autoFreeze_=r}setUseStrictShallowCopy(r){this.useStrictShallowCopy_=r}setUseStrictIteration(r){this.useStrictIteration_=r}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(r,s){let l;for(l=s.length-1;l>=0;l--){const _=s[l];if(_.path.length===0&&_.op==="replace"){r=_.value;break}}l>-1&&(s=s.slice(l+1));const m=Ua("Patches").applyPatches_;return Va(r)?m(r,s):this.produce(r,_=>m(_,s))}};function Bg(r,s){const l=yh(r)?Ua("MapSet").proxyMap_(r,s):Zp(r)?Ua("MapSet").proxySet_(r,s):MT(r,s);return(s?s.scope_:dw()).drafts_.push(l),l}function DT(r){return Va(r)||Zi(10,r),fw(r)}function fw(r){if(!qs(r)||qp(r))return r;const s=r[di];let l,m=!0;if(s){if(!s.modified_)return s.base_;s.finalized_=!0,l=Dg(r,s.scope_.immer_.useStrictShallowCopy_),m=s.scope_.immer_.shouldUseStrictIteration()}else l=Dg(r,!0);return kp(l,(_,k)=>{hw(l,_,fw(k))},m),s&&(s.finalized_=!1),l}var Og=new AT,mw=Og.produce,LT=Og.setUseStrictIteration.bind(Og);function gw(r){return({dispatch:l,getState:m})=>_=>k=>typeof k=="function"?k(l,m,r):_(k)}var RT=gw(),FT=gw,BT=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?Sp:Sp.apply(null,arguments)};function Bx(r,s){function l(...m){if(s){let _=s(...m);if(!_)throw new Error(js(0));return{type:r,payload:_.payload,..."meta"in _&&{meta:_.meta},..."error"in _&&{error:_.error}}}return{type:r,payload:m[0]}}return l.toString=()=>`${r}`,l.type=r,l.match=m=>ST(m)&&m.type===r,l}var yw=class Rc extends Array{constructor(...s){super(...s),Object.setPrototypeOf(this,Rc.prototype)}static get[Symbol.species](){return Rc}concat(...s){return super.concat.apply(this,s)}prepend(...s){return s.length===1&&Array.isArray(s[0])?new Rc(...s[0].concat(this)):new Rc(...s.concat(this))}};function Ox(r){return qs(r)?mw(r,()=>{}):r}function Od(r,s,l){return r.has(s)?r.get(s):r.set(s,l(s)).get(s)}function OT(r){return typeof r=="boolean"}var NT=()=>function(s){const{thunk:l=!0,immutableCheck:m=!0,serializableCheck:_=!0,actionCreatorCheck:k=!0}=s??{};let w=new yw;return l&&(OT(l)?w.push(RT):w.push(FT(l.extraArgument))),w},jT="RTK_autoBatch",Nx=r=>s=>{setTimeout(s,r)},VT=(r={type:"raf"})=>s=>(...l)=>{const m=s(...l);let _=!0,k=!1,w=!1;const d=new Set,B=r.type==="tick"?queueMicrotask:r.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:Nx(10):r.type==="callback"?r.queueNotification:Nx(r.timeout),K=()=>{w=!1,k&&(k=!1,d.forEach(te=>te()))};return Object.assign({},m,{subscribe(te){const Z=()=>_&&te(),U=m.subscribe(Z);return d.add(te),()=>{U(),d.delete(te)}},dispatch(te){var Z;try{return _=!((Z=te==null?void 0:te.meta)!=null&&Z[jT]),k=!_,k&&(w||(w=!0,B(K))),m.dispatch(te)}finally{_=!0}}})},UT=r=>function(l){const{autoBatch:m=!0}=l??{};let _=new yw(r);return m&&_.push(VT(typeof m=="object"?m:void 0)),_};function $T(r){const s=NT(),{reducer:l=void 0,middleware:m,devTools:_=!0,preloadedState:k=void 0,enhancers:w=void 0}=r||{};let d;if(typeof l=="function")d=l;else if(Ly(l))d=wT(l);else throw new Error(js(1));let B;typeof m=="function"?B=m(s):B=s();let K=Sp;_&&(K=BT({trace:!1,...typeof _=="object"&&_}));const te=bT(...B),Z=UT(te);let U=typeof w=="function"?w(Z):Z();const Se=K(...U);return lw(d,k,Se)}function _w(r){const s={},l=[];let m;const _={addCase(k,w){const d=typeof k=="string"?k:k.type;if(!d)throw new Error(js(28));if(d in s)throw new Error(js(29));return s[d]=w,_},addAsyncThunk(k,w){return w.pending&&(s[k.pending.type]=w.pending),w.rejected&&(s[k.rejected.type]=w.rejected),w.fulfilled&&(s[k.fulfilled.type]=w.fulfilled),w.settled&&l.push({matcher:k.settled,reducer:w.settled}),_},addMatcher(k,w){return l.push({matcher:k,reducer:w}),_},addDefaultCase(k){return m=k,_}};return r(_),[s,l,m]}LT(!1);function ZT(r){return typeof r=="function"}function qT(r,s){let[l,m,_]=_w(s),k;if(ZT(r))k=()=>Ox(r());else{const d=Ox(r);k=()=>d}function w(d=k(),B){let K=[l[B.type],...m.filter(({matcher:te})=>te(B)).map(({reducer:te})=>te)];return K.filter(te=>!!te).length===0&&(K=[_]),K.reduce((te,Z)=>{if(Z)if(Va(te)){const Se=Z(te,B);return Se===void 0?te:Se}else{if(qs(te))return mw(te,U=>Z(U,B));{const U=Z(te,B);if(U===void 0){if(te===null)return te;throw Error("A case reducer on a non-draftable value must not return undefined")}return U}}return te},d)}return w.getInitialState=k,w}var GT="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",HT=(r=21)=>{let s="",l=r;for(;l--;)s+=GT[Math.random()*64|0];return s},WT=Symbol.for("rtk-slice-createasyncthunk");function XT(r,s){return`${r}/${s}`}function KT({creators:r}={}){var l;const s=(l=r==null?void 0:r.asyncThunk)==null?void 0:l[WT];return function(_){const{name:k,reducerPath:w=k}=_;if(!k)throw new Error(js(11));const d=(typeof _.reducers=="function"?_.reducers(YT()):_.reducers)||{},B=Object.keys(d),K={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},te={addCase(de,ye){const Ce=typeof de=="string"?de:de.type;if(!Ce)throw new Error(js(12));if(Ce in K.sliceCaseReducersByType)throw new Error(js(13));return K.sliceCaseReducersByType[Ce]=ye,te},addMatcher(de,ye){return K.sliceMatchers.push({matcher:de,reducer:ye}),te},exposeAction(de,ye){return K.actionCreators[de]=ye,te},exposeCaseReducer(de,ye){return K.sliceCaseReducersByName[de]=ye,te}};B.forEach(de=>{const ye=d[de],Ce={reducerName:de,type:XT(k,de),createNotation:typeof _.reducers=="function"};eI(ye)?rI(Ce,ye,te,s):QT(Ce,ye,te)});function Z(){const[de={},ye=[],Ce=void 0]=typeof _.extraReducers=="function"?_w(_.extraReducers):[_.extraReducers],ze={...de,...K.sliceCaseReducersByType};return qT(_.initialState,Ue=>{for(let tt in ze)Ue.addCase(tt,ze[tt]);for(let tt of K.sliceMatchers)Ue.addMatcher(tt.matcher,tt.reducer);for(let tt of ye)Ue.addMatcher(tt.matcher,tt.reducer);Ce&&Ue.addDefaultCase(Ce)})}const U=de=>de,Se=new Map,be=new WeakMap;let ke;function Pe(de,ye){return ke||(ke=Z()),ke(de,ye)}function ne(){return ke||(ke=Z()),ke.getInitialState()}function q(de,ye=!1){function Ce(Ue){let tt=Ue[de];return typeof tt>"u"&&ye&&(tt=Od(be,Ce,ne)),tt}function ze(Ue=U){const tt=Od(Se,ye,()=>new WeakMap);return Od(tt,Ue,()=>{const ut={};for(const[ot,wr]of Object.entries(_.selectors??{}))ut[ot]=JT(wr,Ue,()=>Od(be,Ue,ne),ye);return ut})}return{reducerPath:de,getSelectors:ze,get selectors(){return ze(Ce)},selectSlice:Ce}}const re={name:k,reducer:Pe,actions:K.actionCreators,caseReducers:K.sliceCaseReducersByName,getInitialState:ne,...q(w),injectInto(de,{reducerPath:ye,...Ce}={}){const ze=ye??w;return de.inject({reducerPath:ze,reducer:Pe},Ce),{...re,...q(ze,!0)}}};return re}}function JT(r,s,l,m){function _(k,...w){let d=s(k);return typeof d>"u"&&m&&(d=l()),r(d,...w)}return _.unwrapped=r,_}var vw=KT();function YT(){function r(s,l){return{_reducerDefinitionType:"asyncThunk",payloadCreator:s,...l}}return r.withTypes=()=>r,{reducer(s){return Object.assign({[s.name](...l){return s(...l)}}[s.name],{_reducerDefinitionType:"reducer"})},preparedReducer(s,l){return{_reducerDefinitionType:"reducerWithPrepare",prepare:s,reducer:l}},asyncThunk:r}}function QT({type:r,reducerName:s,createNotation:l},m,_){let k,w;if("reducer"in m){if(l&&!tI(m))throw new Error(js(17));k=m.reducer,w=m.prepare}else k=m;_.addCase(r,k).exposeCaseReducer(s,k).exposeAction(s,w?Bx(r,w):Bx(r))}function eI(r){return r._reducerDefinitionType==="asyncThunk"}function tI(r){return r._reducerDefinitionType==="reducerWithPrepare"}function rI({type:r,reducerName:s},l,m,_){if(!_)throw new Error(js(18));const{payloadCreator:k,fulfilled:w,pending:d,rejected:B,settled:K,options:te}=l,Z=_(r,k,te);m.exposeAction(s,Z),w&&m.addCase(Z.fulfilled,w),d&&m.addCase(Z.pending,d),B&&m.addCase(Z.rejected,B),K&&m.addMatcher(Z.settled,K),m.exposeCaseReducer(s,{fulfilled:w||Nd,pending:d||Nd,rejected:B||Nd,settled:K||Nd})}function Nd(){}function js(r){return`Minified Redux Toolkit error #${r}; visit https://redux-toolkit.js.org/Errors?code=${r} for the full message or use the non-minified dev environment for full errors. `}const nI={byId:{},allIds:[],selectedId:null},xw=vw({name:"entities",initialState:nI,reducers:{addEntity:(r,s)=>{const l=r.allIds.find(w=>{const d=r.byId[w];if(!d||d.kind!==s.payload.kind)return!1;if(s.payload.kind==="point"){const B=s.payload.data;return d.kind==="point"&&Math.abs(d.coordinates[0]-B.coordinates[0])<1e-4&&Math.abs(d.coordinates[1]-B.coordinates[1])<1e-4}if(s.payload.kind==="circle"){const B=s.payload.data;return d.kind==="circle"&&Math.abs(d.center[0]-B.center[0])<1e-4&&Math.abs(d.center[1]-B.center[1])<1e-4&&Math.abs(d.radiusMeters-B.radiusMeters)<1}if(s.payload.kind==="rectangle"){const B=s.payload.data;return d.kind!=="rectangle"||!B.coordinates||!d.coordinates||B.coordinates.length!==d.coordinates.length?!1:B.coordinates.every((te,Z)=>{const U=d.coordinates[Z];return Math.abs(te[0]-U[0])<1e-4&&Math.abs(te[1]-U[1])<1e-4})}if(s.payload.kind==="line"){const B=s.payload.data;return d.kind!=="line"||!B.coordinates||!d.coordinates||B.coordinates.length!==d.coordinates.length?!1:B.coordinates.every((te,Z)=>{const U=d.coordinates[Z];return Math.abs(te[0]-U[0])<1e-4&&Math.abs(te[1]-U[1])<1e-4})}if(s.payload.kind==="polygon"){const B=s.payload.data;if(d.kind!=="polygon"||!B.coordinates||!d.coordinates)return!1;const K=B.coordinates.slice(0,-1),te=d.coordinates.slice(0,-1);return K.length!==te.length?!1:K.every((U,Se)=>{const be=te[Se];return Math.abs(U[0]-be[0])<1e-4&&Math.abs(U[1]-be[1])<1e-4})}return!1});if(l){r.selectedId=l;return}const m=HT(),k={...{id:m,kind:s.payload.kind,name:s.payload.name??`${s.payload.kind.toUpperCase()} ${r.allIds.length+1}`,visible:s.payload.visible??!0,color:s.payload.color??"#38bdf8"},...s.payload.data};r.byId[m]=k,r.allIds.push(m),r.selectedId=m},updateEntity:(r,s)=>{const{id:l,changes:m}=s.payload,_=r.byId[l];_&&(r.byId[l]={..._,...m})},removeEntity:(r,s)=>{const l=s.payload;r.byId[l]&&(delete r.byId[l],r.allIds=r.allIds.filter(m=>m!==l),r.selectedId===l&&(r.selectedId=null))},toggleVisibility:(r,s)=>{const l=r.byId[s.payload];l&&(l.visible=!l.visible)},setSelectedEntity:(r,s)=>{r.selectedId=s.payload}}}),{addEntity:Fs,updateEntity:Ds,removeEntity:ww,toggleVisibility:iI,setSelectedEntity:bw}=xw.actions,sI=xw.reducer,oI={activeDrawMode:"none",rightSidebarOpen:!0,editingEntityId:null,editingVertexIndex:null,darkMode:!1,measurementMode:!1,showCoordinates:!0,welcomeScreenClosed:!1,exampleFormOpen:!1,mapType:"default"},Sw=vw({name:"ui",initialState:oI,reducers:{setDrawMode:(r,s)=>{r.activeDrawMode=s.payload,s.payload!=="edit"&&(r.editingEntityId=null,r.editingVertexIndex=null)},setRightSidebarOpen:(r,s)=>{r.rightSidebarOpen=s.payload},setEditingEntity:(r,s)=>{r.editingEntityId=s.payload.entityId,r.editingVertexIndex=s.payload.vertexIndex??null,s.payload.entityId&&(r.activeDrawMode="edit")},setDarkMode:(r,s)=>{r.darkMode=s.payload},setMeasurementMode:(r,s)=>{r.measurementMode=s.payload},setShowCoordinates:(r,s)=>{r.showCoordinates=s.payload},setWelcomeScreenClosed:r=>{r.welcomeScreenClosed=!0},setExampleFormOpen:(r,s)=>{r.exampleFormOpen=s.payload},setMapType:(r,s)=>{r.mapType=s.payload}}}),{setDrawMode:Dr,setRightSidebarOpen:AI,setEditingEntity:jl,setDarkMode:aI,setMeasurementMode:kw,setShowCoordinates:DI,setWelcomeScreenClosed:lI,setExampleFormOpen:Tw,setMapType:uI}=Sw.actions,cI=Sw.reducer,hI=$T({reducer:{entities:sI,ui:cI}}),dI=()=>{const r=Wi(),s=()=>{r(lI())};return ge.jsx("div",{className:"fixed inset-0 bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center z-50",children:ge.jsxs("div",{className:"text-center space-y-8 px-8",children:[ge.jsx("div",{className:"flex justify-center",children:ge.jsxs("div",{className:"relative",children:[ge.jsx("svg",{className:"w-40 h-40 text-accent",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:ge.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})}),ge.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:ge.jsx("div",{className:"w-24 h-24 bg-accent/30 rounded-full blur-2xl animate-pulse"})})]})}),ge.jsxs("div",{className:"space-y-4",children:[ge.jsxs("h1",{className:"text-5xl font-bold text-white tracking-wide",children:["BASE ",ge.jsx("span",{className:"text-accent",children:"MAPS"})]}),ge.jsx("p",{className:"text-slate-400 text-lg",children:"Professional Map Editor & Analysis System"})]}),ge.jsx("button",{onClick:s,className:"px-8 py-3 bg-accent text-black font-semibold rounded-lg hover:bg-accent/90 transition-all duration-200 transform hover:scale-105 shadow-lg hover:shadow-accent/50 text-lg",children:"ENTER SYSTEM"}),ge.jsx("div",{className:"pt-8 text-xs text-slate-500",children:ge.jsx("p",{children:"React  TypeScript  MapLibre  Redux"})})]})})},pI=()=>{const r=Wi(),[s,l]=ft.useState(new Date);ft.useEffect(()=>{const k=setInterval(()=>{l(new Date)},1e3);return()=>clearInterval(k)},[]);const m=k=>k.toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}),_=k=>k.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1});return ge.jsxs("div",{className:"h-12 flex items-center justify-between px-4 bg-slate-900 border-b border-slate-700 text-slate-100",children:[ge.jsxs("div",{className:"flex items-center gap-3",children:[ge.jsx("button",{onClick:()=>r(Tw(!0)),className:"p-2 hover:bg-slate-800 rounded-md transition-colors",title:"Example Form",children:ge.jsx("svg",{className:"w-5 h-5 text-slate-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:ge.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),ge.jsxs("div",{className:"font-semibold tracking-wide",children:["Map Editor ",ge.jsx("span",{className:"text-accent",children:"PRO"})]})]}),ge.jsxs("div",{className:"flex items-center gap-6 flex-1 justify-center",children:[ge.jsxs("div",{className:"flex items-center gap-4",children:[ge.jsxs("div",{className:"flex items-center gap-1.5",title:"Antenna Status",children:[ge.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:ge.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"})}),ge.jsx("span",{className:"text-xs text-white font-semibold",children:"ANT"})]}),ge.jsxs("div",{className:"flex items-center gap-1.5",title:"Communication Status",children:[ge.jsx("svg",{className:"w-5 h-5 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:ge.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),ge.jsx("span",{className:"text-xs text-green-500 font-semibold",children:"COM"})]}),ge.jsxs("div",{className:"flex items-center gap-1.5",title:"GPS Status",children:[ge.jsxs("svg",{className:"w-5 h-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[ge.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),ge.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),ge.jsx("span",{className:"text-xs text-red-500 font-semibold",children:"GPS"})]})]}),ge.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-300",children:[ge.jsx("span",{className:"text-slate-400",children:""}),ge.jsx("span",{children:_(s)}),ge.jsx("span",{className:"text-slate-500",children:"|"}),ge.jsx("span",{children:m(s)})]}),ge.jsx("div",{className:"px-2 py-0.5 bg-green-500/20 border border-green-500/50 rounded text-xs text-green-400 font-semibold",children:"OPERATIONAL MODE"})]}),ge.jsx("div",{className:"text-xs text-slate-400",children:"React  MapLibre  Redux"})]})};var Iw={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(r,s){(function(l,m){r.exports=m()})(x2,function(){var l={},m={};function _(w,d,B){if(m[w]=B,w==="index"){var K="var sharedModule = {}; ("+m.shared+")(sharedModule); ("+m.worker+")(sharedModule);",te={};return m.shared(te),m.index(l,te),typeof window<"u"&&l.setWorkerUrl(window.URL.createObjectURL(new Blob([K],{type:"text/javascript"}))),l}}_("shared",["exports"],function(w){function d(n,t,i,a){return new(i||(i=Promise))(function(h,g){function y(I){try{b(a.next(I))}catch(C){g(C)}}function v(I){try{b(a.throw(I))}catch(C){g(C)}}function b(I){var C;I.done?h(I.value):(C=I.value,C instanceof i?C:new i(function(P){P(C)})).then(y,v)}b((a=a.apply(n,t||[])).next())})}function B(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}typeof SuppressedError=="function"&&SuppressedError;var K=te;function te(n,t){this.x=n,this.y=t}te.prototype={clone:function(){return new te(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,t){return this.clone()._rotateAround(n,t)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var t=n.x-this.x,i=n.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult:function(n){var t=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=t,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var t=Math.cos(n),i=Math.sin(n),a=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=a,this},_rotateAround:function(n,t){var i=Math.cos(n),a=Math.sin(n),h=t.y+a*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-a*(this.y-t.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},te.convert=function(n){return n instanceof te?n:Array.isArray(n)?new te(n[0],n[1]):n};var Z=B(K),U=Se;function Se(n,t,i,a){this.cx=3*n,this.bx=3*(i-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=i,this.p2y=a}Se.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(t===void 0&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var i=n,a=0;a<8;a++){var h=this.sampleCurveX(i)-n;if(Math.abs(h)<t)return i;var g=this.sampleCurveDerivativeX(i);if(Math.abs(g)<1e-6)break;i-=h/g}var y=0,v=1;for(i=n,a=0;a<20&&(h=this.sampleCurveX(i),!(Math.abs(h-n)<t));a++)n>h?y=i:v=i,i=.5*(v-y)+y;return i},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};var be=B(U);let ke,Pe;function ne(){return ke==null&&(ke=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ke}function q(){if(Pe==null&&(Pe=!1,ne())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let a=0;a<5*5;a++){const h=4*a;t.fillStyle=`rgb(${h},${h+1},${h+2})`,t.fillRect(a%5,Math.floor(a/5),1,1)}const i=t.getImageData(0,0,5,5).data;for(let a=0;a<5*5*4;a++)if(a%4!=3&&i[a]!==a){Pe=!0;break}}}return Pe||!1}function re(n,t,i,a){const h=new be(n,t,i,a);return g=>h.solve(g)}const de=re(.25,.1,.25,1);function ye(n,t,i){return Math.min(i,Math.max(t,n))}function Ce(n,t,i){const a=i-t,h=((n-t)%a+a)%a+t;return h===t?i:h}function ze(n,...t){for(const i of t)for(const a in i)n[a]=i[a];return n}let Ue=1;function tt(n,t,i){const a={};for(const h in n)a[h]=t.call(this,n[h],h,n);return a}function ut(n,t,i){const a={};for(const h in n)t.call(this,n[h],h,n)&&(a[h]=n[h]);return a}function ot(n){return Array.isArray(n)?n.map(ot):typeof n=="object"&&n?tt(n,ot):n}const wr={};function Zt(n){wr[n]||(typeof console<"u"&&console.warn(n),wr[n]=!0)}function gr(n,t,i){return(i.y-n.y)*(t.x-n.x)>(t.y-n.y)*(i.x-n.x)}function xn(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let mi=null;function nn(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const Ke="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function mt(n,t,i,a,h){return d(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const g=new VideoFrame(n,{timestamp:0});try{const y=g==null?void 0:g.format;if(!y||!y.startsWith("BGR")&&!y.startsWith("RGB"))throw new Error(`Unrecognized format ${y}`);const v=y.startsWith("BGR"),b=new Uint8ClampedArray(a*h*4);if(yield g.copyTo(b,function(I,C,P,A,R){const O=4*Math.max(-C,0),N=(Math.max(0,P)-P)*A*4+O,H=4*A,Y=Math.max(0,C),fe=Math.max(0,P);return{rect:{x:Y,y:fe,width:Math.min(I.width,C+A)-Y,height:Math.min(I.height,P+R)-fe},layout:[{offset:N,stride:H}]}}(n,t,i,a,h)),v)for(let I=0;I<b.length;I+=4){const C=b[I];b[I]=b[I+2],b[I+2]=C}return b}finally{g.close()}})}let gt,Ct;const Bt="AbortError";function Hn(){return new Error(Bt)}const Fr={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function sn(n){return Fr.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const on="global-dispatcher";class kr extends Error{constructor(t,i,a,h){super(`AJAXError: ${i} (${t}): ${a}`),this.status=t,this.statusText=i,this.url=a,this.body=h}}const Wn=()=>xn(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ps=function(n,t){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const a=sn(n.url);if(a)return a(n,t);if(xn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:on},t)}if(!(/^file:/.test(i=n.url)||/^file:/.test(Wn())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(a,h){return d(this,void 0,void 0,function*(){const g=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,cache:a.cache,referrer:Wn(),signal:h.signal});a.type!=="json"||g.headers.has("Accept")||g.headers.set("Accept","application/json");const y=yield fetch(g);if(!y.ok){const I=yield y.blob();throw new kr(y.status,y.statusText,a.url,I)}let v;v=a.type==="arrayBuffer"||a.type==="image"?y.arrayBuffer():a.type==="json"?y.json():y.text();const b=yield v;if(h.signal.aborted)throw Hn();return{data:b,cacheControl:y.headers.get("Cache-Control"),expires:y.headers.get("Expires")}})}(n,t);if(xn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:on},t)}var i;return function(a,h){return new Promise((g,y)=>{var v;const b=new XMLHttpRequest;b.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(b.responseType="arraybuffer");for(const I in a.headers)b.setRequestHeader(I,a.headers[I]);a.type==="json"&&(b.responseType="text",!((v=a.headers)===null||v===void 0)&&v.Accept||b.setRequestHeader("Accept","application/json")),b.withCredentials=a.credentials==="include",b.onerror=()=>{y(new Error(b.statusText))},b.onload=()=>{if(!h.signal.aborted)if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){let I=b.response;if(a.type==="json")try{I=JSON.parse(b.response)}catch(C){return void y(C)}g({data:I,cacheControl:b.getResponseHeader("Cache-Control"),expires:b.getResponseHeader("Expires")})}else{const I=new Blob([b.response],{type:b.getResponseHeader("Content-Type")});y(new kr(b.status,b.statusText,a.url,I))}},h.signal.addEventListener("abort",()=>{b.abort(),y(Hn())}),b.send(a.body)})}(n,t)};function fs(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const t=new URL(n),i=window.location;return t.protocol===i.protocol&&t.host===i.host}function Ko(n,t,i){i[n]&&i[n].indexOf(t)!==-1||(i[n]=i[n]||[],i[n].push(t))}function Ai(n,t,i){if(i&&i[n]){const a=i[n].indexOf(t);a!==-1&&i[n].splice(a,1)}}class Xi{constructor(t,i={}){ze(this,i),this.type=t}}class Ki extends Xi{constructor(t,i={}){super("error",ze({error:t},i))}}class Hs{on(t,i){return this._listeners=this._listeners||{},Ko(t,i,this._listeners),this}off(t,i){return Ai(t,i,this._listeners),Ai(t,i,this._oneTimeListeners),this}once(t,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Ko(t,i,this._oneTimeListeners),this):new Promise(a=>this.once(t,a))}fire(t,i){typeof t=="string"&&(t=new Xi(t,i||{}));const a=t.type;if(this.listens(a)){t.target=this;const h=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const v of h)v.call(this,t);const g=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const v of g)Ai(a,v,this._oneTimeListeners),v.call(this,t);const y=this._eventedParent;y&&(ze(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(t))}else t instanceof Ki&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,i){return this._eventedParent=t,this._eventedParentData=i,this}}var ve={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const ms=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Jo(n,t){const i={};for(const a in n)a!=="ref"&&(i[a]=n[a]);return ms.forEach(a=>{a in t&&(i[a]=t[a])}),i}function Dt(n,t){if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let i=0;i<n.length;i++)if(!Dt(n[i],t[i]))return!1;return!0}if(typeof n=="object"&&n!==null&&t!==null){if(typeof t!="object"||Object.keys(n).length!==Object.keys(t).length)return!1;for(const i in n)if(!Dt(n[i],t[i]))return!1;return!0}return n===t}function tr(n,t){n.push(t)}function Yo(n,t,i){tr(i,{command:"addSource",args:[n,t[n]]})}function Ji(n,t,i){tr(t,{command:"removeSource",args:[n]}),i[n]=!0}function Di(n,t,i,a){Ji(n,i,a),Yo(n,t,i)}function Ws(n,t,i){let a;for(a in n[i])if(Object.prototype.hasOwnProperty.call(n[i],a)&&a!=="data"&&!Dt(n[i][a],t[i][a]))return!1;for(a in t[i])if(Object.prototype.hasOwnProperty.call(t[i],a)&&a!=="data"&&!Dt(n[i][a],t[i][a]))return!1;return!0}function Dn(n,t,i,a,h,g){n=n||{},t=t||{};for(const y in n)Object.prototype.hasOwnProperty.call(n,y)&&(Dt(n[y],t[y])||i.push({command:g,args:[a,y,t[y],h]}));for(const y in t)Object.prototype.hasOwnProperty.call(t,y)&&!Object.prototype.hasOwnProperty.call(n,y)&&(Dt(n[y],t[y])||i.push({command:g,args:[a,y,t[y],h]}))}function Qo(n){return n.id}function ea(n,t){return n[t.id]=t,n}class De{constructor(t,i,a,h){this.message=(t?`${t}: `:"")+a,h&&(this.identifier=h),i!=null&&i.__line__&&(this.line=i.__line__)}}function gi(n,...t){for(const i of t)for(const a in i)n[a]=i[a];return n}class Hr extends Error{constructor(t,i){super(i),this.message=i,this.key=t}}class yi{constructor(t,i=[]){this.parent=t,this.bindings={};for(const[a,h]of i)this.bindings[a]=h}concat(t){return new yi(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Yi={kind:"null"},Oe={kind:"number"},xt={kind:"string"},ct={kind:"boolean"},an={kind:"color"},Xn={kind:"object"},yt={kind:"value"},_i={kind:"collator"},Li={kind:"formatted"},Qi={kind:"padding"},vi={kind:"resolvedImage"},J={kind:"variableAnchorOffsetCollection"};function L(n,t){return{kind:"array",itemType:n,N:t}}function D(n){if(n.kind==="array"){const t=D(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}return n.kind}const j=[Yi,Oe,xt,ct,an,Li,Xn,L(yt),Qi,vi,J];function W(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!W(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(const i of j)if(!W(i,t))return null}}return`Expected ${D(n)} but found ${D(t)} instead.`}function ae(n,t){return t.some(i=>i.kind===n.kind)}function ue(n,t){return t.some(i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n)}function pe(n,t){return n.kind==="array"&&t.kind==="array"?n.itemType.kind===t.itemType.kind&&typeof n.N=="number":n.kind===t.kind}const ie=.96422,we=.82521,Ee=4/29,_e=6/29,Re=3*_e*_e,nt=_e*_e*_e,st=Math.PI/180,Et=180/Math.PI;function _t(n){return(n%=360)<0&&(n+=360),n}function Pt([n,t,i,a]){let h,g;const y=yr((.2225045*(n=St(n))+.7168786*(t=St(t))+.0606169*(i=St(i)))/1);n===t&&t===i?h=g=y:(h=yr((.4360747*n+.3850649*t+.1430804*i)/ie),g=yr((.0139322*n+.0971045*t+.7141733*i)/we));const v=116*y-16;return[v<0?0:v,500*(h-y),200*(y-g),a]}function St(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function yr(n){return n>nt?Math.pow(n,1/3):n/Re+Ee}function rr([n,t,i,a]){let h=(n+16)/116,g=isNaN(t)?h:h+t/500,y=isNaN(i)?h:h-i/200;return h=1*Ot(h),g=ie*Ot(g),y=we*Ot(y),[wt(3.1338561*g-1.6168667*h-.4906146*y),wt(-.9787684*g+1.9161415*h+.033454*y),wt(.0719453*g-.2289914*h+1.4052427*y),a]}function wt(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function Ot(n){return n>_e?n*n*n:Re*(n-Ee)}function Qt(n){return parseInt(n.padEnd(2,n),16)/255}function Tr(n,t){return Mr(t?n/100:n,0,1)}function Mr(n,t,i){return Math.min(Math.max(t,n),i)}function Wr(n){return!n.some(Number.isNaN)}const Xs={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Nt{constructor(t,i,a,h=1,g=!0){this.r=t,this.g=i,this.b=a,this.a=h,g||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[t,i,a,h]))}static parse(t){if(t instanceof Nt)return t;if(typeof t!="string")return;const i=function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];const h=Xs[a];if(h){const[y,v,b]=h;return[y/255,v/255,b/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){const y=a.length<6?1:2;let v=1;return[Qt(a.slice(v,v+=y)),Qt(a.slice(v,v+=y)),Qt(a.slice(v,v+=y)),Qt(a.slice(v,v+y)||"ff")]}if(a.startsWith("rgb")){const y=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){const[v,b,I,C,P,A,R,O,N,H,Y,fe]=y,oe=[C||" ",R||" ",H].join("");if(oe==="  "||oe==="  /"||oe===",,"||oe===",,,"){const he=[I,A,N].join(""),xe=he==="%%%"?100:he===""?255:0;if(xe){const Me=[Mr(+b/xe,0,1),Mr(+P/xe,0,1),Mr(+O/xe,0,1),Y?Tr(+Y,fe):1];if(Wr(Me))return Me}}return}}const g=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[y,v,b,I,C,P,A,R,O]=g,N=[b||" ",C||" ",A].join("");if(N==="  "||N==="  /"||N===",,"||N===",,,"){const H=[+v,Mr(+I,0,100),Mr(+P,0,100),R?Tr(+R,O):1];if(Wr(H))return function([Y,fe,oe,he]){function xe(Me){const qe=(Me+Y/30)%12,at=fe*Math.min(oe,1-oe);return oe-at*Math.max(-1,Math.min(qe-3,9-qe,1))}return Y=_t(Y),fe/=100,oe/=100,[xe(0),xe(8),xe(4),he]}(H)}}}(t);return i?new Nt(...i,!1):void 0}get rgb(){const{r:t,g:i,b:a,a:h}=this,g=h||1/0;return this.overwriteGetter("rgb",[t/g,i/g,a/g,h])}get hcl(){return this.overwriteGetter("hcl",function(t){const[i,a,h,g]=Pt(t),y=Math.sqrt(a*a+h*h);return[Math.round(1e4*y)?_t(Math.atan2(h,a)*Et):NaN,y,i,g]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Pt(this.rgb))}overwriteGetter(t,i){return Object.defineProperty(this,t,{value:i}),i}toString(){const[t,i,a,h]=this.rgb;return`rgba(${[t,i,a].map(g=>Math.round(255*g)).join(",")},${h})`}}Nt.black=new Nt(0,0,0,1),Nt.white=new Nt(1,1,1,1),Nt.transparent=new Nt(0,0,0,0),Nt.red=new Nt(1,0,0,1);class mu{constructor(t,i,a){this.sensitivity=t?i?"variant":"case":i?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,i){return this.collator.compare(t,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class gu{constructor(t,i,a,h,g){this.text=t,this.image=i,this.scale=a,this.fontStack=h,this.textColor=g}}class wn{constructor(t){this.sections=t}static fromString(t){return new wn([new gu(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof wn?t:wn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class bn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof bn)return t;if(typeof t=="number")return new bn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const i of t)if(typeof i!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new bn(t)}}toString(){return JSON.stringify(this.values)}}const Gp=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ln{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Ln)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let i=0;i<t.length;i+=2){const a=t[i],h=t[i+1];if(typeof a!="string"||!Gp.has(a)||!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")return}return new Ln(t)}}toString(){return JSON.stringify(this.values)}}class Sn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Sn({name:t,available:!1}):null}}function Ks(n,t,i,a){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof i=="number"&&i>=0&&i<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[n,t,i,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[n,t,i,a]:[n,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function gs(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Nt||n instanceof mu||n instanceof wn||n instanceof bn||n instanceof Ln||n instanceof Sn)return!0;if(Array.isArray(n)){for(const t of n)if(!gs(t))return!1;return!0}if(typeof n=="object"){for(const t in n)if(!gs(n[t]))return!1;return!0}return!1}function _r(n){if(n===null)return Yi;if(typeof n=="string")return xt;if(typeof n=="boolean")return ct;if(typeof n=="number")return Oe;if(n instanceof Nt)return an;if(n instanceof mu)return _i;if(n instanceof wn)return Li;if(n instanceof bn)return Qi;if(n instanceof Ln)return J;if(n instanceof Sn)return vi;if(Array.isArray(n)){const t=n.length;let i;for(const a of n){const h=_r(a);if(i){if(i===h)continue;i=yt;break}i=h}return L(i||yt,t)}return Xn}function ta(n){const t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof Nt||n instanceof wn||n instanceof bn||n instanceof Ln||n instanceof Sn?n.toString():JSON.stringify(n)}class Kn{constructor(t,i){this.type=t,this.value=i}static parse(t,i){if(t.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!gs(t[1]))return i.error("invalid value");const a=t[1];let h=_r(a);const g=i.expectedType;return h.kind!=="array"||h.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(h=g),new Kn(h,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class hr{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const qa={string:xt,number:Oe,boolean:ct,object:Xn};class Jn{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let a,h=1;const g=t[0];if(g==="array"){let v,b;if(t.length>2){const I=t[1];if(typeof I!="string"||!(I in qa)||I==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);v=qa[I],h++}else v=yt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return i.error('The length argument to "array" must be a positive integer literal',2);b=t[2],h++}a=L(v,b)}else{if(!qa[g])throw new Error(`Types doesn't contain name = ${g}`);a=qa[g]}const y=[];for(;h<t.length;h++){const v=i.parse(t[h],h,yt);if(!v)return null;y.push(v)}return new Jn(a,y)}evaluate(t){for(let i=0;i<this.args.length;i++){const a=this.args[i].evaluate(t);if(!W(this.type,_r(a)))return a;if(i===this.args.length-1)throw new hr(`Expected value to be of type ${D(this.type)}, but found ${D(_r(a))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const yu={"to-boolean":ct,"to-color":an,"to-number":Oe,"to-string":xt};class Yn{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const a=t[0];if(!yu[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&t.length!==2)return i.error("Expected one argument.");const h=yu[a],g=[];for(let y=1;y<t.length;y++){const v=i.parse(t[y],y,yt);if(!v)return null;g.push(v)}return new Yn(h,g)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let i,a;for(const h of this.args){if(i=h.evaluate(t),a=null,i instanceof Nt)return i;if(typeof i=="string"){const g=t.parseColor(i);if(g)return g}else if(Array.isArray(i)&&(a=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Ks(i[0],i[1],i[2],i[3]),!a))return new Nt(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new hr(a||`Could not parse color from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"padding":{let i;for(const a of this.args){i=a.evaluate(t);const h=bn.parse(i);if(h)return h}throw new hr(`Could not parse padding from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"variableAnchorOffsetCollection":{let i;for(const a of this.args){i=a.evaluate(t);const h=Ln.parse(i);if(h)return h}throw new hr(`Could not parse variableAnchorOffsetCollection from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"number":{let i=null;for(const a of this.args){if(i=a.evaluate(t),i===null)return 0;const h=Number(i);if(!isNaN(h))return h}throw new hr(`Could not convert ${JSON.stringify(i)} to number.`)}case"formatted":return wn.fromString(ta(this.args[0].evaluate(t)));case"resolvedImage":return Sn.fromString(ta(this.args[0].evaluate(t)));default:return ta(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Hp=["Unknown","Point","LineString","Polygon"];class Ga{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Hp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let i=this._parseColorCache[t];return i||(i=this._parseColorCache[t]=Nt.parse(t)),i}}class ys{constructor(t,i,a=[],h,g=new yi,y=[]){this.registry=t,this.path=a,this.key=a.map(v=>`[${v}]`).join(""),this.scope=g,this.errors=y,this.expectedType=h,this._isConstant=i}parse(t,i,a,h,g={}){return i?this.concat(i,a,h)._parse(t,g):this._parse(t,g)}_parse(t,i){function a(h,g,y){return y==="assert"?new Jn(g,[h]):y==="coerce"?new Yn(g,[h]):h}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=t[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[h];if(g){let y=g.parse(t,this);if(!y)return null;if(this.expectedType){const v=this.expectedType,b=y.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||b.kind!=="value")if(v.kind!=="color"&&v.kind!=="formatted"&&v.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string")if(v.kind!=="padding"||b.kind!=="value"&&b.kind!=="number"&&b.kind!=="array")if(v.kind!=="variableAnchorOffsetCollection"||b.kind!=="value"&&b.kind!=="array"){if(this.checkSubtype(v,b))return null}else y=a(y,v,i.typeAnnotation||"coerce");else y=a(y,v,i.typeAnnotation||"coerce");else y=a(y,v,i.typeAnnotation||"coerce");else y=a(y,v,i.typeAnnotation||"assert")}if(!(y instanceof Kn)&&y.type.kind!=="resolvedImage"&&this._isConstant(y)){const v=new Ga;try{y=new Kn(y.type,y.evaluate(v))}catch(b){return this.error(b.message),null}}return y}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,i,a){const h=typeof t=="number"?this.path.concat(t):this.path,g=a?this.scope.concat(a):this.scope;return new ys(this.registry,this._isConstant,h,i||null,g,this.errors)}error(t,...i){const a=`${this.key}${i.map(h=>`[${h}]`).join("")}`;this.errors.push(new Hr(a,t))}checkSubtype(t,i){const a=W(t,i);return a&&this.error(a),a}}class es{constructor(t,i){this.type=i.type,this.bindings=[].concat(t),this.result=i}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const i of this.bindings)t(i[1]);t(this.result)}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const a=[];for(let g=1;g<t.length-1;g+=2){const y=t[g];if(typeof y!="string")return i.error(`Expected string, but found ${typeof y} instead.`,g);if(/[^a-zA-Z0-9_]/.test(y))return i.error("Variable names must contain only alphanumeric characters or '_'.",g);const v=i.parse(t[g+1],g+1);if(!v)return null;a.push([y,v])}const h=i.parse(t[t.length-1],t.length-1,i.expectedType,a);return h?new es(a,h):null}outputDefined(){return this.result.outputDefined()}}class Lt{constructor(t,i){this.type=i.type,this.name=t,this.boundExpression=i}static parse(t,i){if(t.length!==2||typeof t[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const a=t[1];return i.scope.has(a)?new Lt(a,i.scope.get(a)):i.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class _u{constructor(t,i,a){this.type=t,this.index=i,this.input=a}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=i.parse(t[1],1,Oe),h=i.parse(t[2],2,L(i.expectedType||yt));return a&&h?new _u(h.type.itemType,a,h):null}evaluate(t){const i=this.index.evaluate(t),a=this.input.evaluate(t);if(i<0)throw new hr(`Array index out of bounds: ${i} < 0.`);if(i>=a.length)throw new hr(`Array index out of bounds: ${i} > ${a.length-1}.`);if(i!==Math.floor(i))throw new hr(`Array index must be an integer, but found ${i} instead.`);return a[i]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class vu{constructor(t,i){this.type=ct,this.needle=t,this.haystack=i}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=i.parse(t[1],1,yt),h=i.parse(t[2],2,yt);return a&&h?ae(a.type,[ct,xt,Oe,Yi,yt])?new vu(a,h):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${D(a.type)} instead`):null}evaluate(t){const i=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!a)return!1;if(!ue(i,["boolean","string","number","null"]))throw new hr(`Expected first argument to be of type boolean, string, number or null, but found ${D(_r(i))} instead.`);if(!ue(a,["string","array"]))throw new hr(`Expected second argument to be of type array or string, but found ${D(_r(a))} instead.`);return a.indexOf(i)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Js{constructor(t,i,a){this.type=Oe,this.needle=t,this.haystack=i,this.fromIndex=a}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=i.parse(t[1],1,yt),h=i.parse(t[2],2,yt);if(!a||!h)return null;if(!ae(a.type,[ct,xt,Oe,Yi,yt]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${D(a.type)} instead`);if(t.length===4){const g=i.parse(t[3],3,Oe);return g?new Js(a,h,g):null}return new Js(a,h)}evaluate(t){const i=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!ue(i,["boolean","string","number","null"]))throw new hr(`Expected first argument to be of type boolean, string, number or null, but found ${D(_r(i))} instead.`);let h;if(this.fromIndex&&(h=this.fromIndex.evaluate(t)),ue(a,["string"])){const g=a.indexOf(i,h);return g===-1?-1:[...a.slice(0,g)].length}if(ue(a,["array"]))return a.indexOf(i,h);throw new hr(`Expected second argument to be of type array or string, but found ${D(_r(a))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class xu{constructor(t,i,a,h,g,y){this.inputType=t,this.type=i,this.input=a,this.cases=h,this.outputs=g,this.otherwise=y}static parse(t,i){if(t.length<5)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return i.error("Expected an even number of arguments.");let a,h;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);const g={},y=[];for(let I=2;I<t.length-1;I+=2){let C=t[I];const P=t[I+1];Array.isArray(C)||(C=[C]);const A=i.concat(I);if(C.length===0)return A.error("Expected at least one branch label.");for(const O of C){if(typeof O!="number"&&typeof O!="string")return A.error("Branch labels must be numbers or strings.");if(typeof O=="number"&&Math.abs(O)>Number.MAX_SAFE_INTEGER)return A.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof O=="number"&&Math.floor(O)!==O)return A.error("Numeric branch labels must be integer values.");if(a){if(A.checkSubtype(a,_r(O)))return null}else a=_r(O);if(g[String(O)]!==void 0)return A.error("Branch labels must be unique.");g[String(O)]=y.length}const R=i.parse(P,I,h);if(!R)return null;h=h||R.type,y.push(R)}const v=i.parse(t[1],1,yt);if(!v)return null;const b=i.parse(t[t.length-1],t.length-1,h);return b?v.type.kind!=="value"&&i.concat(1).checkSubtype(a,v.type)?null:new xu(a,h,v,g,y,b):null}evaluate(t){const i=this.input.evaluate(t);return(_r(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Ha{constructor(t,i,a){this.type=t,this.branches=i,this.otherwise=a}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return i.error("Expected an odd number of arguments.");let a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const h=[];for(let y=1;y<t.length-1;y+=2){const v=i.parse(t[y],y,ct);if(!v)return null;const b=i.parse(t[y+1],y+1,a);if(!b)return null;h.push([v,b]),a=a||b.type}const g=i.parse(t[t.length-1],t.length-1,a);if(!g)return null;if(!a)throw new Error("Can't infer output type");return new Ha(a,h,g)}evaluate(t){for(const[i,a]of this.branches)if(i.evaluate(t))return a.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[i,a]of this.branches)t(i),t(a);t(this.otherwise)}outputDefined(){return this.branches.every(([t,i])=>i.outputDefined())&&this.otherwise.outputDefined()}}class ra{constructor(t,i,a,h){this.type=t,this.input=i,this.beginIndex=a,this.endIndex=h}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=i.parse(t[1],1,yt),h=i.parse(t[2],2,Oe);if(!a||!h)return null;if(!ae(a.type,[L(yt),xt,yt]))return i.error(`Expected first argument to be of type array or string, but found ${D(a.type)} instead`);if(t.length===4){const g=i.parse(t[3],3,Oe);return g?new ra(a.type,a,h,g):null}return new ra(a.type,a,h)}evaluate(t){const i=this.input.evaluate(t),a=this.beginIndex.evaluate(t);let h;if(this.endIndex&&(h=this.endIndex.evaluate(t)),ue(i,["string"]))return[...i].slice(a,h).join("");if(ue(i,["array"]))return i.slice(a,h);throw new hr(`Expected first argument to be of type array or string, but found ${D(_r(i))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Wa(n,t){const i=n.length-1;let a,h,g=0,y=i,v=0;for(;g<=y;)if(v=Math.floor((g+y)/2),a=n[v],h=n[v+1],a<=t){if(v===i||t<h)return v;g=v+1}else{if(!(a>t))throw new hr("Input is not a number.");y=v-1}return 0}class Ys{constructor(t,i,a){this.type=t,this.input=i,this.labels=[],this.outputs=[];for(const[h,g]of a)this.labels.push(h),this.outputs.push(g)}static parse(t,i){if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");const a=i.parse(t[1],1,Oe);if(!a)return null;const h=[];let g=null;i.expectedType&&i.expectedType.kind!=="value"&&(g=i.expectedType);for(let y=1;y<t.length;y+=2){const v=y===1?-1/0:t[y],b=t[y+1],I=y,C=y+1;if(typeof v!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(h.length&&h[h.length-1][0]>=v)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const P=i.parse(b,C,g);if(!P)return null;g=g||P.type,h.push([v,P])}return new Ys(g,a,h)}evaluate(t){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(t);const h=this.input.evaluate(t);if(h<=i[0])return a[0].evaluate(t);const g=i.length;return h>=i[g-1]?a[g-1].evaluate(t):a[Wa(i,h)].evaluate(t)}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function _h(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Wp=vh;function vh(n,t,i,a){this.cx=3*n,this.bx=3*(i-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=i,this.p2y=a}vh.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(t===void 0&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var i=n,a=0;a<8;a++){var h=this.sampleCurveX(i)-n;if(Math.abs(h)<t)return i;var g=this.sampleCurveDerivativeX(i);if(Math.abs(g)<1e-6)break;i-=h/g}var y=0,v=1;for(i=n,a=0;a<20&&(h=this.sampleCurveX(i),!(Math.abs(h-n)<t));a++)n>h?y=i:v=i,i=.5*(v-y)+y;return i},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};var Xp=_h(Wp);function _s(n,t,i){return n+i*(t-n)}function na(n,t,i){return n.map((a,h)=>_s(a,t[h],i))}const ln={number:_s,color:function(n,t,i,a="rgb"){switch(a){case"rgb":{const[h,g,y,v]=na(n.rgb,t.rgb,i);return new Nt(h,g,y,v,!1)}case"hcl":{const[h,g,y,v]=n.hcl,[b,I,C,P]=t.hcl;let A,R;if(isNaN(h)||isNaN(b))isNaN(h)?isNaN(b)?A=NaN:(A=b,y!==1&&y!==0||(R=I)):(A=h,C!==1&&C!==0||(R=g));else{let fe=b-h;b>h&&fe>180?fe-=360:b<h&&h-b>180&&(fe+=360),A=h+i*fe}const[O,N,H,Y]=function([fe,oe,he,xe]){return fe=isNaN(fe)?0:fe*st,rr([he,Math.cos(fe)*oe,Math.sin(fe)*oe,xe])}([A,R??_s(g,I,i),_s(y,C,i),_s(v,P,i)]);return new Nt(O,N,H,Y,!1)}case"lab":{const[h,g,y,v]=rr(na(n.lab,t.lab,i));return new Nt(h,g,y,v,!1)}}},array:na,padding:function(n,t,i){return new bn(na(n.values,t.values,i))},variableAnchorOffsetCollection:function(n,t,i){const a=n.values,h=t.values;if(a.length!==h.length)throw new hr(`Cannot interpolate values of different length. from: ${n.toString()}, to: ${t.toString()}`);const g=[];for(let y=0;y<a.length;y+=2){if(a[y]!==h[y])throw new hr(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${a[y]}, to[${y}]: ${h[y]}`);g.push(a[y]);const[v,b]=a[y+1],[I,C]=h[y+1];g.push([_s(v,I,i),_s(b,C,i)])}return new Ln(g)}};class un{constructor(t,i,a,h,g){this.type=t,this.operator=i,this.interpolation=a,this.input=h,this.labels=[],this.outputs=[];for(const[y,v]of g)this.labels.push(y),this.outputs.push(v)}static interpolationFactor(t,i,a,h){let g=0;if(t.name==="exponential")g=Xa(i,t.base,a,h);else if(t.name==="linear")g=Xa(i,1,a,h);else if(t.name==="cubic-bezier"){const y=t.controlPoints;g=new Xp(y[0],y[1],y[2],y[3]).solve(Xa(i,1,a,h))}return g}static parse(t,i){let[a,h,g,...y]=t;if(!Array.isArray(h)||h.length===0)return i.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const I=h[1];if(typeof I!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:I}}else{if(h[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const I=h.slice(1);if(I.length!==4||I.some(C=>typeof C!="number"||C<0||C>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:I}}}if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(g=i.parse(g,2,Oe),!g)return null;const v=[];let b=null;a==="interpolate-hcl"||a==="interpolate-lab"?b=an:i.expectedType&&i.expectedType.kind!=="value"&&(b=i.expectedType);for(let I=0;I<y.length;I+=2){const C=y[I],P=y[I+1],A=I+3,R=I+4;if(typeof C!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(v.length&&v[v.length-1][0]>=C)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',A);const O=i.parse(P,R,b);if(!O)return null;b=b||O.type,v.push([C,O])}return pe(b,Oe)||pe(b,an)||pe(b,Qi)||pe(b,J)||pe(b,L(Oe))?new un(b,a,h,g,v):i.error(`Type ${D(b)} is not interpolatable.`)}evaluate(t){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(t);const h=this.input.evaluate(t);if(h<=i[0])return a[0].evaluate(t);const g=i.length;if(h>=i[g-1])return a[g-1].evaluate(t);const y=Wa(i,h),v=un.interpolationFactor(this.interpolation,h,i[y],i[y+1]),b=a[y].evaluate(t),I=a[y+1].evaluate(t);switch(this.operator){case"interpolate":return ln[this.type.kind](b,I,v);case"interpolate-hcl":return ln.color(b,I,v,"hcl");case"interpolate-lab":return ln.color(b,I,v,"lab")}}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Xa(n,t,i,a){const h=a-i,g=n-i;return h===0?0:t===1?g/h:(Math.pow(t,g)-1)/(Math.pow(t,h)-1)}class Ka{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expectected at least one argument.");let a=null;const h=i.expectedType;h&&h.kind!=="value"&&(a=h);const g=[];for(const v of t.slice(1)){const b=i.parse(v,1+g.length,a,void 0,{typeAnnotation:"omit"});if(!b)return null;a=a||b.type,g.push(b)}if(!a)throw new Error("No output type");const y=h&&g.some(v=>W(h,v.type));return new Ka(y?yt:a,g)}evaluate(t){let i,a=null,h=0;for(const g of this.args)if(h++,a=g.evaluate(t),a&&a instanceof Sn&&!a.available&&(i||(i=a.name),a=null,h===this.args.length&&(a=i)),a!==null)break;return a}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Ja(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function xh(n,t,i,a){return a.compare(t,i)===0}function Qs(n,t,i){const a=n!=="=="&&n!=="!=";return class Cw{constructor(g,y,v){this.type=ct,this.lhs=g,this.rhs=y,this.collator=v,this.hasUntypedArgument=g.type.kind==="value"||y.type.kind==="value"}static parse(g,y){if(g.length!==3&&g.length!==4)return y.error("Expected two or three arguments.");const v=g[0];let b=y.parse(g[1],1,yt);if(!b)return null;if(!Ja(v,b.type))return y.concat(1).error(`"${v}" comparisons are not supported for type '${D(b.type)}'.`);let I=y.parse(g[2],2,yt);if(!I)return null;if(!Ja(v,I.type))return y.concat(2).error(`"${v}" comparisons are not supported for type '${D(I.type)}'.`);if(b.type.kind!==I.type.kind&&b.type.kind!=="value"&&I.type.kind!=="value")return y.error(`Cannot compare types '${D(b.type)}' and '${D(I.type)}'.`);a&&(b.type.kind==="value"&&I.type.kind!=="value"?b=new Jn(I.type,[b]):b.type.kind!=="value"&&I.type.kind==="value"&&(I=new Jn(b.type,[I])));let C=null;if(g.length===4){if(b.type.kind!=="string"&&I.type.kind!=="string"&&b.type.kind!=="value"&&I.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(C=y.parse(g[3],3,_i),!C)return null}return new Cw(b,I,C)}evaluate(g){const y=this.lhs.evaluate(g),v=this.rhs.evaluate(g);if(a&&this.hasUntypedArgument){const b=_r(y),I=_r(v);if(b.kind!==I.kind||b.kind!=="string"&&b.kind!=="number")throw new hr(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${b.kind}, ${I.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const b=_r(y),I=_r(v);if(b.kind!=="string"||I.kind!=="string")return t(g,y,v)}return this.collator?i(g,y,v,this.collator.evaluate(g)):t(g,y,v)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}const Kp=Qs("==",function(n,t,i){return t===i},xh),wh=Qs("!=",function(n,t,i){return t!==i},function(n,t,i,a){return!xh(0,t,i,a)}),bh=Qs("<",function(n,t,i){return t<i},function(n,t,i,a){return a.compare(t,i)<0}),Jp=Qs(">",function(n,t,i){return t>i},function(n,t,i,a){return a.compare(t,i)>0}),Yp=Qs("<=",function(n,t,i){return t<=i},function(n,t,i,a){return a.compare(t,i)<=0}),Sh=Qs(">=",function(n,t,i){return t>=i},function(n,t,i,a){return a.compare(t,i)>=0});class ia{constructor(t,i,a){this.type=_i,this.locale=a,this.caseSensitive=t,this.diacriticSensitive=i}static parse(t,i){if(t.length!==2)return i.error("Expected one argument.");const a=t[1];if(typeof a!="object"||Array.isArray(a))return i.error("Collator options argument must be an object.");const h=i.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,ct);if(!h)return null;const g=i.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,ct);if(!g)return null;let y=null;return a.locale&&(y=i.parse(a.locale,1,xt),!y)?null:new ia(h,g,y)}evaluate(t){return new mu(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class wu{constructor(t,i,a,h,g){this.type=xt,this.number=t,this.locale=i,this.currency=a,this.minFractionDigits=h,this.maxFractionDigits=g}static parse(t,i){if(t.length!==3)return i.error("Expected two arguments.");const a=i.parse(t[1],1,Oe);if(!a)return null;const h=t[2];if(typeof h!="object"||Array.isArray(h))return i.error("NumberFormat options argument must be an object.");let g=null;if(h.locale&&(g=i.parse(h.locale,1,xt),!g))return null;let y=null;if(h.currency&&(y=i.parse(h.currency,1,xt),!y))return null;let v=null;if(h["min-fraction-digits"]&&(v=i.parse(h["min-fraction-digits"],1,Oe),!v))return null;let b=null;return h["max-fraction-digits"]&&(b=i.parse(h["max-fraction-digits"],1,Oe),!b)?null:new wu(a,g,y,v,b)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Ya{constructor(t){this.type=Li,this.sections=t}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const a=t[1];if(!Array.isArray(a)&&typeof a=="object")return i.error("First argument must be an image or text section.");const h=[];let g=!1;for(let y=1;y<=t.length-1;++y){const v=t[y];if(g&&typeof v=="object"&&!Array.isArray(v)){g=!1;let b=null;if(v["font-scale"]&&(b=i.parse(v["font-scale"],1,Oe),!b))return null;let I=null;if(v["text-font"]&&(I=i.parse(v["text-font"],1,L(xt)),!I))return null;let C=null;if(v["text-color"]&&(C=i.parse(v["text-color"],1,an),!C))return null;const P=h[h.length-1];P.scale=b,P.font=I,P.textColor=C}else{const b=i.parse(t[y],1,yt);if(!b)return null;const I=b.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,h.push({content:b,scale:null,font:null,textColor:null})}}return new Ya(h)}evaluate(t){return new wn(this.sections.map(i=>{const a=i.content.evaluate(t);return _r(a)===vi?new gu("",a,null,null,null):new gu(ta(a),null,i.scale?i.scale.evaluate(t):null,i.font?i.font.evaluate(t).join(","):null,i.textColor?i.textColor.evaluate(t):null)}))}eachChild(t){for(const i of this.sections)t(i.content),i.scale&&t(i.scale),i.font&&t(i.font),i.textColor&&t(i.textColor)}outputDefined(){return!1}}class bu{constructor(t){this.type=vi,this.input=t}static parse(t,i){if(t.length!==2)return i.error("Expected two arguments.");const a=i.parse(t[1],1,xt);return a?new bu(a):i.error("No image name provided.")}evaluate(t){const i=this.input.evaluate(t),a=Sn.fromString(i);return a&&t.availableImages&&(a.available=t.availableImages.indexOf(i)>-1),a}eachChild(t){t(this.input)}outputDefined(){return!1}}class Su{constructor(t){this.type=Oe,this.input=t}static parse(t,i){if(t.length!==2)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);const a=i.parse(t[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${D(a.type)} instead.`):new Su(a):null}evaluate(t){const i=this.input.evaluate(t);if(typeof i=="string")return[...i].length;if(Array.isArray(i))return i.length;throw new hr(`Expected value to be of type string or array, but found ${D(_r(i))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const xi=8192;function Qp(n,t){const i=(180+n[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(i*h*xi),Math.round(a*h*xi)]}function ku(n,t){const i=Math.pow(2,t.z);return[(h=(n[0]/xi+t.x)/i,360*h-180),(a=(n[1]/xi+t.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90)];var a,h}function vs(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function ts(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function Rt(n,t,i){const a=n[0]-t[0],h=n[1]-t[1],g=n[0]-i[0],y=n[1]-i[1];return a*y-g*h==0&&a*g<=0&&h*y<=0}function Qa(n,t,i,a){return(h=[a[0]-i[0],a[1]-i[1]])[0]*(g=[t[0]-n[0],t[1]-n[1]])[1]-h[1]*g[0]!=0&&!(!Th(n,t,i,a)||!Th(i,a,n,t));var h,g}function ef(n,t,i){for(const a of i)for(let h=0;h<a.length-1;++h)if(Qa(n,t,a[h],a[h+1]))return!0;return!1}function eo(n,t,i=!1){let a=!1;for(const v of t)for(let b=0;b<v.length-1;b++){if(Rt(n,v[b],v[b+1]))return i;(g=v[b])[1]>(h=n)[1]!=(y=v[b+1])[1]>h[1]&&h[0]<(y[0]-g[0])*(h[1]-g[1])/(y[1]-g[1])+g[0]&&(a=!a)}var h,g,y;return a}function tf(n,t){for(const i of t)if(eo(n,i))return!0;return!1}function kh(n,t){for(const i of n)if(!eo(i,t))return!1;for(let i=0;i<n.length-1;++i)if(ef(n[i],n[i+1],t))return!1;return!0}function rf(n,t){for(const i of t)if(kh(n,i))return!0;return!1}function Th(n,t,i,a){const h=a[0]-i[0],g=a[1]-i[1],y=(n[0]-i[0])*g-h*(n[1]-i[1]),v=(t[0]-i[0])*g-h*(t[1]-i[1]);return y>0&&v<0||y<0&&v>0}function Tu(n,t,i){const a=[];for(let h=0;h<n.length;h++){const g=[];for(let y=0;y<n[h].length;y++){const v=Qp(n[h][y],i);vs(t,v),g.push(v)}a.push(g)}return a}function Ih(n,t,i){const a=[];for(let h=0;h<n.length;h++){const g=Tu(n[h],t,i);a.push(g)}return a}function Ch(n,t,i,a){if(n[0]<i[0]||n[0]>i[2]){const h=.5*a;let g=n[0]-i[0]>h?-a:i[0]-n[0]>h?a:0;g===0&&(g=n[0]-i[2]>h?-a:i[2]-n[0]>h?a:0),n[0]+=g}vs(t,n)}function Eh(n,t,i,a){const h=Math.pow(2,a.z)*xi,g=[a.x*xi,a.y*xi],y=[];for(const v of n)for(const b of v){const I=[b.x+g[0],b.y+g[1]];Ch(I,t,i,h),y.push(I)}return y}function Ph(n,t,i,a){const h=Math.pow(2,a.z)*xi,g=[a.x*xi,a.y*xi],y=[];for(const b of n){const I=[];for(const C of b){const P=[C.x+g[0],C.y+g[1]];vs(t,P),I.push(P)}y.push(I)}if(t[2]-t[0]<=h/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const b of y)for(const I of b)Ch(I,t,i,h)}var v;return y}class xs{constructor(t,i){this.type=ct,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(gs(t[1])){const a=t[1];if(a.type==="FeatureCollection"){const h=[];for(const g of a.features){const{type:y,coordinates:v}=g.geometry;y==="Polygon"&&h.push(v),y==="MultiPolygon"&&h.push(...v)}if(h.length)return new xs(a,{type:"MultiPolygon",coordinates:h})}else if(a.type==="Feature"){const h=a.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new xs(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new xs(a,a)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(i,a){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=i.canonicalID();if(a.type==="Polygon"){const v=Tu(a.coordinates,g,y),b=Eh(i.geometry(),h,g,y);if(!ts(h,g))return!1;for(const I of b)if(!eo(I,v))return!1}if(a.type==="MultiPolygon"){const v=Ih(a.coordinates,g,y),b=Eh(i.geometry(),h,g,y);if(!ts(h,g))return!1;for(const I of b)if(!tf(I,v))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(i,a){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=i.canonicalID();if(a.type==="Polygon"){const v=Tu(a.coordinates,g,y),b=Ph(i.geometry(),h,g,y);if(!ts(h,g))return!1;for(const I of b)if(!kh(I,v))return!1}if(a.type==="MultiPolygon"){const v=Ih(a.coordinates,g,y),b=Ph(i.geometry(),h,g,y);if(!ts(h,g))return!1;for(const I of b)if(!rf(I,v))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Mh=class{constructor(n=[],t=(i,a)=>i<a?-1:i>a?1:0){if(this.data=n,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:t,compare:i}=this,a=t[n];for(;n>0;){const h=n-1>>1,g=t[h];if(i(a,g)>=0)break;t[n]=g,n=h}t[n]=a}_down(n){const{data:t,compare:i}=this,a=this.length>>1,h=t[n];for(;n<a;){let g=1+(n<<1);const y=g+1;if(y<this.length&&i(t[y],t[g])<0&&(g=y),i(t[g],h)>=0)break;t[n]=t[g],n=g}t[n]=h}};function nf(n,t,i,a,h){zh(n,t,i,a||n.length-1,h||sf)}function zh(n,t,i,a,h){for(;a>i;){if(a-i>600){var g=a-i+1,y=t-i+1,v=Math.log(g),b=.5*Math.exp(2*v/3),I=.5*Math.sqrt(v*b*(g-b)/g)*(y-g/2<0?-1:1);zh(n,t,Math.max(i,Math.floor(t-y*b/g+I)),Math.min(a,Math.floor(t+(g-y)*b/g+I)),h)}var C=n[t],P=i,A=a;for(sa(n,i,t),h(n[a],C)>0&&sa(n,i,a);P<A;){for(sa(n,P,A),P++,A--;h(n[P],C)<0;)P++;for(;h(n[A],C)>0;)A--}h(n[i],C)===0?sa(n,i,A):sa(n,++A,a),A<=t&&(i=A+1),t<=A&&(a=A-1)}}function sa(n,t,i){var a=n[t];n[t]=n[i],n[i]=a}function sf(n,t){return n<t?-1:n>t?1:0}function el(n,t){if(n.length<=1)return[n];const i=[];let a,h;for(const g of n){const y=af(g);y!==0&&(g.area=Math.abs(y),h===void 0&&(h=y<0),h===y<0?(a&&i.push(a),a=[g]):a.push(g))}if(a&&i.push(a),t>1)for(let g=0;g<i.length;g++)i[g].length<=t||(nf(i[g],t,1,i[g].length-1,of),i[g]=i[g].slice(0,t));return i}function of(n,t){return t.area-n.area}function af(n){let t=0;for(let i,a,h=0,g=n.length,y=g-1;h<g;y=h++)i=n[h],a=n[y],t+=(a.x-i.x)*(i.y+a.y);return t}const Ah=1/298.257223563,Dh=Ah*(2-Ah),Lh=Math.PI/180;class Iu{constructor(t){const i=6378.137*Lh*1e3,a=Math.cos(t*Lh),h=1/(1-Dh*(1-a*a)),g=Math.sqrt(h);this.kx=i*g*a,this.ky=i*g*h*(1-Dh)}distance(t,i){const a=this.wrap(t[0]-i[0])*this.kx,h=(t[1]-i[1])*this.ky;return Math.sqrt(a*a+h*h)}pointOnLine(t,i){let a,h,g,y,v=1/0;for(let b=0;b<t.length-1;b++){let I=t[b][0],C=t[b][1],P=this.wrap(t[b+1][0]-I)*this.kx,A=(t[b+1][1]-C)*this.ky,R=0;P===0&&A===0||(R=(this.wrap(i[0]-I)*this.kx*P+(i[1]-C)*this.ky*A)/(P*P+A*A),R>1?(I=t[b+1][0],C=t[b+1][1]):R>0&&(I+=P/this.kx*R,C+=A/this.ky*R)),P=this.wrap(i[0]-I)*this.kx,A=(i[1]-C)*this.ky;const O=P*P+A*A;O<v&&(v=O,a=I,h=C,g=b,y=R)}return{point:[a,h],index:g,t:Math.max(0,Math.min(1,y))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Rh(n,t){return t[0]-n[0]}function tl(n){return n[1]-n[0]+1}function Ri(n,t){return n[1]>=n[0]&&n[1]<t}function Cu(n,t){if(n[0]>n[1])return[null,null];const i=tl(n);if(t){if(i===2)return[n,null];const h=Math.floor(i/2);return[[n[0],n[0]+h],[n[0]+h,n[1]]]}if(i===1)return[n,null];const a=Math.floor(i/2)-1;return[[n[0],n[0]+a],[n[0]+a+1,n[1]]]}function Eu(n,t){if(!Ri(t,n.length))return[1/0,1/0,-1/0,-1/0];const i=[1/0,1/0,-1/0,-1/0];for(let a=t[0];a<=t[1];++a)vs(i,n[a]);return i}function Pu(n){const t=[1/0,1/0,-1/0,-1/0];for(const i of n)for(const a of i)vs(t,a);return t}function rl(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function Mu(n,t,i){if(!rl(n)||!rl(t))return NaN;let a=0,h=0;return n[2]<t[0]&&(a=t[0]-n[2]),n[0]>t[2]&&(a=n[0]-t[2]),n[1]>t[3]&&(h=n[1]-t[3]),n[3]<t[1]&&(h=t[1]-n[3]),i.distance([0,0],[a,h])}function ws(n,t,i){const a=i.pointOnLine(t,n);return i.distance(n,a.point)}function zu(n,t,i,a,h){const g=Math.min(ws(n,[i,a],h),ws(t,[i,a],h)),y=Math.min(ws(i,[n,t],h),ws(a,[n,t],h));return Math.min(g,y)}function lf(n,t,i,a,h){if(!Ri(t,n.length)||!Ri(a,i.length))return 1/0;let g=1/0;for(let y=t[0];y<t[1];++y){const v=n[y],b=n[y+1];for(let I=a[0];I<a[1];++I){const C=i[I],P=i[I+1];if(Qa(v,b,C,P))return 0;g=Math.min(g,zu(v,b,C,P,h))}}return g}function ar(n,t,i,a,h){if(!Ri(t,n.length)||!Ri(a,i.length))return NaN;let g=1/0;for(let y=t[0];y<=t[1];++y)for(let v=a[0];v<=a[1];++v)if(g=Math.min(g,h.distance(n[y],i[v])),g===0)return g;return g}function uf(n,t,i){if(eo(n,t,!0))return 0;let a=1/0;for(const h of t){const g=h[0],y=h[h.length-1];if(g!==y&&(a=Math.min(a,ws(n,[y,g],i)),a===0))return a;const v=i.pointOnLine(h,n);if(a=Math.min(a,i.distance(n,v.point)),a===0)return a}return a}function bt(n,t,i,a){if(!Ri(t,n.length))return NaN;for(let g=t[0];g<=t[1];++g)if(eo(n[g],i,!0))return 0;let h=1/0;for(let g=t[0];g<t[1];++g){const y=n[g],v=n[g+1];for(const b of i)for(let I=0,C=b.length,P=C-1;I<C;P=I++){const A=b[P],R=b[I];if(Qa(y,v,A,R))return 0;h=Math.min(h,zu(y,v,A,R,a))}}return h}function nl(n,t){for(const i of n)for(const a of i)if(eo(a,t,!0))return!0;return!1}function qt(n,t,i,a=1/0){const h=Pu(n),g=Pu(t);if(a!==1/0&&Mu(h,g,i)>=a)return a;if(ts(h,g)){if(nl(n,t))return 0}else if(nl(t,n))return 0;let y=1/0;for(const v of n)for(let b=0,I=v.length,C=I-1;b<I;C=b++){const P=v[C],A=v[b];for(const R of t)for(let O=0,N=R.length,H=N-1;O<N;H=O++){const Y=R[H],fe=R[O];if(Qa(P,A,Y,fe))return 0;y=Math.min(y,zu(P,A,Y,fe,i))}}return y}function jt(n,t,i,a,h,g){if(!g)return;const y=Mu(Eu(a,g),h,i);y<t&&n.push([y,g,[0,0]])}function bs(n,t,i,a,h,g,y){if(!g||!y)return;const v=Mu(Eu(a,g),Eu(h,y),i);v<t&&n.push([v,g,y])}function oa(n,t,i,a,h=1/0){let g=Math.min(a.distance(n[0],i[0][0]),h);if(g===0)return g;const y=new Mh([[0,[0,n.length-1],[0,0]]],Rh),v=Pu(i);for(;y.length>0;){const b=y.pop();if(b[0]>=g)continue;const I=b[1],C=t?50:100;if(tl(I)<=C){if(!Ri(I,n.length))return NaN;if(t){const P=bt(n,I,i,a);if(isNaN(P)||P===0)return P;g=Math.min(g,P)}else for(let P=I[0];P<=I[1];++P){const A=uf(n[P],i,a);if(g=Math.min(g,A),g===0)return 0}}else{const P=Cu(I,t);jt(y,g,a,n,v,P[0]),jt(y,g,a,n,v,P[1])}}return g}function aa(n,t,i,a,h,g=1/0){let y=Math.min(g,h.distance(n[0],i[0]));if(y===0)return y;const v=new Mh([[0,[0,n.length-1],[0,i.length-1]]],Rh);for(;v.length>0;){const b=v.pop();if(b[0]>=y)continue;const I=b[1],C=b[2],P=t?50:100,A=a?50:100;if(tl(I)<=P&&tl(C)<=A){if(!Ri(I,n.length)&&Ri(C,i.length))return NaN;let R;if(t&&a)R=lf(n,I,i,C,h),y=Math.min(y,R);else if(t&&!a){const O=n.slice(I[0],I[1]+1);for(let N=C[0];N<=C[1];++N)if(R=ws(i[N],O,h),y=Math.min(y,R),y===0)return y}else if(!t&&a){const O=i.slice(C[0],C[1]+1);for(let N=I[0];N<=I[1];++N)if(R=ws(n[N],O,h),y=Math.min(y,R),y===0)return y}else R=ar(n,I,i,C,h),y=Math.min(y,R)}else{const R=Cu(I,t),O=Cu(C,a);bs(v,y,h,n,i,R[0],O[0]),bs(v,y,h,n,i,R[0],O[1]),bs(v,y,h,n,i,R[1],O[0]),bs(v,y,h,n,i,R[1],O[1])}}return y}function Au(n){return n.type==="MultiPolygon"?n.coordinates.map(t=>({type:"Polygon",coordinates:t})):n.type==="MultiLineString"?n.coordinates.map(t=>({type:"LineString",coordinates:t})):n.type==="MultiPoint"?n.coordinates.map(t=>({type:"Point",coordinates:t})):[n]}class Ss{constructor(t,i){this.type=Oe,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(gs(t[1])){const a=t[1];if(a.type==="FeatureCollection")return new Ss(a,a.features.map(h=>Au(h.geometry)).flat());if(a.type==="Feature")return new Ss(a,Au(a.geometry));if("type"in a&&"coordinates"in a)return new Ss(a,Au(a))}return i.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(i,a){const h=i.geometry(),g=h.flat().map(b=>ku([b.x,b.y],i.canonical));if(h.length===0)return NaN;const y=new Iu(g[0][1]);let v=1/0;for(const b of a){switch(b.type){case"Point":v=Math.min(v,aa(g,!1,[b.coordinates],!1,y,v));break;case"LineString":v=Math.min(v,aa(g,!1,b.coordinates,!0,y,v));break;case"Polygon":v=Math.min(v,oa(g,!1,b.coordinates,y,v))}if(v===0)return v}return v}(t,this.geometries);if(t.geometryType()==="LineString")return function(i,a){const h=i.geometry(),g=h.flat().map(b=>ku([b.x,b.y],i.canonical));if(h.length===0)return NaN;const y=new Iu(g[0][1]);let v=1/0;for(const b of a){switch(b.type){case"Point":v=Math.min(v,aa(g,!0,[b.coordinates],!1,y,v));break;case"LineString":v=Math.min(v,aa(g,!0,b.coordinates,!0,y,v));break;case"Polygon":v=Math.min(v,oa(g,!0,b.coordinates,y,v))}if(v===0)return v}return v}(t,this.geometries);if(t.geometryType()==="Polygon")return function(i,a){const h=i.geometry();if(h.length===0||h[0].length===0)return NaN;const g=el(h,0).map(b=>b.map(I=>I.map(C=>ku([C.x,C.y],i.canonical)))),y=new Iu(g[0][0][0][1]);let v=1/0;for(const b of a)for(const I of g){switch(b.type){case"Point":v=Math.min(v,oa([b.coordinates],!1,I,y,v));break;case"LineString":v=Math.min(v,oa(b.coordinates,!0,I,y,v));break;case"Polygon":v=Math.min(v,qt(I,b.coordinates,y,v))}if(v===0)return v}return v}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const to={"==":Kp,"!=":wh,">":Jp,"<":bh,">=":Sh,"<=":Yp,array:Jn,at:_u,boolean:Jn,case:Ha,coalesce:Ka,collator:ia,format:Ya,image:bu,in:vu,"index-of":Js,interpolate:un,"interpolate-hcl":un,"interpolate-lab":un,length:Su,let:es,literal:Kn,match:xu,number:Jn,"number-format":wu,object:Jn,slice:ra,step:Ys,string:Jn,"to-boolean":Yn,"to-color":Yn,"to-number":Yn,"to-string":Yn,var:Lt,within:xs,distance:Ss};class Rn{constructor(t,i,a,h){this.name=t,this.type=i,this._evaluate=a,this.args=h}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,i){const a=t[0],h=Rn.definitions[a];if(!h)return i.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(h)?h[0]:h.type,y=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=y.filter(([I])=>!Array.isArray(I)||I.length===t.length-1);let b=null;for(const[I,C]of v){b=new ys(i.registry,la,i.path,null,i.scope);const P=[];let A=!1;for(let R=1;R<t.length;R++){const O=t[R],N=Array.isArray(I)?I[R-1]:I.type,H=b.parse(O,1+P.length,N);if(!H){A=!0;break}P.push(H)}if(!A)if(Array.isArray(I)&&I.length!==P.length)b.error(`Expected ${I.length} arguments, but found ${P.length} instead.`);else{for(let R=0;R<P.length;R++){const O=Array.isArray(I)?I[R]:I.type,N=P[R];b.concat(R+1).checkSubtype(O,N.type)}if(b.errors.length===0)return new Rn(a,g,C,P)}}if(v.length===1)i.errors.push(...b.errors);else{const I=(v.length?v:y).map(([P])=>{return A=P,Array.isArray(A)?`(${A.map(D).join(", ")})`:`(${D(A.type)}...)`;var A}).join(" | "),C=[];for(let P=1;P<t.length;P++){const A=i.parse(t[P],1+C.length);if(!A)return null;C.push(D(A.type))}i.error(`Expected arguments of type ${I}, but found (${C.join(", ")}) instead.`)}return null}static register(t,i){Rn.definitions=i;for(const a in i)t[a]=Rn}}function Du(n,[t,i,a,h]){t=t.evaluate(n),i=i.evaluate(n),a=a.evaluate(n);const g=h?h.evaluate(n):1,y=Ks(t,i,a,g);if(y)throw new hr(y);return new Nt(t/255,i/255,a/255,g,!1)}function Lu(n,t){return n in t}function Ru(n,t){const i=t[n];return i===void 0?null:i}function ks(n){return{type:n}}function la(n){if(n instanceof Lt)return la(n.boundExpression);if(n instanceof Rn&&n.name==="error"||n instanceof ia||n instanceof xs||n instanceof Ss)return!1;const t=n instanceof Yn||n instanceof Jn;let i=!0;return n.eachChild(a=>{i=t?i&&la(a):i&&a instanceof Kn}),!!i&&ua(n)&&ca(n,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ua(n){if(n instanceof Rn&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof xs||n instanceof Ss)return!1;let t=!0;return n.eachChild(i=>{t&&!ua(i)&&(t=!1)}),t}function ro(n){if(n instanceof Rn&&n.name==="feature-state")return!1;let t=!0;return n.eachChild(i=>{t&&!ro(i)&&(t=!1)}),t}function ca(n,t){if(n instanceof Rn&&t.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(a=>{i&&!ca(a,t)&&(i=!1)}),i}function il(n){return{result:"success",value:n}}function no(n){return{result:"error",value:n}}function io(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function Fh(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Fu(n){return!!n.expression&&n.expression.interpolated}function zt(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function sl(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function cf(n){return n}function Bh(n,t){const i=t.type==="color",a=n.stops&&typeof n.stops[0][0]=="object",h=a||!(a||n.property!==void 0),g=n.type||(Fu(t)?"exponential":"interval");if(i||t.type==="padding"){const C=i?Nt.parse:bn.parse;(n=gi({},n)).stops&&(n.stops=n.stops.map(P=>[P[0],C(P[1])])),n.default=C(n.default?n.default:t.default)}if(n.colorSpace&&(y=n.colorSpace)!=="rgb"&&y!=="hcl"&&y!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var y;let v,b,I;if(g==="exponential")v=Nh;else if(g==="interval")v=ol;else if(g==="categorical"){v=Oh,b=Object.create(null);for(const C of n.stops)b[C[0]]=C[1];I=typeof n.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);v=jh}if(a){const C={},P=[];for(let O=0;O<n.stops.length;O++){const N=n.stops[O],H=N[0].zoom;C[H]===void 0&&(C[H]={zoom:H,type:n.type,property:n.property,default:n.default,stops:[]},P.push(H)),C[H].stops.push([N[0].value,N[1]])}const A=[];for(const O of P)A.push([C[O].zoom,Bh(C[O],t)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:un.interpolationFactor.bind(void 0,R),zoomStops:A.map(O=>O[0]),evaluate:({zoom:O},N)=>Nh({stops:A,base:n.base},t,O).evaluate(O,N)}}if(h){const C=g==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:un.interpolationFactor.bind(void 0,C),zoomStops:n.stops.map(P=>P[0]),evaluate:({zoom:P})=>v(n,t,P,b,I)}}return{kind:"source",evaluate(C,P){const A=P&&P.properties?P.properties[n.property]:void 0;return A===void 0?so(n.default,t.default):v(n,t,A,b,I)}}}function so(n,t,i){return n!==void 0?n:t!==void 0?t:i!==void 0?i:void 0}function Oh(n,t,i,a,h){return so(typeof i===h?a[i]:void 0,n.default,t.default)}function ol(n,t,i){if(zt(i)!=="number")return so(n.default,t.default);const a=n.stops.length;if(a===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[a-1][0])return n.stops[a-1][1];const h=Wa(n.stops.map(g=>g[0]),i);return n.stops[h][1]}function Nh(n,t,i){const a=n.base!==void 0?n.base:1;if(zt(i)!=="number")return so(n.default,t.default);const h=n.stops.length;if(h===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[h-1][0])return n.stops[h-1][1];const g=Wa(n.stops.map(C=>C[0]),i),y=function(C,P,A,R){const O=R-A,N=C-A;return O===0?0:P===1?N/O:(Math.pow(P,N)-1)/(Math.pow(P,O)-1)}(i,a,n.stops[g][0],n.stops[g+1][0]),v=n.stops[g][1],b=n.stops[g+1][1],I=ln[t.type]||cf;return typeof v.evaluate=="function"?{evaluate(...C){const P=v.evaluate.apply(void 0,C),A=b.evaluate.apply(void 0,C);if(P!==void 0&&A!==void 0)return I(P,A,y,n.colorSpace)}}:I(v,b,y,n.colorSpace)}function jh(n,t,i){switch(t.type){case"color":i=Nt.parse(i);break;case"formatted":i=wn.fromString(i.toString());break;case"resolvedImage":i=Sn.fromString(i.toString());break;case"padding":i=bn.parse(i);break;default:zt(i)===t.type||t.type==="enum"&&t.values[i]||(i=void 0)}return so(i,n.default,t.default)}Rn.register(to,{error:[{kind:"error"},[xt],(n,[t])=>{throw new hr(t.evaluate(n))}],typeof:[xt,[yt],(n,[t])=>D(_r(t.evaluate(n)))],"to-rgba":[L(Oe,4),[an],(n,[t])=>{const[i,a,h,g]=t.evaluate(n).rgb;return[255*i,255*a,255*h,g]}],rgb:[an,[Oe,Oe,Oe],Du],rgba:[an,[Oe,Oe,Oe,Oe],Du],has:{type:ct,overloads:[[[xt],(n,[t])=>Lu(t.evaluate(n),n.properties())],[[xt,Xn],(n,[t,i])=>Lu(t.evaluate(n),i.evaluate(n))]]},get:{type:yt,overloads:[[[xt],(n,[t])=>Ru(t.evaluate(n),n.properties())],[[xt,Xn],(n,[t,i])=>Ru(t.evaluate(n),i.evaluate(n))]]},"feature-state":[yt,[xt],(n,[t])=>Ru(t.evaluate(n),n.featureState||{})],properties:[Xn,[],n=>n.properties()],"geometry-type":[xt,[],n=>n.geometryType()],id:[yt,[],n=>n.id()],zoom:[Oe,[],n=>n.globals.zoom],"heatmap-density":[Oe,[],n=>n.globals.heatmapDensity||0],"line-progress":[Oe,[],n=>n.globals.lineProgress||0],accumulated:[yt,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Oe,ks(Oe),(n,t)=>{let i=0;for(const a of t)i+=a.evaluate(n);return i}],"*":[Oe,ks(Oe),(n,t)=>{let i=1;for(const a of t)i*=a.evaluate(n);return i}],"-":{type:Oe,overloads:[[[Oe,Oe],(n,[t,i])=>t.evaluate(n)-i.evaluate(n)],[[Oe],(n,[t])=>-t.evaluate(n)]]},"/":[Oe,[Oe,Oe],(n,[t,i])=>t.evaluate(n)/i.evaluate(n)],"%":[Oe,[Oe,Oe],(n,[t,i])=>t.evaluate(n)%i.evaluate(n)],ln2:[Oe,[],()=>Math.LN2],pi:[Oe,[],()=>Math.PI],e:[Oe,[],()=>Math.E],"^":[Oe,[Oe,Oe],(n,[t,i])=>Math.pow(t.evaluate(n),i.evaluate(n))],sqrt:[Oe,[Oe],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[Oe,[Oe],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[Oe,[Oe],(n,[t])=>Math.log(t.evaluate(n))],log2:[Oe,[Oe],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[Oe,[Oe],(n,[t])=>Math.sin(t.evaluate(n))],cos:[Oe,[Oe],(n,[t])=>Math.cos(t.evaluate(n))],tan:[Oe,[Oe],(n,[t])=>Math.tan(t.evaluate(n))],asin:[Oe,[Oe],(n,[t])=>Math.asin(t.evaluate(n))],acos:[Oe,[Oe],(n,[t])=>Math.acos(t.evaluate(n))],atan:[Oe,[Oe],(n,[t])=>Math.atan(t.evaluate(n))],min:[Oe,ks(Oe),(n,t)=>Math.min(...t.map(i=>i.evaluate(n)))],max:[Oe,ks(Oe),(n,t)=>Math.max(...t.map(i=>i.evaluate(n)))],abs:[Oe,[Oe],(n,[t])=>Math.abs(t.evaluate(n))],round:[Oe,[Oe],(n,[t])=>{const i=t.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[Oe,[Oe],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[Oe,[Oe],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[ct,[xt,yt],(n,[t,i])=>n.properties()[t.value]===i.value],"filter-id-==":[ct,[yt],(n,[t])=>n.id()===t.value],"filter-type-==":[ct,[xt],(n,[t])=>n.geometryType()===t.value],"filter-<":[ct,[xt,yt],(n,[t,i])=>{const a=n.properties()[t.value],h=i.value;return typeof a==typeof h&&a<h}],"filter-id-<":[ct,[yt],(n,[t])=>{const i=n.id(),a=t.value;return typeof i==typeof a&&i<a}],"filter->":[ct,[xt,yt],(n,[t,i])=>{const a=n.properties()[t.value],h=i.value;return typeof a==typeof h&&a>h}],"filter-id->":[ct,[yt],(n,[t])=>{const i=n.id(),a=t.value;return typeof i==typeof a&&i>a}],"filter-<=":[ct,[xt,yt],(n,[t,i])=>{const a=n.properties()[t.value],h=i.value;return typeof a==typeof h&&a<=h}],"filter-id-<=":[ct,[yt],(n,[t])=>{const i=n.id(),a=t.value;return typeof i==typeof a&&i<=a}],"filter->=":[ct,[xt,yt],(n,[t,i])=>{const a=n.properties()[t.value],h=i.value;return typeof a==typeof h&&a>=h}],"filter-id->=":[ct,[yt],(n,[t])=>{const i=n.id(),a=t.value;return typeof i==typeof a&&i>=a}],"filter-has":[ct,[yt],(n,[t])=>t.value in n.properties()],"filter-has-id":[ct,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[ct,[L(xt)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[ct,[L(yt)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[ct,[xt,L(yt)],(n,[t,i])=>i.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[ct,[xt,L(yt)],(n,[t,i])=>function(a,h,g,y){for(;g<=y;){const v=g+y>>1;if(h[v]===a)return!0;h[v]>a?y=v-1:g=v+1}return!1}(n.properties()[t.value],i.value,0,i.value.length-1)],all:{type:ct,overloads:[[[ct,ct],(n,[t,i])=>t.evaluate(n)&&i.evaluate(n)],[ks(ct),(n,t)=>{for(const i of t)if(!i.evaluate(n))return!1;return!0}]]},any:{type:ct,overloads:[[[ct,ct],(n,[t,i])=>t.evaluate(n)||i.evaluate(n)],[ks(ct),(n,t)=>{for(const i of t)if(i.evaluate(n))return!0;return!1}]]},"!":[ct,[ct],(n,[t])=>!t.evaluate(n)],"is-supported-script":[ct,[xt],(n,[t])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(t.evaluate(n))}],upcase:[xt,[xt],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[xt,[xt],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[xt,ks(yt),(n,t)=>t.map(i=>ta(i.evaluate(n))).join("")],"resolved-locale":[xt,[_i],(n,[t])=>t.evaluate(n).resolvedLocale()]});class al{constructor(t,i){var a;this.expression=t,this._warningHistory={},this._evaluator=new Ga,this._defaultValue=i?(a=i).type==="color"&&sl(a.default)?new Nt(0,0,0,0):a.type==="color"?Nt.parse(a.default)||null:a.type==="padding"?bn.parse(a.default)||null:a.type==="variableAnchorOffsetCollection"?Ln.parse(a.default)||null:a.default===void 0?null:a.default:null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(t,i,a,h,g,y){return this._evaluator.globals=t,this._evaluator.feature=i,this._evaluator.featureState=a,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(t,i,a,h,g,y){this._evaluator.globals=t,this._evaluator.feature=i||null,this._evaluator.featureState=a||null,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new hr(`Expected value to be one of ${Object.keys(this._enumValues).map(b=>JSON.stringify(b)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function ll(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in to}function oo(n,t){const i=new ys(to,la,[],t?function(h){const g={color:an,string:xt,number:Oe,enum:xt,boolean:ct,formatted:Li,padding:Qi,resolvedImage:vi,variableAnchorOffsetCollection:J};return h.type==="array"?L(g[h.value]||yt,h.length):g[h.type]}(t):void 0),a=i.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?il(new al(a,t)):no(i.errors)}class ao{constructor(t,i){this.kind=t,this._styleExpression=i,this.isStateDependent=t!=="constant"&&!ro(i.expression)}evaluateWithoutErrorHandling(t,i,a,h,g,y){return this._styleExpression.evaluateWithoutErrorHandling(t,i,a,h,g,y)}evaluate(t,i,a,h,g,y){return this._styleExpression.evaluate(t,i,a,h,g,y)}}class lo{constructor(t,i,a,h){this.kind=t,this.zoomStops=a,this._styleExpression=i,this.isStateDependent=t!=="camera"&&!ro(i.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,i,a,h,g,y){return this._styleExpression.evaluateWithoutErrorHandling(t,i,a,h,g,y)}evaluate(t,i,a,h,g,y){return this._styleExpression.evaluate(t,i,a,h,g,y)}interpolationFactor(t,i,a){return this.interpolationType?un.interpolationFactor(this.interpolationType,t,i,a):0}}function Bu(n,t){const i=oo(n,t);if(i.result==="error")return i;const a=i.value.expression,h=ua(a);if(!h&&!io(t))return no([new Hr("","data expressions not supported")]);const g=ca(a,["zoom"]);if(!g&&!Fh(t))return no([new Hr("","zoom expressions not supported")]);const y=ha(a);return y||g?y instanceof Hr?no([y]):y instanceof un&&!Fu(t)?no([new Hr("",'"interpolate" expressions cannot be used with this property')]):il(y?new lo(h?"camera":"composite",i.value,y.labels,y instanceof un?y.interpolation:void 0):new ao(h?"constant":"source",i.value)):no([new Hr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class uo{constructor(t,i){this._parameters=t,this._specification=i,gi(this,Bh(this._parameters,this._specification))}static deserialize(t){return new uo(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function ha(n){let t=null;if(n instanceof es)t=ha(n.result);else if(n instanceof Ka){for(const i of n.args)if(t=ha(i),t)break}else(n instanceof Ys||n instanceof un)&&n.input instanceof Rn&&n.input.name==="zoom"&&(t=n);return t instanceof Hr||n.eachChild(i=>{const a=ha(i);a instanceof Hr?t=a:!t&&a?t=new Hr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&a&&t!==a&&(t=new Hr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function ul(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!ul(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const cl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ou(n){if(n==null)return{filter:()=>!0,needGeometry:!1};ul(n)||(n=hl(n));const t=oo(n,cl);if(t.result==="error")throw new Error(t.value.map(i=>`${i.key}: ${i.message}`).join(", "));return{filter:(i,a,h)=>t.value.evaluate(i,a,{},h),needGeometry:Vh(n)}}function hf(n,t){return n<t?-1:n>t?1:0}function Vh(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let t=1;t<n.length;t++)if(Vh(n[t]))return!0;return!1}function hl(n){if(!n)return!0;const t=n[0];return n.length<=1?t!=="any":t==="=="?Nu(n[1],n[2],"=="):t==="!="?Br(Nu(n[1],n[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Nu(n[1],n[2],t):t==="any"?(i=n.slice(1),["any"].concat(i.map(hl))):t==="all"?["all"].concat(n.slice(1).map(hl)):t==="none"?["all"].concat(n.slice(1).map(hl).map(Br)):t==="in"?da(n[1],n.slice(2)):t==="!in"?Br(da(n[1],n.slice(2))):t==="has"?pa(n[1]):t!=="!has"||Br(pa(n[1]));var i}function Nu(n,t,i){switch(n){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,n,t]}}function da(n,t){if(t.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(i=>typeof i!=typeof t[0])?["filter-in-large",n,["literal",t.sort(hf)]]:["filter-in-small",n,["literal",t]]}}function pa(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Br(n){return["!",n]}function Ts(n){const t=typeof n;if(t==="number"||t==="boolean"||t==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let h="[";for(const g of n)h+=`${Ts(g)},`;return`${h}]`}const i=Object.keys(n).sort();let a="{";for(let h=0;h<i.length;h++)a+=`${JSON.stringify(i[h])}:${Ts(n[i[h]])},`;return`${a}}`}function Uh(n){let t="";for(const i of ms)t+=`/${Ts(n[i])}`;return t}function $h(n){const t=n.value;return t?[new De(n.key,t,"constants have been deprecated as of v8")]:[]}function lr(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Qn(n){if(Array.isArray(n))return n.map(Qn);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const i in n)t[i]=Qn(n[i]);return t}return lr(n)}function kn(n){const t=n.key,i=n.value,a=n.valueSpec||{},h=n.objectElementValidators||{},g=n.style,y=n.styleSpec,v=n.validateSpec;let b=[];const I=zt(i);if(I!=="object")return[new De(t,i,`object expected, ${I} found`)];for(const C in i){const P=C.split(".")[0],A=a[P]||a["*"];let R;if(h[P])R=h[P];else if(a[P])R=v;else if(h["*"])R=h["*"];else{if(!a["*"]){b.push(new De(t,i[C],`unknown property "${C}"`));continue}R=v}b=b.concat(R({key:(t&&`${t}.`)+C,value:i[C],valueSpec:A,style:g,styleSpec:y,object:i,objectKey:C,validateSpec:v},i))}for(const C in a)h[C]||a[C].required&&a[C].default===void 0&&i[C]===void 0&&b.push(new De(t,i,`missing required property "${C}"`));return b}function fa(n){const t=n.value,i=n.valueSpec,a=n.style,h=n.styleSpec,g=n.key,y=n.arrayElementValidator||n.validateSpec;if(zt(t)!=="array")return[new De(g,t,`array expected, ${zt(t)} found`)];if(i.length&&t.length!==i.length)return[new De(g,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new De(g,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let v={type:i.value,values:i.values};h.$version<7&&(v.function=i.function),zt(i.value)==="object"&&(v=i.value);let b=[];for(let I=0;I<t.length;I++)b=b.concat(y({array:t,arrayIndex:I,value:t[I],valueSpec:v,validateSpec:n.validateSpec,style:a,styleSpec:h,key:`${g}[${I}]`}));return b}function ju(n){const t=n.key,i=n.value,a=n.valueSpec;let h=zt(i);return h==="number"&&i!=i&&(h="NaN"),h!=="number"?[new De(t,i,`number expected, ${h} found`)]:"minimum"in a&&i<a.minimum?[new De(t,i,`${i} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&i>a.maximum?[new De(t,i,`${i} is greater than the maximum value ${a.maximum}`)]:[]}function dl(n){const t=n.valueSpec,i=lr(n.value.type);let a,h,g,y={};const v=i!=="categorical"&&n.value.property===void 0,b=!v,I=zt(n.value.stops)==="array"&&zt(n.value.stops[0])==="array"&&zt(n.value.stops[0][0])==="object",C=kn({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(R){if(i==="identity")return[new De(R.key,R.value,'identity function may not have a "stops" property')];let O=[];const N=R.value;return O=O.concat(fa({key:R.key,value:N,valueSpec:R.valueSpec,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:P})),zt(N)==="array"&&N.length===0&&O.push(new De(R.key,N,"array must have at least one stop")),O},default:function(R){return R.validateSpec({key:R.key,value:R.value,valueSpec:t,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec})}}});return i==="identity"&&v&&C.push(new De(n.key,n.value,'missing required property "property"')),i==="identity"||n.value.stops||C.push(new De(n.key,n.value,'missing required property "stops"')),i==="exponential"&&n.valueSpec.expression&&!Fu(n.valueSpec)&&C.push(new De(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(b&&!io(n.valueSpec)?C.push(new De(n.key,n.value,"property functions not supported")):v&&!Fh(n.valueSpec)&&C.push(new De(n.key,n.value,"zoom functions not supported"))),i!=="categorical"&&!I||n.value.property!==void 0||C.push(new De(n.key,n.value,'"property" property is required')),C;function P(R){let O=[];const N=R.value,H=R.key;if(zt(N)!=="array")return[new De(H,N,`array expected, ${zt(N)} found`)];if(N.length!==2)return[new De(H,N,`array length 2 expected, length ${N.length} found`)];if(I){if(zt(N[0])!=="object")return[new De(H,N,`object expected, ${zt(N[0])} found`)];if(N[0].zoom===void 0)return[new De(H,N,"object stop key must have zoom")];if(N[0].value===void 0)return[new De(H,N,"object stop key must have value")];if(g&&g>lr(N[0].zoom))return[new De(H,N[0].zoom,"stop zoom values must appear in ascending order")];lr(N[0].zoom)!==g&&(g=lr(N[0].zoom),h=void 0,y={}),O=O.concat(kn({key:`${H}[0]`,value:N[0],valueSpec:{zoom:{}},validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec,objectElementValidators:{zoom:ju,value:A}}))}else O=O.concat(A({key:`${H}[0]`,value:N[0],validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec},N));return ll(Qn(N[1]))?O.concat([new De(`${H}[1]`,N[1],"expressions are not allowed in function stops.")]):O.concat(R.validateSpec({key:`${H}[1]`,value:N[1],valueSpec:t,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec}))}function A(R,O){const N=zt(R.value),H=lr(R.value),Y=R.value!==null?R.value:O;if(a){if(N!==a)return[new De(R.key,Y,`${N} stop domain type must match previous stop domain type ${a}`)]}else a=N;if(N!=="number"&&N!=="string"&&N!=="boolean")return[new De(R.key,Y,"stop domain value must be a number, string, or boolean")];if(N!=="number"&&i!=="categorical"){let fe=`number expected, ${N} found`;return io(t)&&i===void 0&&(fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new De(R.key,Y,fe)]}return i!=="categorical"||N!=="number"||isFinite(H)&&Math.floor(H)===H?i!=="categorical"&&N==="number"&&h!==void 0&&H<h?[new De(R.key,Y,"stop domain values must appear in ascending order")]:(h=H,i==="categorical"&&H in y?[new De(R.key,Y,"stop domain values must be unique")]:(y[H]=!0,[])):[new De(R.key,Y,`integer expected, found ${H}`)]}}function co(n){const t=(n.expressionContext==="property"?Bu:oo)(Qn(n.value),n.valueSpec);if(t.result==="error")return t.value.map(a=>new De(`${n.key}${a.key}`,n.value,a.message));const i=t.value.expression||t.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!i.outputDefined())return[new De(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!ro(i))return[new De(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!ro(i))return[new De(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!ca(i,["zoom","feature-state"]))return[new De(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!ua(i))return[new De(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Fi(n){const t=n.key,i=n.value,a=n.valueSpec,h=[];return Array.isArray(a.values)?a.values.indexOf(lr(i))===-1&&h.push(new De(t,i,`expected one of [${a.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(a.values).indexOf(lr(i))===-1&&h.push(new De(t,i,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(i)} found`)),h}function Vu(n){return ul(Qn(n.value))?co(gi({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):pl(n)}function pl(n){const t=n.value,i=n.key;if(zt(t)!=="array")return[new De(i,t,`array expected, ${zt(t)} found`)];const a=n.styleSpec;let h,g=[];if(t.length<1)return[new De(i,t,"filter array must have at least 1 element")];switch(g=g.concat(Fi({key:`${i}[0]`,value:t[0],valueSpec:a.filter_operator,style:n.style,styleSpec:n.styleSpec})),lr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&lr(t[1])==="$type"&&g.push(new De(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&g.push(new De(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(h=zt(t[1]),h!=="string"&&g.push(new De(`${i}[1]`,t[1],`string expected, ${h} found`)));for(let y=2;y<t.length;y++)h=zt(t[y]),lr(t[1])==="$type"?g=g.concat(Fi({key:`${i}[${y}]`,value:t[y],valueSpec:a.geometry_type,style:n.style,styleSpec:n.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&g.push(new De(`${i}[${y}]`,t[y],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let y=1;y<t.length;y++)g=g.concat(pl({key:`${i}[${y}]`,value:t[y],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":h=zt(t[1]),t.length!==2?g.push(new De(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):h!=="string"&&g.push(new De(`${i}[1]`,t[1],`string expected, ${h} found`))}return g}function Uu(n,t){const i=n.key,a=n.validateSpec,h=n.style,g=n.styleSpec,y=n.value,v=n.objectKey,b=g[`${t}_${n.layerType}`];if(!b)return[];const I=v.match(/^(.*)-transition$/);if(t==="paint"&&I&&b[I[1]]&&b[I[1]].transition)return a({key:i,value:y,valueSpec:g.transition,style:h,styleSpec:g});const C=n.valueSpec||b[v];if(!C)return[new De(i,y,`unknown property "${v}"`)];let P;if(zt(y)==="string"&&io(C)&&!C.tokens&&(P=/^{([^}]+)}$/.exec(y)))return[new De(i,y,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(P[1])} }\`.`)];const A=[];return n.layerType==="symbol"&&(v==="text-field"&&h&&!h.glyphs&&A.push(new De(i,y,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&sl(Qn(y))&&lr(y.type)==="identity"&&A.push(new De(i,y,'"text-font" does not support identity functions'))),A.concat(a({key:n.key,value:y,valueSpec:C,style:h,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:v}))}function fl(n){return Uu(n,"paint")}function $u(n){return Uu(n,"layout")}function Zu(n){let t=[];const i=n.value,a=n.key,h=n.style,g=n.styleSpec;i.type||i.ref||t.push(new De(a,i,'either "type" or "ref" is required'));let y=lr(i.type);const v=lr(i.ref);if(i.id){const b=lr(i.id);for(let I=0;I<n.arrayIndex;I++){const C=h.layers[I];lr(C.id)===b&&t.push(new De(a,i.id,`duplicate layer id "${i.id}", previously used at line ${C.id.__line__}`))}}if("ref"in i){let b;["type","source","source-layer","filter","layout"].forEach(I=>{I in i&&t.push(new De(a,i[I],`"${I}" is prohibited for ref layers`))}),h.layers.forEach(I=>{lr(I.id)===v&&(b=I)}),b?b.ref?t.push(new De(a,i.ref,"ref cannot reference another ref layer")):y=lr(b.type):t.push(new De(a,i.ref,`ref layer "${v}" not found`))}else if(y!=="background")if(i.source){const b=h.sources&&h.sources[i.source],I=b&&lr(b.type);b?I==="vector"&&y==="raster"?t.push(new De(a,i.source,`layer "${i.id}" requires a raster source`)):I!=="raster-dem"&&y==="hillshade"?t.push(new De(a,i.source,`layer "${i.id}" requires a raster-dem source`)):I==="raster"&&y!=="raster"?t.push(new De(a,i.source,`layer "${i.id}" requires a vector source`)):I!=="vector"||i["source-layer"]?I==="raster-dem"&&y!=="hillshade"?t.push(new De(a,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!i.paint||!i.paint["line-gradient"]||I==="geojson"&&b.lineMetrics||t.push(new De(a,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new De(a,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new De(a,i.source,`source "${i.source}" not found`))}else t.push(new De(a,i,'missing required property "source"'));return t=t.concat(kn({key:a,value:i,valueSpec:g.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${a}.type`,value:i.type,valueSpec:g.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:i,objectKey:"type"}),filter:Vu,layout:b=>kn({layer:i,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":I=>$u(gi({layerType:y},I))}}),paint:b=>kn({layer:i,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":I=>fl(gi({layerType:y},I))}})}})),t}function Is(n){const t=n.value,i=n.key,a=zt(t);return a!=="string"?[new De(i,t,`string expected, ${a} found`)]:[]}const ml={promoteId:function({key:n,value:t}){if(zt(t)==="string")return Is({key:n,value:t});{const i=[];for(const a in t)i.push(...Is({key:`${n}.${a}`,value:t[a]}));return i}}};function ma(n){const t=n.value,i=n.key,a=n.styleSpec,h=n.style,g=n.validateSpec;if(!t.type)return[new De(i,t,'"type" is required')];const y=lr(t.type);let v;switch(y){case"vector":case"raster":return v=kn({key:i,value:t,valueSpec:a[`source_${y.replace("-","_")}`],style:n.style,styleSpec:a,objectElementValidators:ml,validateSpec:g}),v;case"raster-dem":return v=function(b){var I;const C=(I=b.sourceName)!==null&&I!==void 0?I:"",P=b.value,A=b.styleSpec,R=A.source_raster_dem,O=b.style;let N=[];const H=zt(P);if(P===void 0)return N;if(H!=="object")return N.push(new De("source_raster_dem",P,`object expected, ${H} found`)),N;const Y=lr(P.encoding)==="custom",fe=["redFactor","greenFactor","blueFactor","baseShift"],oe=b.value.encoding?`"${b.value.encoding}"`:"Default";for(const he in P)!Y&&fe.includes(he)?N.push(new De(he,P[he],`In "${C}": "${he}" is only valid when "encoding" is set to "custom". ${oe} encoding found`)):R[he]?N=N.concat(b.validateSpec({key:he,value:P[he],valueSpec:R[he],validateSpec:b.validateSpec,style:O,styleSpec:A})):N.push(new De(he,P[he],`unknown property "${he}"`));return N}({sourceName:i,value:t,style:n.style,styleSpec:a,validateSpec:g}),v;case"geojson":if(v=kn({key:i,value:t,valueSpec:a.source_geojson,style:h,styleSpec:a,validateSpec:g,objectElementValidators:ml}),t.cluster)for(const b in t.clusterProperties){const[I,C]=t.clusterProperties[b],P=typeof I=="string"?[I,["accumulated"],["get",b]]:I;v.push(...co({key:`${i}.${b}.map`,value:C,expressionContext:"cluster-map"})),v.push(...co({key:`${i}.${b}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return v;case"video":return kn({key:i,value:t,valueSpec:a.source_video,style:h,validateSpec:g,styleSpec:a});case"image":return kn({key:i,value:t,valueSpec:a.source_image,style:h,validateSpec:g,styleSpec:a});case"canvas":return[new De(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Fi({key:`${i}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function qu(n){const t=n.value,i=n.styleSpec,a=i.light,h=n.style;let g=[];const y=zt(t);if(t===void 0)return g;if(y!=="object")return g=g.concat([new De("light",t,`object expected, ${y} found`)]),g;for(const v in t){const b=v.match(/^(.*)-transition$/);g=g.concat(b&&a[b[1]]&&a[b[1]].transition?n.validateSpec({key:v,value:t[v],valueSpec:i.transition,validateSpec:n.validateSpec,style:h,styleSpec:i}):a[v]?n.validateSpec({key:v,value:t[v],valueSpec:a[v],validateSpec:n.validateSpec,style:h,styleSpec:i}):[new De(v,t[v],`unknown property "${v}"`)])}return g}function Gu(n){const t=n.value,i=n.styleSpec,a=i.sky,h=n.style,g=zt(t);if(t===void 0)return[];if(g!=="object")return[new De("sky",t,`object expected, ${g} found`)];let y=[];for(const v in t)y=y.concat(a[v]?n.validateSpec({key:v,value:t[v],valueSpec:a[v],style:h,styleSpec:i}):[new De(v,t[v],`unknown property "${v}"`)]);return y}function Hu(n){const t=n.value,i=n.styleSpec,a=i.terrain,h=n.style;let g=[];const y=zt(t);if(t===void 0)return g;if(y!=="object")return g=g.concat([new De("terrain",t,`object expected, ${y} found`)]),g;for(const v in t)g=g.concat(a[v]?n.validateSpec({key:v,value:t[v],valueSpec:a[v],validateSpec:n.validateSpec,style:h,styleSpec:i}):[new De(v,t[v],`unknown property "${v}"`)]);return g}function Wu(n){let t=[];const i=n.value,a=n.key;if(Array.isArray(i)){const h=[],g=[];for(const y in i)i[y].id&&h.includes(i[y].id)&&t.push(new De(a,i,`all the sprites' ids must be unique, but ${i[y].id} is duplicated`)),h.push(i[y].id),i[y].url&&g.includes(i[y].url)&&t.push(new De(a,i,`all the sprites' URLs must be unique, but ${i[y].url} is duplicated`)),g.push(i[y].url),t=t.concat(kn({key:`${a}[${y}]`,value:i[y],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return t}return Is({key:a,value:i})}const gl={"*":()=>[],array:fa,boolean:function(n){const t=n.value,i=n.key,a=zt(t);return a!=="boolean"?[new De(i,t,`boolean expected, ${a} found`)]:[]},number:ju,color:function(n){const t=n.key,i=n.value,a=zt(i);return a!=="string"?[new De(t,i,`color expected, ${a} found`)]:Nt.parse(String(i))?[]:[new De(t,i,`color expected, "${i}" found`)]},constants:$h,enum:Fi,filter:Vu,function:dl,layer:Zu,object:kn,source:ma,light:qu,sky:Gu,terrain:Hu,projection:function(n){const t=n.value,i=n.styleSpec,a=i.projection,h=n.style,g=zt(t);if(t===void 0)return[];if(g!=="object")return[new De("projection",t,`object expected, ${g} found`)];let y=[];for(const v in t)y=y.concat(a[v]?n.validateSpec({key:v,value:t[v],valueSpec:a[v],style:h,styleSpec:i}):[new De(v,t[v],`unknown property "${v}"`)]);return y},string:Is,formatted:function(n){return Is(n).length===0?[]:co(n)},resolvedImage:function(n){return Is(n).length===0?[]:co(n)},padding:function(n){const t=n.key,i=n.value;if(zt(i)==="array"){if(i.length<1||i.length>4)return[new De(t,i,`padding requires 1 to 4 values; ${i.length} values found`)];const a={type:"number"};let h=[];for(let g=0;g<i.length;g++)h=h.concat(n.validateSpec({key:`${t}[${g}]`,value:i[g],validateSpec:n.validateSpec,valueSpec:a}));return h}return ju({key:t,value:i,valueSpec:{}})},variableAnchorOffsetCollection:function(n){const t=n.key,i=n.value,a=zt(i),h=n.styleSpec;if(a!=="array"||i.length<1||i.length%2!=0)return[new De(t,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let g=[];for(let y=0;y<i.length;y+=2)g=g.concat(Fi({key:`${t}[${y}]`,value:i[y],valueSpec:h.layout_symbol["text-anchor"]})),g=g.concat(fa({key:`${t}[${y+1}]`,value:i[y+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:h}));return g},sprite:Wu};function ga(n){const t=n.value,i=n.valueSpec,a=n.styleSpec;return n.validateSpec=ga,i.expression&&sl(lr(t))?dl(n):i.expression&&ll(Qn(t))?co(n):i.type&&gl[i.type]?gl[i.type](n):kn(gi({},n,{valueSpec:i.type?a[i.type]:i}))}function Zh(n){const t=n.value,i=n.key,a=Is(n);return a.length||(t.indexOf("{fontstack}")===-1&&a.push(new De(i,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&a.push(new De(i,t,'"glyphs" url must include a "{range}" token'))),a}function Fn(n,t=ve){let i=[];return i=i.concat(ga({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,validateSpec:ga,objectElementValidators:{glyphs:Zh,"*":()=>[]}})),n.constants&&(i=i.concat($h({key:"constants",value:n.constants}))),Xu(i)}function wi(n){return function(t){return n({...t,validateSpec:ga})}}function Xu(n){return[].concat(n).sort((t,i)=>t.line-i.line)}function ei(n){return function(...t){return Xu(n.apply(this,t))}}Fn.source=ei(wi(ma)),Fn.sprite=ei(wi(Wu)),Fn.glyphs=ei(wi(Zh)),Fn.light=ei(wi(qu)),Fn.sky=ei(wi(Gu)),Fn.terrain=ei(wi(Hu)),Fn.layer=ei(wi(Zu)),Fn.filter=ei(wi(Vu)),Fn.paintProperty=ei(wi(fl)),Fn.layoutProperty=ei(wi($u));const Cs=Fn,df=Cs.light,pf=Cs.sky,qh=Cs.paintProperty,Gh=Cs.layoutProperty;function Ku(n,t){let i=!1;if(t&&t.length)for(const a of t)n.fire(new Ki(new Error(a.message))),i=!0;return i}class ho{constructor(t,i,a){const h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const y=new Int32Array(this.arrayBuffer);t=y[0],this.d=(i=y[1])+2*(a=y[2]);for(let b=0;b<this.d*this.d;b++){const I=y[3+b],C=y[3+b+1];h.push(I===C?null:y.subarray(I,C))}const v=y[3+h.length+1];this.keys=y.subarray(y[3+h.length],v),this.bboxes=y.subarray(v),this.insert=this._insertReadonly}else{this.d=i+2*a;for(let y=0;y<this.d*this.d;y++)h.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=t,this.padding=a,this.scale=i/t,this.uid=0;const g=a/i*t;this.min=-g,this.max=t+g}insert(t,i,a,h,g){this._forEachCell(i,a,h,g,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(g)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,i,a,h,g,y){this.cells[g].push(y)}query(t,i,a,h,g){const y=this.min,v=this.max;if(t<=y&&i<=y&&v<=a&&v<=h&&!g)return Array.prototype.slice.call(this.keys);{const b=[];return this._forEachCell(t,i,a,h,this._queryCell,b,{},g),b}}_queryCell(t,i,a,h,g,y,v,b){const I=this.cells[g];if(I!==null){const C=this.keys,P=this.bboxes;for(let A=0;A<I.length;A++){const R=I[A];if(v[R]===void 0){const O=4*R;(b?b(P[O+0],P[O+1],P[O+2],P[O+3]):t<=P[O+2]&&i<=P[O+3]&&a>=P[O+0]&&h>=P[O+1])?(v[R]=!0,y.push(C[R])):v[R]=!1}}}}_forEachCell(t,i,a,h,g,y,v,b){const I=this._convertToCellCoord(t),C=this._convertToCellCoord(i),P=this._convertToCellCoord(a),A=this._convertToCellCoord(h);for(let R=I;R<=P;R++)for(let O=C;O<=A;O++){const N=this.d*O+R;if((!b||b(this._convertFromCellCoord(R),this._convertFromCellCoord(O),this._convertFromCellCoord(R+1),this._convertFromCellCoord(O+1)))&&g.call(this,t,i,a,h,N,y,v,b))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,i=3+this.cells.length+1+1;let a=0;for(let y=0;y<this.cells.length;y++)a+=this.cells[y].length;const h=new Int32Array(i+a+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;let g=i;for(let y=0;y<t.length;y++){const v=t[y];h[3+y]=g,h.set(v,g),g+=v.length}return h[3+t.length]=g,h.set(this.keys,g),g+=this.keys.length,h[3+t.length+1]=g,h.set(this.bboxes,g),g+=this.bboxes.length,h.buffer}static serialize(t,i){const a=t.toArrayBuffer();return i&&i.push(a),{buffer:a}}static deserialize(t){return new ho(t.buffer)}}const Bn={};function We(n,t,i={}){if(Bn[n])throw new Error(`${n} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:n,writeable:!1}),Bn[n]={klass:t,omit:i.omit||[],shallow:i.shallow||[]}}We("Object",Object),We("TransferableGridIndex",ho),We("Color",Nt),We("Error",Error),We("AJAXError",kr),We("ResolvedImage",Sn),We("StylePropertyFunction",uo),We("StyleExpression",al,{omit:["_evaluator"]}),We("ZoomDependentExpression",lo),We("ZoomConstantExpression",ao),We("CompoundExpression",Rn,{omit:["_evaluate"]});for(const n in to)to[n]._classRegistryKey||We(`Expression_${n}`,to[n]);function yl(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Ju(n){return n.$name||n.constructor._classRegistryKey}function Hh(n){return!function(t){if(t===null||typeof t!="object")return!1;const i=Ju(t);return!(!i||i==="Object")}(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||yl(n)||nn(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function po(n,t){if(Hh(n))return(yl(n)||nn(n))&&t&&t.push(n),ArrayBuffer.isView(n)&&t&&t.push(n.buffer),n instanceof ImageData&&t&&t.push(n.data.buffer),n;if(Array.isArray(n)){const g=[];for(const y of n)g.push(po(y,t));return g}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const i=Ju(n);if(!i)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!Bn[i])throw new Error(`${i} is not registered.`);const{klass:a}=Bn[i],h=a.serialize?a.serialize(n,t):{};if(a.serialize){if(t&&h===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const g in n){if(!n.hasOwnProperty(g)||Bn[i].omit.indexOf(g)>=0)continue;const y=n[g];h[g]=Bn[i].shallow.indexOf(g)>=0?y:po(y,t)}n instanceof Error&&(h.message=n.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return i!=="Object"&&(h.$name=i),h}function fo(n){if(Hh(n))return n;if(Array.isArray(n))return n.map(fo);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const t=Ju(n)||"Object";if(!Bn[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:i}=Bn[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(n);const a=Object.create(i.prototype);for(const h of Object.keys(n)){if(h==="$name")continue;const g=n[h];a[h]=Bn[t].shallow.indexOf(h)>=0?g:fo(g)}return a}class Yu{constructor(){this.first=!0}update(t,i){const a=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=i),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=a,!0))}}const Tt={"Latin-1 Supplement":n=>n>=128&&n<=255,"Hangul Jamo":n=>n>=4352&&n<=4607,Khmer:n=>n>=6016&&n<=6143,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Katakana:n=>n>=12448&&n<=12543,Kanbun:n=>n>=12688&&n<=12703,"CJK Strokes":n=>n>=12736&&n<=12783,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"Private Use Area":n=>n>=57344&&n<=63743,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function Qu(n){for(const t of n)if(tc(t.charCodeAt(0)))return!0;return!1}function ff(n){for(const t of n)if(!mo(t.charCodeAt(0)))return!1;return!0}function ec(n){const t=n.map(i=>{try{return new RegExp(`\\p{sc=${i}}`,"u").source}catch{return null}}).filter(i=>i);return new RegExp(t.join("|"),"u")}const mf=ec(["Arab","Dupl","Mong","Ougr","Syrc"]);function mo(n){return!mf.test(String.fromCodePoint(n))}const Wh=ec(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function tc(n){return!(n!==746&&n!==747&&(n<4352||!(Tt["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||Tt["CJK Compatibility"](n)||Tt["CJK Strokes"](n)||!(!Tt["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Tt["Enclosed CJK Letters and Months"](n)||Tt["Ideographic Description Characters"](n)||Tt.Kanbun(n)||Tt.Katakana(n)&&n!==12540||!(!Tt["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!Tt["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||Tt["Vertical Forms"](n)||Tt["Yijing Hexagram Symbols"](n)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(n))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(n))||Wh.test(String.fromCodePoint(n)))))}function Xh(n){return!(tc(n)||function(t){return!!(Tt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Tt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Tt["Letterlike Symbols"](t)||Tt["Number Forms"](t)||Tt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Tt["Control Pictures"](t)&&t!==9251||Tt["Optical Character Recognition"](t)||Tt["Enclosed Alphanumerics"](t)||Tt["Geometric Shapes"](t)||Tt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Tt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Tt["CJK Symbols and Punctuation"](t)||Tt.Katakana(t)||Tt["Private Use Area"](t)||Tt["CJK Compatibility Forms"](t)||Tt["Small Form Variants"](t)||Tt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(n))}const gf=ec(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function rc(n){return gf.test(String.fromCodePoint(n))}function yf(n,t){return!(!t&&rc(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||Tt.Khmer(n))}function _f(n){for(const t of n)if(rc(t.charCodeAt(0)))return!0;return!1}const Tn=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Wt{constructor(t,i){this.zoom=t,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.zoomHistory=i.zoomHistory,this.transition=i.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Yu,this.transition={})}isSupportedScript(t){return function(i,a){for(const h of i)if(!yf(h.charCodeAt(0),a))return!1;return!0}(t,Tn.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,i=t-Math.floor(t),a=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*i}}}class go{constructor(t,i){this.property=t,this.value=i,this.expression=function(a,h){if(sl(a))return new uo(a,h);if(ll(a)){const g=Bu(a,h);if(g.result==="error")throw new Error(g.value.map(y=>`${y.key}: ${y.message}`).join(", "));return g.value}{let g=a;return h.type==="color"&&typeof a=="string"?g=Nt.parse(a):h.type!=="padding"||typeof a!="number"&&!Array.isArray(a)?h.type==="variableAnchorOffsetCollection"&&Array.isArray(a)&&(g=Ln.parse(a)):g=bn.parse(a),{kind:"constant",evaluate:()=>g}}}(i===void 0?t.specification.default:i,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,i,a){return this.property.possiblyEvaluate(this,t,i,a)}}class _l{constructor(t){this.property=t,this.value=new go(t,void 0)}transitioned(t,i){return new Kh(this.property,this.value,i,ze({},t.transition,this.transition),t.now)}untransitioned(){return new Kh(this.property,this.value,null,{},0)}}class vl{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return ot(this._values[t].value.value)}setValue(t,i){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new _l(this._values[t].property)),this._values[t].value=new go(this._values[t].property,i===null?void 0:ot(i))}getTransition(t){return ot(this._values[t].transition)}setTransition(t,i){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new _l(this._values[t].property)),this._values[t].transition=ot(i)||void 0}serialize(){const t={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(t[i]=a);const h=this.getTransition(i);h!==void 0&&(t[`${i}-transition`]=h)}return t}transitioned(t,i){const a=new ya(this._properties);for(const h of Object.keys(this._values))a._values[h]=this._values[h].transitioned(t,i._values[h]);return a}untransitioned(){const t=new ya(this._properties);for(const i of Object.keys(this._values))t._values[i]=this._values[i].untransitioned();return t}}class Kh{constructor(t,i,a,h,g){this.property=t,this.value=i,this.begin=g+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=a)}possiblyEvaluate(t,i,a){const h=t.now||0,g=this.value.possiblyEvaluate(t,i,a),y=this.prior;if(y){if(h>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(h<this.begin)return y.possiblyEvaluate(t,i,a);{const v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(t,i,a),g,function(b){if(b<=0)return 0;if(b>=1)return 1;const I=b*b,C=I*b;return 4*(b<.5?C:3*(b-I)+C-.75)}(v))}}return g}}class ya{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,i,a){const h=new va(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(t,i,a);return h}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class _a{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return ot(this._values[t].value)}setValue(t,i){this._values[t]=new go(this._values[t].property,i===null?void 0:ot(i))}serialize(){const t={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(t[i]=a)}return t}possiblyEvaluate(t,i,a){const h=new va(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(t,i,a);return h}}class bi{constructor(t,i,a){this.property=t,this.value=i,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,i,a,h){return this.property.evaluate(this.value,this.parameters,t,i,a,h)}}class va{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Je{constructor(t){this.specification=t}possiblyEvaluate(t,i){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(i)}interpolate(t,i,a){const h=ln[this.specification.type];return h?h(t,i,a):t}}class lt{constructor(t,i){this.specification=t,this.overrides=i}possiblyEvaluate(t,i,a,h){return new bi(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(i,null,{},a,h)}:t.expression,i)}interpolate(t,i,a){if(t.value.kind!=="constant"||i.value.kind!=="constant")return t;if(t.value.value===void 0||i.value.value===void 0)return new bi(this,{kind:"constant",value:void 0},t.parameters);const h=ln[this.specification.type];if(h){const g=h(t.value.value,i.value.value,a);return new bi(this,{kind:"constant",value:g},t.parameters)}return t}evaluate(t,i,a,h,g,y){return t.kind==="constant"?t.value:t.evaluate(i,a,h,g,y)}}class xl extends lt{possiblyEvaluate(t,i,a,h){if(t.value===void 0)return new bi(this,{kind:"constant",value:void 0},i);if(t.expression.kind==="constant"){const g=t.expression.evaluate(i,null,{},a,h),y=t.property.specification.type==="resolvedImage"&&typeof g!="string"?g.name:g,v=this._calculate(y,y,y,i);return new bi(this,{kind:"constant",value:v},i)}if(t.expression.kind==="camera"){const g=this._calculate(t.expression.evaluate({zoom:i.zoom-1}),t.expression.evaluate({zoom:i.zoom}),t.expression.evaluate({zoom:i.zoom+1}),i);return new bi(this,{kind:"constant",value:g},i)}return new bi(this,t.expression,i)}evaluate(t,i,a,h,g,y){if(t.kind==="source"){const v=t.evaluate(i,a,h,g,y);return this._calculate(v,v,v,i)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(i.zoom)-1},a,h),t.evaluate({zoom:Math.floor(i.zoom)},a,h),t.evaluate({zoom:Math.floor(i.zoom)+1},a,h),i):t.value}_calculate(t,i,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:i}:{from:a,to:i}}interpolate(t){return t}}class wl{constructor(t){this.specification=t}possiblyEvaluate(t,i,a,h){if(t.value!==void 0){if(t.expression.kind==="constant"){const g=t.expression.evaluate(i,null,{},a,h);return this._calculate(g,g,g,i)}return this._calculate(t.expression.evaluate(new Wt(Math.floor(i.zoom-1),i)),t.expression.evaluate(new Wt(Math.floor(i.zoom),i)),t.expression.evaluate(new Wt(Math.floor(i.zoom+1),i)),i)}}_calculate(t,i,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:i}:{from:a,to:i}}interpolate(t){return t}}class nc{constructor(t){this.specification=t}possiblyEvaluate(t,i,a,h){return!!t.expression.evaluate(i,null,{},a,h)}interpolate(){return!1}}class f{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const i in t){const a=t[i];a.specification.overridable&&this.overridableProperties.push(i);const h=this.defaultPropertyValues[i]=new go(a,void 0),g=this.defaultTransitionablePropertyValues[i]=new _l(a);this.defaultTransitioningPropertyValues[i]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=h.possiblyEvaluate({})}}}We("DataDrivenProperty",lt),We("DataConstantProperty",Je),We("CrossFadedDataDrivenProperty",xl),We("CrossFadedProperty",wl),We("ColorRampProperty",nc);const e="-transition";class o extends Hs{constructor(t,i){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),i.layout&&(this._unevaluatedLayout=new _a(i.layout)),i.paint)){this._transitionablePaint=new vl(i.paint);for(const a in t.paint)this.setPaintProperty(a,t.paint[a],{validate:!1});for(const a in t.layout)this.setLayoutProperty(a,t.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new va(i.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,i,a={}){i!=null&&this._validate(Gh,`layers.${this.id}.layout.${t}`,t,i,a)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,i):this.visibility=i)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,i,a={}){if(i!=null&&this._validate(qh,`layers.${this.id}.paint.${t}`,t,i,a))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),i||void 0),!1;{const h=this._transitionablePaint._values[t],g=h.property.specification["property-type"]==="cross-faded-data-driven",y=h.value.isDataDriven(),v=h.value;this._transitionablePaint.setValue(t,i),this._handleSpecialPaintPropertyUpdate(t);const b=this._transitionablePaint._values[t].value;return b.isDataDriven()||y||g||this._handleOverridablePaintPropertyUpdate(t,v,b)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,i,a){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,i){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,i)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),ut(t,(i,a)=>!(i===void 0||a==="layout"&&!Object.keys(i).length||a==="paint"&&!Object.keys(i).length))}_validate(t,i,a,h,g={}){return(!g||g.validate!==!1)&&Ku(this,t.call(Cs,{key:i,layerType:this.type,objectKey:a,value:h,styleSpec:ve,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const i=this.paint.get(t);if(i instanceof bi&&io(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}}const u={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class c{constructor(t,i){this._structArray=t,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class p{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,i){return t._trim(),i&&(t.isTransferred=!0,i.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const i=Object.create(this.prototype);return i.arrayBuffer=t.arrayBuffer,i.length=t.length,i.capacity=t.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function x(n,t=1){let i=0,a=0;return{members:n.map(h=>{const g=u[h.type].BYTES_PER_ELEMENT,y=i=S(i,Math.max(t,g)),v=h.components||1;return a=Math.max(a,g),i+=g*v,{name:h.name,type:h.type,components:v,offset:y}}),size:S(i,Math.max(a,t)),alignment:t}}function S(n,t){return Math.ceil(n/t)*t}class T extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i){const a=this.length;return this.resize(a+1),this.emplace(a,t,i)}emplace(t,i,a){const h=2*t;return this.int16[h+0]=i,this.int16[h+1]=a,t}}T.prototype.bytesPerElement=4,We("StructArrayLayout2i4",T);class E extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,a)}emplace(t,i,a,h){const g=3*t;return this.int16[g+0]=i,this.int16[g+1]=a,this.int16[g+2]=h,t}}E.prototype.bytesPerElement=6,We("StructArrayLayout3i6",E);class M extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,i,a,h)}emplace(t,i,a,h,g){const y=4*t;return this.int16[y+0]=i,this.int16[y+1]=a,this.int16[y+2]=h,this.int16[y+3]=g,t}}M.prototype.bytesPerElement=8,We("StructArrayLayout4i8",M);class z extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,h,g,y){const v=this.length;return this.resize(v+1),this.emplace(v,t,i,a,h,g,y)}emplace(t,i,a,h,g,y,v){const b=6*t;return this.int16[b+0]=i,this.int16[b+1]=a,this.int16[b+2]=h,this.int16[b+3]=g,this.int16[b+4]=y,this.int16[b+5]=v,t}}z.prototype.bytesPerElement=12,We("StructArrayLayout2i4i12",z);class F extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,h,g,y){const v=this.length;return this.resize(v+1),this.emplace(v,t,i,a,h,g,y)}emplace(t,i,a,h,g,y,v){const b=4*t,I=8*t;return this.int16[b+0]=i,this.int16[b+1]=a,this.uint8[I+4]=h,this.uint8[I+5]=g,this.uint8[I+6]=y,this.uint8[I+7]=v,t}}F.prototype.bytesPerElement=8,We("StructArrayLayout2i4ub8",F);class V extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i){const a=this.length;return this.resize(a+1),this.emplace(a,t,i)}emplace(t,i,a){const h=2*t;return this.float32[h+0]=i,this.float32[h+1]=a,t}}V.prototype.bytesPerElement=8,We("StructArrayLayout2f8",V);class $ extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a,h,g,y,v,b,I,C){const P=this.length;return this.resize(P+1),this.emplace(P,t,i,a,h,g,y,v,b,I,C)}emplace(t,i,a,h,g,y,v,b,I,C,P){const A=10*t;return this.uint16[A+0]=i,this.uint16[A+1]=a,this.uint16[A+2]=h,this.uint16[A+3]=g,this.uint16[A+4]=y,this.uint16[A+5]=v,this.uint16[A+6]=b,this.uint16[A+7]=I,this.uint16[A+8]=C,this.uint16[A+9]=P,t}}$.prototype.bytesPerElement=20,We("StructArrayLayout10ui20",$);class X extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a,h,g,y,v,b,I,C,P,A){const R=this.length;return this.resize(R+1),this.emplace(R,t,i,a,h,g,y,v,b,I,C,P,A)}emplace(t,i,a,h,g,y,v,b,I,C,P,A,R){const O=12*t;return this.int16[O+0]=i,this.int16[O+1]=a,this.int16[O+2]=h,this.int16[O+3]=g,this.uint16[O+4]=y,this.uint16[O+5]=v,this.uint16[O+6]=b,this.uint16[O+7]=I,this.int16[O+8]=C,this.int16[O+9]=P,this.int16[O+10]=A,this.int16[O+11]=R,t}}X.prototype.bytesPerElement=24,We("StructArrayLayout4i4ui4i24",X);class Q extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,a)}emplace(t,i,a,h){const g=3*t;return this.float32[g+0]=i,this.float32[g+1]=a,this.float32[g+2]=h,t}}Q.prototype.bytesPerElement=12,We("StructArrayLayout3f12",Q);class ee extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint32[1*t+0]=i,t}}ee.prototype.bytesPerElement=4,We("StructArrayLayout1ul4",ee);class se extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a,h,g,y,v,b,I){const C=this.length;return this.resize(C+1),this.emplace(C,t,i,a,h,g,y,v,b,I)}emplace(t,i,a,h,g,y,v,b,I,C){const P=10*t,A=5*t;return this.int16[P+0]=i,this.int16[P+1]=a,this.int16[P+2]=h,this.int16[P+3]=g,this.int16[P+4]=y,this.int16[P+5]=v,this.uint32[A+3]=b,this.uint16[P+8]=I,this.uint16[P+9]=C,t}}se.prototype.bytesPerElement=20,We("StructArrayLayout6i1ul2ui20",se);class G extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,h,g,y){const v=this.length;return this.resize(v+1),this.emplace(v,t,i,a,h,g,y)}emplace(t,i,a,h,g,y,v){const b=6*t;return this.int16[b+0]=i,this.int16[b+1]=a,this.int16[b+2]=h,this.int16[b+3]=g,this.int16[b+4]=y,this.int16[b+5]=v,t}}G.prototype.bytesPerElement=12,We("StructArrayLayout2i2i2i12",G);class le extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,h,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,i,a,h,g)}emplace(t,i,a,h,g,y){const v=4*t,b=8*t;return this.float32[v+0]=i,this.float32[v+1]=a,this.float32[v+2]=h,this.int16[b+6]=g,this.int16[b+7]=y,t}}le.prototype.bytesPerElement=16,We("StructArrayLayout2f1f2i16",le);class ce extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,h,g,y){const v=this.length;return this.resize(v+1),this.emplace(v,t,i,a,h,g,y)}emplace(t,i,a,h,g,y,v){const b=16*t,I=4*t,C=8*t;return this.uint8[b+0]=i,this.uint8[b+1]=a,this.float32[I+1]=h,this.float32[I+2]=g,this.int16[C+6]=y,this.int16[C+7]=v,t}}ce.prototype.bytesPerElement=16,We("StructArrayLayout2ub2f2i16",ce);class me extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,a)}emplace(t,i,a,h){const g=3*t;return this.uint16[g+0]=i,this.uint16[g+1]=a,this.uint16[g+2]=h,t}}me.prototype.bytesPerElement=6,We("StructArrayLayout3ui6",me);class Ie extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,h,g,y,v,b,I,C,P,A,R,O,N,H,Y){const fe=this.length;return this.resize(fe+1),this.emplace(fe,t,i,a,h,g,y,v,b,I,C,P,A,R,O,N,H,Y)}emplace(t,i,a,h,g,y,v,b,I,C,P,A,R,O,N,H,Y,fe){const oe=24*t,he=12*t,xe=48*t;return this.int16[oe+0]=i,this.int16[oe+1]=a,this.uint16[oe+2]=h,this.uint16[oe+3]=g,this.uint32[he+2]=y,this.uint32[he+3]=v,this.uint32[he+4]=b,this.uint16[oe+10]=I,this.uint16[oe+11]=C,this.uint16[oe+12]=P,this.float32[he+7]=A,this.float32[he+8]=R,this.uint8[xe+36]=O,this.uint8[xe+37]=N,this.uint8[xe+38]=H,this.uint32[he+10]=Y,this.int16[oe+22]=fe,t}}Ie.prototype.bytesPerElement=48,We("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ie);class Ae extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,h,g,y,v,b,I,C,P,A,R,O,N,H,Y,fe,oe,he,xe,Me,qe,at,$e,je,et,Xe){const He=this.length;return this.resize(He+1),this.emplace(He,t,i,a,h,g,y,v,b,I,C,P,A,R,O,N,H,Y,fe,oe,he,xe,Me,qe,at,$e,je,et,Xe)}emplace(t,i,a,h,g,y,v,b,I,C,P,A,R,O,N,H,Y,fe,oe,he,xe,Me,qe,at,$e,je,et,Xe,He){const Te=32*t,rt=16*t;return this.int16[Te+0]=i,this.int16[Te+1]=a,this.int16[Te+2]=h,this.int16[Te+3]=g,this.int16[Te+4]=y,this.int16[Te+5]=v,this.int16[Te+6]=b,this.int16[Te+7]=I,this.uint16[Te+8]=C,this.uint16[Te+9]=P,this.uint16[Te+10]=A,this.uint16[Te+11]=R,this.uint16[Te+12]=O,this.uint16[Te+13]=N,this.uint16[Te+14]=H,this.uint16[Te+15]=Y,this.uint16[Te+16]=fe,this.uint16[Te+17]=oe,this.uint16[Te+18]=he,this.uint16[Te+19]=xe,this.uint16[Te+20]=Me,this.uint16[Te+21]=qe,this.uint16[Te+22]=at,this.uint32[rt+12]=$e,this.float32[rt+13]=je,this.float32[rt+14]=et,this.uint16[Te+30]=Xe,this.uint16[Te+31]=He,t}}Ae.prototype.bytesPerElement=64,We("StructArrayLayout8i15ui1ul2f2ui64",Ae);class Ve extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.float32[1*t+0]=i,t}}Ve.prototype.bytesPerElement=4,We("StructArrayLayout1f4",Ve);class Ge extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,a)}emplace(t,i,a,h){const g=3*t;return this.uint16[6*t+0]=i,this.float32[g+1]=a,this.float32[g+2]=h,t}}Ge.prototype.bytesPerElement=12,We("StructArrayLayout1ui2f12",Ge);class Be extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,a)}emplace(t,i,a,h){const g=4*t;return this.uint32[2*t+0]=i,this.uint16[g+2]=a,this.uint16[g+3]=h,t}}Be.prototype.bytesPerElement=8,We("StructArrayLayout1ul2ui8",Be);class Fe extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i){const a=this.length;return this.resize(a+1),this.emplace(a,t,i)}emplace(t,i,a){const h=2*t;return this.uint16[h+0]=i,this.uint16[h+1]=a,t}}Fe.prototype.bytesPerElement=4,We("StructArrayLayout2ui4",Fe);class Ye extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint16[1*t+0]=i,t}}Ye.prototype.bytesPerElement=2,We("StructArrayLayout1ui2",Ye);class pt extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,i,a,h)}emplace(t,i,a,h,g){const y=4*t;return this.float32[y+0]=i,this.float32[y+1]=a,this.float32[y+2]=h,this.float32[y+3]=g,t}}pt.prototype.bytesPerElement=16,We("StructArrayLayout4f16",pt);class Ne extends c{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Z(this.anchorPointX,this.anchorPointY)}}Ne.prototype.size=20;class Ze extends se{get(t){return new Ne(this,t)}}We("CollisionBoxArray",Ze);class ht extends c{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ht.prototype.size=48;class Xt extends Ie{get(t){return new ht(this,t)}}We("PlacedSymbolArray",Xt);class vt extends c{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}vt.prototype.size=64;class kt extends Ae{get(t){return new vt(this,t)}}We("SymbolInstanceArray",kt);class Kt extends Ve{getoffsetX(t){return this.float32[1*t+0]}}We("GlyphOffsetArray",Kt);class Or extends E{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}We("SymbolLineVertexArray",Or);class ti extends c{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ti.prototype.size=12;class Jt extends Ge{get(t){return new ti(this,t)}}We("TextAnchorOffsetArray",Jt);class cn extends c{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}cn.prototype.size=8;class Xr extends Be{get(t){return new cn(this,t)}}We("FeatureIndexArray",Xr);class Nr extends T{}class Kr extends T{}class Si extends T{}class yo extends z{}class bl extends F{}class _o extends V{}class On extends ${}class Sl extends X{}class ic extends Q{}class Nn extends ee{}class jn extends G{}class rs extends ce{}class ri extends me{}class zr extends Fe{}const jr=x([{name:"a_pos",components:2,type:"Int16"}],4),{members:In}=jr;class It{constructor(t=[]){this.segments=t}prepareSegment(t,i,a,h){let g=this.segments[this.segments.length-1];return t>It.MAX_VERTEX_ARRAY_LENGTH&&Zt(`Max vertices per segment is ${It.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!g||g.vertexLength+t>It.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==h)&&(g={vertexOffset:i.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},h!==void 0&&(g.sortKey=h),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const t of this.segments)for(const i in t.vaos)t.vaos[i].destroy()}static simpleSegment(t,i,a,h){return new It([{vertexOffset:t,primitiveOffset:i,vertexLength:a,primitiveLength:h,vaos:{},sortKey:0}])}}function Es(n,t){return 256*(n=ye(Math.floor(n),0,255))+ye(Math.floor(t),0,255)}It.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,We("SegmentVector",It);const vo=x([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var xo={exports:{}},Jh={exports:{}};Jh.exports=function(n,t){var i,a,h,g,y,v,b,I;for(a=n.length-(i=3&n.length),h=t,y=3432918353,v=461845907,I=0;I<a;)b=255&n.charCodeAt(I)|(255&n.charCodeAt(++I))<<8|(255&n.charCodeAt(++I))<<16|(255&n.charCodeAt(++I))<<24,++I,h=27492+(65535&(g=5*(65535&(h=(h^=b=(65535&(b=(b=(65535&b)*y+(((b>>>16)*y&65535)<<16)&4294967295)<<15|b>>>17))*v+(((b>>>16)*v&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(b=0,i){case 3:b^=(255&n.charCodeAt(I+2))<<16;case 2:b^=(255&n.charCodeAt(I+1))<<8;case 1:h^=b=(65535&(b=(b=(65535&(b^=255&n.charCodeAt(I)))*y+(((b>>>16)*y&65535)<<16)&4294967295)<<15|b>>>17))*v+(((b>>>16)*v&65535)<<16)&4294967295}return h^=n.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0};var vf=Jh.exports,Yh={exports:{}};Yh.exports=function(n,t){for(var i,a=n.length,h=t^a,g=0;a>=4;)i=1540483477*(65535&(i=255&n.charCodeAt(g)|(255&n.charCodeAt(++g))<<8|(255&n.charCodeAt(++g))<<16|(255&n.charCodeAt(++g))<<24))+((1540483477*(i>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),a-=4,++g;switch(a){case 3:h^=(255&n.charCodeAt(g+2))<<16;case 2:h^=(255&n.charCodeAt(g+1))<<8;case 1:h=1540483477*(65535&(h^=255&n.charCodeAt(g)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0};var ns=vf,Qh=Yh.exports;xo.exports=ns,xo.exports.murmur3=ns,xo.exports.murmur2=Qh;var kl=B(xo.exports);class xa{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,i,a,h){this.ids.push(Tl(t)),this.positions.push(i,a,h)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const i=Tl(t);let a=0,h=this.ids.length-1;for(;a<h;){const y=a+h>>1;this.ids[y]>=i?h=y:a=y+1}const g=[];for(;this.ids[a]===i;)g.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return g}static serialize(t,i){const a=new Float64Array(t.ids),h=new Uint32Array(t.positions);return Il(a,h,0,a.length-1),i&&i.push(a.buffer,h.buffer),{ids:a,positions:h}}static deserialize(t){const i=new xa;return i.ids=t.ids,i.positions=t.positions,i.indexed=!0,i}}function Tl(n){const t=+n;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:kl(String(n))}function Il(n,t,i,a){for(;i<a;){const h=n[i+a>>1];let g=i-1,y=a+1;for(;;){do g++;while(n[g]<h);do y--;while(n[y]>h);if(g>=y)break;wo(n,g,y),wo(t,3*g,3*y),wo(t,3*g+1,3*y+1),wo(t,3*g+2,3*y+2)}y-i<a-y?(Il(n,t,i,y),i=y+1):(Il(n,t,y+1,a),a=y)}}function wo(n,t,i){const a=n[t];n[t]=n[i],n[i]=a}We("FeaturePositionMap",xa);class wa{constructor(t,i){this.gl=t.gl,this.location=i}}class ed extends wa{constructor(t,i){super(t,i),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class By extends wa{constructor(t,i){super(t,i),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Oy extends wa{constructor(t,i){super(t,i),this.current=Nt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Ew=new Float32Array(16);function xf(n){return[Es(255*n.r,255*n.g),Es(255*n.b,255*n.a)]}class sc{constructor(t,i,a){this.value=t,this.uniformNames=i.map(h=>`u_${h}`),this.type=a}setUniform(t,i,a){t.set(a.constantOr(this.value))}getBinding(t,i,a){return this.type==="color"?new Oy(t,i):new ed(t,i)}}class Cl{constructor(t,i){this.uniformNames=i.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=i.tlbr,this.patternTo=t.tlbr}setUniform(t,i,a,h){const g=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&t.set(g)}getBinding(t,i,a){return a.substr(0,9)==="u_pattern"?new By(t,i):new ed(t,i)}}class Ps{constructor(t,i,a,h){this.expression=t,this.type=a,this.maxValue=0,this.paintVertexAttributes=i.map(g=>({name:`a_${g}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,i,a,h,g){const y=this.paintVertexArray.length,v=this.expression.evaluate(new Wt(0),i,{},h,[],g);this.paintVertexArray.resize(t),this._setPaintValue(y,t,v)}updatePaintArray(t,i,a,h){const g=this.expression.evaluate({zoom:0},a,h);this._setPaintValue(t,i,g)}_setPaintValue(t,i,a){if(this.type==="color"){const h=xf(a);for(let g=t;g<i;g++)this.paintVertexArray.emplace(g,h[0],h[1])}else{for(let h=t;h<i;h++)this.paintVertexArray.emplace(h,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Bi{constructor(t,i,a,h,g,y){this.expression=t,this.uniformNames=i.map(v=>`u_${v}_t`),this.type=a,this.useIntegerZoom=h,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=i.map(v=>({name:`a_${v}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(t,i,a,h,g){const y=this.expression.evaluate(new Wt(this.zoom),i,{},h,[],g),v=this.expression.evaluate(new Wt(this.zoom+1),i,{},h,[],g),b=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(b,t,y,v)}updatePaintArray(t,i,a,h){const g=this.expression.evaluate({zoom:this.zoom},a,h),y=this.expression.evaluate({zoom:this.zoom+1},a,h);this._setPaintValue(t,i,g,y)}_setPaintValue(t,i,a,h){if(this.type==="color"){const g=xf(a),y=xf(h);for(let v=t;v<i;v++)this.paintVertexArray.emplace(v,g[0],g[1],y[0],y[1])}else{for(let g=t;g<i;g++)this.paintVertexArray.emplace(g,a,h);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,i){const a=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,h=ye(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);t.set(h)}getBinding(t,i,a){return new ed(t,i)}}class bo{constructor(t,i,a,h,g,y){this.expression=t,this.type=i,this.useIntegerZoom=a,this.zoom=h,this.layerId=y,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(t,i,a){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,i.patterns&&i.patterns[this.layerId],a)}updatePaintArray(t,i,a,h,g){this._setPaintValues(t,i,a.patterns&&a.patterns[this.layerId],g)}_setPaintValues(t,i,a,h){if(!h||!a)return;const{min:g,mid:y,max:v}=a,b=h[g],I=h[y],C=h[v];if(b&&I&&C)for(let P=t;P<i;P++)this.zoomInPaintVertexArray.emplace(P,I.tl[0],I.tl[1],I.br[0],I.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1],I.pixelRatio,b.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,I.tl[0],I.tl[1],I.br[0],I.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],I.pixelRatio,C.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,vo.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,vo.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ny{constructor(t,i,a){this.binders={},this._buffers=[];const h=[];for(const g in t.paint._values){if(!a(g))continue;const y=t.paint.get(g);if(!(y instanceof bi&&io(y.property.specification)))continue;const v=Pw(g,t.type),b=y.value,I=y.property.specification.type,C=y.property.useIntegerZoom,P=y.property.specification["property-type"],A=P==="cross-faded"||P==="cross-faded-data-driven";if(b.kind==="constant")this.binders[g]=A?new Cl(b.value,v):new sc(b.value,v,I),h.push(`/u_${g}`);else if(b.kind==="source"||A){const R=jy(g,I,"source");this.binders[g]=A?new bo(b,I,C,i,R,t.id):new Ps(b,v,I,R),h.push(`/a_${g}`)}else{const R=jy(g,I,"composite");this.binders[g]=new Bi(b,v,I,C,i,R),h.push(`/z_${g}`)}}this.cacheKey=h.sort().join("")}getMaxValue(t){const i=this.binders[t];return i instanceof Ps||i instanceof Bi?i.maxValue:0}populatePaintArrays(t,i,a,h,g){for(const y in this.binders){const v=this.binders[y];(v instanceof Ps||v instanceof Bi||v instanceof bo)&&v.populatePaintArray(t,i,a,h,g)}}setConstantPatternPositions(t,i){for(const a in this.binders){const h=this.binders[a];h instanceof Cl&&h.setConstantPatternPositions(t,i)}}updatePaintArrays(t,i,a,h,g){let y=!1;for(const v in t){const b=i.getPositions(v);for(const I of b){const C=a.feature(I.index);for(const P in this.binders){const A=this.binders[P];if((A instanceof Ps||A instanceof Bi||A instanceof bo)&&A.expression.isStateDependent===!0){const R=h.paint.get(P);A.expression=R.value,A.updatePaintArray(I.start,I.end,C,t[v],g),y=!0}}}}return y}defines(){const t=[];for(const i in this.binders){const a=this.binders[i];(a instanceof sc||a instanceof Cl)&&t.push(...a.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return t}getBinderAttributes(){const t=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof Ps||a instanceof Bi)for(let h=0;h<a.paintVertexAttributes.length;h++)t.push(a.paintVertexAttributes[h].name);else if(a instanceof bo)for(let h=0;h<vo.members.length;h++)t.push(vo.members[h].name)}return t}getBinderUniforms(){const t=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof sc||a instanceof Cl||a instanceof Bi)for(const h of a.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,i){const a=[];for(const h in this.binders){const g=this.binders[h];if(g instanceof sc||g instanceof Cl||g instanceof Bi){for(const y of g.uniformNames)if(i[y]){const v=g.getBinding(t,i[y],y);a.push({name:y,property:h,binding:v})}}}return a}setUniforms(t,i,a,h){for(const{name:g,property:y,binding:v}of i)this.binders[y].setUniform(v,h,a.get(y),g)}updatePaintBuffers(t){this._buffers=[];for(const i in this.binders){const a=this.binders[i];if(t&&a instanceof bo){const h=t.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(a instanceof Ps||a instanceof Bi)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(t){for(const i in this.binders){const a=this.binders[i];(a instanceof Ps||a instanceof Bi||a instanceof bo)&&a.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const i=this.binders[t];(i instanceof Ps||i instanceof Bi||i instanceof bo)&&i.destroy()}}}class ba{constructor(t,i,a=()=>!0){this.programConfigurations={};for(const h of t)this.programConfigurations[h.id]=new Ny(h,i,a);this.needsUpload=!1,this._featureMap=new xa,this._bufferOffset=0}populatePaintArrays(t,i,a,h,g,y){for(const v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(t,i,h,g,y);i.id!==void 0&&this._featureMap.add(i.id,a,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,i,a,h){for(const g of a)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(t,this._featureMap,i,g,h)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Pw(n,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}function jy(n,t,i){const a={color:{source:V,composite:pt},number:{source:Ve,composite:V}},h=function(g){return{"line-pattern":{source:On,composite:On},"fill-pattern":{source:On,composite:On},"fill-extrusion-pattern":{source:On,composite:On}}[g]}(n);return h&&h[i]||a[t][i]}We("ConstantBinder",sc),We("CrossFadedConstantBinder",Cl),We("SourceExpressionBinder",Ps),We("CrossFadedCompositeBinder",bo),We("CompositeExpressionBinder",Bi),We("ProgramConfiguration",Ny,{omit:["_buffers"]}),We("ProgramConfigurationSet",ba);const vr=8192,wf=Math.pow(2,14)-1,Vy=-wf-1;function Sa(n){const t=vr/n.extent,i=n.loadGeometry();for(let a=0;a<i.length;a++){const h=i[a];for(let g=0;g<h.length;g++){const y=h[g],v=Math.round(y.x*t),b=Math.round(y.y*t);y.x=ye(v,Vy,wf),y.y=ye(b,Vy,wf),(v<y.x||v>y.x+1||b<y.y||b>y.y+1)&&Zt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function ka(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?Sa(n):[]}}function td(n,t,i,a,h){n.emplaceBack(2*t+(a+1)/2,2*i+(h+1)/2)}class bf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Kr,this.indexArray=new ri,this.segments=new It,this.programConfigurations=new ba(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,a){const h=this.layers[0],g=[];let y=null,v=!1;h.type==="circle"&&(y=h.layout.get("circle-sort-key"),v=!y.isConstant());for(const{feature:b,id:I,index:C,sourceLayerIndex:P}of t){const A=this.layers[0]._featureFilter.needGeometry,R=ka(b,A);if(!this.layers[0]._featureFilter.filter(new Wt(this.zoom),R,a))continue;const O=v?y.evaluate(R,{},a):void 0,N={id:I,properties:b.properties,type:b.type,sourceLayerIndex:P,index:C,geometry:A?R.geometry:Sa(b),patterns:{},sortKey:O};g.push(N)}v&&g.sort((b,I)=>b.sortKey-I.sortKey);for(const b of g){const{geometry:I,index:C,sourceLayerIndex:P}=b,A=t[C].feature;this.addFeature(b,I,C,a),i.featureIndex.insert(A,I,C,P,this.index)}}update(t,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,In),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,i,a,h){for(const g of i)for(const y of g){const v=y.x,b=y.y;if(v<0||v>=vr||b<0||b>=vr)continue;const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),C=I.vertexLength;td(this.layoutVertexArray,v,b,-1,-1),td(this.layoutVertexArray,v,b,1,-1),td(this.layoutVertexArray,v,b,1,1),td(this.layoutVertexArray,v,b,-1,1),this.indexArray.emplaceBack(C,C+1,C+2),this.indexArray.emplaceBack(C,C+3,C+2),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{},h)}}function Uy(n,t){for(let i=0;i<n.length;i++)if(El(t,n[i]))return!0;for(let i=0;i<t.length;i++)if(El(n,t[i]))return!0;return!!Sf(n,t)}function Mw(n,t,i){return!!El(n,t)||!!kf(t,n,i)}function $y(n,t){if(n.length===1)return qy(t,n[0]);for(let i=0;i<t.length;i++){const a=t[i];for(let h=0;h<a.length;h++)if(El(n,a[h]))return!0}for(let i=0;i<n.length;i++)if(qy(t,n[i]))return!0;for(let i=0;i<t.length;i++)if(Sf(n,t[i]))return!0;return!1}function zw(n,t,i){if(n.length>1){if(Sf(n,t))return!0;for(let a=0;a<t.length;a++)if(kf(t[a],n,i))return!0}for(let a=0;a<n.length;a++)if(kf(n[a],t,i))return!0;return!1}function Sf(n,t){if(n.length===0||t.length===0)return!1;for(let i=0;i<n.length-1;i++){const a=n[i],h=n[i+1];for(let g=0;g<t.length-1;g++)if(Aw(a,h,t[g],t[g+1]))return!0}return!1}function Aw(n,t,i,a){return gr(n,i,a)!==gr(t,i,a)&&gr(n,t,i)!==gr(n,t,a)}function kf(n,t,i){const a=i*i;if(t.length===1)return n.distSqr(t[0])<a;for(let h=1;h<t.length;h++)if(Zy(n,t[h-1],t[h])<a)return!0;return!1}function Zy(n,t,i){const a=t.distSqr(i);if(a===0)return n.distSqr(t);const h=((n.x-t.x)*(i.x-t.x)+(n.y-t.y)*(i.y-t.y))/a;return n.distSqr(h<0?t:h>1?i:i.sub(t)._mult(h)._add(t))}function qy(n,t){let i,a,h,g=!1;for(let y=0;y<n.length;y++){i=n[y];for(let v=0,b=i.length-1;v<i.length;b=v++)a=i[v],h=i[b],a.y>t.y!=h.y>t.y&&t.x<(h.x-a.x)*(t.y-a.y)/(h.y-a.y)+a.x&&(g=!g)}return g}function El(n,t){let i=!1;for(let a=0,h=n.length-1;a<n.length;h=a++){const g=n[a],y=n[h];g.y>t.y!=y.y>t.y&&t.x<(y.x-g.x)*(t.y-g.y)/(y.y-g.y)+g.x&&(i=!i)}return i}function Dw(n,t,i){const a=i[0],h=i[2];if(n.x<a.x&&t.x<a.x||n.x>h.x&&t.x>h.x||n.y<a.y&&t.y<a.y||n.y>h.y&&t.y>h.y)return!1;const g=gr(n,t,i[0]);return g!==gr(n,t,i[1])||g!==gr(n,t,i[2])||g!==gr(n,t,i[3])}function oc(n,t,i){const a=t.paint.get(n).value;return a.kind==="constant"?a.value:i.programConfigurations.get(t.id).getMaxValue(n)}function rd(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function nd(n,t,i,a,h){if(!t[0]&&!t[1])return n;const g=Z.convert(t)._mult(h);i==="viewport"&&g._rotate(-a);const y=[];for(let v=0;v<n.length;v++)y.push(n[v].sub(g));return y}let Gy,Hy;We("CircleBucket",bf,{omit:["layers"]});var Lw={get paint(){return Hy=Hy||new f({"circle-radius":new lt(ve.paint_circle["circle-radius"]),"circle-color":new lt(ve.paint_circle["circle-color"]),"circle-blur":new lt(ve.paint_circle["circle-blur"]),"circle-opacity":new lt(ve.paint_circle["circle-opacity"]),"circle-translate":new Je(ve.paint_circle["circle-translate"]),"circle-translate-anchor":new Je(ve.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Je(ve.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Je(ve.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new lt(ve.paint_circle["circle-stroke-width"]),"circle-stroke-color":new lt(ve.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new lt(ve.paint_circle["circle-stroke-opacity"])})},get layout(){return Gy=Gy||new f({"circle-sort-key":new lt(ve.layout_circle["circle-sort-key"])})}},hn=1e-6,Pl=typeof Float32Array<"u"?Float32Array:Array;function Tf(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Wy(n,t,i){var a=t[0],h=t[1],g=t[2],y=t[3],v=t[4],b=t[5],I=t[6],C=t[7],P=t[8],A=t[9],R=t[10],O=t[11],N=t[12],H=t[13],Y=t[14],fe=t[15],oe=i[0],he=i[1],xe=i[2],Me=i[3];return n[0]=oe*a+he*v+xe*P+Me*N,n[1]=oe*h+he*b+xe*A+Me*H,n[2]=oe*g+he*I+xe*R+Me*Y,n[3]=oe*y+he*C+xe*O+Me*fe,n[4]=(oe=i[4])*a+(he=i[5])*v+(xe=i[6])*P+(Me=i[7])*N,n[5]=oe*h+he*b+xe*A+Me*H,n[6]=oe*g+he*I+xe*R+Me*Y,n[7]=oe*y+he*C+xe*O+Me*fe,n[8]=(oe=i[8])*a+(he=i[9])*v+(xe=i[10])*P+(Me=i[11])*N,n[9]=oe*h+he*b+xe*A+Me*H,n[10]=oe*g+he*I+xe*R+Me*Y,n[11]=oe*y+he*C+xe*O+Me*fe,n[12]=(oe=i[12])*a+(he=i[13])*v+(xe=i[14])*P+(Me=i[15])*N,n[13]=oe*h+he*b+xe*A+Me*H,n[14]=oe*g+he*I+xe*R+Me*Y,n[15]=oe*y+he*C+xe*O+Me*fe,n}Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var ac,Rw=Wy;function id(n,t,i){var a=t[0],h=t[1],g=t[2],y=t[3];return n[0]=i[0]*a+i[4]*h+i[8]*g+i[12]*y,n[1]=i[1]*a+i[5]*h+i[9]*g+i[13]*y,n[2]=i[2]*a+i[6]*h+i[10]*g+i[14]*y,n[3]=i[3]*a+i[7]*h+i[11]*g+i[15]*y,n}ac=new Pl(4),Pl!=Float32Array&&(ac[0]=0,ac[1]=0,ac[2]=0,ac[3]=0);class Fw extends o{constructor(t){super(t,Lw)}createBucket(t){return new bf(t)}queryRadius(t){const i=t;return oc("circle-radius",this,i)+oc("circle-stroke-width",this,i)+rd(this.paint.get("circle-translate"))}queryIntersectsFeature(t,i,a,h,g,y,v,b){const I=nd(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,v),C=this.paint.get("circle-radius").evaluate(i,a)+this.paint.get("circle-stroke-width").evaluate(i,a),P=this.paint.get("circle-pitch-alignment")==="map",A=P?I:function(O,N){return O.map(H=>Xy(H,N))}(I,b),R=P?C*v:C;for(const O of h)for(const N of O){const H=P?N:Xy(N,b);let Y=R;const fe=id([],[N.x,N.y,0,1],b);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Y*=fe[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Y*=y.cameraToCenterDistance/fe[3]),Mw(A,H,Y))return!0}return!1}}function Xy(n,t){const i=id([],[n.x,n.y,0,1],t);return new Z(i[0]/i[3],i[1]/i[3])}class Ky extends bf{}let Jy;We("HeatmapBucket",Ky,{omit:["layers"]});var Bw={get paint(){return Jy=Jy||new f({"heatmap-radius":new lt(ve.paint_heatmap["heatmap-radius"]),"heatmap-weight":new lt(ve.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Je(ve.paint_heatmap["heatmap-intensity"]),"heatmap-color":new nc(ve.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Je(ve.paint_heatmap["heatmap-opacity"])})}};function If(n,{width:t,height:i},a,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*i*a)throw new RangeError(`mismatched image size. expected: ${h.length} but got: ${t*i*a}`)}else h=new Uint8Array(t*i*a);return n.width=t,n.height=i,n.data=h,n}function Yy(n,{width:t,height:i},a){if(t===n.width&&i===n.height)return;const h=If({},{width:t,height:i},a);Cf(n,h,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,t),height:Math.min(n.height,i)},a),n.width=t,n.height=i,n.data=h.data}function Cf(n,t,i,a,h,g){if(h.width===0||h.height===0)return t;if(h.width>n.width||h.height>n.height||i.x>n.width-h.width||i.y>n.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||a.x>t.width-h.width||a.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const y=n.data,v=t.data;if(y===v)throw new Error("srcData equals dstData, so image is already copied");for(let b=0;b<h.height;b++){const I=((i.y+b)*n.width+i.x)*g,C=((a.y+b)*t.width+a.x)*g;for(let P=0;P<h.width*g;P++)v[C+P]=y[I+P]}return t}class lc{constructor(t,i){If(this,t,1,i)}resize(t){Yy(this,t,1)}clone(){return new lc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,a,h,g){Cf(t,i,a,h,g,1)}}class ni{constructor(t,i){If(this,t,4,i)}resize(t){Yy(this,t,4)}replace(t,i){i?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new ni({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,a,h,g){Cf(t,i,a,h,g,4)}}function Qy(n){const t={},i=n.resolution||256,a=n.clips?n.clips.length:1,h=n.image||new ni({width:i,height:a});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);const g=(y,v,b)=>{t[n.evaluationKey]=b;const I=n.expression.evaluate(t);h.data[y+v+0]=Math.floor(255*I.r/I.a),h.data[y+v+1]=Math.floor(255*I.g/I.a),h.data[y+v+2]=Math.floor(255*I.b/I.a),h.data[y+v+3]=Math.floor(255*I.a)};if(n.clips)for(let y=0,v=0;y<a;++y,v+=4*i)for(let b=0,I=0;b<i;b++,I+=4){const C=b/(i-1),{start:P,end:A}=n.clips[y];g(v,I,P*(1-C)+A*C)}else for(let y=0,v=0;y<i;y++,v+=4)g(0,v,y/(i-1));return h}We("AlphaImage",lc),We("RGBAImage",ni);const Ef="big-fb";class Ow extends o{createBucket(t){return new Ky(t)}constructor(t){super(t,Bw),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Qy({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Ef)&&this.heatmapFbos.delete(Ef)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let e_;var Nw={get paint(){return e_=e_||new f({"hillshade-illumination-direction":new Je(ve.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Je(ve.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Je(ve.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Je(ve.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Je(ve.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Je(ve.paint_hillshade["hillshade-accent-color"])})}};class jw extends o{constructor(t){super(t,Nw)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Vw=x([{name:"a_pos",components:2,type:"Int16"}],4),{members:Uw}=Vw;function t_(n,t,i=2){const a=t&&t.length,h=a?t[0]*i:n.length;let g=r_(n,0,h,i,!0);const y=[];if(!g||g.next===g.prev)return y;let v,b,I;if(a&&(g=function(C,P,A,R){const O=[];for(let N=0,H=P.length;N<H;N++){const Y=r_(C,P[N]*R,N<H-1?P[N+1]*R:C.length,R,!1);Y===Y.next&&(Y.steiner=!0),O.push(Kw(Y))}O.sort(Hw);for(let N=0;N<O.length;N++)A=Ww(O[N],A);return A}(n,t,g,i)),n.length>80*i){v=1/0,b=1/0;let C=-1/0,P=-1/0;for(let A=i;A<h;A+=i){const R=n[A],O=n[A+1];R<v&&(v=R),O<b&&(b=O),R>C&&(C=R),O>P&&(P=O)}I=Math.max(C-v,P-b),I=I!==0?32767/I:0}return uc(g,y,i,v,b,I,0),y}function r_(n,t,i,a,h){let g;if(h===function(y,v,b,I){let C=0;for(let P=v,A=b-I;P<b;P+=I)C+=(y[A]-y[P])*(y[P+1]+y[A+1]),A=P;return C}(n,t,i,a)>0)for(let y=t;y<i;y+=a)g=s_(y/a|0,n[y],n[y+1],g);else for(let y=i-a;y>=t;y-=a)g=s_(y/a|0,n[y],n[y+1],g);return g&&sd(g,g.next)&&(hc(g),g=g.next),g}function Ta(n,t){if(!n)return n;t||(t=n);let i,a=n;do if(i=!1,a.steiner||!sd(a,a.next)&&dr(a.prev,a,a.next)!==0)a=a.next;else{if(hc(a),a=t=a.prev,a===a.next)break;i=!0}while(i||a!==t);return t}function uc(n,t,i,a,h,g,y){if(!n)return;!y&&g&&function(b,I,C,P){let A=b;do A.z===0&&(A.z=Pf(A.x,A.y,I,C,P)),A.prevZ=A.prev,A.nextZ=A.next,A=A.next;while(A!==b);A.prevZ.nextZ=null,A.prevZ=null,function(R){let O,N=1;do{let H,Y=R;R=null;let fe=null;for(O=0;Y;){O++;let oe=Y,he=0;for(let Me=0;Me<N&&(he++,oe=oe.nextZ,oe);Me++);let xe=N;for(;he>0||xe>0&&oe;)he!==0&&(xe===0||!oe||Y.z<=oe.z)?(H=Y,Y=Y.nextZ,he--):(H=oe,oe=oe.nextZ,xe--),fe?fe.nextZ=H:R=H,H.prevZ=fe,fe=H;Y=oe}fe.nextZ=null,N*=2}while(O>1)}(A)}(n,a,h,g);let v=n;for(;n.prev!==n.next;){const b=n.prev,I=n.next;if(g?Zw(n,a,h,g):$w(n))t.push(b.i,n.i,I.i),hc(n),n=I.next,v=I.next;else if((n=I)===v){y?y===1?uc(n=qw(Ta(n),t),t,i,a,h,g,2):y===2&&Gw(n,t,i,a,h,g):uc(Ta(n),t,i,a,h,g,1);break}}}function $w(n){const t=n.prev,i=n,a=n.next;if(dr(t,i,a)>=0)return!1;const h=t.x,g=i.x,y=a.x,v=t.y,b=i.y,I=a.y,C=h<g?h<y?h:y:g<y?g:y,P=v<b?v<I?v:I:b<I?b:I,A=h>g?h>y?h:y:g>y?g:y,R=v>b?v>I?v:I:b>I?b:I;let O=a.next;for(;O!==t;){if(O.x>=C&&O.x<=A&&O.y>=P&&O.y<=R&&Ml(h,v,g,b,y,I,O.x,O.y)&&dr(O.prev,O,O.next)>=0)return!1;O=O.next}return!0}function Zw(n,t,i,a){const h=n.prev,g=n,y=n.next;if(dr(h,g,y)>=0)return!1;const v=h.x,b=g.x,I=y.x,C=h.y,P=g.y,A=y.y,R=v<b?v<I?v:I:b<I?b:I,O=C<P?C<A?C:A:P<A?P:A,N=v>b?v>I?v:I:b>I?b:I,H=C>P?C>A?C:A:P>A?P:A,Y=Pf(R,O,t,i,a),fe=Pf(N,H,t,i,a);let oe=n.prevZ,he=n.nextZ;for(;oe&&oe.z>=Y&&he&&he.z<=fe;){if(oe.x>=R&&oe.x<=N&&oe.y>=O&&oe.y<=H&&oe!==h&&oe!==y&&Ml(v,C,b,P,I,A,oe.x,oe.y)&&dr(oe.prev,oe,oe.next)>=0||(oe=oe.prevZ,he.x>=R&&he.x<=N&&he.y>=O&&he.y<=H&&he!==h&&he!==y&&Ml(v,C,b,P,I,A,he.x,he.y)&&dr(he.prev,he,he.next)>=0))return!1;he=he.nextZ}for(;oe&&oe.z>=Y;){if(oe.x>=R&&oe.x<=N&&oe.y>=O&&oe.y<=H&&oe!==h&&oe!==y&&Ml(v,C,b,P,I,A,oe.x,oe.y)&&dr(oe.prev,oe,oe.next)>=0)return!1;oe=oe.prevZ}for(;he&&he.z<=fe;){if(he.x>=R&&he.x<=N&&he.y>=O&&he.y<=H&&he!==h&&he!==y&&Ml(v,C,b,P,I,A,he.x,he.y)&&dr(he.prev,he,he.next)>=0)return!1;he=he.nextZ}return!0}function qw(n,t){let i=n;do{const a=i.prev,h=i.next.next;!sd(a,h)&&n_(a,i,i.next,h)&&cc(a,h)&&cc(h,a)&&(t.push(a.i,i.i,h.i),hc(i),hc(i.next),i=n=h),i=i.next}while(i!==n);return Ta(i)}function Gw(n,t,i,a,h,g){let y=n;do{let v=y.next.next;for(;v!==y.prev;){if(y.i!==v.i&&Jw(y,v)){let b=i_(y,v);return y=Ta(y,y.next),b=Ta(b,b.next),uc(y,t,i,a,h,g,0),void uc(b,t,i,a,h,g,0)}v=v.next}y=y.next}while(y!==n)}function Hw(n,t){return n.x-t.x}function Ww(n,t){const i=function(h,g){let y=g;const v=h.x,b=h.y;let I,C=-1/0;do{if(b<=y.y&&b>=y.next.y&&y.next.y!==y.y){const N=y.x+(b-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(N<=v&&N>C&&(C=N,I=y.x<y.next.x?y:y.next,N===v))return I}y=y.next}while(y!==g);if(!I)return null;const P=I,A=I.x,R=I.y;let O=1/0;y=I;do{if(v>=y.x&&y.x>=A&&v!==y.x&&Ml(b<R?v:C,b,A,R,b<R?C:v,b,y.x,y.y)){const N=Math.abs(b-y.y)/(v-y.x);cc(y,h)&&(N<O||N===O&&(y.x>I.x||y.x===I.x&&Xw(I,y)))&&(I=y,O=N)}y=y.next}while(y!==P);return I}(n,t);if(!i)return t;const a=i_(i,n);return Ta(a,a.next),Ta(i,i.next)}function Xw(n,t){return dr(n.prev,n,t.prev)<0&&dr(t.next,n,n.next)<0}function Pf(n,t,i,a,h){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*h|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-a)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Kw(n){let t=n,i=n;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==n);return i}function Ml(n,t,i,a,h,g,y,v){return(h-y)*(t-v)>=(n-y)*(g-v)&&(n-y)*(a-v)>=(i-y)*(t-v)&&(i-y)*(g-v)>=(h-y)*(a-v)}function Jw(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!function(i,a){let h=i;do{if(h.i!==i.i&&h.next.i!==i.i&&h.i!==a.i&&h.next.i!==a.i&&n_(h,h.next,i,a))return!0;h=h.next}while(h!==i);return!1}(n,t)&&(cc(n,t)&&cc(t,n)&&function(i,a){let h=i,g=!1;const y=(i.x+a.x)/2,v=(i.y+a.y)/2;do h.y>v!=h.next.y>v&&h.next.y!==h.y&&y<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(g=!g),h=h.next;while(h!==i);return g}(n,t)&&(dr(n.prev,n,t.prev)||dr(n,t.prev,t))||sd(n,t)&&dr(n.prev,n,n.next)>0&&dr(t.prev,t,t.next)>0)}function dr(n,t,i){return(t.y-n.y)*(i.x-t.x)-(t.x-n.x)*(i.y-t.y)}function sd(n,t){return n.x===t.x&&n.y===t.y}function n_(n,t,i,a){const h=ad(dr(n,t,i)),g=ad(dr(n,t,a)),y=ad(dr(i,a,n)),v=ad(dr(i,a,t));return h!==g&&y!==v||!(h!==0||!od(n,i,t))||!(g!==0||!od(n,a,t))||!(y!==0||!od(i,n,a))||!(v!==0||!od(i,t,a))}function od(n,t,i){return t.x<=Math.max(n.x,i.x)&&t.x>=Math.min(n.x,i.x)&&t.y<=Math.max(n.y,i.y)&&t.y>=Math.min(n.y,i.y)}function ad(n){return n>0?1:n<0?-1:0}function cc(n,t){return dr(n.prev,n,n.next)<0?dr(n,t,n.next)>=0&&dr(n,n.prev,t)>=0:dr(n,t,n.prev)<0||dr(n,n.next,t)<0}function i_(n,t){const i=Mf(n.i,n.x,n.y),a=Mf(t.i,t.x,t.y),h=n.next,g=t.prev;return n.next=t,t.prev=n,i.next=h,h.prev=i,a.next=i,i.prev=a,g.next=a,a.prev=g,a}function s_(n,t,i,a){const h=Mf(n,t,i);return a?(h.next=a.next,h.prev=a,a.next.prev=h,a.next=h):(h.prev=h,h.next=h),h}function hc(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Mf(n,t,i){return{i:n,x:t,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function zf(n,t,i){const a=i.patternDependencies;let h=!1;for(const g of t){const y=g.paint.get(`${n}-pattern`);y.isConstant()||(h=!0);const v=y.constantOr(null);v&&(h=!0,a[v.to]=!0,a[v.from]=!0)}return h}function Af(n,t,i,a,h){const g=h.patternDependencies;for(const y of t){const v=y.paint.get(`${n}-pattern`).value;if(v.kind!=="constant"){let b=v.evaluate({zoom:a-1},i,{},h.availableImages),I=v.evaluate({zoom:a},i,{},h.availableImages),C=v.evaluate({zoom:a+1},i,{},h.availableImages);b=b&&b.name?b.name:b,I=I&&I.name?I.name:I,C=C&&C.name?C.name:C,g[b]=!0,g[I]=!0,g[C]=!0,i.patterns[y.id]={min:b,mid:I,max:C}}}return i}class Df{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Si,this.indexArray=new ri,this.indexArray2=new zr,this.programConfigurations=new ba(t.layers,t.zoom),this.segments=new It,this.segments2=new It,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,a){this.hasPattern=zf("fill",this.layers,i);const h=this.layers[0].layout.get("fill-sort-key"),g=!h.isConstant(),y=[];for(const{feature:v,id:b,index:I,sourceLayerIndex:C}of t){const P=this.layers[0]._featureFilter.needGeometry,A=ka(v,P);if(!this.layers[0]._featureFilter.filter(new Wt(this.zoom),A,a))continue;const R=g?h.evaluate(A,{},a,i.availableImages):void 0,O={id:b,properties:v.properties,type:v.type,sourceLayerIndex:C,index:I,geometry:P?A.geometry:Sa(v),patterns:{},sortKey:R};y.push(O)}g&&y.sort((v,b)=>v.sortKey-b.sortKey);for(const v of y){const{geometry:b,index:I,sourceLayerIndex:C}=v;if(this.hasPattern){const P=Af("fill",this.layers,v,this.zoom,i);this.patternFeatures.push(P)}else this.addFeature(v,b,I,a,{});i.featureIndex.insert(t[I].feature,b,I,C,this.index)}}update(t,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a)}addFeatures(t,i,a){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,i,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Uw),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,i,a,h,g){for(const y of el(i,500)){let v=0;for(const R of y)v+=R.length;const b=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray),I=b.vertexLength,C=[],P=[];for(const R of y){if(R.length===0)continue;R!==y[0]&&P.push(C.length/2);const O=this.segments2.prepareSegment(R.length,this.layoutVertexArray,this.indexArray2),N=O.vertexLength;this.layoutVertexArray.emplaceBack(R[0].x,R[0].y),this.indexArray2.emplaceBack(N+R.length-1,N),C.push(R[0].x),C.push(R[0].y);for(let H=1;H<R.length;H++)this.layoutVertexArray.emplaceBack(R[H].x,R[H].y),this.indexArray2.emplaceBack(N+H-1,N+H),C.push(R[H].x),C.push(R[H].y);O.vertexLength+=R.length,O.primitiveLength+=R.length}const A=t_(C,P);for(let R=0;R<A.length;R+=3)this.indexArray.emplaceBack(I+A[R],I+A[R+1],I+A[R+2]);b.vertexLength+=v,b.primitiveLength+=A.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,g,h)}}let o_,a_;We("FillBucket",Df,{omit:["layers","patternFeatures"]});var Yw={get paint(){return a_=a_||new f({"fill-antialias":new Je(ve.paint_fill["fill-antialias"]),"fill-opacity":new lt(ve.paint_fill["fill-opacity"]),"fill-color":new lt(ve.paint_fill["fill-color"]),"fill-outline-color":new lt(ve.paint_fill["fill-outline-color"]),"fill-translate":new Je(ve.paint_fill["fill-translate"]),"fill-translate-anchor":new Je(ve.paint_fill["fill-translate-anchor"]),"fill-pattern":new xl(ve.paint_fill["fill-pattern"])})},get layout(){return o_=o_||new f({"fill-sort-key":new lt(ve.layout_fill["fill-sort-key"])})}};class Qw extends o{constructor(t){super(t,Yw)}recalculate(t,i){super.recalculate(t,i);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Df(t)}queryRadius(){return rd(this.paint.get("fill-translate"))}queryIntersectsFeature(t,i,a,h,g,y,v){return $y(nd(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,v),h)}isTileClipped(){return!0}}const eb=x([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),tb=x([{name:"a_centroid",components:2,type:"Int16"}],4),{members:rb}=eb;var So={},nb=K,l_=zl;function zl(n,t,i,a,h){this.properties={},this.extent=i,this.type=0,this._pbf=n,this._geometry=-1,this._keys=a,this._values=h,n.readFields(ib,this,t)}function ib(n,t,i){n==1?t.id=i.readVarint():n==2?function(a,h){for(var g=a.readVarint()+a.pos;a.pos<g;){var y=h._keys[a.readVarint()],v=h._values[a.readVarint()];h.properties[y]=v}}(i,t):n==3?t.type=i.readVarint():n==4&&(t._geometry=i.pos)}function sb(n){for(var t,i,a=0,h=0,g=n.length,y=g-1;h<g;y=h++)a+=((i=n[y]).x-(t=n[h]).x)*(t.y+i.y);return a}zl.types=["Unknown","Point","LineString","Polygon"],zl.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var t,i=n.readVarint()+n.pos,a=1,h=0,g=0,y=0,v=[];n.pos<i;){if(h<=0){var b=n.readVarint();a=7&b,h=b>>3}if(h--,a===1||a===2)g+=n.readSVarint(),y+=n.readSVarint(),a===1&&(t&&v.push(t),t=[]),t.push(new nb(g,y));else{if(a!==7)throw new Error("unknown command "+a);t&&t.push(t[0].clone())}}return t&&v.push(t),v},zl.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var t=n.readVarint()+n.pos,i=1,a=0,h=0,g=0,y=1/0,v=-1/0,b=1/0,I=-1/0;n.pos<t;){if(a<=0){var C=n.readVarint();i=7&C,a=C>>3}if(a--,i===1||i===2)(h+=n.readSVarint())<y&&(y=h),h>v&&(v=h),(g+=n.readSVarint())<b&&(b=g),g>I&&(I=g);else if(i!==7)throw new Error("unknown command "+i)}return[y,b,v,I]},zl.prototype.toGeoJSON=function(n,t,i){var a,h,g=this.extent*Math.pow(2,i),y=this.extent*n,v=this.extent*t,b=this.loadGeometry(),I=zl.types[this.type];function C(R){for(var O=0;O<R.length;O++){var N=R[O];R[O]=[360*(N.x+y)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(N.y+v)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(a=0;a<b.length;a++)P[a]=b[a][0];C(b=P);break;case 2:for(a=0;a<b.length;a++)C(b[a]);break;case 3:for(b=function(R){var O=R.length;if(O<=1)return[R];for(var N,H,Y=[],fe=0;fe<O;fe++){var oe=sb(R[fe]);oe!==0&&(H===void 0&&(H=oe<0),H===oe<0?(N&&Y.push(N),N=[R[fe]]):N.push(R[fe]))}return N&&Y.push(N),Y}(b),a=0;a<b.length;a++)for(h=0;h<b[a].length;h++)C(b[a][h])}b.length===1?b=b[0]:I="Multi"+I;var A={type:"Feature",geometry:{type:I,coordinates:b},properties:this.properties};return"id"in this&&(A.id=this.id),A};var ob=l_,u_=c_;function c_(n,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(ab,this,t),this.length=this._features.length}function ab(n,t,i){n===15?t.version=i.readVarint():n===1?t.name=i.readString():n===5?t.extent=i.readVarint():n===2?t._features.push(i.pos):n===3?t._keys.push(i.readString()):n===4&&t._values.push(function(a){for(var h=null,g=a.readVarint()+a.pos;a.pos<g;){var y=a.readVarint()>>3;h=y===1?a.readString():y===2?a.readFloat():y===3?a.readDouble():y===4?a.readVarint64():y===5?a.readVarint():y===6?a.readSVarint():y===7?a.readBoolean():null}return h}(i))}c_.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var t=this._pbf.readVarint()+this._pbf.pos;return new ob(this._pbf,t,this.extent,this._keys,this._values)};var lb=u_;function ub(n,t,i){if(n===3){var a=new lb(i,i.readVarint()+i.pos);a.length&&(t[a.name]=a)}}So.VectorTile=function(n,t){this.layers=n.readFields(ub,{},t)},So.VectorTileFeature=l_,So.VectorTileLayer=u_;const cb=So.VectorTileFeature.types,Lf=Math.pow(2,13);function dc(n,t,i,a,h,g,y,v){n.emplaceBack(t,i,2*Math.floor(a*Lf)+y,h*Lf*2,g*Lf*2,Math.round(v))}class Rf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new yo,this.centroidVertexArray=new Nr,this.indexArray=new ri,this.programConfigurations=new ba(t.layers,t.zoom),this.segments=new It,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,a){this.features=[],this.hasPattern=zf("fill-extrusion",this.layers,i);for(const{feature:h,id:g,index:y,sourceLayerIndex:v}of t){const b=this.layers[0]._featureFilter.needGeometry,I=ka(h,b);if(!this.layers[0]._featureFilter.filter(new Wt(this.zoom),I,a))continue;const C={id:g,sourceLayerIndex:v,index:y,geometry:b?I.geometry:Sa(h),properties:h.properties,type:h.type,patterns:{}};this.hasPattern?this.features.push(Af("fill-extrusion",this.layers,C,this.zoom,i)):this.addFeature(C,C.geometry,y,a,{}),i.featureIndex.insert(h,C.geometry,y,v,this.index,!0)}}addFeatures(t,i,a){for(const h of this.features){const{geometry:g}=h;this.addFeature(h,g,h.index,i,a)}}update(t,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,rb),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,tb.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,i,a,h,g){for(const y of el(i,500)){const v={x:0,y:0,vertexCount:0};let b=0;for(const O of y)b+=O.length;let I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const O of y){if(O.length===0||db(O))continue;let N=0;for(let H=0;H<O.length;H++){const Y=O[H];if(H>=1){const fe=O[H-1];if(!hb(Y,fe)){I.vertexLength+4>It.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const oe=Y.sub(fe)._perp()._unit(),he=fe.dist(Y);N+he>32768&&(N=0),dc(this.layoutVertexArray,Y.x,Y.y,oe.x,oe.y,0,0,N),dc(this.layoutVertexArray,Y.x,Y.y,oe.x,oe.y,0,1,N),v.x+=2*Y.x,v.y+=2*Y.y,v.vertexCount+=2,N+=he,dc(this.layoutVertexArray,fe.x,fe.y,oe.x,oe.y,0,0,N),dc(this.layoutVertexArray,fe.x,fe.y,oe.x,oe.y,0,1,N),v.x+=2*fe.x,v.y+=2*fe.y,v.vertexCount+=2;const xe=I.vertexLength;this.indexArray.emplaceBack(xe,xe+2,xe+1),this.indexArray.emplaceBack(xe+1,xe+2,xe+3),I.vertexLength+=4,I.primitiveLength+=2}}}}if(I.vertexLength+b>It.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray)),cb[t.type]!=="Polygon")continue;const C=[],P=[],A=I.vertexLength;for(const O of y)if(O.length!==0){O!==y[0]&&P.push(C.length/2);for(let N=0;N<O.length;N++){const H=O[N];dc(this.layoutVertexArray,H.x,H.y,0,0,1,1,0),v.x+=H.x,v.y+=H.y,v.vertexCount+=1,C.push(H.x),C.push(H.y)}}const R=t_(C,P);for(let O=0;O<R.length;O+=3)this.indexArray.emplaceBack(A+R[O],A+R[O+2],A+R[O+1]);I.primitiveLength+=R.length/3,I.vertexLength+=b;for(let O=0;O<v.vertexCount;O++){const N=Math.floor(v.x/v.vertexCount),H=Math.floor(v.y/v.vertexCount);this.centroidVertexArray.emplaceBack(N,H)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,g,h)}}function hb(n,t){return n.x===t.x&&(n.x<0||n.x>vr)||n.y===t.y&&(n.y<0||n.y>vr)}function db(n){return n.every(t=>t.x<0)||n.every(t=>t.x>vr)||n.every(t=>t.y<0)||n.every(t=>t.y>vr)}let h_;We("FillExtrusionBucket",Rf,{omit:["layers","features"]});var pb={get paint(){return h_=h_||new f({"fill-extrusion-opacity":new Je(ve["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new lt(ve["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Je(ve["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Je(ve["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new xl(ve["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new lt(ve["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new lt(ve["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Je(ve["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class fb extends o{constructor(t){super(t,pb)}createBucket(t){return new Rf(t)}queryRadius(){return rd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,i,a,h,g,y,v,b){const I=nd(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,v),C=this.paint.get("fill-extrusion-height").evaluate(i,a),P=this.paint.get("fill-extrusion-base").evaluate(i,a),A=function(O,N,H,Y){const fe=[];for(const oe of O){const he=[oe.x,oe.y,0,1];id(he,he,N),fe.push(new Z(he[0]/he[3],he[1]/he[3]))}return fe}(I,b),R=function(O,N,H,Y){const fe=[],oe=[],he=Y[8]*N,xe=Y[9]*N,Me=Y[10]*N,qe=Y[11]*N,at=Y[8]*H,$e=Y[9]*H,je=Y[10]*H,et=Y[11]*H;for(const Xe of O){const He=[],Te=[];for(const rt of Xe){const Qe=rt.x,dt=rt.y,$t=Y[0]*Qe+Y[4]*dt+Y[12],Ut=Y[1]*Qe+Y[5]*dt+Y[13],Ir=Y[2]*Qe+Y[6]*dt+Y[14],ki=Y[3]*Qe+Y[7]*dt+Y[15],Ur=Ir+Me,Cr=ki+qe,dn=$t+at,pn=Ut+$e,fn=Ir+je,ur=ki+et,Er=new Z(($t+he)/Cr,(Ut+xe)/Cr);Er.z=Ur/Cr,He.push(Er);const Jr=new Z(dn/ur,pn/ur);Jr.z=fn/ur,Te.push(Jr)}fe.push(He),oe.push(Te)}return[fe,oe]}(h,P,C,b);return function(O,N,H){let Y=1/0;$y(H,N)&&(Y=d_(H,N[0]));for(let fe=0;fe<N.length;fe++){const oe=N[fe],he=O[fe];for(let xe=0;xe<oe.length-1;xe++){const Me=oe[xe],qe=[Me,oe[xe+1],he[xe+1],he[xe],Me];Uy(H,qe)&&(Y=Math.min(Y,d_(H,qe)))}}return Y!==1/0&&Y}(R[0],R[1],A)}}function pc(n,t){return n.x*t.x+n.y*t.y}function d_(n,t){if(n.length===1){let i=0;const a=t[i++];let h;for(;!h||a.equals(h);)if(h=t[i++],!h)return 1/0;for(;i<t.length;i++){const g=t[i],y=n[0],v=h.sub(a),b=g.sub(a),I=y.sub(a),C=pc(v,v),P=pc(v,b),A=pc(b,b),R=pc(I,v),O=pc(I,b),N=C*A-P*P,H=(A*R-P*O)/N,Y=(C*O-P*R)/N,fe=a.z*(1-H-Y)+h.z*H+g.z*Y;if(isFinite(fe))return fe}return 1/0}{let i=1/0;for(const a of t)i=Math.min(i,a.z);return i}}const mb=x([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:gb}=mb,yb=x([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:_b}=yb,vb=So.VectorTileFeature.types,xb=Math.cos(Math.PI/180*37.5),p_=Math.pow(2,14)/.5;class Ff{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new bl,this.layoutVertexArray2=new _o,this.indexArray=new ri,this.programConfigurations=new ba(t.layers,t.zoom),this.segments=new It,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,a){this.hasPattern=zf("line",this.layers,i);const h=this.layers[0].layout.get("line-sort-key"),g=!h.isConstant(),y=[];for(const{feature:v,id:b,index:I,sourceLayerIndex:C}of t){const P=this.layers[0]._featureFilter.needGeometry,A=ka(v,P);if(!this.layers[0]._featureFilter.filter(new Wt(this.zoom),A,a))continue;const R=g?h.evaluate(A,{},a):void 0,O={id:b,properties:v.properties,type:v.type,sourceLayerIndex:C,index:I,geometry:P?A.geometry:Sa(v),patterns:{},sortKey:R};y.push(O)}g&&y.sort((v,b)=>v.sortKey-b.sortKey);for(const v of y){const{geometry:b,index:I,sourceLayerIndex:C}=v;if(this.hasPattern){const P=Af("line",this.layers,v,this.zoom,i);this.patternFeatures.push(P)}else this.addFeature(v,b,I,a,{});i.featureIndex.insert(t[I].feature,b,I,C,this.index)}}update(t,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a)}addFeatures(t,i,a){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,i,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,_b)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,gb),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,i,a,h,g){const y=this.layers[0].layout,v=y.get("line-join").evaluate(t,{}),b=y.get("line-cap"),I=y.get("line-miter-limit"),C=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const P of i)this.addLine(P,t,v,b,I,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,g,h)}addLine(t,i,a,h,g,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Y=0;Y<t.length-1;Y++)this.totalDistance+=t[Y].dist(t[Y+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v=vb[i.type]==="Polygon";let b=t.length;for(;b>=2&&t[b-1].equals(t[b-2]);)b--;let I=0;for(;I<b-1&&t[I].equals(t[I+1]);)I++;if(b<(v?3:2))return;a==="bevel"&&(g=1.05);const C=this.overscaling<=16?15*vr/(512*this.overscaling):0,P=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let A,R,O,N,H;this.e1=this.e2=-1,v&&(A=t[b-2],H=t[I].sub(A)._unit()._perp());for(let Y=I;Y<b;Y++){if(O=Y===b-1?v?t[I+1]:void 0:t[Y+1],O&&t[Y].equals(O))continue;H&&(N=H),A&&(R=A),A=t[Y],H=O?O.sub(A)._unit()._perp():N,N=N||H;let fe=N.add(H);fe.x===0&&fe.y===0||fe._unit();const oe=N.x*H.x+N.y*H.y,he=fe.x*H.x+fe.y*H.y,xe=he!==0?1/he:1/0,Me=2*Math.sqrt(2-2*he),qe=he<xb&&R&&O,at=N.x*H.y-N.y*H.x>0;if(qe&&Y>I){const et=A.dist(R);if(et>2*C){const Xe=A.sub(A.sub(R)._mult(C/et)._round());this.updateDistance(R,Xe),this.addCurrentVertex(Xe,N,0,0,P),R=Xe}}const $e=R&&O;let je=$e?a:v?"butt":h;if($e&&je==="round"&&(xe<y?je="miter":xe<=2&&(je="fakeround")),je==="miter"&&xe>g&&(je="bevel"),je==="bevel"&&(xe>2&&(je="flipbevel"),xe<g&&(je="miter")),R&&this.updateDistance(R,A),je==="miter")fe._mult(xe),this.addCurrentVertex(A,fe,0,0,P);else if(je==="flipbevel"){if(xe>100)fe=H.mult(-1);else{const et=xe*N.add(H).mag()/N.sub(H).mag();fe._perp()._mult(et*(at?-1:1))}this.addCurrentVertex(A,fe,0,0,P),this.addCurrentVertex(A,fe.mult(-1),0,0,P)}else if(je==="bevel"||je==="fakeround"){const et=-Math.sqrt(xe*xe-1),Xe=at?et:0,He=at?0:et;if(R&&this.addCurrentVertex(A,N,Xe,He,P),je==="fakeround"){const Te=Math.round(180*Me/Math.PI/20);for(let rt=1;rt<Te;rt++){let Qe=rt/Te;if(Qe!==.5){const $t=Qe-.5;Qe+=Qe*$t*(Qe-1)*((1.0904+oe*(oe*(3.55645-1.43519*oe)-3.2452))*$t*$t+(.848013+oe*(.215638*oe-1.06021)))}const dt=H.sub(N)._mult(Qe)._add(N)._unit()._mult(at?-1:1);this.addHalfVertex(A,dt.x,dt.y,!1,at,0,P)}}O&&this.addCurrentVertex(A,H,-Xe,-He,P)}else if(je==="butt")this.addCurrentVertex(A,fe,0,0,P);else if(je==="square"){const et=R?1:-1;this.addCurrentVertex(A,fe,et,et,P)}else je==="round"&&(R&&(this.addCurrentVertex(A,N,0,0,P),this.addCurrentVertex(A,N,1,1,P,!0)),O&&(this.addCurrentVertex(A,H,-1,-1,P,!0),this.addCurrentVertex(A,H,0,0,P)));if(qe&&Y<b-1){const et=A.dist(O);if(et>2*C){const Xe=A.add(O.sub(A)._mult(C/et)._round());this.updateDistance(A,Xe),this.addCurrentVertex(Xe,H,0,0,P),A=Xe}}}}addCurrentVertex(t,i,a,h,g,y=!1){const v=i.y*h-i.x,b=-i.y-i.x*h;this.addHalfVertex(t,i.x+i.y*a,i.y-i.x*a,y,!1,a,g),this.addHalfVertex(t,v,b,y,!0,-h,g),this.distance>p_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,i,a,h,g,y))}addHalfVertex({x:t,y:i},a,h,g,y,v,b){const I=.5*(this.lineClips?this.scaledDistance*(p_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(g?1:0),(i<<1)+(y?1:0),Math.round(63*a)+128,Math.round(63*h)+128,1+(v===0?0:v<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const C=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,C),b.primitiveLength++),y?this.e2=C:this.e1=C}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,i){this.distance+=t.dist(i),this.updateScaledDistance()}}let f_,m_;We("LineBucket",Ff,{omit:["layers","patternFeatures"]});var g_={get paint(){return m_=m_||new f({"line-opacity":new lt(ve.paint_line["line-opacity"]),"line-color":new lt(ve.paint_line["line-color"]),"line-translate":new Je(ve.paint_line["line-translate"]),"line-translate-anchor":new Je(ve.paint_line["line-translate-anchor"]),"line-width":new lt(ve.paint_line["line-width"]),"line-gap-width":new lt(ve.paint_line["line-gap-width"]),"line-offset":new lt(ve.paint_line["line-offset"]),"line-blur":new lt(ve.paint_line["line-blur"]),"line-dasharray":new wl(ve.paint_line["line-dasharray"]),"line-pattern":new xl(ve.paint_line["line-pattern"]),"line-gradient":new nc(ve.paint_line["line-gradient"])})},get layout(){return f_=f_||new f({"line-cap":new Je(ve.layout_line["line-cap"]),"line-join":new lt(ve.layout_line["line-join"]),"line-miter-limit":new Je(ve.layout_line["line-miter-limit"]),"line-round-limit":new Je(ve.layout_line["line-round-limit"]),"line-sort-key":new lt(ve.layout_line["line-sort-key"])})}};class wb extends lt{possiblyEvaluate(t,i){return i=new Wt(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(t,i)}evaluate(t,i,a,h){return i=ze({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(t,i,a,h)}}let ld;class bb extends o{constructor(t){super(t,g_),this.gradientVersion=0,ld||(ld=new wb(g_.paint.properties["line-width"].specification),ld.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const i=this.gradientExpression();this.stepInterpolant=!!function(a){return a._styleExpression!==void 0}(i)&&i._styleExpression.expression instanceof Ys,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,i){super.recalculate(t,i),this.paint._values["line-floorwidth"]=ld.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Ff(t)}queryRadius(t){const i=t,a=y_(oc("line-width",this,i),oc("line-gap-width",this,i)),h=oc("line-offset",this,i);return a/2+Math.abs(h)+rd(this.paint.get("line-translate"))}queryIntersectsFeature(t,i,a,h,g,y,v){const b=nd(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,v),I=v/2*y_(this.paint.get("line-width").evaluate(i,a),this.paint.get("line-gap-width").evaluate(i,a)),C=this.paint.get("line-offset").evaluate(i,a);return C&&(h=function(P,A){const R=[];for(let O=0;O<P.length;O++){const N=P[O],H=[];for(let Y=0;Y<N.length;Y++){const fe=N[Y-1],oe=N[Y],he=N[Y+1],xe=Y===0?new Z(0,0):oe.sub(fe)._unit()._perp(),Me=Y===N.length-1?new Z(0,0):he.sub(oe)._unit()._perp(),qe=xe._add(Me)._unit(),at=qe.x*Me.x+qe.y*Me.y;at!==0&&qe._mult(1/at),H.push(qe._mult(A)._add(oe))}R.push(H)}return R}(h,C*v)),function(P,A,R){for(let O=0;O<A.length;O++){const N=A[O];if(P.length>=3){for(let H=0;H<N.length;H++)if(El(P,N[H]))return!0}if(zw(P,N,R))return!0}return!1}(b,h,I)}isTileClipped(){return!0}}function y_(n,t){return t>0?t+2*n:n}const Sb=x([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),kb=x([{name:"a_projected_pos",components:3,type:"Float32"}],4);x([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Tb=x([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);x([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const __=x([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Ib=x([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Cb(n,t,i){return n.sections.forEach(a=>{a.text=function(h,g,y){const v=g.layout.get("text-transform").evaluate(y,{});return v==="uppercase"?h=h.toLocaleUpperCase():v==="lowercase"&&(h=h.toLocaleLowerCase()),Tn.applyArabicShaping&&(h=Tn.applyArabicShaping(h)),h}(a.text,t,i)}),n}x([{name:"triangle",components:3,type:"Uint16"}]),x([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),x([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),x([{type:"Float32",name:"offsetX"}]),x([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),x([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const fc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var br=24,v_=Vt,x_=function(n,t,i,a,h){var g,y,v=8*h-a-1,b=(1<<v)-1,I=b>>1,C=-7,P=h-1,A=-1,R=n[t+P];for(P+=A,g=R&(1<<-C)-1,R>>=-C,C+=v;C>0;g=256*g+n[t+P],P+=A,C-=8);for(y=g&(1<<-C)-1,g>>=-C,C+=a;C>0;y=256*y+n[t+P],P+=A,C-=8);if(g===0)g=1-I;else{if(g===b)return y?NaN:1/0*(R?-1:1);y+=Math.pow(2,a),g-=I}return(R?-1:1)*y*Math.pow(2,g-a)},w_=function(n,t,i,a,h,g){var y,v,b,I=8*g-h-1,C=(1<<I)-1,P=C>>1,A=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=0,O=1,N=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(v=isNaN(t)?1:0,y=C):(y=Math.floor(Math.log(t)/Math.LN2),t*(b=Math.pow(2,-y))<1&&(y--,b*=2),(t+=y+P>=1?A/b:A*Math.pow(2,1-P))*b>=2&&(y++,b/=2),y+P>=C?(v=0,y=C):y+P>=1?(v=(t*b-1)*Math.pow(2,h),y+=P):(v=t*Math.pow(2,P-1)*Math.pow(2,h),y=0));h>=8;n[i+R]=255&v,R+=O,v/=256,h-=8);for(y=y<<h|v,I+=h;I>0;n[i+R]=255&y,R+=O,y/=256,I-=8);n[i+R-O]|=128*N};function Vt(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}Vt.Varint=0,Vt.Fixed64=1,Vt.Bytes=2,Vt.Fixed32=5;var Bf=4294967296,b_=1/Bf,S_=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function Ms(n){return n.type===Vt.Bytes?n.readVarint()+n.pos:n.pos+1}function Al(n,t,i){return i?4294967296*t+(n>>>0):4294967296*(t>>>0)+(n>>>0)}function k_(n,t,i){var a=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(a);for(var h=i.pos-1;h>=n;h--)i.buf[h+a]=i.buf[h]}function Eb(n,t){for(var i=0;i<n.length;i++)t.writeVarint(n[i])}function Pb(n,t){for(var i=0;i<n.length;i++)t.writeSVarint(n[i])}function Mb(n,t){for(var i=0;i<n.length;i++)t.writeFloat(n[i])}function zb(n,t){for(var i=0;i<n.length;i++)t.writeDouble(n[i])}function Ab(n,t){for(var i=0;i<n.length;i++)t.writeBoolean(n[i])}function Db(n,t){for(var i=0;i<n.length;i++)t.writeFixed32(n[i])}function Lb(n,t){for(var i=0;i<n.length;i++)t.writeSFixed32(n[i])}function Rb(n,t){for(var i=0;i<n.length;i++)t.writeFixed64(n[i])}function Fb(n,t){for(var i=0;i<n.length;i++)t.writeSFixed64(n[i])}function ud(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+16777216*n[t+3]}function Dl(n,t,i){n[i]=t,n[i+1]=t>>>8,n[i+2]=t>>>16,n[i+3]=t>>>24}function T_(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+(n[t+3]<<24)}Vt.prototype={destroy:function(){this.buf=null},readFields:function(n,t,i){for(i=i||this.length;this.pos<i;){var a=this.readVarint(),h=a>>3,g=this.pos;this.type=7&a,n(h,t,this),this.pos===g&&this.skip(a)}return t},readMessage:function(n,t){return this.readFields(n,t,this.readVarint()+this.pos)},readFixed32:function(){var n=ud(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=T_(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=ud(this.buf,this.pos)+ud(this.buf,this.pos+4)*Bf;return this.pos+=8,n},readSFixed64:function(){var n=ud(this.buf,this.pos)+T_(this.buf,this.pos+4)*Bf;return this.pos+=8,n},readFloat:function(){var n=x_(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=x_(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var t,i,a=this.buf;return t=127&(i=a[this.pos++]),i<128?t:(t|=(127&(i=a[this.pos++]))<<7,i<128?t:(t|=(127&(i=a[this.pos++]))<<14,i<128?t:(t|=(127&(i=a[this.pos++]))<<21,i<128?t:function(h,g,y){var v,b,I=y.buf;if(v=(112&(b=I[y.pos++]))>>4,b<128||(v|=(127&(b=I[y.pos++]))<<3,b<128)||(v|=(127&(b=I[y.pos++]))<<10,b<128)||(v|=(127&(b=I[y.pos++]))<<17,b<128)||(v|=(127&(b=I[y.pos++]))<<24,b<128)||(v|=(1&(b=I[y.pos++]))<<31,b<128))return Al(h,v,g);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=a[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,t=this.pos;return this.pos=n,n-t>=12&&S_?function(i,a,h){return S_.decode(i.subarray(a,h))}(this.buf,t,n):function(i,a,h){for(var g="",y=a;y<h;){var v,b,I,C=i[y],P=null,A=C>239?4:C>223?3:C>191?2:1;if(y+A>h)break;A===1?C<128&&(P=C):A===2?(192&(v=i[y+1]))==128&&(P=(31&C)<<6|63&v)<=127&&(P=null):A===3?(b=i[y+2],(192&(v=i[y+1]))==128&&(192&b)==128&&((P=(15&C)<<12|(63&v)<<6|63&b)<=2047||P>=55296&&P<=57343)&&(P=null)):A===4&&(b=i[y+2],I=i[y+3],(192&(v=i[y+1]))==128&&(192&b)==128&&(192&I)==128&&((P=(15&C)<<18|(63&v)<<12|(63&b)<<6|63&I)<=65535||P>=1114112)&&(P=null)),P===null?(P=65533,A=1):P>65535&&(P-=65536,g+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),g+=String.fromCharCode(P),y+=A}return g}(this.buf,t,n)},readBytes:function(){var n=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,n);return this.pos=n,t},readPackedVarint:function(n,t){if(this.type!==Vt.Bytes)return n.push(this.readVarint(t));var i=Ms(this);for(n=n||[];this.pos<i;)n.push(this.readVarint(t));return n},readPackedSVarint:function(n){if(this.type!==Vt.Bytes)return n.push(this.readSVarint());var t=Ms(this);for(n=n||[];this.pos<t;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==Vt.Bytes)return n.push(this.readBoolean());var t=Ms(this);for(n=n||[];this.pos<t;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==Vt.Bytes)return n.push(this.readFloat());var t=Ms(this);for(n=n||[];this.pos<t;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==Vt.Bytes)return n.push(this.readDouble());var t=Ms(this);for(n=n||[];this.pos<t;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==Vt.Bytes)return n.push(this.readFixed32());var t=Ms(this);for(n=n||[];this.pos<t;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==Vt.Bytes)return n.push(this.readSFixed32());var t=Ms(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==Vt.Bytes)return n.push(this.readFixed64());var t=Ms(this);for(n=n||[];this.pos<t;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==Vt.Bytes)return n.push(this.readSFixed64());var t=Ms(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed64());return n},skip:function(n){var t=7&n;if(t===Vt.Varint)for(;this.buf[this.pos++]>127;);else if(t===Vt.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Vt.Fixed32)this.pos+=4;else{if(t!==Vt.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(n,t){this.writeVarint(n<<3|t)},realloc:function(n){for(var t=this.length||16;t<this.pos+n;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),Dl(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),Dl(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),Dl(this.buf,-1&n,this.pos),Dl(this.buf,Math.floor(n*b_),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),Dl(this.buf,-1&n,this.pos),Dl(this.buf,Math.floor(n*b_),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(t,i){var a,h;if(t>=0?(a=t%4294967296|0,h=t/4294967296|0):(h=~(-t/4294967296),4294967295^(a=~(-t%4294967296))?a=a+1|0:(a=0,h=h+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(g,y,v){v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,v.buf[v.pos]=127&(g>>>=7)}(a,0,i),function(g,y){var v=(7&g)<<4;y.buf[y.pos++]|=v|((g>>>=3)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g)))))}(h,i)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var t=this.pos;this.pos=function(a,h,g){for(var y,v,b=0;b<h.length;b++){if((y=h.charCodeAt(b))>55295&&y<57344){if(!v){y>56319||b+1===h.length?(a[g++]=239,a[g++]=191,a[g++]=189):v=y;continue}if(y<56320){a[g++]=239,a[g++]=191,a[g++]=189,v=y;continue}y=v-55296<<10|y-56320|65536,v=null}else v&&(a[g++]=239,a[g++]=191,a[g++]=189,v=null);y<128?a[g++]=y:(y<2048?a[g++]=y>>6|192:(y<65536?a[g++]=y>>12|224:(a[g++]=y>>18|240,a[g++]=y>>12&63|128),a[g++]=y>>6&63|128),a[g++]=63&y|128)}return g}(this.buf,n,this.pos);var i=this.pos-t;i>=128&&k_(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(n){this.realloc(4),w_(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),w_(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var t=n.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=n[i]},writeRawMessage:function(n,t){this.pos++;var i=this.pos;n(t,this);var a=this.pos-i;a>=128&&k_(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a},writeMessage:function(n,t,i){this.writeTag(n,Vt.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(n,t){t.length&&this.writeMessage(n,Eb,t)},writePackedSVarint:function(n,t){t.length&&this.writeMessage(n,Pb,t)},writePackedBoolean:function(n,t){t.length&&this.writeMessage(n,Ab,t)},writePackedFloat:function(n,t){t.length&&this.writeMessage(n,Mb,t)},writePackedDouble:function(n,t){t.length&&this.writeMessage(n,zb,t)},writePackedFixed32:function(n,t){t.length&&this.writeMessage(n,Db,t)},writePackedSFixed32:function(n,t){t.length&&this.writeMessage(n,Lb,t)},writePackedFixed64:function(n,t){t.length&&this.writeMessage(n,Rb,t)},writePackedSFixed64:function(n,t){t.length&&this.writeMessage(n,Fb,t)},writeBytesField:function(n,t){this.writeTag(n,Vt.Bytes),this.writeBytes(t)},writeFixed32Field:function(n,t){this.writeTag(n,Vt.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(n,t){this.writeTag(n,Vt.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(n,t){this.writeTag(n,Vt.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(n,t){this.writeTag(n,Vt.Fixed64),this.writeSFixed64(t)},writeVarintField:function(n,t){this.writeTag(n,Vt.Varint),this.writeVarint(t)},writeSVarintField:function(n,t){this.writeTag(n,Vt.Varint),this.writeSVarint(t)},writeStringField:function(n,t){this.writeTag(n,Vt.Bytes),this.writeString(t)},writeFloatField:function(n,t){this.writeTag(n,Vt.Fixed32),this.writeFloat(t)},writeDoubleField:function(n,t){this.writeTag(n,Vt.Fixed64),this.writeDouble(t)},writeBooleanField:function(n,t){this.writeVarintField(n,!!t)}};var Of=B(v_);const Nf=3;function Bb(n,t,i){n===1&&i.readMessage(Ob,t)}function Ob(n,t,i){if(n===3){const{id:a,bitmap:h,width:g,height:y,left:v,top:b,advance:I}=i.readMessage(Nb,{});t.push({id:a,bitmap:new lc({width:g+2*Nf,height:y+2*Nf},h),metrics:{width:g,height:y,left:v,top:b,advance:I}})}}function Nb(n,t,i){n===1?t.id=i.readVarint():n===2?t.bitmap=i.readBytes():n===3?t.width=i.readVarint():n===4?t.height=i.readVarint():n===5?t.left=i.readSVarint():n===6?t.top=i.readSVarint():n===7&&(t.advance=i.readVarint())}const I_=Nf;function C_(n){let t=0,i=0;for(const y of n)t+=y.w*y.h,i=Math.max(i,y.w);n.sort((y,v)=>v.h-y.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let h=0,g=0;for(const y of n)for(let v=a.length-1;v>=0;v--){const b=a[v];if(!(y.w>b.w||y.h>b.h)){if(y.x=b.x,y.y=b.y,g=Math.max(g,y.y+y.h),h=Math.max(h,y.x+y.w),y.w===b.w&&y.h===b.h){const I=a.pop();v<a.length&&(a[v]=I)}else y.h===b.h?(b.x+=y.w,b.w-=y.w):y.w===b.w?(b.y+=y.h,b.h-=y.h):(a.push({x:b.x+y.w,y:b.y,w:b.w-y.w,h:y.h}),b.y+=y.h,b.h-=y.h);break}}return{w:h,h:g,fill:t/(h*g)||0}}const Cn=1;class jf{constructor(t,{pixelRatio:i,version:a,stretchX:h,stretchY:g,content:y,textFitWidth:v,textFitHeight:b}){this.paddedRect=t,this.pixelRatio=i,this.stretchX=h,this.stretchY=g,this.content=y,this.version=a,this.textFitWidth=v,this.textFitHeight=b}get tl(){return[this.paddedRect.x+Cn,this.paddedRect.y+Cn]}get br(){return[this.paddedRect.x+this.paddedRect.w-Cn,this.paddedRect.y+this.paddedRect.h-Cn]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Cn)/this.pixelRatio,(this.paddedRect.h-2*Cn)/this.pixelRatio]}}class E_{constructor(t,i){const a={},h={};this.haveRenderCallbacks=[];const g=[];this.addImages(t,a,g),this.addImages(i,h,g);const{w:y,h:v}=C_(g),b=new ni({width:y||1,height:v||1});for(const I in t){const C=t[I],P=a[I].paddedRect;ni.copy(C.data,b,{x:0,y:0},{x:P.x+Cn,y:P.y+Cn},C.data)}for(const I in i){const C=i[I],P=h[I].paddedRect,A=P.x+Cn,R=P.y+Cn,O=C.data.width,N=C.data.height;ni.copy(C.data,b,{x:0,y:0},{x:A,y:R},C.data),ni.copy(C.data,b,{x:0,y:N-1},{x:A,y:R-1},{width:O,height:1}),ni.copy(C.data,b,{x:0,y:0},{x:A,y:R+N},{width:O,height:1}),ni.copy(C.data,b,{x:O-1,y:0},{x:A-1,y:R},{width:1,height:N}),ni.copy(C.data,b,{x:0,y:0},{x:A+O,y:R},{width:1,height:N})}this.image=b,this.iconPositions=a,this.patternPositions=h}addImages(t,i,a){for(const h in t){const g=t[h],y={x:0,y:0,w:g.data.width+2*Cn,h:g.data.height+2*Cn};a.push(y),i[h]=new jf(y,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(t,i){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in t.updatedImages)this.patchUpdatedImage(this.iconPositions[a],t.getImage(a),i),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a),i)}patchUpdatedImage(t,i,a){if(!t||!i||t.version===i.version)return;t.version=i.version;const[h,g]=t.tl;a.update(i.data,void 0,{x:h,y:g})}}var ko;We("ImagePosition",jf),We("ImageAtlas",E_),w.ah=void 0,(ko=w.ah||(w.ah={}))[ko.none=0]="none",ko[ko.horizontal=1]="horizontal",ko[ko.vertical=2]="vertical",ko[ko.horizontalOnly=3]="horizontalOnly";const mc=-17;class gc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,i){const a=new gc;return a.scale=t||1,a.fontStack=i,a}static forImage(t){const i=new gc;return i.imageName=t,i}}class Ll{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,i){const a=new Ll;for(let h=0;h<t.sections.length;h++){const g=t.sections[h];g.image?a.addImageSection(g):a.addTextSection(g,i)}return a}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let i="";for(let a=0;a<t.length;a++){const h=t.charCodeAt(a+1)||null,g=t.charCodeAt(a-1)||null;i+=h&&Xh(h)&&!fc[t[a+1]]||g&&Xh(g)&&!fc[t[a-1]]||!fc[t[a]]?t[a]:fc[t[a]]}return i}(this.text)}trim(){let t=0;for(let a=0;a<this.text.length&&hd[this.text.charCodeAt(a)];a++)t++;let i=this.text.length;for(let a=this.text.length-1;a>=0&&a>=t&&hd[this.text.charCodeAt(a)];a--)i--;this.text=this.text.substring(t,i),this.sectionIndex=this.sectionIndex.slice(t,i)}substring(t,i){const a=new Ll;return a.text=this.text.substring(t,i),a.sectionIndex=this.sectionIndex.slice(t,i),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,i)=>Math.max(t,this.sections[i].scale),0)}addTextSection(t,i){this.text+=t.text,this.sections.push(gc.forText(t.scale,t.fontStack||i));const a=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(a)}addImageSection(t){const i=t.image?t.image.name:"";if(i.length===0)return void Zt("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(gc.forImage(i)),this.sectionIndex.push(this.sections.length-1)):Zt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function cd(n,t,i,a,h,g,y,v,b,I,C,P,A,R,O){const N=Ll.fromFeature(n,h);let H;P===w.ah.vertical&&N.verticalizePunctuation();const{processBidirectionalText:Y,processStyledBidirectionalText:fe}=Tn;if(Y&&N.sections.length===1){H=[];const xe=Y(N.toString(),Vf(N,I,g,t,a,R));for(const Me of xe){const qe=new Ll;qe.text=Me,qe.sections=N.sections;for(let at=0;at<Me.length;at++)qe.sectionIndex.push(0);H.push(qe)}}else if(fe){H=[];const xe=fe(N.text,N.sectionIndex,Vf(N,I,g,t,a,R));for(const Me of xe){const qe=new Ll;qe.text=Me[0],qe.sectionIndex=Me[1],qe.sections=N.sections,H.push(qe)}}else H=function(xe,Me){const qe=[],at=xe.text;let $e=0;for(const je of Me)qe.push(xe.substring($e,je)),$e=je;return $e<at.length&&qe.push(xe.substring($e,at.length)),qe}(N,Vf(N,I,g,t,a,R));const oe=[],he={positionedLines:oe,text:N.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:P,iconsInText:!1,verticalizable:!1};return function(xe,Me,qe,at,$e,je,et,Xe,He,Te,rt,Qe){let dt=0,$t=mc,Ut=0,Ir=0;const ki=Xe==="right"?1:Xe==="left"?0:.5;let Ur=0;for(const ur of $e){ur.trim();const Er=ur.getMaxScale(),Jr=(Er-1)*br,$r={positionedGlyphs:[],lineOffset:0};xe.positionedLines[Ur]=$r;const mn=$r.positionedGlyphs;let Zr=0;if(!ur.length()){$t+=je,++Ur;continue}for(let En=0;En<ur.length();En++){const At=ur.getSection(En),Gt=ur.getSectionIndex(En),Yt=ur.getCharCode(En);let Vn=0,nr=null,Ol=null,ss=null,os=br;const Ti=!(He===w.ah.horizontal||!rt&&!tc(Yt)||rt&&(hd[Yt]||(Cr=Yt,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Cr)))));if(At.imageName){const oi=at[At.imageName];if(!oi)continue;ss=At.imageName,xe.iconsInText=xe.iconsInText||!0,Ol=oi.paddedRect;const Ar=oi.displaySize;At.scale=At.scale*br/Qe,nr={width:Ar[0],height:Ar[1],left:Cn,top:-I_,advance:Ti?Ar[1]:Ar[0]},Vn=Jr+(br-Ar[1]*At.scale),os=nr.advance;const zs=Ti?Ar[0]*At.scale-br*Er:Ar[1]*At.scale-br*Er;zs>0&&zs>Zr&&(Zr=zs)}else{const oi=qe[At.fontStack],Ar=oi&&oi[Yt];if(Ar&&Ar.rect)Ol=Ar.rect,nr=Ar.metrics;else{const zs=Me[At.fontStack],bc=zs&&zs[Yt];if(!bc)continue;nr=bc.metrics}Vn=(Er-At.scale)*br}Ti?(xe.verticalizable=!0,mn.push({glyph:Yt,imageName:ss,x:dt,y:$t+Vn,vertical:Ti,scale:At.scale,fontStack:At.fontStack,sectionIndex:Gt,metrics:nr,rect:Ol}),dt+=os*At.scale+Te):(mn.push({glyph:Yt,imageName:ss,x:dt,y:$t+Vn,vertical:Ti,scale:At.scale,fontStack:At.fontStack,sectionIndex:Gt,metrics:nr,rect:Ol}),dt+=nr.advance*At.scale+Te)}mn.length!==0&&(Ut=Math.max(dt-Te,Ut),$b(mn,0,mn.length-1,ki,Zr)),dt=0;const si=je*Er+Zr;$r.lineOffset=Math.max(Zr,Jr),$t+=si,Ir=Math.max(si,Ir),++Ur}var Cr;const dn=$t-mc,{horizontalAlign:pn,verticalAlign:fn}=Uf(et);(function(ur,Er,Jr,$r,mn,Zr,si,En,At){const Gt=(Er-Jr)*mn;let Yt=0;Yt=Zr!==si?-En*$r-mc:(-$r*At+.5)*si;for(const Vn of ur)for(const nr of Vn.positionedGlyphs)nr.x+=Gt,nr.y+=Yt})(xe.positionedLines,ki,pn,fn,Ut,Ir,je,dn,$e.length),xe.top+=-fn*dn,xe.bottom=xe.top+dn,xe.left+=-pn*Ut,xe.right=xe.left+Ut}(he,t,i,a,H,y,v,b,P,I,A,O),!function(xe){for(const Me of xe)if(Me.positionedGlyphs.length!==0)return!1;return!0}(oe)&&he}const hd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},jb={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Vb={40:!0};function P_(n,t,i,a,h,g){if(t.imageName){const y=a[t.imageName];return y?y.displaySize[0]*t.scale*br/g+h:0}{const y=i[t.fontStack],v=y&&y[n];return v?v.metrics.advance*t.scale+h:0}}function M_(n,t,i,a){const h=Math.pow(n-t,2);return a?n<t?h/2:2*h:h+Math.abs(i)*i}function Ub(n,t,i){let a=0;return n===10&&(a-=1e4),i&&(a+=150),n!==40&&n!==65288||(a+=50),t!==41&&t!==65289||(a+=50),a}function z_(n,t,i,a,h,g){let y=null,v=M_(t,i,h,g);for(const b of a){const I=M_(t-b.x,i,h,g)+b.badness;I<=v&&(y=b,v=I)}return{index:n,x:t,priorBreak:y,badness:v}}function A_(n){return n?A_(n.priorBreak).concat(n.index):[]}function Vf(n,t,i,a,h,g){if(!n)return[];const y=[],v=function(P,A,R,O,N,H){let Y=0;for(let fe=0;fe<P.length();fe++){const oe=P.getSection(fe);Y+=P_(P.getCharCode(fe),oe,O,N,A,H)}return Y/Math.max(1,Math.ceil(Y/R))}(n,t,i,a,h,g),b=n.text.indexOf("")>=0;let I=0;for(let P=0;P<n.length();P++){const A=n.getSection(P),R=n.getCharCode(P);if(hd[R]||(I+=P_(R,A,a,h,t,g)),P<n.length()-1){const O=!((C=R)<11904)&&(!!Tt["CJK Compatibility Forms"](C)||!!Tt["CJK Compatibility"](C)||!!Tt["CJK Strokes"](C)||!!Tt["CJK Symbols and Punctuation"](C)||!!Tt["Enclosed CJK Letters and Months"](C)||!!Tt["Halfwidth and Fullwidth Forms"](C)||!!Tt["Ideographic Description Characters"](C)||!!Tt["Vertical Forms"](C)||Wh.test(String.fromCodePoint(C)));(jb[R]||O||A.imageName||P!==n.length()-2&&Vb[n.getCharCode(P+1)])&&y.push(z_(P+1,I,v,y,Ub(R,n.getCharCode(P+1),O&&b),!1))}}var C;return A_(z_(n.length(),I,v,y,0,!0))}function Uf(n){let t=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function $b(n,t,i,a,h){if(!a&&!h)return;const g=n[i],y=(n[i].x+g.metrics.advance*g.scale)*a;for(let v=t;v<=i;v++)n[v].x-=y,n[v].y+=h}function Zb(n,t,i){const{horizontalAlign:a,verticalAlign:h}=Uf(i),g=t[0]-n.displaySize[0]*a,y=t[1]-n.displaySize[1]*h;return{image:n,top:y,bottom:y+n.displaySize[1],left:g,right:g+n.displaySize[0]}}function D_(n){var t,i;let a=n.left,h=n.top,g=n.right-a,y=n.bottom-h;const v=(t=n.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",b=(i=n.image.textFitHeight)!==null&&i!==void 0?i:"stretchOrShrink",I=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(b==="proportional"){if(v==="stretchOnly"&&g/y<I||v==="proportional"){const C=Math.ceil(y*I);a*=C/g,g=C}}else if(v==="proportional"&&b==="stretchOnly"&&I!==0&&g/y>I){const C=Math.ceil(g/I);h*=C/y,y=C}return{x1:a,y1:h,x2:a+g,y2:h+y}}function L_(n,t,i,a,h,g){const y=n.image;let v;if(y.content){const H=y.content,Y=y.pixelRatio||1;v=[H[0]/Y,H[1]/Y,y.displaySize[0]-H[2]/Y,y.displaySize[1]-H[3]/Y]}const b=t.left*g,I=t.right*g;let C,P,A,R;i==="width"||i==="both"?(R=h[0]+b-a[3],P=h[0]+I+a[1]):(R=h[0]+(b+I-y.displaySize[0])/2,P=R+y.displaySize[0]);const O=t.top*g,N=t.bottom*g;return i==="height"||i==="both"?(C=h[1]+O-a[0],A=h[1]+N+a[2]):(C=h[1]+(O+N-y.displaySize[1])/2,A=C+y.displaySize[1]),{image:y,top:C,right:P,bottom:A,left:R,collisionPadding:v}}const yc=255,is=128,To=yc*is;function R_(n,t){const{expression:i}=t;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Wt(n+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:h}=i;let g=0;for(;g<a.length&&a[g]<=n;)g++;g=Math.max(0,g-1);let y=g;for(;y<a.length&&a[y]<n+1;)y++;y=Math.min(a.length-1,y);const v=a[g],b=a[y];return i.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:b,interpolationType:h}:{kind:"camera",minZoom:v,maxZoom:b,minSize:i.evaluate(new Wt(v)),maxSize:i.evaluate(new Wt(b)),interpolationType:h}}}function $f(n,t,i){let a="never";const h=n.get(t);return h?a=h:n.get(i)&&(a="always"),a}const qb=So.VectorTileFeature.types,Gb=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function dd(n,t,i,a,h,g,y,v,b,I,C,P,A){const R=v?Math.min(To,Math.round(v[0])):0,O=v?Math.min(To,Math.round(v[1])):0;n.emplaceBack(t,i,Math.round(32*a),Math.round(32*h),g,y,(R<<1)+(b?1:0),O,16*I,16*C,256*P,256*A)}function Zf(n,t,i){n.emplaceBack(t.x,t.y,i),n.emplaceBack(t.x,t.y,i),n.emplaceBack(t.x,t.y,i),n.emplaceBack(t.x,t.y,i)}function Hb(n){for(const t of n.sections)if(_f(t.text))return!0;return!1}class qf{constructor(t){this.layoutVertexArray=new Sl,this.indexArray=new ri,this.programConfigurations=t,this.segments=new It,this.dynamicLayoutVertexArray=new ic,this.opacityVertexArray=new Nn,this.hasVisibleVertices=!1,this.placedSymbolArray=new Xt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,i,a,h){this.isEmpty()||(a&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Sb.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,kb.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Gb,!0),this.opacityVertexBuffer.itemSize=1),(a||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}We("SymbolBuffers",qf);class Gf{constructor(t,i,a){this.layoutVertexArray=new t,this.layoutAttributes=i,this.indexArray=new a,this.segments=new It,this.collisionVertexArray=new rs}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Tb.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}We("CollisionBuffers",Gf);class Rl{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(y=>y.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Tf([]),this.placementViewportMatrix=Tf([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=R_(this.zoom,i["text-size"]),this.iconSizeData=R_(this.zoom,i["icon-size"]);const a=this.layers[0].layout,h=a.get("symbol-sort-key"),g=a.get("symbol-z-order");this.canOverlap=$f(a,"text-overlap","text-allow-overlap")!=="never"||$f(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&!h.isConstant(),this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(y=>w.ah[y])),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=t.sourceID}createArrays(){this.text=new qf(new ba(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new qf(new ba(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Kt,this.lineVertexArray=new Or,this.symbolInstances=new kt,this.textAnchorOffsets=new Jt}calculateGlyphDependencies(t,i,a,h,g){for(let y=0;y<t.length;y++)if(i[t.charCodeAt(y)]=!0,(a||h)&&g){const v=fc[t.charAt(y)];v&&(i[v.charCodeAt(0)]=!0)}}populate(t,i,a){const h=this.layers[0],g=h.layout,y=g.get("text-font"),v=g.get("text-field"),b=g.get("icon-image"),I=(v.value.kind!=="constant"||v.value.value instanceof wn&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),C=b.value.kind!=="constant"||!!b.value.value||Object.keys(b.parameters).length>0,P=g.get("symbol-sort-key");if(this.features=[],!I&&!C)return;const A=i.iconDependencies,R=i.glyphDependencies,O=i.availableImages,N=new Wt(this.zoom);for(const{feature:H,id:Y,index:fe,sourceLayerIndex:oe}of t){const he=h._featureFilter.needGeometry,xe=ka(H,he);if(!h._featureFilter.filter(N,xe,a))continue;let Me,qe;if(he||(xe.geometry=Sa(H)),I){const $e=h.getValueAndResolveTokens("text-field",xe,a,O),je=wn.factory($e),et=this.hasRTLText=this.hasRTLText||Hb(je);(!et||Tn.getRTLTextPluginStatus()==="unavailable"||et&&Tn.isParsed())&&(Me=Cb(je,h,xe))}if(C){const $e=h.getValueAndResolveTokens("icon-image",xe,a,O);qe=$e instanceof Sn?$e:Sn.fromString($e)}if(!Me&&!qe)continue;const at=this.sortFeaturesByKey?P.evaluate(xe,{},a):void 0;if(this.features.push({id:Y,text:Me,icon:qe,index:fe,sourceLayerIndex:oe,geometry:xe.geometry,properties:H.properties,type:qb[H.type],sortKey:at}),qe&&(A[qe.name]=!0),Me){const $e=y.evaluate(xe,{},a).join(","),je=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(w.ah.vertical)>=0;for(const et of Me.sections)if(et.image)A[et.image.name]=!0;else{const Xe=Qu(Me.toString()),He=et.fontStack||$e,Te=R[He]=R[He]||{};this.calculateGlyphDependencies(et.text,Te,je,this.allowVerticalPlacement,Xe)}}}g.get("symbol-placement")==="line"&&(this.features=function(H){const Y={},fe={},oe=[];let he=0;function xe($e){oe.push(H[$e]),he++}function Me($e,je,et){const Xe=fe[$e];return delete fe[$e],fe[je]=Xe,oe[Xe].geometry[0].pop(),oe[Xe].geometry[0]=oe[Xe].geometry[0].concat(et[0]),Xe}function qe($e,je,et){const Xe=Y[je];return delete Y[je],Y[$e]=Xe,oe[Xe].geometry[0].shift(),oe[Xe].geometry[0]=et[0].concat(oe[Xe].geometry[0]),Xe}function at($e,je,et){const Xe=et?je[0][je[0].length-1]:je[0][0];return`${$e}:${Xe.x}:${Xe.y}`}for(let $e=0;$e<H.length;$e++){const je=H[$e],et=je.geometry,Xe=je.text?je.text.toString():null;if(!Xe){xe($e);continue}const He=at(Xe,et),Te=at(Xe,et,!0);if(He in fe&&Te in Y&&fe[He]!==Y[Te]){const rt=qe(He,Te,et),Qe=Me(He,Te,oe[rt].geometry);delete Y[He],delete fe[Te],fe[at(Xe,oe[Qe].geometry,!0)]=Qe,oe[rt].geometry=null}else He in fe?Me(He,Te,et):Te in Y?qe(He,Te,et):(xe($e),Y[He]=he-1,fe[Te]=he-1)}return oe.filter($e=>$e.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((H,Y)=>H.sortKey-Y.sortKey)}update(t,i,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,i,this.layers,a),this.icon.programConfigurations.updatePaintArrays(t,i,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,i){const a=this.lineVertexArray.length;if(t.segment!==void 0){let h=t.dist(i[t.segment+1]),g=t.dist(i[t.segment]);const y={};for(let v=t.segment+1;v<i.length;v++)y[v]={x:i[v].x,y:i[v].y,tileUnitDistanceFromAnchor:h},v<i.length-1&&(h+=i[v+1].dist(i[v]));for(let v=t.segment||0;v>=0;v--)y[v]={x:i[v].x,y:i[v].y,tileUnitDistanceFromAnchor:g},v>0&&(g+=i[v-1].dist(i[v]));for(let v=0;v<i.length;v++){const b=y[v];this.lineVertexArray.emplaceBack(b.x,b.y,b.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(t,i,a,h,g,y,v,b,I,C,P,A){const R=t.indexArray,O=t.layoutVertexArray,N=t.segments.prepareSegment(4*i.length,O,R,this.canOverlap?y.sortKey:void 0),H=this.glyphOffsetArray.length,Y=N.vertexLength,fe=this.allowVerticalPlacement&&v===w.ah.vertical?Math.PI/2:0,oe=y.text&&y.text.sections;for(let he=0;he<i.length;he++){const{tl:xe,tr:Me,bl:qe,br:at,tex:$e,pixelOffsetTL:je,pixelOffsetBR:et,minFontScaleX:Xe,minFontScaleY:He,glyphOffset:Te,isSDF:rt,sectionIndex:Qe}=i[he],dt=N.vertexLength,$t=Te[1];dd(O,b.x,b.y,xe.x,$t+xe.y,$e.x,$e.y,a,rt,je.x,je.y,Xe,He),dd(O,b.x,b.y,Me.x,$t+Me.y,$e.x+$e.w,$e.y,a,rt,et.x,je.y,Xe,He),dd(O,b.x,b.y,qe.x,$t+qe.y,$e.x,$e.y+$e.h,a,rt,je.x,et.y,Xe,He),dd(O,b.x,b.y,at.x,$t+at.y,$e.x+$e.w,$e.y+$e.h,a,rt,et.x,et.y,Xe,He),Zf(t.dynamicLayoutVertexArray,b,fe),R.emplaceBack(dt,dt+1,dt+2),R.emplaceBack(dt+1,dt+2,dt+3),N.vertexLength+=4,N.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Te[0]),he!==i.length-1&&Qe===i[he+1].sectionIndex||t.programConfigurations.populatePaintArrays(O.length,y,y.index,{},A,oe&&oe[Qe])}t.placedSymbolArray.emplaceBack(b.x,b.y,H,this.glyphOffsetArray.length-H,Y,I,C,b.segment,a?a[0]:0,a?a[1]:0,h[0],h[1],v,0,!1,0,P)}_addCollisionDebugVertex(t,i,a,h,g,y){return i.emplaceBack(0,0),t.emplaceBack(a.x,a.y,h,g,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(t,i,a,h,g,y,v){const b=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),I=b.vertexLength,C=g.layoutVertexArray,P=g.collisionVertexArray,A=v.anchorX,R=v.anchorY;this._addCollisionDebugVertex(C,P,y,A,R,new Z(t,i)),this._addCollisionDebugVertex(C,P,y,A,R,new Z(a,i)),this._addCollisionDebugVertex(C,P,y,A,R,new Z(a,h)),this._addCollisionDebugVertex(C,P,y,A,R,new Z(t,h)),b.vertexLength+=4;const O=g.indexArray;O.emplaceBack(I,I+1),O.emplaceBack(I+1,I+2),O.emplaceBack(I+2,I+3),O.emplaceBack(I+3,I),b.primitiveLength+=4}addDebugCollisionBoxes(t,i,a,h){for(let g=t;g<i;g++){const y=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,h?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Gf(jn,__.members,zr),this.iconCollisionBox=new Gf(jn,__.members,zr);for(let t=0;t<this.symbolInstances.length;t++){const i=this.symbolInstances.get(t);this.addDebugCollisionBoxes(i.textBoxStartIndex,i.textBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.iconBoxStartIndex,i.iconBoxEndIndex,i,!1),this.addDebugCollisionBoxes(i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex,i,!1)}}_deserializeCollisionBoxesForSymbol(t,i,a,h,g,y,v,b,I){const C={};for(let P=i;P<a;P++){const A=t.get(P);C.textBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},C.textFeatureIndex=A.featureIndex;break}for(let P=h;P<g;P++){const A=t.get(P);C.verticalTextBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},C.verticalTextFeatureIndex=A.featureIndex;break}for(let P=y;P<v;P++){const A=t.get(P);C.iconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},C.iconFeatureIndex=A.featureIndex;break}for(let P=b;P<I;P++){const A=t.get(P);C.verticalIconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},C.verticalIconFeatureIndex=A.featureIndex;break}return C}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const a=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,i){const a=t.placedSymbolArray.get(i),h=a.vertexStartIndex+4*a.numGlyphs;for(let g=a.vertexStartIndex;g<h;g+=4)t.indexArray.emplaceBack(g,g+1,g+2),t.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(t),a=Math.cos(t),h=[],g=[],y=[];for(let v=0;v<this.symbolInstances.length;++v){y.push(v);const b=this.symbolInstances.get(v);h.push(0|Math.round(i*b.anchorX+a*b.anchorY)),g.push(b.featureIndex)}return y.sort((v,b)=>h[v]-h[b]||g[b]-g[v]),y}addToSortKeyRanges(t,i){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===i?a.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const a=this.symbolInstances.get(i);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((h,g,y)=>{h>=0&&y.indexOf(h)===g&&this.addIndicesForPlacedSymbol(this.text,h)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let F_,B_;We("SymbolBucket",Rl,{omit:["layers","collisionBoxArray","features","compareText"]}),Rl.MAX_GLYPHS=65535,Rl.addDynamicAttributes=Zf;var Hf={get paint(){return B_=B_||new f({"icon-opacity":new lt(ve.paint_symbol["icon-opacity"]),"icon-color":new lt(ve.paint_symbol["icon-color"]),"icon-halo-color":new lt(ve.paint_symbol["icon-halo-color"]),"icon-halo-width":new lt(ve.paint_symbol["icon-halo-width"]),"icon-halo-blur":new lt(ve.paint_symbol["icon-halo-blur"]),"icon-translate":new Je(ve.paint_symbol["icon-translate"]),"icon-translate-anchor":new Je(ve.paint_symbol["icon-translate-anchor"]),"text-opacity":new lt(ve.paint_symbol["text-opacity"]),"text-color":new lt(ve.paint_symbol["text-color"],{runtimeType:an,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new lt(ve.paint_symbol["text-halo-color"]),"text-halo-width":new lt(ve.paint_symbol["text-halo-width"]),"text-halo-blur":new lt(ve.paint_symbol["text-halo-blur"]),"text-translate":new Je(ve.paint_symbol["text-translate"]),"text-translate-anchor":new Je(ve.paint_symbol["text-translate-anchor"])})},get layout(){return F_=F_||new f({"symbol-placement":new Je(ve.layout_symbol["symbol-placement"]),"symbol-spacing":new Je(ve.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Je(ve.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new lt(ve.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Je(ve.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Je(ve.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Je(ve.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Je(ve.layout_symbol["icon-ignore-placement"]),"icon-optional":new Je(ve.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Je(ve.layout_symbol["icon-rotation-alignment"]),"icon-size":new lt(ve.layout_symbol["icon-size"]),"icon-text-fit":new Je(ve.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Je(ve.layout_symbol["icon-text-fit-padding"]),"icon-image":new lt(ve.layout_symbol["icon-image"]),"icon-rotate":new lt(ve.layout_symbol["icon-rotate"]),"icon-padding":new lt(ve.layout_symbol["icon-padding"]),"icon-keep-upright":new Je(ve.layout_symbol["icon-keep-upright"]),"icon-offset":new lt(ve.layout_symbol["icon-offset"]),"icon-anchor":new lt(ve.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Je(ve.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Je(ve.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Je(ve.layout_symbol["text-rotation-alignment"]),"text-field":new lt(ve.layout_symbol["text-field"]),"text-font":new lt(ve.layout_symbol["text-font"]),"text-size":new lt(ve.layout_symbol["text-size"]),"text-max-width":new lt(ve.layout_symbol["text-max-width"]),"text-line-height":new Je(ve.layout_symbol["text-line-height"]),"text-letter-spacing":new lt(ve.layout_symbol["text-letter-spacing"]),"text-justify":new lt(ve.layout_symbol["text-justify"]),"text-radial-offset":new lt(ve.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Je(ve.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new lt(ve.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new lt(ve.layout_symbol["text-anchor"]),"text-max-angle":new Je(ve.layout_symbol["text-max-angle"]),"text-writing-mode":new Je(ve.layout_symbol["text-writing-mode"]),"text-rotate":new lt(ve.layout_symbol["text-rotate"]),"text-padding":new Je(ve.layout_symbol["text-padding"]),"text-keep-upright":new Je(ve.layout_symbol["text-keep-upright"]),"text-transform":new lt(ve.layout_symbol["text-transform"]),"text-offset":new lt(ve.layout_symbol["text-offset"]),"text-allow-overlap":new Je(ve.layout_symbol["text-allow-overlap"]),"text-overlap":new Je(ve.layout_symbol["text-overlap"]),"text-ignore-placement":new Je(ve.layout_symbol["text-ignore-placement"]),"text-optional":new Je(ve.layout_symbol["text-optional"])})}};class O_{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Yi,this.defaultValue=t}evaluate(t){if(t.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(t.formattedSection))return i.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}We("FormatSectionOverride",O_,{omit:["defaultValue"]});class pd extends o{constructor(t){super(t,Hf)}recalculate(t,i){if(super.recalculate(t,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const a=this.layout.get("text-writing-mode");if(a){const h=[];for(const g of a)h.indexOf(g)<0&&h.push(g);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,i,a,h){const g=this.layout.get(t).evaluate(i,{},a,h),y=this._unevaluatedLayout._values[t];return y.isDataDriven()||ll(y.value)||!g?g:function(v,b){return b.replace(/{([^{}]+)}/g,(I,C)=>v&&C in v?String(v[C]):"")}(i.properties,g)}createBucket(t){return new Rl(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Hf.paint.overridableProperties){if(!pd.hasPaintOverride(this.layout,t))continue;const i=this.paint.get(t),a=new O_(i),h=new al(a,i.property.specification);let g=null;g=i.value.kind==="constant"||i.value.kind==="source"?new ao("source",h):new lo("composite",h,i.value.zoomStops),this.paint._values[t]=new bi(i.property,g,i.parameters)}}_handleOverridablePaintPropertyUpdate(t,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven())&&pd.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,i){const a=t.get("text-field"),h=Hf.paint.properties[i];let g=!1;const y=v=>{for(const b of v)if(h.overrides&&h.overrides.hasOverride(b))return void(g=!0)};if(a.value.kind==="constant"&&a.value.value instanceof wn)y(a.value.value.sections);else if(a.value.kind==="source"){const v=I=>{g||(I instanceof Kn&&_r(I.value)===Li?y(I.value.sections):I instanceof Ya?y(I.sections):I.eachChild(v))},b=a.value;b._styleExpression&&v(b._styleExpression.expression)}return g}}let N_;var Wb={get paint(){return N_=N_||new f({"background-color":new Je(ve.paint_background["background-color"]),"background-pattern":new wl(ve.paint_background["background-pattern"]),"background-opacity":new Je(ve.paint_background["background-opacity"])})}};class Xb extends o{constructor(t){super(t,Wb)}}let j_;var Kb={get paint(){return j_=j_||new f({"raster-opacity":new Je(ve.paint_raster["raster-opacity"]),"raster-hue-rotate":new Je(ve.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Je(ve.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Je(ve.paint_raster["raster-brightness-max"]),"raster-saturation":new Je(ve.paint_raster["raster-saturation"]),"raster-contrast":new Je(ve.paint_raster["raster-contrast"]),"raster-resampling":new Je(ve.paint_raster["raster-resampling"]),"raster-fade-duration":new Je(ve.paint_raster["raster-fade-duration"])})}};class Jb extends o{constructor(t){super(t,Kb)}}class Yb extends o{constructor(t){super(t,{}),this.onAdd=i=>{this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)},this.onRemove=i=>{this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Qb{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Wf=63710088e-1;class Io{constructor(t,i){if(isNaN(t)||isNaN(i))throw new Error(`Invalid LngLat object: (${t}, ${i})`);if(this.lng=+t,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Io(Ce(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const i=Math.PI/180,a=this.lat*i,h=t.lat*i,g=Math.sin(a)*Math.sin(h)+Math.cos(a)*Math.cos(h)*Math.cos((t.lng-this.lng)*i);return Wf*Math.acos(Math.min(g,1))}static convert(t){if(t instanceof Io)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Io(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Io(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const V_=2*Math.PI*Wf;function U_(n){return V_*Math.cos(n*Math.PI/180)}function $_(n){return(180+n)/360}function Z_(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function q_(n,t){return n/U_(t)}function Xf(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}class _c{constructor(t,i,a=0){this.x=+t,this.y=+i,this.z=+a}static fromLngLat(t,i=0){const a=Io.convert(t);return new _c($_(a.lng),Z_(a.lat),q_(i,a.lat))}toLngLat(){return new Io(360*this.x-180,Xf(this.y))}toAltitude(){return this.z*U_(Xf(this.y))}meterInMercatorCoordinateUnits(){return 1/V_*(t=Xf(this.y),1/Math.cos(t*Math.PI/180));var t}}function G_(n,t,i){var a=2*Math.PI*6378137/256/Math.pow(2,i);return[n*a-2*Math.PI*6378137/2,t*a-2*Math.PI*6378137/2]}class Kf{constructor(t,i,a){if(!function(h,g,y){return!(h<0||h>25||y<0||y>=Math.pow(2,h)||g<0||g>=Math.pow(2,h))}(t,i,a))throw new Error(`x=${i}, y=${a}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=i,this.y=a,this.key=vc(0,t,t,i,a)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,i,a){const h=(y=this.y,v=this.z,b=G_(256*(g=this.x),256*(y=Math.pow(2,v)-y-1),v),I=G_(256*(g+1),256*(y+1),v),b[0]+","+b[1]+","+I[0]+","+I[1]);var g,y,v,b,I;const C=function(P,A,R){let O,N="";for(let H=P;H>0;H--)O=1<<H-1,N+=(A&O?1:0)+(R&O?2:0);return N}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,i>1?"@2x":"").replace(/{quadkey}/g,C).replace(/{bbox-epsg-3857}/g,h)}isChildOf(t){const i=this.z-t.z;return i>0&&t.x===this.x>>i&&t.y===this.y>>i}getTilePoint(t){const i=Math.pow(2,this.z);return new Z((t.x*i-this.x)*vr,(t.y*i-this.y)*vr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class H_{constructor(t,i){this.wrap=t,this.canonical=i,this.key=vc(t,i.z,i.z,i.x,i.y)}}class ii{constructor(t,i,a,h,g){if(t<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${a}`);this.overscaledZ=t,this.wrap=i,this.canonical=new Kf(a,+h,+g),this.key=vc(i,t,a,h,g)}clone(){return new ii(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const i=this.canonical.z-t;return t>this.canonical.z?new ii(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ii(t,this.wrap,t,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(t,i){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-t;return t>this.canonical.z?vc(this.wrap*+i,t,this.canonical.z,this.canonical.x,this.canonical.y):vc(this.wrap*+i,t,t,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const i=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>i&&t.canonical.y===this.canonical.y>>i}children(t){if(this.overscaledZ>=t)return[new ii(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,a=2*this.canonical.x,h=2*this.canonical.y;return[new ii(i,this.wrap,i,a,h),new ii(i,this.wrap,i,a+1,h),new ii(i,this.wrap,i,a,h+1),new ii(i,this.wrap,i,a+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new ii(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new ii(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new H_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new _c(t.x-this.wrap,t.y))}}function vc(n,t,i,a,h){(n*=2)<0&&(n=-1*n-1);const g=1<<i;return(g*g*n+g*h+a).toString(36)+i.toString(36)+t.toString(36)}We("CanonicalTileID",Kf),We("OverscaledTileID",ii,{omit:["posMatrix"]});class W_{constructor(t,i,a,h=1,g=1,y=1,v=0){if(this.uid=t,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void Zt(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=i.height;const b=this.dim=i.height-2;switch(this.data=new Uint32Array(i.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=h,this.greenFactor=g,this.blueFactor=y,this.baseShift=v;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let I=0;I<b;I++)this.data[this._idx(-1,I)]=this.data[this._idx(0,I)],this.data[this._idx(b,I)]=this.data[this._idx(b-1,I)],this.data[this._idx(I,-1)]=this.data[this._idx(I,0)],this.data[this._idx(I,b)]=this.data[this._idx(I,b-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(b,-1)]=this.data[this._idx(b-1,0)],this.data[this._idx(-1,b)]=this.data[this._idx(0,b-1)],this.data[this._idx(b,b)]=this.data[this._idx(b-1,b-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let I=0;I<b;I++)for(let C=0;C<b;C++){const P=this.get(I,C);P>this.max&&(this.max=P),P<this.min&&(this.min=P)}}get(t,i){const a=new Uint8Array(this.data.buffer),h=4*this._idx(t,i);return this.unpack(a[h],a[h+1],a[h+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,i){if(t<-1||t>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(t+1)}unpack(t,i,a){return t*this.redFactor+i*this.greenFactor+a*this.blueFactor-this.baseShift}getPixels(){return new ni({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,i,a){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=i*this.dim,g=i*this.dim+this.dim,y=a*this.dim,v=a*this.dim+this.dim;switch(i){case-1:h=g-1;break;case 1:g=h+1}switch(a){case-1:y=v-1;break;case 1:v=y+1}const b=-i*this.dim,I=-a*this.dim;for(let C=y;C<v;C++)for(let P=h;P<g;P++)this.data[this._idx(P,C)]=t.data[this._idx(P+b,C+I)]}}We("DEMData",W_);class X_{constructor(t){this._stringToNumber={},this._numberToString=[];for(let i=0;i<t.length;i++){const a=t[i];this._stringToNumber[a]=i,this._numberToString[i]=a}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class K_{constructor(t,i,a,h,g){this.type="Feature",this._vectorTileFeature=t,t._z=i,t._x=a,t._y=h,this.properties=t.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const i in this)i!=="_geometry"&&i!=="_vectorTileFeature"&&(t[i]=this[i]);return t}}class J_{constructor(t,i){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new ho(vr,16,0),this.grid3D=new ho(vr,16,0),this.featureIndexArray=new Xr,this.promoteId=i}insert(t,i,a,h,g,y){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,h,g);const b=y?this.grid3D:this.grid;for(let I=0;I<i.length;I++){const C=i[I],P=[1/0,1/0,-1/0,-1/0];for(let A=0;A<C.length;A++){const R=C[A];P[0]=Math.min(P[0],R.x),P[1]=Math.min(P[1],R.y),P[2]=Math.max(P[2],R.x),P[3]=Math.max(P[3],R.y)}P[0]<vr&&P[1]<vr&&P[2]>=0&&P[3]>=0&&b.insert(v,P[0],P[1],P[2],P[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new So.VectorTile(new Of(this.rawTileData)).layers,this.sourceLayerCoder=new X_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,i,a,h){this.loadVTLayers();const g=t.params||{},y=vr/t.tileSize/t.scale,v=Ou(g.filter),b=t.queryGeometry,I=t.queryPadding*y,C=Q_(b),P=this.grid.query(C.minX-I,C.minY-I,C.maxX+I,C.maxY+I),A=Q_(t.cameraQueryGeometry),R=this.grid3D.query(A.minX-I,A.minY-I,A.maxX+I,A.maxY+I,(H,Y,fe,oe)=>function(he,xe,Me,qe,at){for(const je of he)if(xe<=je.x&&Me<=je.y&&qe>=je.x&&at>=je.y)return!0;const $e=[new Z(xe,Me),new Z(xe,at),new Z(qe,at),new Z(qe,Me)];if(he.length>2){for(const je of $e)if(El(he,je))return!0}for(let je=0;je<he.length-1;je++)if(Dw(he[je],he[je+1],$e))return!0;return!1}(t.cameraQueryGeometry,H-I,Y-I,fe+I,oe+I));for(const H of R)P.push(H);P.sort(e2);const O={};let N;for(let H=0;H<P.length;H++){const Y=P[H];if(Y===N)continue;N=Y;const fe=this.featureIndexArray.get(Y);let oe=null;this.loadMatchingFeature(O,fe.bucketIndex,fe.sourceLayerIndex,fe.featureIndex,v,g.layers,g.availableImages,i,a,h,(he,xe,Me)=>(oe||(oe=Sa(he)),xe.queryIntersectsFeature(b,he,Me,oe,this.z,t.transform,y,t.pixelPosMatrix)))}return O}loadMatchingFeature(t,i,a,h,g,y,v,b,I,C,P){const A=this.bucketLayerIDs[i];if(y&&!function(H,Y){for(let fe=0;fe<H.length;fe++)if(Y.indexOf(H[fe])>=0)return!0;return!1}(y,A))return;const R=this.sourceLayerCoder.decode(a),O=this.vtLayers[R].feature(h);if(g.needGeometry){const H=ka(O,!0);if(!g.filter(new Wt(this.tileID.overscaledZ),H,this.tileID.canonical))return}else if(!g.filter(new Wt(this.tileID.overscaledZ),O))return;const N=this.getId(O,R);for(let H=0;H<A.length;H++){const Y=A[H];if(y&&y.indexOf(Y)<0)continue;const fe=b[Y];if(!fe)continue;let oe={};N&&C&&(oe=C.getState(fe.sourceLayer||"_geojsonTileLayer",N));const he=ze({},I[Y]);he.paint=Y_(he.paint,fe.paint,O,oe,v),he.layout=Y_(he.layout,fe.layout,O,oe,v);const xe=!P||P(O,fe,oe);if(!xe)continue;const Me=new K_(O,this.z,this.x,this.y,N);Me.layer=he;let qe=t[Y];qe===void 0&&(qe=t[Y]=[]),qe.push({featureIndex:h,feature:Me,intersectionZ:xe})}}lookupSymbolFeatures(t,i,a,h,g,y,v,b){const I={};this.loadVTLayers();const C=Ou(g);for(const P of t)this.loadMatchingFeature(I,a,h,P,C,y,v,b,i);return I}hasLayer(t){for(const i of this.bucketLayerIDs)for(const a of i)if(t===a)return!0;return!1}getId(t,i){let a=t.id;return this.promoteId&&(a=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[i]],typeof a=="boolean"&&(a=Number(a))),a}}function Y_(n,t,i,a,h){return tt(n,(g,y)=>{const v=t instanceof va?t.get(y):null;return v&&v.evaluate?v.evaluate(i,a,h):v})}function Q_(n){let t=1/0,i=1/0,a=-1/0,h=-1/0;for(const g of n)t=Math.min(t,g.x),i=Math.min(i,g.y),a=Math.max(a,g.x),h=Math.max(h,g.y);return{minX:t,minY:i,maxX:a,maxY:h}}function e2(n,t){return t-n}function ev(n,t,i,a,h){const g=[];for(let y=0;y<n.length;y++){const v=n[y];let b;for(let I=0;I<v.length-1;I++){let C=v[I],P=v[I+1];C.x<t&&P.x<t||(C.x<t?C=new Z(t,C.y+(t-C.x)/(P.x-C.x)*(P.y-C.y))._round():P.x<t&&(P=new Z(t,C.y+(t-C.x)/(P.x-C.x)*(P.y-C.y))._round()),C.y<i&&P.y<i||(C.y<i?C=new Z(C.x+(i-C.y)/(P.y-C.y)*(P.x-C.x),i)._round():P.y<i&&(P=new Z(C.x+(i-C.y)/(P.y-C.y)*(P.x-C.x),i)._round()),C.x>=a&&P.x>=a||(C.x>=a?C=new Z(a,C.y+(a-C.x)/(P.x-C.x)*(P.y-C.y))._round():P.x>=a&&(P=new Z(a,C.y+(a-C.x)/(P.x-C.x)*(P.y-C.y))._round()),C.y>=h&&P.y>=h||(C.y>=h?C=new Z(C.x+(h-C.y)/(P.y-C.y)*(P.x-C.x),h)._round():P.y>=h&&(P=new Z(C.x+(h-C.y)/(P.y-C.y)*(P.x-C.x),h)._round()),b&&C.equals(b[b.length-1])||(b=[C],g.push(b)),b.push(P)))))}}return g}We("FeatureIndex",J_,{omit:["rawTileData","sourceLayerCoder"]});class Co extends Z{constructor(t,i,a,h){super(t,i),this.angle=a,h!==void 0&&(this.segment=h)}clone(){return new Co(this.x,this.y,this.angle,this.segment)}}function tv(n,t,i,a,h){if(t.segment===void 0||i===0)return!0;let g=t,y=t.segment+1,v=0;for(;v>-i/2;){if(y--,y<0)return!1;v-=n[y].dist(g),g=n[y]}v+=n[y].dist(n[y+1]),y++;const b=[];let I=0;for(;v<i/2;){const C=n[y],P=n[y+1];if(!P)return!1;let A=n[y-1].angleTo(C)-C.angleTo(P);for(A=Math.abs((A+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:v,angleDelta:A}),I+=A;v-b[0].distance>a;)I-=b.shift().angleDelta;if(I>h)return!1;y++,v+=C.dist(P)}return!0}function rv(n){let t=0;for(let i=0;i<n.length-1;i++)t+=n[i].dist(n[i+1]);return t}function nv(n,t,i){return n?.6*t*i:0}function iv(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function t2(n,t,i,a,h,g){const y=nv(i,h,g),v=iv(i,a)*g;let b=0;const I=rv(n)/2;for(let C=0;C<n.length-1;C++){const P=n[C],A=n[C+1],R=P.dist(A);if(b+R>I){const O=(I-b)/R,N=ln.number(P.x,A.x,O),H=ln.number(P.y,A.y,O),Y=new Co(N,H,A.angleTo(P),C);return Y._round(),!y||tv(n,Y,v,y,t)?Y:void 0}b+=R}}function r2(n,t,i,a,h,g,y,v,b){const I=nv(a,g,y),C=iv(a,h),P=C*y,A=n[0].x===0||n[0].x===b||n[0].y===0||n[0].y===b;return t-P<t/4&&(t=P+t/4),sv(n,A?t/2*v%t:(C/2+2*g)*y*v%t,t,I,i,P,A,!1,b)}function sv(n,t,i,a,h,g,y,v,b){const I=g/2,C=rv(n);let P=0,A=t-i,R=[];for(let O=0;O<n.length-1;O++){const N=n[O],H=n[O+1],Y=N.dist(H),fe=H.angleTo(N);for(;A+i<P+Y;){A+=i;const oe=(A-P)/Y,he=ln.number(N.x,H.x,oe),xe=ln.number(N.y,H.y,oe);if(he>=0&&he<b&&xe>=0&&xe<b&&A-I>=0&&A+I<=C){const Me=new Co(he,xe,fe,O);Me._round(),a&&!tv(n,Me,g,a,h)||R.push(Me)}}P+=Y}return v||R.length||y||(R=sv(n,P/2,i,a,h,g,y,!0,b)),R}We("Anchor",Co);const Fl=Cn;function ov(n,t,i,a){const h=[],g=n.image,y=g.pixelRatio,v=g.paddedRect.w-2*Fl,b=g.paddedRect.h-2*Fl;let I={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const C=g.stretchX||[[0,v]],P=g.stretchY||[[0,b]],A=(Te,rt)=>Te+rt[1]-rt[0],R=C.reduce(A,0),O=P.reduce(A,0),N=v-R,H=b-O;let Y=0,fe=R,oe=0,he=O,xe=0,Me=N,qe=0,at=H;if(g.content&&a){const Te=g.content,rt=Te[2]-Te[0],Qe=Te[3]-Te[1];(g.textFitWidth||g.textFitHeight)&&(I=D_(n)),Y=fd(C,0,Te[0]),oe=fd(P,0,Te[1]),fe=fd(C,Te[0],Te[2]),he=fd(P,Te[1],Te[3]),xe=Te[0]-Y,qe=Te[1]-oe,Me=rt-fe,at=Qe-he}const $e=I.x1,je=I.y1,et=I.x2-$e,Xe=I.y2-je,He=(Te,rt,Qe,dt)=>{const $t=md(Te.stretch-Y,fe,et,$e),Ut=gd(Te.fixed-xe,Me,Te.stretch,R),Ir=md(rt.stretch-oe,he,Xe,je),ki=gd(rt.fixed-qe,at,rt.stretch,O),Ur=md(Qe.stretch-Y,fe,et,$e),Cr=gd(Qe.fixed-xe,Me,Qe.stretch,R),dn=md(dt.stretch-oe,he,Xe,je),pn=gd(dt.fixed-qe,at,dt.stretch,O),fn=new Z($t,Ir),ur=new Z(Ur,Ir),Er=new Z(Ur,dn),Jr=new Z($t,dn),$r=new Z(Ut/y,ki/y),mn=new Z(Cr/y,pn/y),Zr=t*Math.PI/180;if(Zr){const At=Math.sin(Zr),Gt=Math.cos(Zr),Yt=[Gt,-At,At,Gt];fn._matMult(Yt),ur._matMult(Yt),Jr._matMult(Yt),Er._matMult(Yt)}const si=Te.stretch+Te.fixed,En=rt.stretch+rt.fixed;return{tl:fn,tr:ur,bl:Jr,br:Er,tex:{x:g.paddedRect.x+Fl+si,y:g.paddedRect.y+Fl+En,w:Qe.stretch+Qe.fixed-si,h:dt.stretch+dt.fixed-En},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:$r,pixelOffsetBR:mn,minFontScaleX:Me/y/et,minFontScaleY:at/y/Xe,isSDF:i}};if(a&&(g.stretchX||g.stretchY)){const Te=av(C,N,R),rt=av(P,H,O);for(let Qe=0;Qe<Te.length-1;Qe++){const dt=Te[Qe],$t=Te[Qe+1];for(let Ut=0;Ut<rt.length-1;Ut++)h.push(He(dt,rt[Ut],$t,rt[Ut+1]))}}else h.push(He({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:b+1}));return h}function fd(n,t,i){let a=0;for(const h of n)a+=Math.max(t,Math.min(i,h[1]))-Math.max(t,Math.min(i,h[0]));return a}function av(n,t,i){const a=[{fixed:-Fl,stretch:0}];for(const[h,g]of n){const y=a[a.length-1];a.push({fixed:h-y.stretch,stretch:y.stretch}),a.push({fixed:h-y.stretch,stretch:y.stretch+(g-h)})}return a.push({fixed:t+Fl,stretch:i}),a}function md(n,t,i,a){return n/t*i+a}function gd(n,t,i,a){return n-t*i/a}class yd{constructor(t,i,a,h,g,y,v,b,I,C){var P;if(this.boxStartIndex=t.length,I){let A=y.top,R=y.bottom;const O=y.collisionPadding;O&&(A-=O[1],R+=O[3]);let N=R-A;N>0&&(N=Math.max(10,N),this.circleDiameter=N)}else{const A=!((P=y.image)===null||P===void 0)&&P.content&&(y.image.textFitWidth||y.image.textFitHeight)?D_(y):{x1:y.left,y1:y.top,x2:y.right,y2:y.bottom};A.y1=A.y1*v-b[0],A.y2=A.y2*v+b[2],A.x1=A.x1*v-b[3],A.x2=A.x2*v+b[1];const R=y.collisionPadding;if(R&&(A.x1-=R[0]*v,A.y1-=R[1]*v,A.x2+=R[2]*v,A.y2+=R[3]*v),C){const O=new Z(A.x1,A.y1),N=new Z(A.x2,A.y1),H=new Z(A.x1,A.y2),Y=new Z(A.x2,A.y2),fe=C*Math.PI/180;O._rotate(fe),N._rotate(fe),H._rotate(fe),Y._rotate(fe),A.x1=Math.min(O.x,N.x,H.x,Y.x),A.x2=Math.max(O.x,N.x,H.x,Y.x),A.y1=Math.min(O.y,N.y,H.y,Y.y),A.y2=Math.max(O.y,N.y,H.y,Y.y)}t.emplaceBack(i.x,i.y,A.x1,A.y1,A.x2,A.y2,a,h,g)}this.boxEndIndex=t.length}}class n2{constructor(t=[],i=(a,h)=>a<h?-1:a>h?1:0){if(this.data=t,this.length=this.data.length,this.compare=i,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:i,compare:a}=this,h=i[t];for(;t>0;){const g=t-1>>1,y=i[g];if(a(h,y)>=0)break;i[t]=y,t=g}i[t]=h}_down(t){const{data:i,compare:a}=this,h=this.length>>1,g=i[t];for(;t<h;){let y=1+(t<<1);const v=y+1;if(v<this.length&&a(i[v],i[y])<0&&(y=v),a(i[y],g)>=0)break;i[t]=i[y],t=y}i[t]=g}}function i2(n,t=1,i=!1){let a=1/0,h=1/0,g=-1/0,y=-1/0;const v=n[0];for(let R=0;R<v.length;R++){const O=v[R];(!R||O.x<a)&&(a=O.x),(!R||O.y<h)&&(h=O.y),(!R||O.x>g)&&(g=O.x),(!R||O.y>y)&&(y=O.y)}const b=Math.min(g-a,y-h);let I=b/2;const C=new n2([],s2);if(b===0)return new Z(a,h);for(let R=a;R<g;R+=b)for(let O=h;O<y;O+=b)C.push(new Bl(R+I,O+I,I,n));let P=function(R){let O=0,N=0,H=0;const Y=R[0];for(let fe=0,oe=Y.length,he=oe-1;fe<oe;he=fe++){const xe=Y[fe],Me=Y[he],qe=xe.x*Me.y-Me.x*xe.y;N+=(xe.x+Me.x)*qe,H+=(xe.y+Me.y)*qe,O+=3*qe}return new Bl(N/O,H/O,0,R)}(n),A=C.length;for(;C.length;){const R=C.pop();(R.d>P.d||!P.d)&&(P=R,i&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,A)),R.max-P.d<=t||(I=R.h/2,C.push(new Bl(R.p.x-I,R.p.y-I,I,n)),C.push(new Bl(R.p.x+I,R.p.y-I,I,n)),C.push(new Bl(R.p.x-I,R.p.y+I,I,n)),C.push(new Bl(R.p.x+I,R.p.y+I,I,n)),A+=4)}return i&&(console.log(`num probes: ${A}`),console.log(`best distance: ${P.d}`)),P.p}function s2(n,t){return t.max-n.max}function Bl(n,t,i,a){this.p=new Z(n,t),this.h=i,this.d=function(h,g){let y=!1,v=1/0;for(let b=0;b<g.length;b++){const I=g[b];for(let C=0,P=I.length,A=P-1;C<P;A=C++){const R=I[C],O=I[A];R.y>h.y!=O.y>h.y&&h.x<(O.x-R.x)*(h.y-R.y)/(O.y-R.y)+R.x&&(y=!y),v=Math.min(v,Zy(h,R,O))}}return(y?1:-1)*Math.sqrt(v)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}var Vr;w.aq=void 0,(Vr=w.aq||(w.aq={}))[Vr.center=1]="center",Vr[Vr.left=2]="left",Vr[Vr.right=3]="right",Vr[Vr.top=4]="top",Vr[Vr.bottom=5]="bottom",Vr[Vr["top-left"]=6]="top-left",Vr[Vr["top-right"]=7]="top-right",Vr[Vr["bottom-left"]=8]="bottom-left",Vr[Vr["bottom-right"]=9]="bottom-right";const Eo=7,Jf=Number.POSITIVE_INFINITY;function lv(n,t){return t[1]!==Jf?function(i,a,h){let g=0,y=0;switch(a=Math.abs(a),h=Math.abs(h),i){case"top-right":case"top-left":case"top":y=h-Eo;break;case"bottom-right":case"bottom-left":case"bottom":y=-h+Eo}switch(i){case"top-right":case"bottom-right":case"right":g=-a;break;case"top-left":case"bottom-left":case"left":g=a}return[g,y]}(n,t[0],t[1]):function(i,a){let h=0,g=0;a<0&&(a=0);const y=a/Math.SQRT2;switch(i){case"top-right":case"top-left":g=y-Eo;break;case"bottom-right":case"bottom-left":g=-y+Eo;break;case"bottom":g=-a+Eo;break;case"top":g=a-Eo}switch(i){case"top-right":case"bottom-right":h=-y;break;case"top-left":case"bottom-left":h=y;break;case"left":h=a;break;case"right":h=-a}return[h,g]}(n,t[0])}function uv(n,t,i){var a;const h=n.layout,g=(a=h.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(t,{},i);if(g){const v=g.values,b=[];for(let I=0;I<v.length;I+=2){const C=b[I]=v[I],P=v[I+1].map(A=>A*br);C.startsWith("top")?P[1]-=Eo:C.startsWith("bottom")&&(P[1]+=Eo),b[I+1]=P}return new Ln(b)}const y=h.get("text-variable-anchor");if(y){let v;v=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[h.get("text-radial-offset").evaluate(t,{},i)*br,Jf]:h.get("text-offset").evaluate(t,{},i).map(I=>I*br);const b=[];for(const I of y)b.push(I,lv(I,v));return new Ln(b)}return null}function Yf(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function o2(n,t,i,a,h,g,y,v,b,I,C){let P=g.textMaxSize.evaluate(t,{});P===void 0&&(P=y);const A=n.layers[0].layout,R=A.get("icon-offset").evaluate(t,{},C),O=hv(i.horizontal),N=y/24,H=n.tilePixelRatio*N,Y=n.tilePixelRatio*P/24,fe=n.tilePixelRatio*v,oe=n.tilePixelRatio*A.get("symbol-spacing"),he=A.get("text-padding")*n.tilePixelRatio,xe=function(Te,rt,Qe,dt=1){const $t=Te.get("icon-padding").evaluate(rt,{},Qe),Ut=$t&&$t.values;return[Ut[0]*dt,Ut[1]*dt,Ut[2]*dt,Ut[3]*dt]}(A,t,C,n.tilePixelRatio),Me=A.get("text-max-angle")/180*Math.PI,qe=A.get("text-rotation-alignment")!=="viewport"&&A.get("symbol-placement")!=="point",at=A.get("icon-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",$e=A.get("symbol-placement"),je=oe/2,et=A.get("icon-text-fit");let Xe;a&&et!=="none"&&(n.allowVerticalPlacement&&i.vertical&&(Xe=L_(a,i.vertical,et,A.get("icon-text-fit-padding"),R,N)),O&&(a=L_(a,O,et,A.get("icon-text-fit-padding"),R,N)));const He=(Te,rt)=>{rt.x<0||rt.x>=vr||rt.y<0||rt.y>=vr||function(Qe,dt,$t,Ut,Ir,ki,Ur,Cr,dn,pn,fn,ur,Er,Jr,$r,mn,Zr,si,En,At,Gt,Yt,Vn,nr,Ol){const ss=Qe.addToLineVertexArray(dt,$t);let os,Ti,oi,Ar,zs=0,bc=0,mv=0,gv=0,om=-1,am=-1;const As={};let yv=kl("");if(Qe.allowVerticalPlacement&&Ut.vertical){const Yr=Cr.layout.get("text-rotate").evaluate(Gt,{},nr)+90;oi=new yd(dn,dt,pn,fn,ur,Ut.vertical,Er,Jr,$r,Yr),Ur&&(Ar=new yd(dn,dt,pn,fn,ur,Ur,Zr,si,$r,Yr))}if(Ir){const Yr=Cr.layout.get("icon-rotate").evaluate(Gt,{}),ai=Cr.layout.get("icon-text-fit")!=="none",Ia=ov(Ir,Yr,Vn,ai),Ni=Ur?ov(Ur,Yr,Vn,ai):void 0;Ti=new yd(dn,dt,pn,fn,ur,Ir,Zr,si,!1,Yr),zs=4*Ia.length;const Ca=Qe.iconSizeData;let as=null;Ca.kind==="source"?(as=[is*Cr.layout.get("icon-size").evaluate(Gt,{})],as[0]>To&&Zt(`${Qe.layerIds[0]}: Value for "icon-size" is >= ${yc}. Reduce your "icon-size".`)):Ca.kind==="composite"&&(as=[is*Yt.compositeIconSizes[0].evaluate(Gt,{},nr),is*Yt.compositeIconSizes[1].evaluate(Gt,{},nr)],(as[0]>To||as[1]>To)&&Zt(`${Qe.layerIds[0]}: Value for "icon-size" is >= ${yc}. Reduce your "icon-size".`)),Qe.addSymbols(Qe.icon,Ia,as,At,En,Gt,w.ah.none,dt,ss.lineStartIndex,ss.lineLength,-1,nr),om=Qe.icon.placedSymbolArray.length-1,Ni&&(bc=4*Ni.length,Qe.addSymbols(Qe.icon,Ni,as,At,En,Gt,w.ah.vertical,dt,ss.lineStartIndex,ss.lineLength,-1,nr),am=Qe.icon.placedSymbolArray.length-1)}const _v=Object.keys(Ut.horizontal);for(const Yr of _v){const ai=Ut.horizontal[Yr];if(!os){yv=kl(ai.text);const Ni=Cr.layout.get("text-rotate").evaluate(Gt,{},nr);os=new yd(dn,dt,pn,fn,ur,ai,Er,Jr,$r,Ni)}const Ia=ai.positionedLines.length===1;if(mv+=cv(Qe,dt,ai,ki,Cr,$r,Gt,mn,ss,Ut.vertical?w.ah.horizontal:w.ah.horizontalOnly,Ia?_v:[Yr],As,om,Yt,nr),Ia)break}Ut.vertical&&(gv+=cv(Qe,dt,Ut.vertical,ki,Cr,$r,Gt,mn,ss,w.ah.vertical,["vertical"],As,am,Yt,nr));const u2=os?os.boxStartIndex:Qe.collisionBoxArray.length,c2=os?os.boxEndIndex:Qe.collisionBoxArray.length,h2=oi?oi.boxStartIndex:Qe.collisionBoxArray.length,d2=oi?oi.boxEndIndex:Qe.collisionBoxArray.length,p2=Ti?Ti.boxStartIndex:Qe.collisionBoxArray.length,f2=Ti?Ti.boxEndIndex:Qe.collisionBoxArray.length,m2=Ar?Ar.boxStartIndex:Qe.collisionBoxArray.length,g2=Ar?Ar.boxEndIndex:Qe.collisionBoxArray.length;let Oi=-1;const vd=(Yr,ai)=>Yr&&Yr.circleDiameter?Math.max(Yr.circleDiameter,ai):ai;Oi=vd(os,Oi),Oi=vd(oi,Oi),Oi=vd(Ti,Oi),Oi=vd(Ar,Oi);const vv=Oi>-1?1:0;vv&&(Oi*=Ol/br),Qe.glyphOffsetArray.length>=Rl.MAX_GLYPHS&&Zt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Gt.sortKey!==void 0&&Qe.addToSortKeyRanges(Qe.symbolInstances.length,Gt.sortKey);const y2=uv(Cr,Gt,nr),[_2,v2]=function(Yr,ai){const Ia=Yr.length,Ni=ai==null?void 0:ai.values;if((Ni==null?void 0:Ni.length)>0)for(let Ca=0;Ca<Ni.length;Ca+=2){const as=Ni[Ca+1];Yr.emplaceBack(w.aq[Ni[Ca]],as[0],as[1])}return[Ia,Yr.length]}(Qe.textAnchorOffsets,y2);Qe.symbolInstances.emplaceBack(dt.x,dt.y,As.right>=0?As.right:-1,As.center>=0?As.center:-1,As.left>=0?As.left:-1,As.vertical||-1,om,am,yv,u2,c2,h2,d2,p2,f2,m2,g2,pn,mv,gv,zs,bc,vv,0,Er,Oi,_2,v2)}(n,rt,Te,i,a,h,Xe,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,H,[he,he,he,he],qe,b,fe,xe,at,R,t,g,I,C,y)};if($e==="line")for(const Te of ev(t.geometry,0,0,vr,vr)){const rt=r2(Te,oe,Me,i.vertical||O,a,24,Y,n.overscaling,vr);for(const Qe of rt)O&&a2(n,O.text,je,Qe)||He(Te,Qe)}else if($e==="line-center"){for(const Te of t.geometry)if(Te.length>1){const rt=t2(Te,Me,i.vertical||O,a,24,Y);rt&&He(Te,rt)}}else if(t.type==="Polygon")for(const Te of el(t.geometry,0)){const rt=i2(Te,16);He(Te[0],new Co(rt.x,rt.y,0))}else if(t.type==="LineString")for(const Te of t.geometry)He(Te,new Co(Te[0].x,Te[0].y,0));else if(t.type==="Point")for(const Te of t.geometry)for(const rt of Te)He([rt],new Co(rt.x,rt.y,0))}function cv(n,t,i,a,h,g,y,v,b,I,C,P,A,R,O){const N=function(fe,oe,he,xe,Me,qe,at,$e){const je=xe.layout.get("text-rotate").evaluate(qe,{})*Math.PI/180,et=[];for(const Xe of oe.positionedLines)for(const He of Xe.positionedGlyphs){if(!He.rect)continue;const Te=He.rect||{};let rt=I_+1,Qe=!0,dt=1,$t=0;const Ut=(Me||$e)&&He.vertical,Ir=He.metrics.advance*He.scale/2;if($e&&oe.verticalizable&&($t=Xe.lineOffset/2-(He.imageName?-(br-He.metrics.width*He.scale)/2:(He.scale-1)*br)),He.imageName){const At=at[He.imageName];Qe=At.sdf,dt=At.pixelRatio,rt=Cn/dt}const ki=Me?[He.x+Ir,He.y]:[0,0];let Ur=Me?[0,0]:[He.x+Ir+he[0],He.y+he[1]-$t],Cr=[0,0];Ut&&(Cr=Ur,Ur=[0,0]);const dn=He.metrics.isDoubleResolution?2:1,pn=(He.metrics.left-rt)*He.scale-Ir+Ur[0],fn=(-He.metrics.top-rt)*He.scale+Ur[1],ur=pn+Te.w/dn*He.scale/dt,Er=fn+Te.h/dn*He.scale/dt,Jr=new Z(pn,fn),$r=new Z(ur,fn),mn=new Z(pn,Er),Zr=new Z(ur,Er);if(Ut){const At=new Z(-Ir,Ir-mc),Gt=-Math.PI/2,Yt=br/2-Ir,Vn=new Z(5-mc-Yt,-(He.imageName?Yt:0)),nr=new Z(...Cr);Jr._rotateAround(Gt,At)._add(Vn)._add(nr),$r._rotateAround(Gt,At)._add(Vn)._add(nr),mn._rotateAround(Gt,At)._add(Vn)._add(nr),Zr._rotateAround(Gt,At)._add(Vn)._add(nr)}if(je){const At=Math.sin(je),Gt=Math.cos(je),Yt=[Gt,-At,At,Gt];Jr._matMult(Yt),$r._matMult(Yt),mn._matMult(Yt),Zr._matMult(Yt)}const si=new Z(0,0),En=new Z(0,0);et.push({tl:Jr,tr:$r,bl:mn,br:Zr,tex:Te,writingMode:oe.writingMode,glyphOffset:ki,sectionIndex:He.sectionIndex,isSDF:Qe,pixelOffsetTL:si,pixelOffsetBR:En,minFontScaleX:0,minFontScaleY:0})}return et}(0,i,v,h,g,y,a,n.allowVerticalPlacement),H=n.textSizeData;let Y=null;H.kind==="source"?(Y=[is*h.layout.get("text-size").evaluate(y,{})],Y[0]>To&&Zt(`${n.layerIds[0]}: Value for "text-size" is >= ${yc}. Reduce your "text-size".`)):H.kind==="composite"&&(Y=[is*R.compositeTextSizes[0].evaluate(y,{},O),is*R.compositeTextSizes[1].evaluate(y,{},O)],(Y[0]>To||Y[1]>To)&&Zt(`${n.layerIds[0]}: Value for "text-size" is >= ${yc}. Reduce your "text-size".`)),n.addSymbols(n.text,N,Y,v,g,y,I,t,b.lineStartIndex,b.lineLength,A,O);for(const fe of C)P[fe]=n.text.placedSymbolArray.length-1;return 4*N.length}function hv(n){for(const t in n)return n[t];return null}function a2(n,t,i,a){const h=n.compareText;if(t in h){const g=h[t];for(let y=g.length-1;y>=0;y--)if(a.dist(g[y])<i)return!0}else h[t]=[];return h[t].push(a),!1}const dv=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Qf{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,a]=new Uint8Array(t,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=a>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const g=dv[15&a];if(!g)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(t,2,1),[v]=new Uint32Array(t,4,1);return new Qf(v,y,g,t)}constructor(t,i=64,a=Float64Array,h){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=a,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const g=dv.indexOf(this.ArrayType),y=2*t*this.ArrayType.BYTES_PER_ELEMENT,v=t*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-v%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${a}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+b,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+y+v+b),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+b,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=t)}add(t,i){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=t,this.coords[this._pos++]=i,a}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return em(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,i,a,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:y,nodeSize:v}=this,b=[0,g.length-1,0],I=[];for(;b.length;){const C=b.pop()||0,P=b.pop()||0,A=b.pop()||0;if(P-A<=v){for(let H=A;H<=P;H++){const Y=y[2*H],fe=y[2*H+1];Y>=t&&Y<=a&&fe>=i&&fe<=h&&I.push(g[H])}continue}const R=A+P>>1,O=y[2*R],N=y[2*R+1];O>=t&&O<=a&&N>=i&&N<=h&&I.push(g[R]),(C===0?t<=O:i<=N)&&(b.push(A),b.push(R-1),b.push(1-C)),(C===0?a>=O:h>=N)&&(b.push(R+1),b.push(P),b.push(1-C))}return I}within(t,i,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:g,nodeSize:y}=this,v=[0,h.length-1,0],b=[],I=a*a;for(;v.length;){const C=v.pop()||0,P=v.pop()||0,A=v.pop()||0;if(P-A<=y){for(let H=A;H<=P;H++)fv(g[2*H],g[2*H+1],t,i)<=I&&b.push(h[H]);continue}const R=A+P>>1,O=g[2*R],N=g[2*R+1];fv(O,N,t,i)<=I&&b.push(h[R]),(C===0?t-a<=O:i-a<=N)&&(v.push(A),v.push(R-1),v.push(1-C)),(C===0?t+a>=O:i+a>=N)&&(v.push(R+1),v.push(P),v.push(1-C))}return b}}function em(n,t,i,a,h,g){if(h-a<=i)return;const y=a+h>>1;pv(n,t,y,a,h,g),em(n,t,i,a,y-1,1-g),em(n,t,i,y+1,h,1-g)}function pv(n,t,i,a,h,g){for(;h>a;){if(h-a>600){const I=h-a+1,C=i-a+1,P=Math.log(I),A=.5*Math.exp(2*P/3),R=.5*Math.sqrt(P*A*(I-A)/I)*(C-I/2<0?-1:1);pv(n,t,i,Math.max(a,Math.floor(i-C*A/I+R)),Math.min(h,Math.floor(i+(I-C)*A/I+R)),g)}const y=t[2*i+g];let v=a,b=h;for(xc(n,t,a,i),t[2*h+g]>y&&xc(n,t,a,h);v<b;){for(xc(n,t,v,b),v++,b--;t[2*v+g]<y;)v++;for(;t[2*b+g]>y;)b--}t[2*a+g]===y?xc(n,t,a,b):(b++,xc(n,t,b,h)),b<=i&&(a=b+1),i<=b&&(h=b-1)}}function xc(n,t,i,a){tm(n,i,a),tm(t,2*i,2*a),tm(t,2*i+1,2*a+1)}function tm(n,t,i){const a=n[t];n[t]=n[i],n[i]=a}function fv(n,t,i,a){const h=n-i,g=t-a;return h*h+g*g}var rm;w.bg=void 0,(rm=w.bg||(w.bg={})).create="create",rm.load="load",rm.fullLoad="fullLoad";let _d=null,wc=[];const nm=1e3/60,im="loadTime",sm="fullLoadTime",l2={mark(n){performance.mark(n)},frame(n){const t=n;_d!=null&&wc.push(t-_d),_d=t},clearMetrics(){_d=null,wc=[],performance.clearMeasures(im),performance.clearMeasures(sm);for(const n in w.bg)performance.clearMarks(w.bg[n])},getPerformanceMetrics(){performance.measure(im,w.bg.create,w.bg.load),performance.measure(sm,w.bg.create,w.bg.fullLoad);const n=performance.getEntriesByName(im)[0].duration,t=performance.getEntriesByName(sm)[0].duration,i=wc.length,a=1/(wc.reduce((g,y)=>g+y,0)/i/1e3),h=wc.filter(g=>g>nm).reduce((g,y)=>g+(y-nm)/nm,0);return{loadTime:n,fullLoadTime:t,fps:a,percentDroppedFrames:h/(i+h)*100,totalFrames:i}}};w.$=class extends M{},w.A=Pl,w.B=pf,w.C=function(n){if(mi==null){const t=n.navigator?n.navigator.userAgent:null;mi=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return mi},w.D=Je,w.E=Hs,w.F=class{constructor(n,t){this.target=n,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Qb(()=>this.process()),this.subscription=function(i,a,h,g){return i.addEventListener(a,h,!1),{unsubscribe:()=>{i.removeEventListener(a,h,!1)}}}(this.target,"message",i=>this.receive(i)),this.globalScope=xn(self)?n:window}registerMessageHandler(n,t){this.messageHandlers[n]=t}sendAsync(n,t){return new Promise((i,a)=>{const h=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[h]={resolve:i,reject:a},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[h];const v={id:h,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(v)},{once:!0});const g=[],y=Object.assign(Object.assign({},n),{id:h,sourceMapId:this.mapId,origin:location.origin,data:po(n.data,g)});this.target.postMessage(y,{transfer:g})})}receive(n){const t=n.data,i=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[i];const a=this.abortControllers[i];return delete this.abortControllers[i],void(a&&a.abort())}if(xn(self)||t.mustQueue)return this.tasks[i]=t,this.taskQueue.push(i),void this.invoker.trigger();this.processTask(i,t)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),t=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(n,t)}processTask(n,t){return d(this,void 0,void 0,function*(){if(t.type==="<response>"){const h=this.resolveRejects[n];return delete this.resolveRejects[n],h?void(t.error?h.reject(fo(t.error)):h.resolve(fo(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const i=fo(t.data),a=new AbortController;this.abortControllers[n]=a;try{const h=yield this.messageHandlers[t.type](t.sourceMapId,i,a);this.completeTask(n,null,h)}catch(h){this.completeTask(n,h)}})}completeTask(n,t,i){const a=[];delete this.abortControllers[n];const h={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?po(t):null,data:po(i,a)};this.target.postMessage(h,{transfer:a})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},w.G=on,w.H=function(){var n=new Pl(16);return Pl!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},w.I=jf,w.J=function(n,t,i){var a,h,g,y,v,b,I,C,P,A,R,O,N=i[0],H=i[1],Y=i[2];return t===n?(n[12]=t[0]*N+t[4]*H+t[8]*Y+t[12],n[13]=t[1]*N+t[5]*H+t[9]*Y+t[13],n[14]=t[2]*N+t[6]*H+t[10]*Y+t[14],n[15]=t[3]*N+t[7]*H+t[11]*Y+t[15]):(h=t[1],g=t[2],y=t[3],v=t[4],b=t[5],I=t[6],C=t[7],P=t[8],A=t[9],R=t[10],O=t[11],n[0]=a=t[0],n[1]=h,n[2]=g,n[3]=y,n[4]=v,n[5]=b,n[6]=I,n[7]=C,n[8]=P,n[9]=A,n[10]=R,n[11]=O,n[12]=a*N+v*H+P*Y+t[12],n[13]=h*N+b*H+A*Y+t[13],n[14]=g*N+I*H+R*Y+t[14],n[15]=y*N+C*H+O*Y+t[15]),n},w.K=function(n,t,i){var a=i[0],h=i[1],g=i[2];return n[0]=t[0]*a,n[1]=t[1]*a,n[2]=t[2]*a,n[3]=t[3]*a,n[4]=t[4]*h,n[5]=t[5]*h,n[6]=t[6]*h,n[7]=t[7]*h,n[8]=t[8]*g,n[9]=t[9]*g,n[10]=t[10]*g,n[11]=t[11]*g,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},w.L=Wy,w.M=function(n,t){const i={};for(let a=0;a<t.length;a++){const h=t[a];h in n&&(i[h]=n[h])}return i},w.N=Io,w.O=$_,w.P=Z,w.Q=Z_,w.R=ni,w.S=ii,w.T=vl,w.U=ne,w.V=q,w.W=mt,w.X=vr,w.Y=x,w.Z=_c,w._=d,w.a=Fr,w.a$=function(n,t){var i=n[0],a=n[1],h=n[2],g=n[3],y=n[4],v=n[5],b=n[6],I=n[7],C=n[8],P=n[9],A=n[10],R=n[11],O=n[12],N=n[13],H=n[14],Y=n[15],fe=t[0],oe=t[1],he=t[2],xe=t[3],Me=t[4],qe=t[5],at=t[6],$e=t[7],je=t[8],et=t[9],Xe=t[10],He=t[11],Te=t[12],rt=t[13],Qe=t[14],dt=t[15];return Math.abs(i-fe)<=hn*Math.max(1,Math.abs(i),Math.abs(fe))&&Math.abs(a-oe)<=hn*Math.max(1,Math.abs(a),Math.abs(oe))&&Math.abs(h-he)<=hn*Math.max(1,Math.abs(h),Math.abs(he))&&Math.abs(g-xe)<=hn*Math.max(1,Math.abs(g),Math.abs(xe))&&Math.abs(y-Me)<=hn*Math.max(1,Math.abs(y),Math.abs(Me))&&Math.abs(v-qe)<=hn*Math.max(1,Math.abs(v),Math.abs(qe))&&Math.abs(b-at)<=hn*Math.max(1,Math.abs(b),Math.abs(at))&&Math.abs(I-$e)<=hn*Math.max(1,Math.abs(I),Math.abs($e))&&Math.abs(C-je)<=hn*Math.max(1,Math.abs(C),Math.abs(je))&&Math.abs(P-et)<=hn*Math.max(1,Math.abs(P),Math.abs(et))&&Math.abs(A-Xe)<=hn*Math.max(1,Math.abs(A),Math.abs(Xe))&&Math.abs(R-He)<=hn*Math.max(1,Math.abs(R),Math.abs(He))&&Math.abs(O-Te)<=hn*Math.max(1,Math.abs(O),Math.abs(Te))&&Math.abs(N-rt)<=hn*Math.max(1,Math.abs(N),Math.abs(rt))&&Math.abs(H-Qe)<=hn*Math.max(1,Math.abs(H),Math.abs(Qe))&&Math.abs(Y-dt)<=hn*Math.max(1,Math.abs(Y),Math.abs(dt))},w.a0=It,w.a1=Kf,w.a2=De,w.a3=n=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(i=>{t.onloadstart=()=>{i(t)};for(const a of n){const h=window.document.createElement("source");fs(a)||(t.crossOrigin="Anonymous"),h.src=a,t.appendChild(h)}})},w.a4=function(){return Ue++},w.a5=Ze,w.a6=Rl,w.a7=Ou,w.a8=ka,w.a9=K_,w.aA=function(n){if(n.type==="custom")return new Yb(n);switch(n.type){case"background":return new Xb(n);case"circle":return new Fw(n);case"fill":return new Qw(n);case"fill-extrusion":return new fb(n);case"heatmap":return new Ow(n);case"hillshade":return new jw(n);case"line":return new bb(n);case"raster":return new Jb(n);case"symbol":return new pd(n)}},w.aB=ot,w.aC=function(n,t){if(!n)return[{command:"setStyle",args:[t]}];let i=[];try{if(!Dt(n.version,t.version))return[{command:"setStyle",args:[t]}];Dt(n.center,t.center)||i.push({command:"setCenter",args:[t.center]}),Dt(n.zoom,t.zoom)||i.push({command:"setZoom",args:[t.zoom]}),Dt(n.bearing,t.bearing)||i.push({command:"setBearing",args:[t.bearing]}),Dt(n.pitch,t.pitch)||i.push({command:"setPitch",args:[t.pitch]}),Dt(n.sprite,t.sprite)||i.push({command:"setSprite",args:[t.sprite]}),Dt(n.glyphs,t.glyphs)||i.push({command:"setGlyphs",args:[t.glyphs]}),Dt(n.transition,t.transition)||i.push({command:"setTransition",args:[t.transition]}),Dt(n.light,t.light)||i.push({command:"setLight",args:[t.light]}),Dt(n.terrain,t.terrain)||i.push({command:"setTerrain",args:[t.terrain]}),Dt(n.sky,t.sky)||i.push({command:"setSky",args:[t.sky]}),Dt(n.projection,t.projection)||i.push({command:"setProjection",args:[t.projection]});const a={},h=[];(function(y,v,b,I){let C;for(C in v=v||{},y=y||{})Object.prototype.hasOwnProperty.call(y,C)&&(Object.prototype.hasOwnProperty.call(v,C)||Ji(C,b,I));for(C in v)Object.prototype.hasOwnProperty.call(v,C)&&(Object.prototype.hasOwnProperty.call(y,C)?Dt(y[C],v[C])||(y[C].type==="geojson"&&v[C].type==="geojson"&&Ws(y,v,C)?tr(b,{command:"setGeoJSONSourceData",args:[C,v[C].data]}):Di(C,v,b,I)):Yo(C,v,b))})(n.sources,t.sources,h,a);const g=[];n.layers&&n.layers.forEach(y=>{"source"in y&&a[y.source]?i.push({command:"removeLayer",args:[y.id]}):g.push(y)}),i=i.concat(h),function(y,v,b){v=v||[];const I=(y=y||[]).map(Qo),C=v.map(Qo),P=y.reduce(ea,{}),A=v.reduce(ea,{}),R=I.slice(),O=Object.create(null);let N,H,Y,fe,oe;for(let he=0,xe=0;he<I.length;he++)N=I[he],Object.prototype.hasOwnProperty.call(A,N)?xe++:(tr(b,{command:"removeLayer",args:[N]}),R.splice(R.indexOf(N,xe),1));for(let he=0,xe=0;he<C.length;he++)N=C[C.length-1-he],R[R.length-1-he]!==N&&(Object.prototype.hasOwnProperty.call(P,N)?(tr(b,{command:"removeLayer",args:[N]}),R.splice(R.lastIndexOf(N,R.length-xe),1)):xe++,fe=R[R.length-he],tr(b,{command:"addLayer",args:[A[N],fe]}),R.splice(R.length-he,0,N),O[N]=!0);for(let he=0;he<C.length;he++)if(N=C[he],H=P[N],Y=A[N],!O[N]&&!Dt(H,Y))if(Dt(H.source,Y.source)&&Dt(H["source-layer"],Y["source-layer"])&&Dt(H.type,Y.type)){for(oe in Dn(H.layout,Y.layout,b,N,null,"setLayoutProperty"),Dn(H.paint,Y.paint,b,N,null,"setPaintProperty"),Dt(H.filter,Y.filter)||tr(b,{command:"setFilter",args:[N,Y.filter]}),Dt(H.minzoom,Y.minzoom)&&Dt(H.maxzoom,Y.maxzoom)||tr(b,{command:"setLayerZoomRange",args:[N,Y.minzoom,Y.maxzoom]}),H)Object.prototype.hasOwnProperty.call(H,oe)&&oe!=="layout"&&oe!=="paint"&&oe!=="filter"&&oe!=="metadata"&&oe!=="minzoom"&&oe!=="maxzoom"&&(oe.indexOf("paint.")===0?Dn(H[oe],Y[oe],b,N,oe.slice(6),"setPaintProperty"):Dt(H[oe],Y[oe])||tr(b,{command:"setLayerProperty",args:[N,oe,Y[oe]]}));for(oe in Y)Object.prototype.hasOwnProperty.call(Y,oe)&&!Object.prototype.hasOwnProperty.call(H,oe)&&oe!=="layout"&&oe!=="paint"&&oe!=="filter"&&oe!=="metadata"&&oe!=="minzoom"&&oe!=="maxzoom"&&(oe.indexOf("paint.")===0?Dn(H[oe],Y[oe],b,N,oe.slice(6),"setPaintProperty"):Dt(H[oe],Y[oe])||tr(b,{command:"setLayerProperty",args:[N,oe,Y[oe]]}))}else tr(b,{command:"removeLayer",args:[N]}),fe=R[R.lastIndexOf(N)+1],tr(b,{command:"addLayer",args:[Y,fe]})}(g,t.layers,i)}catch(a){console.warn("Unable to compute style diff:",a),i=[{command:"setStyle",args:[t]}]}return i},w.aD=function(n){const t=[],i=n.id;return i===void 0&&t.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&t.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},w.aE=function n(t,i){if(Array.isArray(t)){if(!Array.isArray(i)||t.length!==i.length)return!1;for(let a=0;a<t.length;a++)if(!n(t[a],i[a]))return!1;return!0}if(typeof t=="object"&&t!==null&&i!==null){if(typeof i!="object"||Object.keys(t).length!==Object.keys(i).length)return!1;for(const a in t)if(!n(t[a],i[a]))return!1;return!0}return t===i},w.aF=tt,w.aG=ut,w.aH=class extends wa{constructor(n,t){super(n,t),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},w.aI=ed,w.aJ=class extends wa{constructor(n,t){super(n,t),this.current=Ew}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let t=1;t<16;t++)if(n[t]!==this.current[t]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},w.aK=By,w.aL=Oy,w.aM=Nt,w.aN=class extends wa{constructor(n,t){super(n,t),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},w.aO=class extends wa{constructor(n,t){super(n,t),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},w.aP=function(n,t,i,a,h,g,y){var v=1/(t-i),b=1/(a-h),I=1/(g-y);return n[0]=-2*v,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*b,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*I,n[11]=0,n[12]=(t+i)*v,n[13]=(h+a)*b,n[14]=(y+g)*I,n[15]=1,n},w.aQ=Rw,w.aR=class extends le{},w.aS=Ib,w.aT=class extends me{},w.aU=Ef,w.aV=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},w.aW=Qy,w.aX=Nr,w.aY=ri,w.aZ=class extends Ye{},w.a_=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]},w.aa=function(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,a,h,g)=>{const y=h||g;return t[a]=!y||y.toLowerCase(),""}),t["max-age"]){const i=parseInt(t["max-age"],10);isNaN(i)?delete t["max-age"]:t["max-age"]=i}return t},w.ab=function(n,t){const i=[];for(const a in n)a in t||i.push(a);return i},w.ac=ye,w.ad=function(n,t,i){var a=Math.sin(i),h=Math.cos(i),g=t[0],y=t[1],v=t[2],b=t[3],I=t[4],C=t[5],P=t[6],A=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=g*h+I*a,n[1]=y*h+C*a,n[2]=v*h+P*a,n[3]=b*h+A*a,n[4]=I*h-g*a,n[5]=C*h-y*a,n[6]=P*h-v*a,n[7]=A*h-b*a,n},w.ae=function(n){var t=new Pl(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},w.af=id,w.ag=function(n,t){let i=0,a=0;if(n.kind==="constant")a=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:h,minZoom:g,maxZoom:y}=n,v=h?ye(un.interpolationFactor(h,t,g,y),0,1):0;n.kind==="camera"?a=ln.number(n.minSize,n.maxSize,v):i=v}return{uSizeT:i,uSize:a}},w.ai=function(n,{uSize:t,uSizeT:i},{lowerSize:a,upperSize:h}){return n.kind==="source"?a/is:n.kind==="composite"?ln.number(a/is,h/is,i):t},w.aj=Zf,w.ak=function(n,t,i,a){const h=t.y-n.y,g=t.x-n.x,y=a.y-i.y,v=a.x-i.x,b=y*g-v*h;if(b===0)return null;const I=(v*(n.y-i.y)-y*(n.x-i.x))/b;return new Z(n.x+I*g,n.y+I*h)},w.al=ev,w.am=Uy,w.an=Tf,w.ao=function(n){let t=1/0,i=1/0,a=-1/0,h=-1/0;for(const g of n)t=Math.min(t,g.x),i=Math.min(i,g.y),a=Math.max(a,g.x),h=Math.max(h,g.y);return[t,i,a,h]},w.ap=br,w.ar=$f,w.as=function(n,t){var i=t[0],a=t[1],h=t[2],g=t[3],y=t[4],v=t[5],b=t[6],I=t[7],C=t[8],P=t[9],A=t[10],R=t[11],O=t[12],N=t[13],H=t[14],Y=t[15],fe=i*v-a*y,oe=i*b-h*y,he=i*I-g*y,xe=a*b-h*v,Me=a*I-g*v,qe=h*I-g*b,at=C*N-P*O,$e=C*H-A*O,je=C*Y-R*O,et=P*H-A*N,Xe=P*Y-R*N,He=A*Y-R*H,Te=fe*He-oe*Xe+he*et+xe*je-Me*$e+qe*at;return Te?(n[0]=(v*He-b*Xe+I*et)*(Te=1/Te),n[1]=(h*Xe-a*He-g*et)*Te,n[2]=(N*qe-H*Me+Y*xe)*Te,n[3]=(A*Me-P*qe-R*xe)*Te,n[4]=(b*je-y*He-I*$e)*Te,n[5]=(i*He-h*je+g*$e)*Te,n[6]=(H*he-O*qe-Y*oe)*Te,n[7]=(C*qe-A*he+R*oe)*Te,n[8]=(y*Xe-v*je+I*at)*Te,n[9]=(a*je-i*Xe-g*at)*Te,n[10]=(O*Me-N*he+Y*fe)*Te,n[11]=(P*he-C*Me-R*fe)*Te,n[12]=(v*$e-y*et-b*at)*Te,n[13]=(i*et-a*$e+h*at)*Te,n[14]=(N*oe-O*xe-H*fe)*Te,n[15]=(C*xe-P*oe+A*fe)*Te,n):null},w.at=Yf,w.au=Uf,w.av=Qf,w.aw=function(){const n={},t=ve.$version;for(const i in ve.$root){const a=ve.$root[i];if(a.required){let h=null;h=i==="version"?t:a.type==="array"?[]:{},h!=null&&(n[i]=h)}}return n},w.ax=Yu,w.ay=Wn,w.az=function(n){n=n.slice();const t=Object.create(null);for(let i=0;i<n.length;i++)t[n[i].id]=n[i];for(let i=0;i<n.length;i++)"ref"in n[i]&&(n[i]=Jo(n[i],t[n[i].ref]));return n},w.b=nn,w.b0=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},w.b1=function(n,t,i){return n[0]=t[0]*i[0],n[1]=t[1]*i[1],n[2]=t[2]*i[2],n[3]=t[3]*i[3],n},w.b2=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]},w.b3=Ce,w.b4=H_,w.b5=q_,w.b6=function(n,t,i,a,h){var g,y=1/Math.tan(t/2);return n[0]=y/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=y,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,h!=null&&h!==1/0?(n[10]=(h+a)*(g=1/(a-h)),n[14]=2*h*a*g):(n[10]=-1,n[14]=-2*a),n},w.b7=function(n,t,i){var a=Math.sin(i),h=Math.cos(i),g=t[4],y=t[5],v=t[6],b=t[7],I=t[8],C=t[9],P=t[10],A=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=g*h+I*a,n[5]=y*h+C*a,n[6]=v*h+P*a,n[7]=b*h+A*a,n[8]=I*h-g*a,n[9]=C*h-y*a,n[10]=P*h-v*a,n[11]=A*h-b*a,n},w.b8=re,w.b9=de,w.bA=v_,w.bB=function(n){return n.message===Bt},w.bC=oo,w.bD=Tn,w.ba=function(n){return n*Math.PI/180},w.bb=function(n,t){const{x:i,y:a}=_c.fromLngLat(t);return!(n<0||n>25||a<0||a>=1||i<0||i>=1)},w.bc=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},w.bd=class extends E{},w.be=Wf,w.bf=l2,w.bh=kr,w.bi=function(n,t){Fr.REGISTERED_PROTOCOLS[n]=t},w.bj=function(n){delete Fr.REGISTERED_PROTOCOLS[n]},w.bk=function(n,t){const i={};for(let h=0;h<n.length;h++){const g=t&&t[n[h].id]||Uh(n[h]);t&&(t[n[h].id]=g);let y=i[g];y||(y=i[g]=[]),y.push(n[h])}const a=[];for(const h in i)a.push(i[h]);return a},w.bl=We,w.bm=X_,w.bn=J_,w.bo=E_,w.bp=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=vr/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const t=n.bucket.layers[0],i=t.layout,a=t._unevaluatedLayout._values,h={layoutIconSize:a["icon-size"].possiblyEvaluate(new Wt(n.bucket.zoom+1),n.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new Wt(n.bucket.zoom+1),n.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new Wt(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:I,maxZoom:C}=n.bucket.textSizeData;h.compositeTextSizes=[a["text-size"].possiblyEvaluate(new Wt(I),n.canonical),a["text-size"].possiblyEvaluate(new Wt(C),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:I,maxZoom:C}=n.bucket.iconSizeData;h.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new Wt(I),n.canonical),a["icon-size"].possiblyEvaluate(new Wt(C),n.canonical)]}const g=i.get("text-line-height")*br,y=i.get("text-rotation-alignment")!=="viewport"&&i.get("symbol-placement")!=="point",v=i.get("text-keep-upright"),b=i.get("text-size");for(const I of n.bucket.features){const C=i.get("text-font").evaluate(I,{},n.canonical).join(","),P=b.evaluate(I,{},n.canonical),A=h.layoutTextSize.evaluate(I,{},n.canonical),R=h.layoutIconSize.evaluate(I,{},n.canonical),O={horizontal:{},vertical:void 0},N=I.text;let H,Y=[0,0];if(N){const he=N.toString(),xe=i.get("text-letter-spacing").evaluate(I,{},n.canonical)*br,Me=ff(he)?xe:0,qe=i.get("text-anchor").evaluate(I,{},n.canonical),at=uv(t,I,n.canonical);if(!at){const Xe=i.get("text-radial-offset").evaluate(I,{},n.canonical);Y=Xe?lv(qe,[Xe*br,Jf]):i.get("text-offset").evaluate(I,{},n.canonical).map(He=>He*br)}let $e=y?"center":i.get("text-justify").evaluate(I,{},n.canonical);const je=i.get("symbol-placement")==="point"?i.get("text-max-width").evaluate(I,{},n.canonical)*br:1/0,et=()=>{n.bucket.allowVerticalPlacement&&Qu(he)&&(O.vertical=cd(N,n.glyphMap,n.glyphPositions,n.imagePositions,C,je,g,qe,"left",Me,Y,w.ah.vertical,!0,A,P))};if(!y&&at){const Xe=new Set;if($e==="auto")for(let Te=0;Te<at.values.length;Te+=2)Xe.add(Yf(at.values[Te]));else Xe.add($e);let He=!1;for(const Te of Xe)if(!O.horizontal[Te])if(He)O.horizontal[Te]=O.horizontal[0];else{const rt=cd(N,n.glyphMap,n.glyphPositions,n.imagePositions,C,je,g,"center",Te,Me,Y,w.ah.horizontal,!1,A,P);rt&&(O.horizontal[Te]=rt,He=rt.positionedLines.length===1)}et()}else{$e==="auto"&&($e=Yf(qe));const Xe=cd(N,n.glyphMap,n.glyphPositions,n.imagePositions,C,je,g,qe,$e,Me,Y,w.ah.horizontal,!1,A,P);Xe&&(O.horizontal[$e]=Xe),et(),Qu(he)&&y&&v&&(O.vertical=cd(N,n.glyphMap,n.glyphPositions,n.imagePositions,C,je,g,qe,$e,Me,Y,w.ah.vertical,!1,A,P))}}let fe=!1;if(I.icon&&I.icon.name){const he=n.imageMap[I.icon.name];he&&(H=Zb(n.imagePositions[I.icon.name],i.get("icon-offset").evaluate(I,{},n.canonical),i.get("icon-anchor").evaluate(I,{},n.canonical)),fe=!!he.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=fe:n.bucket.sdfIcons!==fe&&Zt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(he.pixelRatio!==n.bucket.pixelRatio||i.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const oe=hv(O.horizontal)||O.vertical;n.bucket.iconsInText=!!oe&&oe.iconsInText,(oe||H)&&o2(n.bucket,I,O,H,n.imageMap,h,A,R,Y,fe,n.canonical)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},w.bq=Ff,w.br=Df,w.bs=Rf,w.bt=So,w.bu=Of,w.bv=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},w.bw=function(n,t,i,a,h){return d(this,void 0,void 0,function*(){if(q())try{return yield mt(n,t,i,a,h)}catch{}return function(g,y,v,b,I){const C=g.width,P=g.height;gt&&Ct||(gt=new OffscreenCanvas(C,P),Ct=gt.getContext("2d",{willReadFrequently:!0})),gt.width=C,gt.height=P,Ct.drawImage(g,0,0,C,P);const A=Ct.getImageData(y,v,b,I);return Ct.clearRect(0,0,C,P),A.data}(n,t,i,a,h)})},w.bx=W_,w.by=B,w.bz=K,w.c=Hn,w.d=n=>d(void 0,void 0,void 0,function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(t)}catch(i){throw new Error(`Could not load image because of ${i.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),w.e=ze,w.f=n=>new Promise((t,i)=>{const a=new Image;a.onload=()=>{t(a),URL.revokeObjectURL(a.src),a.onload=null,window.requestAnimationFrame(()=>{a.src=Ke})},a.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const h=new Blob([new Uint8Array(n)],{type:"image/png"});a.src=n.byteLength?URL.createObjectURL(h):Ke}),w.g=sn,w.h=(n,t)=>ps(ze(n,{type:"json"}),t),w.i=xn,w.j=Ki,w.k=Xi,w.l=(n,t)=>ps(ze(n,{type:"arrayBuffer"}),t),w.m=ps,w.n=function(n){return new Of(n).readFields(Bb,[])},w.o=lc,w.p=C_,w.q=f,w.r=df,w.s=fs,w.t=Ku,w.u=Cs,w.v=ve,w.w=Zt,w.x=function([n,t,i]){return t+=90,t*=Math.PI/180,i*=Math.PI/180,{x:n*Math.cos(t)*Math.sin(i),y:n*Math.sin(t)*Math.sin(i),z:n*Math.cos(i)}},w.y=ln,w.z=Wt}),_("worker",["./shared"],function(w){class d{constructor(L){this.keyCache={},L&&this.replace(L)}replace(L){this._layerConfigs={},this._layers={},this.update(L,[])}update(L,D){for(const W of L){this._layerConfigs[W.id]=W;const ae=this._layers[W.id]=w.aA(W);ae._featureFilter=w.a7(ae.filter),this.keyCache[W.id]&&delete this.keyCache[W.id]}for(const W of D)delete this.keyCache[W],delete this._layerConfigs[W],delete this._layers[W];this.familiesBySource={};const j=w.bk(Object.values(this._layerConfigs),this.keyCache);for(const W of j){const ae=W.map(_e=>this._layers[_e.id]),ue=ae[0];if(ue.visibility==="none")continue;const pe=ue.source||"";let ie=this.familiesBySource[pe];ie||(ie=this.familiesBySource[pe]={});const we=ue.sourceLayer||"_geojsonTileLayer";let Ee=ie[we];Ee||(Ee=ie[we]=[]),Ee.push(ae)}}}class B{constructor(L){const D={},j=[];for(const pe in L){const ie=L[pe],we=D[pe]={};for(const Ee in ie){const _e=ie[+Ee];if(!_e||_e.bitmap.width===0||_e.bitmap.height===0)continue;const Re={x:0,y:0,w:_e.bitmap.width+2,h:_e.bitmap.height+2};j.push(Re),we[Ee]={rect:Re,metrics:_e.metrics}}}const{w:W,h:ae}=w.p(j),ue=new w.o({width:W||1,height:ae||1});for(const pe in L){const ie=L[pe];for(const we in ie){const Ee=ie[+we];if(!Ee||Ee.bitmap.width===0||Ee.bitmap.height===0)continue;const _e=D[pe][we].rect;w.o.copy(Ee.bitmap,ue,{x:0,y:0},{x:_e.x+1,y:_e.y+1},Ee.bitmap)}}this.image=ue,this.positions=D}}w.bl("GlyphAtlas",B);class K{constructor(L){this.tileID=new w.S(L.tileID.overscaledZ,L.tileID.wrap,L.tileID.canonical.z,L.tileID.canonical.x,L.tileID.canonical.y),this.uid=L.uid,this.zoom=L.zoom,this.pixelRatio=L.pixelRatio,this.tileSize=L.tileSize,this.source=L.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=L.showCollisionBoxes,this.collectResourceTiming=!!L.collectResourceTiming,this.returnDependencies=!!L.returnDependencies,this.promoteId=L.promoteId,this.inFlightDependencies=[]}parse(L,D,j,W){return w._(this,void 0,void 0,function*(){this.status="parsing",this.data=L,this.collisionBoxArray=new w.a5;const ae=new w.bm(Object.keys(L.layers).sort()),ue=new w.bn(this.tileID,this.promoteId);ue.bucketLayerIDs=[];const pe={},ie={featureIndex:ue,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:j},we=D.familiesBySource[this.source];for(const wt in we){const Ot=L.layers[wt];if(!Ot)continue;Ot.version===1&&w.w(`Vector tile source "${this.source}" layer "${wt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Qt=ae.encode(wt),Tr=[];for(let Mr=0;Mr<Ot.length;Mr++){const Wr=Ot.feature(Mr),Xs=ue.getId(Wr,wt);Tr.push({feature:Wr,id:Xs,index:Mr,sourceLayerIndex:Qt})}for(const Mr of we[wt]){const Wr=Mr[0];Wr.source!==this.source&&w.w(`layer.source = ${Wr.source} does not equal this.source = ${this.source}`),Wr.minzoom&&this.zoom<Math.floor(Wr.minzoom)||Wr.maxzoom&&this.zoom>=Wr.maxzoom||Wr.visibility!=="none"&&(te(Mr,this.zoom,j),(pe[Wr.id]=Wr.createBucket({index:ue.bucketLayerIDs.length,layers:Mr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Qt,sourceID:this.source})).populate(Tr,ie,this.tileID.canonical),ue.bucketLayerIDs.push(Mr.map(Xs=>Xs.id)))}}const Ee=w.aF(ie.glyphDependencies,wt=>Object.keys(wt).map(Number));this.inFlightDependencies.forEach(wt=>wt==null?void 0:wt.abort()),this.inFlightDependencies=[];let _e=Promise.resolve({});if(Object.keys(Ee).length){const wt=new AbortController;this.inFlightDependencies.push(wt),_e=W.sendAsync({type:"GG",data:{stacks:Ee,source:this.source,tileID:this.tileID,type:"glyphs"}},wt)}const Re=Object.keys(ie.iconDependencies);let nt=Promise.resolve({});if(Re.length){const wt=new AbortController;this.inFlightDependencies.push(wt),nt=W.sendAsync({type:"GI",data:{icons:Re,source:this.source,tileID:this.tileID,type:"icons"}},wt)}const st=Object.keys(ie.patternDependencies);let Et=Promise.resolve({});if(st.length){const wt=new AbortController;this.inFlightDependencies.push(wt),Et=W.sendAsync({type:"GI",data:{icons:st,source:this.source,tileID:this.tileID,type:"patterns"}},wt)}const[_t,Pt,St]=yield Promise.all([_e,nt,Et]),yr=new B(_t),rr=new w.bo(Pt,St);for(const wt in pe){const Ot=pe[wt];Ot instanceof w.a6?(te(Ot.layers,this.zoom,j),w.bp({bucket:Ot,glyphMap:_t,glyphPositions:yr.positions,imageMap:Pt,imagePositions:rr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Ot.hasPattern&&(Ot instanceof w.bq||Ot instanceof w.br||Ot instanceof w.bs)&&(te(Ot.layers,this.zoom,j),Ot.addFeatures(ie,this.tileID.canonical,rr.patternPositions))}return this.status="done",{buckets:Object.values(pe).filter(wt=>!wt.isEmpty()),featureIndex:ue,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:yr.image,imageAtlas:rr,glyphMap:this.returnDependencies?_t:null,iconMap:this.returnDependencies?Pt:null,glyphPositions:this.returnDependencies?yr.positions:null}})}}function te(J,L,D){const j=new w.z(L);for(const W of J)W.recalculate(j,D)}class Z{constructor(L,D,j){this.actor=L,this.layerIndex=D,this.availableImages=j,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(L,D){return w._(this,void 0,void 0,function*(){const j=yield w.l(L.request,D);try{return{vectorTile:new w.bt.VectorTile(new w.bu(j.data)),rawData:j.data,cacheControl:j.cacheControl,expires:j.expires}}catch(W){const ae=new Uint8Array(j.data);let ue=`Unable to parse the tile at ${L.request.url}, `;throw ue+=ae[0]===31&&ae[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${W.message}`,new Error(ue)}})}loadTile(L){return w._(this,void 0,void 0,function*(){const D=L.uid,j=!!(L&&L.request&&L.request.collectResourceTiming)&&new w.bv(L.request),W=new K(L);this.loading[D]=W;const ae=new AbortController;W.abort=ae;try{const ue=yield this.loadVectorTile(L,ae);if(delete this.loading[D],!ue)return null;const pe=ue.rawData,ie={};ue.expires&&(ie.expires=ue.expires),ue.cacheControl&&(ie.cacheControl=ue.cacheControl);const we={};if(j){const _e=j.finish();_e&&(we.resourceTiming=JSON.parse(JSON.stringify(_e)))}W.vectorTile=ue.vectorTile;const Ee=W.parse(ue.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[D]=W,this.fetching[D]={rawTileData:pe,cacheControl:ie,resourceTiming:we};try{const _e=yield Ee;return w.e({rawTileData:pe.slice(0)},_e,ie,we)}finally{delete this.fetching[D]}}catch(ue){throw delete this.loading[D],W.status="done",this.loaded[D]=W,ue}})}reloadTile(L){return w._(this,void 0,void 0,function*(){const D=L.uid;if(!this.loaded||!this.loaded[D])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const j=this.loaded[D];if(j.showCollisionBoxes=L.showCollisionBoxes,j.status==="parsing"){const W=yield j.parse(j.vectorTile,this.layerIndex,this.availableImages,this.actor);let ae;if(this.fetching[D]){const{rawTileData:ue,cacheControl:pe,resourceTiming:ie}=this.fetching[D];delete this.fetching[D],ae=w.e({rawTileData:ue.slice(0)},W,pe,ie)}else ae=W;return ae}if(j.status==="done"&&j.vectorTile)return j.parse(j.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(L){return w._(this,void 0,void 0,function*(){const D=this.loading,j=L.uid;D&&D[j]&&D[j].abort&&(D[j].abort.abort(),delete D[j])})}removeTile(L){return w._(this,void 0,void 0,function*(){this.loaded&&this.loaded[L.uid]&&delete this.loaded[L.uid]})}}class U{constructor(){this.loaded={}}loadTile(L){return w._(this,void 0,void 0,function*(){const{uid:D,encoding:j,rawImageData:W,redFactor:ae,greenFactor:ue,blueFactor:pe,baseShift:ie}=L,we=W.width+2,Ee=W.height+2,_e=w.b(W)?new w.R({width:we,height:Ee},yield w.bw(W,-1,-1,we,Ee)):W,Re=new w.bx(D,_e,j,ae,ue,pe,ie);return this.loaded=this.loaded||{},this.loaded[D]=Re,Re})}removeTile(L){const D=this.loaded,j=L.uid;D&&D[j]&&delete D[j]}}function Se(J,L){if(J.length!==0){be(J[0],L);for(var D=1;D<J.length;D++)be(J[D],!L)}}function be(J,L){for(var D=0,j=0,W=0,ae=J.length,ue=ae-1;W<ae;ue=W++){var pe=(J[W][0]-J[ue][0])*(J[ue][1]+J[W][1]),ie=D+pe;j+=Math.abs(D)>=Math.abs(pe)?D-ie+pe:pe-ie+D,D=ie}D+j>=0!=!!L&&J.reverse()}var ke=w.by(function J(L,D){var j,W=L&&L.type;if(W==="FeatureCollection")for(j=0;j<L.features.length;j++)J(L.features[j],D);else if(W==="GeometryCollection")for(j=0;j<L.geometries.length;j++)J(L.geometries[j],D);else if(W==="Feature")J(L.geometry,D);else if(W==="Polygon")Se(L.coordinates,D);else if(W==="MultiPolygon")for(j=0;j<L.coordinates.length;j++)Se(L.coordinates[j],D);return L});const Pe=w.bt.VectorTileFeature.prototype.toGeoJSON;var ne={exports:{}},q=w.bz,re=w.bt.VectorTileFeature,de=ye;function ye(J,L){this.options=L||{},this.features=J,this.length=J.length}function Ce(J,L){this.id=typeof J.id=="number"?J.id:void 0,this.type=J.type,this.rawGeometry=J.type===1?[J.geometry]:J.geometry,this.properties=J.tags,this.extent=L||4096}ye.prototype.feature=function(J){return new Ce(this.features[J],this.options.extent)},Ce.prototype.loadGeometry=function(){var J=this.rawGeometry;this.geometry=[];for(var L=0;L<J.length;L++){for(var D=J[L],j=[],W=0;W<D.length;W++)j.push(new q(D[W][0],D[W][1]));this.geometry.push(j)}return this.geometry},Ce.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var J=this.geometry,L=1/0,D=-1/0,j=1/0,W=-1/0,ae=0;ae<J.length;ae++)for(var ue=J[ae],pe=0;pe<ue.length;pe++){var ie=ue[pe];L=Math.min(L,ie.x),D=Math.max(D,ie.x),j=Math.min(j,ie.y),W=Math.max(W,ie.y)}return[L,j,D,W]},Ce.prototype.toGeoJSON=re.prototype.toGeoJSON;var ze=w.bA,Ue=de;function tt(J){var L=new ze;return function(D,j){for(var W in D.layers)j.writeMessage(3,ut,D.layers[W])}(J,L),L.finish()}function ut(J,L){var D;L.writeVarintField(15,J.version||1),L.writeStringField(1,J.name||""),L.writeVarintField(5,J.extent||4096);var j={keys:[],values:[],keycache:{},valuecache:{}};for(D=0;D<J.length;D++)j.feature=J.feature(D),L.writeMessage(2,ot,j);var W=j.keys;for(D=0;D<W.length;D++)L.writeStringField(3,W[D]);var ae=j.values;for(D=0;D<ae.length;D++)L.writeMessage(4,mi,ae[D])}function ot(J,L){var D=J.feature;D.id!==void 0&&L.writeVarintField(1,D.id),L.writeMessage(2,wr,J),L.writeVarintField(3,D.type),L.writeMessage(4,xn,D)}function wr(J,L){var D=J.feature,j=J.keys,W=J.values,ae=J.keycache,ue=J.valuecache;for(var pe in D.properties){var ie=D.properties[pe],we=ae[pe];if(ie!==null){we===void 0&&(j.push(pe),ae[pe]=we=j.length-1),L.writeVarint(we);var Ee=typeof ie;Ee!=="string"&&Ee!=="boolean"&&Ee!=="number"&&(ie=JSON.stringify(ie));var _e=Ee+":"+ie,Re=ue[_e];Re===void 0&&(W.push(ie),ue[_e]=Re=W.length-1),L.writeVarint(Re)}}}function Zt(J,L){return(L<<3)+(7&J)}function gr(J){return J<<1^J>>31}function xn(J,L){for(var D=J.loadGeometry(),j=J.type,W=0,ae=0,ue=D.length,pe=0;pe<ue;pe++){var ie=D[pe],we=1;j===1&&(we=ie.length),L.writeVarint(Zt(1,we));for(var Ee=j===3?ie.length-1:ie.length,_e=0;_e<Ee;_e++){_e===1&&j!==1&&L.writeVarint(Zt(2,Ee-1));var Re=ie[_e].x-W,nt=ie[_e].y-ae;L.writeVarint(gr(Re)),L.writeVarint(gr(nt)),W+=Re,ae+=nt}j===3&&L.writeVarint(Zt(7,1))}}function mi(J,L){var D=typeof J;D==="string"?L.writeStringField(1,J):D==="boolean"?L.writeBooleanField(7,J):D==="number"&&(J%1!=0?L.writeDoubleField(3,J):J<0?L.writeSVarintField(6,J):L.writeVarintField(5,J))}ne.exports=tt,ne.exports.fromVectorTileJs=tt,ne.exports.fromGeojsonVt=function(J,L){L=L||{};var D={};for(var j in J)D[j]=new Ue(J[j].features,L),D[j].name=j,D[j].version=L.version,D[j].extent=L.extent;return tt({layers:D})},ne.exports.GeoJSONWrapper=Ue;var nn=w.by(ne.exports);const Ke={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:J=>J},mt=Math.fround||(gt=new Float32Array(1),J=>(gt[0]=+J,gt[0]));var gt;const Ct=3,Bt=5,Hn=6;class Fr{constructor(L){this.options=Object.assign(Object.create(Ke),L),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(L){const{log:D,minZoom:j,maxZoom:W}=this.options;D&&console.time("total time");const ae=`prepare ${L.length} points`;D&&console.time(ae),this.points=L;const ue=[];for(let ie=0;ie<L.length;ie++){const we=L[ie];if(!we.geometry)continue;const[Ee,_e]=we.geometry.coordinates,Re=mt(kr(Ee)),nt=mt(Wn(_e));ue.push(Re,nt,1/0,ie,-1,1),this.options.reduce&&ue.push(0)}let pe=this.trees[W+1]=this._createTree(ue);D&&console.timeEnd(ae);for(let ie=W;ie>=j;ie--){const we=+Date.now();pe=this.trees[ie]=this._createTree(this._cluster(pe,ie)),D&&console.log("z%d: %d clusters in %dms",ie,pe.numItems,+Date.now()-we)}return D&&console.timeEnd("total time"),this}getClusters(L,D){let j=((L[0]+180)%360+360)%360-180;const W=Math.max(-90,Math.min(90,L[1]));let ae=L[2]===180?180:((L[2]+180)%360+360)%360-180;const ue=Math.max(-90,Math.min(90,L[3]));if(L[2]-L[0]>=360)j=-180,ae=180;else if(j>ae){const _e=this.getClusters([j,W,180,ue],D),Re=this.getClusters([-180,W,ae,ue],D);return _e.concat(Re)}const pe=this.trees[this._limitZoom(D)],ie=pe.range(kr(j),Wn(ue),kr(ae),Wn(W)),we=pe.data,Ee=[];for(const _e of ie){const Re=this.stride*_e;Ee.push(we[Re+Bt]>1?sn(we,Re,this.clusterProps):this.points[we[Re+Ct]])}return Ee}getChildren(L){const D=this._getOriginId(L),j=this._getOriginZoom(L),W="No cluster with the specified id.",ae=this.trees[j];if(!ae)throw new Error(W);const ue=ae.data;if(D*this.stride>=ue.length)throw new Error(W);const pe=this.options.radius/(this.options.extent*Math.pow(2,j-1)),ie=ae.within(ue[D*this.stride],ue[D*this.stride+1],pe),we=[];for(const Ee of ie){const _e=Ee*this.stride;ue[_e+4]===L&&we.push(ue[_e+Bt]>1?sn(ue,_e,this.clusterProps):this.points[ue[_e+Ct]])}if(we.length===0)throw new Error(W);return we}getLeaves(L,D,j){const W=[];return this._appendLeaves(W,L,D=D||10,j=j||0,0),W}getTile(L,D,j){const W=this.trees[this._limitZoom(L)],ae=Math.pow(2,L),{extent:ue,radius:pe}=this.options,ie=pe/ue,we=(j-ie)/ae,Ee=(j+1+ie)/ae,_e={features:[]};return this._addTileFeatures(W.range((D-ie)/ae,we,(D+1+ie)/ae,Ee),W.data,D,j,ae,_e),D===0&&this._addTileFeatures(W.range(1-ie/ae,we,1,Ee),W.data,ae,j,ae,_e),D===ae-1&&this._addTileFeatures(W.range(0,we,ie/ae,Ee),W.data,-1,j,ae,_e),_e.features.length?_e:null}getClusterExpansionZoom(L){let D=this._getOriginZoom(L)-1;for(;D<=this.options.maxZoom;){const j=this.getChildren(L);if(D++,j.length!==1)break;L=j[0].properties.cluster_id}return D}_appendLeaves(L,D,j,W,ae){const ue=this.getChildren(D);for(const pe of ue){const ie=pe.properties;if(ie&&ie.cluster?ae+ie.point_count<=W?ae+=ie.point_count:ae=this._appendLeaves(L,ie.cluster_id,j,W,ae):ae<W?ae++:L.push(pe),L.length===j)break}return ae}_createTree(L){const D=new w.av(L.length/this.stride|0,this.options.nodeSize,Float32Array);for(let j=0;j<L.length;j+=this.stride)D.add(L[j],L[j+1]);return D.finish(),D.data=L,D}_addTileFeatures(L,D,j,W,ae,ue){for(const pe of L){const ie=pe*this.stride,we=D[ie+Bt]>1;let Ee,_e,Re;if(we)Ee=on(D,ie,this.clusterProps),_e=D[ie],Re=D[ie+1];else{const Et=this.points[D[ie+Ct]];Ee=Et.properties;const[_t,Pt]=Et.geometry.coordinates;_e=kr(_t),Re=Wn(Pt)}const nt={type:1,geometry:[[Math.round(this.options.extent*(_e*ae-j)),Math.round(this.options.extent*(Re*ae-W))]],tags:Ee};let st;st=we||this.options.generateId?D[ie+Ct]:this.points[D[ie+Ct]].id,st!==void 0&&(nt.id=st),ue.features.push(nt)}}_limitZoom(L){return Math.max(this.options.minZoom,Math.min(Math.floor(+L),this.options.maxZoom+1))}_cluster(L,D){const{radius:j,extent:W,reduce:ae,minPoints:ue}=this.options,pe=j/(W*Math.pow(2,D)),ie=L.data,we=[],Ee=this.stride;for(let _e=0;_e<ie.length;_e+=Ee){if(ie[_e+2]<=D)continue;ie[_e+2]=D;const Re=ie[_e],nt=ie[_e+1],st=L.within(ie[_e],ie[_e+1],pe),Et=ie[_e+Bt];let _t=Et;for(const Pt of st){const St=Pt*Ee;ie[St+2]>D&&(_t+=ie[St+Bt])}if(_t>Et&&_t>=ue){let Pt,St=Re*Et,yr=nt*Et,rr=-1;const wt=((_e/Ee|0)<<5)+(D+1)+this.points.length;for(const Ot of st){const Qt=Ot*Ee;if(ie[Qt+2]<=D)continue;ie[Qt+2]=D;const Tr=ie[Qt+Bt];St+=ie[Qt]*Tr,yr+=ie[Qt+1]*Tr,ie[Qt+4]=wt,ae&&(Pt||(Pt=this._map(ie,_e,!0),rr=this.clusterProps.length,this.clusterProps.push(Pt)),ae(Pt,this._map(ie,Qt)))}ie[_e+4]=wt,we.push(St/_t,yr/_t,1/0,wt,-1,_t),ae&&we.push(rr)}else{for(let Pt=0;Pt<Ee;Pt++)we.push(ie[_e+Pt]);if(_t>1)for(const Pt of st){const St=Pt*Ee;if(!(ie[St+2]<=D)){ie[St+2]=D;for(let yr=0;yr<Ee;yr++)we.push(ie[St+yr])}}}}return we}_getOriginId(L){return L-this.points.length>>5}_getOriginZoom(L){return(L-this.points.length)%32}_map(L,D,j){if(L[D+Bt]>1){const ue=this.clusterProps[L[D+Hn]];return j?Object.assign({},ue):ue}const W=this.points[L[D+Ct]].properties,ae=this.options.map(W);return j&&ae===W?Object.assign({},ae):ae}}function sn(J,L,D){return{type:"Feature",id:J[L+Ct],properties:on(J,L,D),geometry:{type:"Point",coordinates:[(j=J[L],360*(j-.5)),ps(J[L+1])]}};var j}function on(J,L,D){const j=J[L+Bt],W=j>=1e4?`${Math.round(j/1e3)}k`:j>=1e3?Math.round(j/100)/10+"k":j,ae=J[L+Hn],ue=ae===-1?{}:Object.assign({},D[ae]);return Object.assign(ue,{cluster:!0,cluster_id:J[L+Ct],point_count:j,point_count_abbreviated:W})}function kr(J){return J/360+.5}function Wn(J){const L=Math.sin(J*Math.PI/180),D=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return D<0?0:D>1?1:D}function ps(J){const L=(180-360*J)*Math.PI/180;return 360*Math.atan(Math.exp(L))/Math.PI-90}function fs(J,L,D,j){let W=j;const ae=L+(D-L>>1);let ue,pe=D-L;const ie=J[L],we=J[L+1],Ee=J[D],_e=J[D+1];for(let Re=L+3;Re<D;Re+=3){const nt=Ko(J[Re],J[Re+1],ie,we,Ee,_e);if(nt>W)ue=Re,W=nt;else if(nt===W){const st=Math.abs(Re-ae);st<pe&&(ue=Re,pe=st)}}W>j&&(ue-L>3&&fs(J,L,ue,j),J[ue+2]=W,D-ue>3&&fs(J,ue,D,j))}function Ko(J,L,D,j,W,ae){let ue=W-D,pe=ae-j;if(ue!==0||pe!==0){const ie=((J-D)*ue+(L-j)*pe)/(ue*ue+pe*pe);ie>1?(D=W,j=ae):ie>0&&(D+=ue*ie,j+=pe*ie)}return ue=J-D,pe=L-j,ue*ue+pe*pe}function Ai(J,L,D,j){const W={id:J??null,type:L,geometry:D,tags:j,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(L==="Point"||L==="MultiPoint"||L==="LineString")Xi(W,D);else if(L==="Polygon")Xi(W,D[0]);else if(L==="MultiLineString")for(const ae of D)Xi(W,ae);else if(L==="MultiPolygon")for(const ae of D)Xi(W,ae[0]);return W}function Xi(J,L){for(let D=0;D<L.length;D+=3)J.minX=Math.min(J.minX,L[D]),J.minY=Math.min(J.minY,L[D+1]),J.maxX=Math.max(J.maxX,L[D]),J.maxY=Math.max(J.maxY,L[D+1])}function Ki(J,L,D,j){if(!L.geometry)return;const W=L.geometry.coordinates;if(W&&W.length===0)return;const ae=L.geometry.type,ue=Math.pow(D.tolerance/((1<<D.maxZoom)*D.extent),2);let pe=[],ie=L.id;if(D.promoteId?ie=L.properties[D.promoteId]:D.generateId&&(ie=j||0),ae==="Point")Hs(W,pe);else if(ae==="MultiPoint")for(const we of W)Hs(we,pe);else if(ae==="LineString")ve(W,pe,ue,!1);else if(ae==="MultiLineString"){if(D.lineMetrics){for(const we of W)pe=[],ve(we,pe,ue,!1),J.push(Ai(ie,"LineString",pe,L.properties));return}ms(W,pe,ue,!1)}else if(ae==="Polygon")ms(W,pe,ue,!0);else{if(ae!=="MultiPolygon"){if(ae==="GeometryCollection"){for(const we of L.geometry.geometries)Ki(J,{id:ie,geometry:we,properties:L.properties},D,j);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const we of W){const Ee=[];ms(we,Ee,ue,!0),pe.push(Ee)}}J.push(Ai(ie,ae,pe,L.properties))}function Hs(J,L){L.push(Jo(J[0]),Dt(J[1]),0)}function ve(J,L,D,j){let W,ae,ue=0;for(let ie=0;ie<J.length;ie++){const we=Jo(J[ie][0]),Ee=Dt(J[ie][1]);L.push(we,Ee,0),ie>0&&(ue+=j?(W*Ee-we*ae)/2:Math.sqrt(Math.pow(we-W,2)+Math.pow(Ee-ae,2))),W=we,ae=Ee}const pe=L.length-3;L[2]=1,fs(L,0,pe,D),L[pe+2]=1,L.size=Math.abs(ue),L.start=0,L.end=L.size}function ms(J,L,D,j){for(let W=0;W<J.length;W++){const ae=[];ve(J[W],ae,D,j),L.push(ae)}}function Jo(J){return J/360+.5}function Dt(J){const L=Math.sin(J*Math.PI/180),D=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return D<0?0:D>1?1:D}function tr(J,L,D,j,W,ae,ue,pe){if(j/=L,ae>=(D/=L)&&ue<j)return J;if(ue<D||ae>=j)return null;const ie=[];for(const we of J){const Ee=we.geometry;let _e=we.type;const Re=W===0?we.minX:we.minY,nt=W===0?we.maxX:we.maxY;if(Re>=D&&nt<j){ie.push(we);continue}if(nt<D||Re>=j)continue;let st=[];if(_e==="Point"||_e==="MultiPoint")Yo(Ee,st,D,j,W);else if(_e==="LineString")Ji(Ee,st,D,j,W,!1,pe.lineMetrics);else if(_e==="MultiLineString")Ws(Ee,st,D,j,W,!1);else if(_e==="Polygon")Ws(Ee,st,D,j,W,!0);else if(_e==="MultiPolygon")for(const Et of Ee){const _t=[];Ws(Et,_t,D,j,W,!0),_t.length&&st.push(_t)}if(st.length){if(pe.lineMetrics&&_e==="LineString"){for(const Et of st)ie.push(Ai(we.id,_e,Et,we.tags));continue}_e!=="LineString"&&_e!=="MultiLineString"||(st.length===1?(_e="LineString",st=st[0]):_e="MultiLineString"),_e!=="Point"&&_e!=="MultiPoint"||(_e=st.length===3?"Point":"MultiPoint"),ie.push(Ai(we.id,_e,st,we.tags))}}return ie.length?ie:null}function Yo(J,L,D,j,W){for(let ae=0;ae<J.length;ae+=3){const ue=J[ae+W];ue>=D&&ue<=j&&Dn(L,J[ae],J[ae+1],J[ae+2])}}function Ji(J,L,D,j,W,ae,ue){let pe=Di(J);const ie=W===0?Qo:ea;let we,Ee,_e=J.start;for(let _t=0;_t<J.length-3;_t+=3){const Pt=J[_t],St=J[_t+1],yr=J[_t+2],rr=J[_t+3],wt=J[_t+4],Ot=W===0?Pt:St,Qt=W===0?rr:wt;let Tr=!1;ue&&(we=Math.sqrt(Math.pow(Pt-rr,2)+Math.pow(St-wt,2))),Ot<D?Qt>D&&(Ee=ie(pe,Pt,St,rr,wt,D),ue&&(pe.start=_e+we*Ee)):Ot>j?Qt<j&&(Ee=ie(pe,Pt,St,rr,wt,j),ue&&(pe.start=_e+we*Ee)):Dn(pe,Pt,St,yr),Qt<D&&Ot>=D&&(Ee=ie(pe,Pt,St,rr,wt,D),Tr=!0),Qt>j&&Ot<=j&&(Ee=ie(pe,Pt,St,rr,wt,j),Tr=!0),!ae&&Tr&&(ue&&(pe.end=_e+we*Ee),L.push(pe),pe=Di(J)),ue&&(_e+=we)}let Re=J.length-3;const nt=J[Re],st=J[Re+1],Et=W===0?nt:st;Et>=D&&Et<=j&&Dn(pe,nt,st,J[Re+2]),Re=pe.length-3,ae&&Re>=3&&(pe[Re]!==pe[0]||pe[Re+1]!==pe[1])&&Dn(pe,pe[0],pe[1],pe[2]),pe.length&&L.push(pe)}function Di(J){const L=[];return L.size=J.size,L.start=J.start,L.end=J.end,L}function Ws(J,L,D,j,W,ae){for(const ue of J)Ji(ue,L,D,j,W,ae,!1)}function Dn(J,L,D,j){J.push(L,D,j)}function Qo(J,L,D,j,W,ae){const ue=(ae-L)/(j-L);return Dn(J,ae,D+(W-D)*ue,1),ue}function ea(J,L,D,j,W,ae){const ue=(ae-D)/(W-D);return Dn(J,L+(j-L)*ue,ae,1),ue}function De(J,L){const D=[];for(let j=0;j<J.length;j++){const W=J[j],ae=W.type;let ue;if(ae==="Point"||ae==="MultiPoint"||ae==="LineString")ue=gi(W.geometry,L);else if(ae==="MultiLineString"||ae==="Polygon"){ue=[];for(const pe of W.geometry)ue.push(gi(pe,L))}else if(ae==="MultiPolygon"){ue=[];for(const pe of W.geometry){const ie=[];for(const we of pe)ie.push(gi(we,L));ue.push(ie)}}D.push(Ai(W.id,ae,ue,W.tags))}return D}function gi(J,L){const D=[];D.size=J.size,J.start!==void 0&&(D.start=J.start,D.end=J.end);for(let j=0;j<J.length;j+=3)D.push(J[j]+L,J[j+1],J[j+2]);return D}function Hr(J,L){if(J.transformed)return J;const D=1<<J.z,j=J.x,W=J.y;for(const ae of J.features){const ue=ae.geometry,pe=ae.type;if(ae.geometry=[],pe===1)for(let ie=0;ie<ue.length;ie+=2)ae.geometry.push(yi(ue[ie],ue[ie+1],L,D,j,W));else for(let ie=0;ie<ue.length;ie++){const we=[];for(let Ee=0;Ee<ue[ie].length;Ee+=2)we.push(yi(ue[ie][Ee],ue[ie][Ee+1],L,D,j,W));ae.geometry.push(we)}}return J.transformed=!0,J}function yi(J,L,D,j,W,ae){return[Math.round(D*(J*j-W)),Math.round(D*(L*j-ae))]}function Yi(J,L,D,j,W){const ae=L===W.maxZoom?0:W.tolerance/((1<<L)*W.extent),ue={features:[],numPoints:0,numSimplified:0,numFeatures:J.length,source:null,x:D,y:j,z:L,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const pe of J)Oe(ue,pe,ae,W);return ue}function Oe(J,L,D,j){const W=L.geometry,ae=L.type,ue=[];if(J.minX=Math.min(J.minX,L.minX),J.minY=Math.min(J.minY,L.minY),J.maxX=Math.max(J.maxX,L.maxX),J.maxY=Math.max(J.maxY,L.maxY),ae==="Point"||ae==="MultiPoint")for(let pe=0;pe<W.length;pe+=3)ue.push(W[pe],W[pe+1]),J.numPoints++,J.numSimplified++;else if(ae==="LineString")xt(ue,W,J,D,!1,!1);else if(ae==="MultiLineString"||ae==="Polygon")for(let pe=0;pe<W.length;pe++)xt(ue,W[pe],J,D,ae==="Polygon",pe===0);else if(ae==="MultiPolygon")for(let pe=0;pe<W.length;pe++){const ie=W[pe];for(let we=0;we<ie.length;we++)xt(ue,ie[we],J,D,!0,we===0)}if(ue.length){let pe=L.tags||null;if(ae==="LineString"&&j.lineMetrics){pe={};for(const we in L.tags)pe[we]=L.tags[we];pe.mapbox_clip_start=W.start/W.size,pe.mapbox_clip_end=W.end/W.size}const ie={geometry:ue,type:ae==="Polygon"||ae==="MultiPolygon"?3:ae==="LineString"||ae==="MultiLineString"?2:1,tags:pe};L.id!==null&&(ie.id=L.id),J.features.push(ie)}}function xt(J,L,D,j,W,ae){const ue=j*j;if(j>0&&L.size<(W?ue:j))return void(D.numPoints+=L.length/3);const pe=[];for(let ie=0;ie<L.length;ie+=3)(j===0||L[ie+2]>ue)&&(D.numSimplified++,pe.push(L[ie],L[ie+1])),D.numPoints++;W&&function(ie,we){let Ee=0;for(let _e=0,Re=ie.length,nt=Re-2;_e<Re;nt=_e,_e+=2)Ee+=(ie[_e]-ie[nt])*(ie[_e+1]+ie[nt+1]);if(Ee>0===we)for(let _e=0,Re=ie.length;_e<Re/2;_e+=2){const nt=ie[_e],st=ie[_e+1];ie[_e]=ie[Re-2-_e],ie[_e+1]=ie[Re-1-_e],ie[Re-2-_e]=nt,ie[Re-1-_e]=st}}(pe,ae),J.push(pe)}const ct={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class an{constructor(L,D){const j=(D=this.options=function(ae,ue){for(const pe in ue)ae[pe]=ue[pe];return ae}(Object.create(ct),D)).debug;if(j&&console.time("preprocess data"),D.maxZoom<0||D.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(D.promoteId&&D.generateId)throw new Error("promoteId and generateId cannot be used together.");let W=function(ae,ue){const pe=[];if(ae.type==="FeatureCollection")for(let ie=0;ie<ae.features.length;ie++)Ki(pe,ae.features[ie],ue,ie);else Ki(pe,ae.type==="Feature"?ae:{geometry:ae},ue);return pe}(L,D);this.tiles={},this.tileCoords=[],j&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",D.indexMaxZoom,D.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),W=function(ae,ue){const pe=ue.buffer/ue.extent;let ie=ae;const we=tr(ae,1,-1-pe,pe,0,-1,2,ue),Ee=tr(ae,1,1-pe,2+pe,0,-1,2,ue);return(we||Ee)&&(ie=tr(ae,1,-pe,1+pe,0,-1,2,ue)||[],we&&(ie=De(we,1).concat(ie)),Ee&&(ie=ie.concat(De(Ee,-1)))),ie}(W,D),W.length&&this.splitTile(W,0,0,0),j&&(W.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(L,D,j,W,ae,ue,pe){const ie=[L,D,j,W],we=this.options,Ee=we.debug;for(;ie.length;){W=ie.pop(),j=ie.pop(),D=ie.pop(),L=ie.pop();const _e=1<<D,Re=Xn(D,j,W);let nt=this.tiles[Re];if(!nt&&(Ee>1&&console.time("creation"),nt=this.tiles[Re]=Yi(L,D,j,W,we),this.tileCoords.push({z:D,x:j,y:W}),Ee)){Ee>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",D,j,W,nt.numFeatures,nt.numPoints,nt.numSimplified),console.timeEnd("creation"));const Tr=`z${D}`;this.stats[Tr]=(this.stats[Tr]||0)+1,this.total++}if(nt.source=L,ae==null){if(D===we.indexMaxZoom||nt.numPoints<=we.indexMaxPoints)continue}else{if(D===we.maxZoom||D===ae)continue;if(ae!=null){const Tr=ae-D;if(j!==ue>>Tr||W!==pe>>Tr)continue}}if(nt.source=null,L.length===0)continue;Ee>1&&console.time("clipping");const st=.5*we.buffer/we.extent,Et=.5-st,_t=.5+st,Pt=1+st;let St=null,yr=null,rr=null,wt=null,Ot=tr(L,_e,j-st,j+_t,0,nt.minX,nt.maxX,we),Qt=tr(L,_e,j+Et,j+Pt,0,nt.minX,nt.maxX,we);L=null,Ot&&(St=tr(Ot,_e,W-st,W+_t,1,nt.minY,nt.maxY,we),yr=tr(Ot,_e,W+Et,W+Pt,1,nt.minY,nt.maxY,we),Ot=null),Qt&&(rr=tr(Qt,_e,W-st,W+_t,1,nt.minY,nt.maxY,we),wt=tr(Qt,_e,W+Et,W+Pt,1,nt.minY,nt.maxY,we),Qt=null),Ee>1&&console.timeEnd("clipping"),ie.push(St||[],D+1,2*j,2*W),ie.push(yr||[],D+1,2*j,2*W+1),ie.push(rr||[],D+1,2*j+1,2*W),ie.push(wt||[],D+1,2*j+1,2*W+1)}}getTile(L,D,j){L=+L,D=+D,j=+j;const W=this.options,{extent:ae,debug:ue}=W;if(L<0||L>24)return null;const pe=1<<L,ie=Xn(L,D=D+pe&pe-1,j);if(this.tiles[ie])return Hr(this.tiles[ie],ae);ue>1&&console.log("drilling down to z%d-%d-%d",L,D,j);let we,Ee=L,_e=D,Re=j;for(;!we&&Ee>0;)Ee--,_e>>=1,Re>>=1,we=this.tiles[Xn(Ee,_e,Re)];return we&&we.source?(ue>1&&(console.log("found parent tile z%d-%d-%d",Ee,_e,Re),console.time("drilling down")),this.splitTile(we.source,Ee,_e,Re,L,D,j),ue>1&&console.timeEnd("drilling down"),this.tiles[ie]?Hr(this.tiles[ie],ae):null):null}}function Xn(J,L,D){return 32*((1<<J)*D+L)+J}function yt(J,L){return L?J.properties[L]:J.id}function _i(J,L){if(J==null)return!0;if(J.type==="Feature")return yt(J,L)!=null;if(J.type==="FeatureCollection"){const D=new Set;for(const j of J.features){const W=yt(j,L);if(W==null||D.has(W))return!1;D.add(W)}return!0}return!1}function Li(J,L){const D=new Map;if(J!=null)if(J.type==="Feature")D.set(yt(J,L),J);else for(const j of J.features)D.set(yt(j,L),j);return D}class Qi extends Z{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(L,D){return w._(this,void 0,void 0,function*(){const j=L.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const W=this._geoJSONIndex.getTile(j.z,j.x,j.y);if(!W)return null;const ae=new class{constructor(pe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=w.X,this.length=pe.length,this._features=pe}feature(pe){return new class{constructor(ie){this._feature=ie,this.extent=w.X,this.type=ie.type,this.properties=ie.tags,"id"in ie&&!isNaN(ie.id)&&(this.id=parseInt(ie.id,10))}loadGeometry(){if(this._feature.type===1){const ie=[];for(const we of this._feature.geometry)ie.push([new w.P(we[0],we[1])]);return ie}{const ie=[];for(const we of this._feature.geometry){const Ee=[];for(const _e of we)Ee.push(new w.P(_e[0],_e[1]));ie.push(Ee)}return ie}}toGeoJSON(ie,we,Ee){return Pe.call(this,ie,we,Ee)}}(this._features[pe])}}(W.features);let ue=nn(ae);return ue.byteOffset===0&&ue.byteLength===ue.buffer.byteLength||(ue=new Uint8Array(ue)),{vectorTile:ae,rawData:ue.buffer}})}loadData(L){return w._(this,void 0,void 0,function*(){var D;(D=this._pendingRequest)===null||D===void 0||D.abort();const j=!!(L&&L.request&&L.request.collectResourceTiming)&&new w.bv(L.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(L,this._pendingRequest),this._geoJSONIndex=L.cluster?new Fr(function({superclusterOptions:ue,clusterProperties:pe}){if(!pe||!ue)return ue;const ie={},we={},Ee={accumulated:null,zoom:0},_e={properties:null},Re=Object.keys(pe);for(const nt of Re){const[st,Et]=pe[nt],_t=w.bC(Et),Pt=w.bC(typeof st=="string"?[st,["accumulated"],["get",nt]]:st);ie[nt]=_t.value,we[nt]=Pt.value}return ue.map=nt=>{_e.properties=nt;const st={};for(const Et of Re)st[Et]=ie[Et].evaluate(Ee,_e);return st},ue.reduce=(nt,st)=>{_e.properties=st;for(const Et of Re)Ee.accumulated=nt[Et],nt[Et]=we[Et].evaluate(Ee,_e)},ue}(L)).load((yield this._pendingData).features):(W=yield this._pendingData,new an(W,L.geojsonVtOptions)),this.loaded={};const ae={};if(j){const ue=j.finish();ue&&(ae.resourceTiming={},ae.resourceTiming[L.source]=JSON.parse(JSON.stringify(ue)))}return ae}catch(ae){if(delete this._pendingRequest,w.bB(ae))return{abandoned:!0};throw ae}var W})}getData(){return w._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(L){const D=this.loaded;return D&&D[L.uid]?super.reloadTile(L):this.loadTile(L)}loadAndProcessGeoJSON(L,D){return w._(this,void 0,void 0,function*(){let j=yield this.loadGeoJSON(L,D);if(delete this._pendingRequest,typeof j!="object")throw new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`);if(ke(j,!0),L.filter){const W=w.bC(L.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(W.result==="error")throw new Error(W.value.map(ue=>`${ue.key}: ${ue.message}`).join(", "));j={type:"FeatureCollection",features:j.features.filter(ue=>W.value.evaluate({zoom:0},ue))}}return j})}loadGeoJSON(L,D){return w._(this,void 0,void 0,function*(){const{promoteId:j}=L;if(L.request){const W=yield w.h(L.request,D);return this._dataUpdateable=_i(W.data,j)?Li(W.data,j):void 0,W.data}if(typeof L.data=="string")try{const W=JSON.parse(L.data);return this._dataUpdateable=_i(W,j)?Li(W,j):void 0,W}catch{throw new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`)}if(!L.dataDiff)throw new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${L.source}`);return function(W,ae,ue){var pe,ie,we,Ee;if(ae.removeAll&&W.clear(),ae.remove)for(const _e of ae.remove)W.delete(_e);if(ae.add)for(const _e of ae.add){const Re=yt(_e,ue);Re!=null&&W.set(Re,_e)}if(ae.update)for(const _e of ae.update){let Re=W.get(_e.id);if(Re==null)continue;const nt=!_e.removeAllProperties&&(((pe=_e.removeProperties)===null||pe===void 0?void 0:pe.length)>0||((ie=_e.addOrUpdateProperties)===null||ie===void 0?void 0:ie.length)>0);if((_e.newGeometry||_e.removeAllProperties||nt)&&(Re=Object.assign({},Re),W.set(_e.id,Re),nt&&(Re.properties=Object.assign({},Re.properties))),_e.newGeometry&&(Re.geometry=_e.newGeometry),_e.removeAllProperties)Re.properties={};else if(((we=_e.removeProperties)===null||we===void 0?void 0:we.length)>0)for(const st of _e.removeProperties)Object.prototype.hasOwnProperty.call(Re.properties,st)&&delete Re.properties[st];if(((Ee=_e.addOrUpdateProperties)===null||Ee===void 0?void 0:Ee.length)>0)for(const{key:st,value:Et}of _e.addOrUpdateProperties)Re.properties[st]=Et}}(this._dataUpdateable,L.dataDiff,j),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(L){return w._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(L){return this._geoJSONIndex.getClusterExpansionZoom(L.clusterId)}getClusterChildren(L){return this._geoJSONIndex.getChildren(L.clusterId)}getClusterLeaves(L){return this._geoJSONIndex.getLeaves(L.clusterId,L.limit,L.offset)}}class vi{constructor(L){this.self=L,this.actor=new w.F(L),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(D,j)=>{if(this.externalWorkerSourceTypes[D])throw new Error(`Worker source with name "${D}" already registered.`);this.externalWorkerSourceTypes[D]=j},this.self.addProtocol=w.bi,this.self.removeProtocol=w.bj,this.self.registerRTLTextPlugin=D=>{if(w.bD.isParsed())throw new Error("RTL text plugin already registered.");w.bD.setMethods(D)},this.actor.registerMessageHandler("LDT",(D,j)=>this._getDEMWorkerSource(D,j.source).loadTile(j)),this.actor.registerMessageHandler("RDT",(D,j)=>w._(this,void 0,void 0,function*(){this._getDEMWorkerSource(D,j.source).removeTile(j)})),this.actor.registerMessageHandler("GCEZ",(D,j)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(D,j.type,j.source).getClusterExpansionZoom(j)})),this.actor.registerMessageHandler("GCC",(D,j)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(D,j.type,j.source).getClusterChildren(j)})),this.actor.registerMessageHandler("GCL",(D,j)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(D,j.type,j.source).getClusterLeaves(j)})),this.actor.registerMessageHandler("LD",(D,j)=>this._getWorkerSource(D,j.type,j.source).loadData(j)),this.actor.registerMessageHandler("GD",(D,j)=>this._getWorkerSource(D,j.type,j.source).getData()),this.actor.registerMessageHandler("LT",(D,j)=>this._getWorkerSource(D,j.type,j.source).loadTile(j)),this.actor.registerMessageHandler("RT",(D,j)=>this._getWorkerSource(D,j.type,j.source).reloadTile(j)),this.actor.registerMessageHandler("AT",(D,j)=>this._getWorkerSource(D,j.type,j.source).abortTile(j)),this.actor.registerMessageHandler("RMT",(D,j)=>this._getWorkerSource(D,j.type,j.source).removeTile(j)),this.actor.registerMessageHandler("RS",(D,j)=>w._(this,void 0,void 0,function*(){if(!this.workerSources[D]||!this.workerSources[D][j.type]||!this.workerSources[D][j.type][j.source])return;const W=this.workerSources[D][j.type][j.source];delete this.workerSources[D][j.type][j.source],W.removeSource!==void 0&&W.removeSource(j)})),this.actor.registerMessageHandler("RM",D=>w._(this,void 0,void 0,function*(){delete this.layerIndexes[D],delete this.availableImages[D],delete this.workerSources[D],delete this.demWorkerSources[D]})),this.actor.registerMessageHandler("SR",(D,j)=>w._(this,void 0,void 0,function*(){this.referrer=j})),this.actor.registerMessageHandler("SRPS",(D,j)=>this._syncRTLPluginState(D,j)),this.actor.registerMessageHandler("IS",(D,j)=>w._(this,void 0,void 0,function*(){this.self.importScripts(j)})),this.actor.registerMessageHandler("SI",(D,j)=>this._setImages(D,j)),this.actor.registerMessageHandler("UL",(D,j)=>w._(this,void 0,void 0,function*(){this._getLayerIndex(D).update(j.layers,j.removedIds)})),this.actor.registerMessageHandler("SL",(D,j)=>w._(this,void 0,void 0,function*(){this._getLayerIndex(D).replace(j)}))}_setImages(L,D){return w._(this,void 0,void 0,function*(){this.availableImages[L]=D;for(const j in this.workerSources[L]){const W=this.workerSources[L][j];for(const ae in W)W[ae].availableImages=D}})}_syncRTLPluginState(L,D){return w._(this,void 0,void 0,function*(){if(w.bD.isParsed())return w.bD.getState();if(D.pluginStatus!=="loading")return w.bD.setState(D),D;const j=D.pluginURL;if(this.self.importScripts(j),w.bD.isParsed()){const W={pluginStatus:"loaded",pluginURL:j};return w.bD.setState(W),W}throw w.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${j}`)})}_getAvailableImages(L){let D=this.availableImages[L];return D||(D=[]),D}_getLayerIndex(L){let D=this.layerIndexes[L];return D||(D=this.layerIndexes[L]=new d),D}_getWorkerSource(L,D,j){if(this.workerSources[L]||(this.workerSources[L]={}),this.workerSources[L][D]||(this.workerSources[L][D]={}),!this.workerSources[L][D][j]){const W={sendAsync:(ae,ue)=>(ae.targetMapId=L,this.actor.sendAsync(ae,ue))};switch(D){case"vector":this.workerSources[L][D][j]=new Z(W,this._getLayerIndex(L),this._getAvailableImages(L));break;case"geojson":this.workerSources[L][D][j]=new Qi(W,this._getLayerIndex(L),this._getAvailableImages(L));break;default:this.workerSources[L][D][j]=new this.externalWorkerSourceTypes[D](W,this._getLayerIndex(L),this._getAvailableImages(L))}}return this.workerSources[L][D][j]}_getDEMWorkerSource(L,D){return this.demWorkerSources[L]||(this.demWorkerSources[L]={}),this.demWorkerSources[L][D]||(this.demWorkerSources[L][D]=new U),this.demWorkerSources[L][D]}}return w.i(self)&&(self.worker=new vi(self)),vi}),_("index",["exports","./shared"],function(w,d){var B="4.7.1";let K,te;const Z={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:f=>new Promise((e,o)=>{const u=requestAnimationFrame(e);f.signal.addEventListener("abort",()=>{cancelAnimationFrame(u),o(d.c())})}),getImageData(f,e=0){return this.getImageCanvasContext(f).getImageData(-e,-e,f.width+2*e,f.height+2*e)},getImageCanvasContext(f){const e=window.document.createElement("canvas"),o=e.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return e.width=f.width,e.height=f.height,o.drawImage(f,0,0,f.width,f.height),o},resolveURL:f=>(K||(K=document.createElement("a")),K.href=f,K.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(te==null&&(te=matchMedia("(prefers-reduced-motion: reduce)")),te.matches)}};class U{static testProp(e){if(!U.docStyle)return e[0];for(let o=0;o<e.length;o++)if(e[o]in U.docStyle)return e[o];return e[0]}static create(e,o,u){const c=window.document.createElement(e);return o!==void 0&&(c.className=o),u&&u.appendChild(c),c}static createNS(e,o){return window.document.createElementNS(e,o)}static disableDrag(){U.docStyle&&U.selectProp&&(U.userSelect=U.docStyle[U.selectProp],U.docStyle[U.selectProp]="none")}static enableDrag(){U.docStyle&&U.selectProp&&(U.docStyle[U.selectProp]=U.userSelect)}static setTransform(e,o){e.style[U.transformProp]=o}static addEventListener(e,o,u,c={}){e.addEventListener(o,u,"passive"in c?c:c.capture)}static removeEventListener(e,o,u,c={}){e.removeEventListener(o,u,"passive"in c?c:c.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",U.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",U.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",U.suppressClickInternal,!0)},0)}static getScale(e){const o=e.getBoundingClientRect();return{x:o.width/e.offsetWidth||1,y:o.height/e.offsetHeight||1,boundingClientRect:o}}static getPoint(e,o,u){const c=o.boundingClientRect;return new d.P((u.clientX-c.left)/o.x-e.clientLeft,(u.clientY-c.top)/o.y-e.clientTop)}static mousePos(e,o){const u=U.getScale(e);return U.getPoint(e,u,o)}static touchPos(e,o){const u=[],c=U.getScale(e);for(let p=0;p<o.length;p++)u.push(U.getPoint(e,c,o[p]));return u}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}U.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,U.selectProp=U.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),U.transformProp=U.testProp(["transform","WebkitTransform"]);const Se={supported:!1,testSupport:function(f){!Pe&&ke&&(ne?q(f):be=f)}};let be,ke,Pe=!1,ne=!1;function q(f){const e=f.createTexture();f.bindTexture(f.TEXTURE_2D,e);try{if(f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,ke),f.isContextLost())return;Se.supported=!0}catch{}f.deleteTexture(e),Pe=!0}var re;typeof document<"u"&&(ke=document.createElement("img"),ke.onload=()=>{be&&q(be),be=null,ne=!0},ke.onerror=()=>{Pe=!0,be=null},ke.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(f){let e,o,u,c;f.resetRequestQueue=()=>{e=[],o=0,u=0,c={}},f.addThrottleControl=T=>{const E=u++;return c[E]=T,E},f.removeThrottleControl=T=>{delete c[T],x()},f.getImage=(T,E,M=!0)=>new Promise((z,F)=>{Se.supported&&(T.headers||(T.headers={}),T.headers.accept="image/webp,*/*"),d.e(T,{type:"image"}),e.push({abortController:E,requestParameters:T,supportImageRefresh:M,state:"queued",onError:V=>{F(V)},onSuccess:V=>{z(V)}}),x()});const p=T=>d._(this,void 0,void 0,function*(){T.state="running";const{requestParameters:E,supportImageRefresh:M,onError:z,onSuccess:F,abortController:V}=T,$=M===!1&&!d.i(self)&&!d.g(E.url)&&(!E.headers||Object.keys(E.headers).reduce((ee,se)=>ee&&se==="accept",!0));o++;const X=$?S(E,V):d.m(E,V);try{const ee=yield X;delete T.abortController,T.state="completed",ee.data instanceof HTMLImageElement||d.b(ee.data)?F(ee):ee.data&&F({data:yield(Q=ee.data,typeof createImageBitmap=="function"?d.d(Q):d.f(Q)),cacheControl:ee.cacheControl,expires:ee.expires})}catch(ee){delete T.abortController,z(ee)}finally{o--,x()}var Q}),x=()=>{const T=(()=>{for(const E of Object.keys(c))if(c[E]())return!0;return!1})()?d.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:d.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let E=o;E<T&&e.length>0;E++){const M=e.shift();M.abortController.signal.aborted?E--:p(M)}},S=(T,E)=>new Promise((M,z)=>{const F=new Image,V=T.url,$=T.credentials;$&&$==="include"?F.crossOrigin="use-credentials":($&&$==="same-origin"||!d.s(V))&&(F.crossOrigin="anonymous"),E.signal.addEventListener("abort",()=>{F.src="",z(d.c())}),F.fetchPriority="high",F.onload=()=>{F.onerror=F.onload=null,M({data:F})},F.onerror=()=>{F.onerror=F.onload=null,E.signal.aborted||z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},F.src=V})}(re||(re={})),re.resetRequestQueue();class de{constructor(e){this._transformRequestFn=e}transformRequest(e,o){return this._transformRequestFn&&this._transformRequestFn(e,o)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function ye(f){var e=new d.A(3);return e[0]=f[0],e[1]=f[1],e[2]=f[2],e}var Ce,ze=function(f,e,o){return f[0]=e[0]-o[0],f[1]=e[1]-o[1],f[2]=e[2]-o[2],f};Ce=new d.A(3),d.A!=Float32Array&&(Ce[0]=0,Ce[1]=0,Ce[2]=0);var Ue=function(f){var e=f[0],o=f[1];return e*e+o*o};function tt(f){const e=[];if(typeof f=="string")e.push({id:"default",url:f});else if(f&&f.length>0){const o=[];for(const{id:u,url:c}of f){const p=`${u}${c}`;o.indexOf(p)===-1&&(o.push(p),e.push({id:u,url:c}))}}return e}function ut(f,e,o){const u=f.split("?");return u[0]+=`${e}${o}`,u.join("?")}(function(){var f=new d.A(2);d.A!=Float32Array&&(f[0]=0,f[1]=0)})();class ot{constructor(e,o,u,c){this.context=e,this.format=u,this.texture=e.gl.createTexture(),this.update(o,c)}update(e,o,u){const{width:c,height:p}=e,x=!(this.size&&this.size[0]===c&&this.size[1]===p||u),{context:S}=this,{gl:T}=S;if(this.useMipmap=!!(o&&o.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!o||o.premultiply!==!1)),x)this.size=[c,p],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||d.b(e)?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,e):T.texImage2D(T.TEXTURE_2D,0,this.format,c,p,0,this.format,T.UNSIGNED_BYTE,e.data);else{const{x:E,y:M}=u||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||d.b(e)?T.texSubImage2D(T.TEXTURE_2D,0,E,M,T.RGBA,T.UNSIGNED_BYTE,e):T.texSubImage2D(T.TEXTURE_2D,0,E,M,c,p,T.RGBA,T.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D)}bind(e,o,u){const{context:c}=this,{gl:p}=c;p.bindTexture(p.TEXTURE_2D,this.texture),u!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=p.LINEAR),e!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,u||e),this.filter=e),o!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function wr(f){const{userImage:e}=f;return!!(e&&e.render&&e.render())&&(f.data.replace(new Uint8Array(e.data.buffer)),!0)}class Zt extends d.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:o,promiseResolve:u}of this.requestors)u(this._getImagesForIds(o));this.requestors=[]}}getImage(e){const o=this.images[e];if(o&&!o.data&&o.spriteData){const u=o.spriteData;o.data=new d.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),o.spriteData=null}return o}addImage(e,o){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,o)&&(this.images[e]=o)}_validate(e,o){let u=!0;const c=o.data||o.spriteData;return this._validateStretch(o.stretchX,c&&c.width)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "stretchX" value`))),u=!1),this._validateStretch(o.stretchY,c&&c.height)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "stretchY" value`))),u=!1),this._validateContent(o.content,o)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "content" value`))),u=!1),u}_validateStretch(e,o){if(!e)return!0;let u=0;for(const c of e){if(c[0]<u||c[1]<c[0]||o<c[1])return!1;u=c[1]}return!0}_validateContent(e,o){if(!e)return!0;if(e.length!==4)return!1;const u=o.spriteData,c=u&&u.width||o.data.width,p=u&&u.height||o.data.height;return!(e[0]<0||c<e[0]||e[1]<0||p<e[1]||e[2]<0||c<e[2]||e[3]<0||p<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,o,u=!0){const c=this.getImage(e);if(u&&(c.data.width!==o.data.width||c.data.height!==o.data.height))throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${o.data.width}x${o.data.height}).`);o.version=c.version+1,this.images[e]=o,this.updatedImages[e]=!0}removeImage(e){const o=this.images[e];delete this.images[e],delete this.patterns[e],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((o,u)=>{let c=!0;if(!this.isLoaded())for(const p of e)this.images[p]||(c=!1);this.isLoaded()||c?o(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:o})})}_getImagesForIds(e){const o={};for(const u of e){let c=this.getImage(u);c||(this.fire(new d.k("styleimagemissing",{id:u})),c=this.getImage(u)),c?o[u]={data:c.data.clone(),pixelRatio:c.pixelRatio,sdf:c.sdf,version:c.version,stretchX:c.stretchX,stretchY:c.stretchY,content:c.content,textFitWidth:c.textFitWidth,textFitHeight:c.textFitHeight,hasRenderCallback:!!(c.userImage&&c.userImage.render)}:d.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return o}getPixelSize(){const{width:e,height:o}=this.atlasImage;return{width:e,height:o}}getPattern(e){const o=this.patterns[e],u=this.getImage(e);if(!u)return null;if(o&&o.position.version===u.version)return o.position;if(o)o.position.version=u.version;else{const c={w:u.data.width+2,h:u.data.height+2,x:0,y:0},p=new d.I(c,u);this.patterns[e]={bin:c,position:p}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const o=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ot(e,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const p in this.patterns)e.push(this.patterns[p].bin);const{w:o,h:u}=d.p(e),c=this.atlasImage;c.resize({width:o||1,height:u||1});for(const p in this.patterns){const{bin:x}=this.patterns[p],S=x.x+1,T=x.y+1,E=this.getImage(p).data,M=E.width,z=E.height;d.R.copy(E,c,{x:0,y:0},{x:S,y:T},{width:M,height:z}),d.R.copy(E,c,{x:0,y:z-1},{x:S,y:T-1},{width:M,height:1}),d.R.copy(E,c,{x:0,y:0},{x:S,y:T+z},{width:M,height:1}),d.R.copy(E,c,{x:M-1,y:0},{x:S-1,y:T},{width:1,height:z}),d.R.copy(E,c,{x:0,y:0},{x:S+M,y:T},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const o of e){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const u=this.getImage(o);u||d.w(`Image with ID: "${o}" was not found`),wr(u)&&this.updateImage(o,u)}}}const gr=1e20;function xn(f,e,o,u,c,p,x,S,T){for(let E=e;E<e+u;E++)mi(f,o*p+E,p,c,x,S,T);for(let E=o;E<o+c;E++)mi(f,E*p+e,1,u,x,S,T)}function mi(f,e,o,u,c,p,x){p[0]=0,x[0]=-gr,x[1]=gr,c[0]=f[e];for(let S=1,T=0,E=0;S<u;S++){c[S]=f[e+S*o];const M=S*S;do{const z=p[T];E=(c[S]-c[z]+M-z*z)/(S-z)/2}while(E<=x[T]&&--T>-1);T++,p[T]=S,x[T]=E,x[T+1]=gr}for(let S=0,T=0;S<u;S++){for(;x[T+1]<S;)T++;const E=p[T],M=S-E;f[e+S*o]=c[E]+M*M}}class nn{constructor(e,o){this.requestManager=e,this.localIdeographFontFamily=o,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return d._(this,void 0,void 0,function*(){const o=[];for(const p in e)for(const x of e[p])o.push(this._getAndCacheGlyphsPromise(p,x));const u=yield Promise.all(o),c={};for(const{stack:p,id:x,glyph:S}of u)c[p]||(c[p]={}),c[p][x]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics};return c})}_getAndCacheGlyphsPromise(e,o){return d._(this,void 0,void 0,function*(){let u=this.entries[e];u||(u=this.entries[e]={glyphs:{},requests:{},ranges:{}});let c=u.glyphs[o];if(c!==void 0)return{stack:e,id:o,glyph:c};if(c=this._tinySDF(u,e,o),c)return u.glyphs[o]=c,{stack:e,id:o,glyph:c};const p=Math.floor(o/256);if(256*p>65535)throw new Error("glyphs > 65535 not supported");if(u.ranges[p])return{stack:e,id:o,glyph:c};if(!this.url)throw new Error("glyphsUrl is not set");if(!u.requests[p]){const S=nn.loadGlyphRange(e,p,this.url,this.requestManager);u.requests[p]=S}const x=yield u.requests[p];for(const S in x)this._doesCharSupportLocalGlyph(+S)||(u.glyphs[+S]=x[+S]);return u.ranges[p]=!0,{stack:e,id:o,glyph:x[o]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,o,u){const c=this.localIdeographFontFamily;if(!c||!this._doesCharSupportLocalGlyph(u))return;let p=e.tinySDF;if(!p){let S="400";/bold/i.test(o)?S="900":/medium/i.test(o)?S="500":/light/i.test(o)&&(S="200"),p=e.tinySDF=new nn.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:S})}const x=p.draw(String.fromCharCode(u));return{id:u,bitmap:new d.o({width:x.width||60,height:x.height||60},x.data),metrics:{width:x.glyphWidth/2||24,height:x.glyphHeight/2||24,left:x.glyphLeft/2+.5||0,top:x.glyphTop/2-27.5||-8,advance:x.glyphAdvance/2||24,isDoubleResolution:!0}}}}nn.loadGlyphRange=function(f,e,o,u){return d._(this,void 0,void 0,function*(){const c=256*e,p=c+255,x=u.transformRequest(o.replace("{fontstack}",f).replace("{range}",`${c}-${p}`),"Glyphs"),S=yield d.l(x,new AbortController);if(!S||!S.data)throw new Error(`Could not load glyph range. range: ${e}, ${c}-${p}`);const T={};for(const E of d.n(S.data))T[E.id]=E;return T})},nn.TinySDF=class{constructor({fontSize:f=24,buffer:e=3,radius:o=8,cutoff:u=.25,fontFamily:c="sans-serif",fontWeight:p="normal",fontStyle:x="normal"}={}){this.buffer=e,this.cutoff=u,this.radius=o;const S=this.size=f+4*e,T=this._createCanvas(S),E=this.ctx=T.getContext("2d",{willReadFrequently:!0});E.font=`${x} ${p} ${f}px ${c}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(f){const e=document.createElement("canvas");return e.width=e.height=f,e}draw(f){const{width:e,actualBoundingBoxAscent:o,actualBoundingBoxDescent:u,actualBoundingBoxLeft:c,actualBoundingBoxRight:p}=this.ctx.measureText(f),x=Math.ceil(o),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-c))),T=Math.min(this.size-this.buffer,x+Math.ceil(u)),E=S+2*this.buffer,M=T+2*this.buffer,z=Math.max(E*M,0),F=new Uint8ClampedArray(z),V={data:F,width:E,height:M,glyphWidth:S,glyphHeight:T,glyphTop:x,glyphLeft:0,glyphAdvance:e};if(S===0||T===0)return V;const{ctx:$,buffer:X,gridInner:Q,gridOuter:ee}=this;$.clearRect(X,X,S,T),$.fillText(f,X,X+x);const se=$.getImageData(X,X,S,T);ee.fill(gr,0,z),Q.fill(0,0,z);for(let G=0;G<T;G++)for(let le=0;le<S;le++){const ce=se.data[4*(G*S+le)+3]/255;if(ce===0)continue;const me=(G+X)*E+le+X;if(ce===1)ee[me]=0,Q[me]=gr;else{const Ie=.5-ce;ee[me]=Ie>0?Ie*Ie:0,Q[me]=Ie<0?Ie*Ie:0}}xn(ee,0,0,E,M,E,this.f,this.v,this.z),xn(Q,X,X,S,T,E,this.f,this.v,this.z);for(let G=0;G<z;G++){const le=Math.sqrt(ee[G])-Math.sqrt(Q[G]);F[G]=Math.round(255-255*(le/this.radius+this.cutoff))}return V}};class Ke{constructor(){this.specification=d.v.light.position}possiblyEvaluate(e,o){return d.x(e.expression.evaluate(o))}interpolate(e,o,u){return{x:d.y.number(e.x,o.x,u),y:d.y.number(e.y,o.y,u),z:d.y.number(e.z,o.z,u)}}}let mt;class gt extends d.E{constructor(e){super(),mt=mt||new d.q({anchor:new d.D(d.v.light.anchor),position:new Ke,color:new d.D(d.v.light.color),intensity:new d.D(d.v.light.intensity)}),this._transitionable=new d.T(mt),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,o={}){if(!this._validate(d.r,e,o))for(const u in e){const c=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),c):this._transitionable.setValue(u,c)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,o,u){return(!u||u.validate!==!1)&&d.t(this,e.call(d.u,{value:o,style:{glyphs:!0,sprite:!0},styleSpec:d.v}))}}const Ct=new d.q({"sky-color":new d.D(d.v.sky["sky-color"]),"horizon-color":new d.D(d.v.sky["horizon-color"]),"fog-color":new d.D(d.v.sky["fog-color"]),"fog-ground-blend":new d.D(d.v.sky["fog-ground-blend"]),"horizon-fog-blend":new d.D(d.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new d.D(d.v.sky["sky-horizon-blend"]),"atmosphere-blend":new d.D(d.v.sky["atmosphere-blend"])});class Bt extends d.E{constructor(e){super(),this._transitionable=new d.T(Ct),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new d.z(0))}setSky(e,o={}){if(!this._validate(d.B,e,o)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const u in e){const c=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),c):this._transitionable.setValue(u,c)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,o,u={}){return(u==null?void 0:u.validate)!==!1&&d.t(this,e.call(d.u,d.e({value:o,style:{glyphs:!0,sprite:!0},styleSpec:d.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Hn{constructor(e,o){this.width=e,this.height=o,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,o){const u=e.join(",")+String(o);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(e,o)),this.dashEntry[u]}getDashRanges(e,o,u){const c=[];let p=e.length%2==1?-e[e.length-1]*u:0,x=e[0]*u,S=!0;c.push({left:p,right:x,isDash:S,zeroLength:e[0]===0});let T=e[0];for(let E=1;E<e.length;E++){S=!S;const M=e[E];p=T*u,T+=M,x=T*u,c.push({left:p,right:x,isDash:S,zeroLength:M===0})}return c}addRoundDash(e,o,u){const c=o/2;for(let p=-u;p<=u;p++){const x=this.width*(this.nextRow+u+p);let S=0,T=e[S];for(let E=0;E<this.width;E++){E/T.right>1&&(T=e[++S]);const M=Math.abs(E-T.left),z=Math.abs(E-T.right),F=Math.min(M,z);let V;const $=p/u*(c+1);if(T.isDash){const X=c-Math.abs($);V=Math.sqrt(F*F+X*X)}else V=c-Math.sqrt(F*F+$*$);this.data[x+E]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(e){for(let S=e.length-1;S>=0;--S){const T=e[S],E=e[S+1];T.zeroLength?e.splice(S,1):E&&E.isDash===T.isDash&&(E.left=T.left,e.splice(S,1))}const o=e[0],u=e[e.length-1];o.isDash===u.isDash&&(o.left=u.left-this.width,u.right=o.right+this.width);const c=this.width*this.nextRow;let p=0,x=e[p];for(let S=0;S<this.width;S++){S/x.right>1&&(x=e[++p]);const T=Math.abs(S-x.left),E=Math.abs(S-x.right),M=Math.min(T,E);this.data[c+S]=Math.max(0,Math.min(255,(x.isDash?M:-M)+128))}}addDash(e,o){const u=o?7:0,c=2*u+1;if(this.nextRow+c>this.height)return d.w("LineAtlas out of space"),null;let p=0;for(let S=0;S<e.length;S++)p+=e[S];if(p!==0){const S=this.width/p,T=this.getDashRanges(e,this.width,S);o?this.addRoundDash(T,S,u):this.addRegularDash(T)}const x={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:p};return this.nextRow+=c,this.dirty=!0,x}bind(e){const o=e.gl;this.texture?(o.bindTexture(o.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,o.texSubImage2D(o.TEXTURE_2D,0,0,0,this.width,this.height,o.ALPHA,o.UNSIGNED_BYTE,this.data))):(this.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.ALPHA,this.width,this.height,0,o.ALPHA,o.UNSIGNED_BYTE,this.data))}}const Fr="maplibre_preloaded_worker_pool";class sn{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<sn.workerCount;)this.workers.push(new Worker(d.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Fr]}numActive(){return Object.keys(this.active).length}}const on=Math.floor(Z.hardwareConcurrency/2);let kr,Wn;function ps(){return kr||(kr=new sn),kr}sn.workerCount=d.C(globalThis)?Math.max(Math.min(on,3),1):1;class fs{constructor(e,o){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=o;const u=this.workerPool.acquire(o);for(let c=0;c<u.length;c++){const p=new d.F(u[c],o);p.name=`Worker ${c}`,this.actors.push(p)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,o){const u=[];for(const c of this.actors)u.push(c.sendAsync({type:e,data:o}));return Promise.all(u)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(o=>{o.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,o){for(const u of this.actors)u.registerMessageHandler(e,o)}}function Ko(){return Wn||(Wn=new fs(ps(),d.G),Wn.registerMessageHandler("GR",(f,e,o)=>d.m(e,o))),Wn}function Ai(f,e){const o=d.H();return d.J(o,o,[1,1,0]),d.K(o,o,[.5*f.width,.5*f.height,1]),d.L(o,o,f.calculatePosMatrix(e.toUnwrapped()))}function Xi(f,e,o,u,c,p){const x=function(z,F,V){if(z)for(const $ of z){const X=F[$];if(X&&X.source===V&&X.type==="fill-extrusion")return!0}else for(const $ in F){const X=F[$];if(X.source===V&&X.type==="fill-extrusion")return!0}return!1}(c&&c.layers,e,f.id),S=p.maxPitchScaleFactor(),T=f.tilesIn(u,S,x);T.sort(Ki);const E=[];for(const z of T)E.push({wrappedTileID:z.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(e,o,f._state,z.queryGeometry,z.cameraQueryGeometry,z.scale,c,p,S,Ai(f.transform,z.tileID))});const M=function(z){const F={},V={};for(const $ of z){const X=$.queryResults,Q=$.wrappedTileID,ee=V[Q]=V[Q]||{};for(const se in X){const G=X[se],le=ee[se]=ee[se]||{},ce=F[se]=F[se]||[];for(const me of G)le[me.featureIndex]||(le[me.featureIndex]=!0,ce.push(me))}}return F}(E);for(const z in M)M[z].forEach(F=>{const V=F.feature,$=f.getFeatureState(V.layer["source-layer"],V.id);V.source=V.layer.source,V.layer["source-layer"]&&(V.sourceLayer=V.layer["source-layer"]),V.state=$});return M}function Ki(f,e){const o=f.tileID,u=e.tileID;return o.overscaledZ-u.overscaledZ||o.canonical.y-u.canonical.y||o.wrap-u.wrap||o.canonical.x-u.canonical.x}function Hs(f,e,o){return d._(this,void 0,void 0,function*(){let u=f;if(f.url?u=(yield d.h(e.transformRequest(f.url,"Source"),o)).data:yield Z.frameAsync(o),!u)return null;const c=d.M(d.e(u,f),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in u&&u.vector_layers&&(c.vectorLayerIds=u.vector_layers.map(p=>p.id)),c})}class ve{constructor(e,o){e&&(o?this.setSouthWest(e).setNorthEast(o):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof d.N?new d.N(e.lng,e.lat):d.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof d.N?new d.N(e.lng,e.lat):d.N.convert(e),this}extend(e){const o=this._sw,u=this._ne;let c,p;if(e instanceof d.N)c=e,p=e;else{if(!(e instanceof ve))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ve.convert(e)):this.extend(d.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(d.N.convert(e)):this;if(c=e._sw,p=e._ne,!c||!p)return this}return o||u?(o.lng=Math.min(c.lng,o.lng),o.lat=Math.min(c.lat,o.lat),u.lng=Math.max(p.lng,u.lng),u.lat=Math.max(p.lat,u.lat)):(this._sw=new d.N(c.lng,c.lat),this._ne=new d.N(p.lng,p.lat)),this}getCenter(){return new d.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new d.N(this.getWest(),this.getNorth())}getSouthEast(){return new d.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:o,lat:u}=d.N.convert(e);let c=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&c}static convert(e){return e instanceof ve?e:e&&new ve(e)}static fromLngLat(e,o=0){const u=360*o/40075017,c=u/Math.cos(Math.PI/180*e.lat);return new ve(new d.N(e.lng-c,e.lat-u),new d.N(e.lng+c,e.lat+u))}adjustAntiMeridian(){const e=new d.N(this._sw.lng,this._sw.lat),o=new d.N(this._ne.lng,this._ne.lat);return new ve(e,e.lng>o.lng?new d.N(o.lng+360,o.lat):o)}}class ms{constructor(e,o,u){this.bounds=ve.convert(this.validateBounds(e)),this.minzoom=o||0,this.maxzoom=u||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const o=Math.pow(2,e.z),u=Math.floor(d.O(this.bounds.getWest())*o),c=Math.floor(d.Q(this.bounds.getNorth())*o),p=Math.ceil(d.O(this.bounds.getEast())*o),x=Math.ceil(d.Q(this.bounds.getSouth())*o);return e.x>=u&&e.x<p&&e.y>=c&&e.y<x}}class Jo extends d.E{constructor(e,o,u,c){if(super(),this.id=e,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.e(this,d.M(o,["url","scheme","tileSize","promoteId"])),this._options=d.e({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c)}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Hs(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(d.e(this,e),e.bounds&&(this.tileBounds=new ms(e.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new d.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return d.e({},this._options)}loadTile(e){return d._(this,void 0,void 0,function*(){const o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(o,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};u.request.collectResourceTiming=this._collectResourceTiming;let c="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((p,x)=>{e.reloadPromise={resolve:p,reject:x}})}else e.actor=this.dispatcher.getActor(),c="LT";e.abortController=new AbortController;try{const p=yield e.actor.sendAsync({type:c,data:u},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,p)}catch(p){if(delete e.abortController,e.aborted)return;if(p&&p.status!==404)throw p;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,o){if(o&&o.resourceTiming&&(e.resourceTiming=o.resourceTiming),o&&this.map._refreshExpiredTiles&&e.setExpiryData(o),e.loadVectorData(o,this.map.painter),e.reloadPromise){const u=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(u.resolve).catch(u.reject)}}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Dt extends d.E{constructor(e,o,u,c){super(),this.id=e,this.dispatcher=u,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.e({type:"raster"},o),d.e(this,d.M(o,["url","scheme","tileSize"]))}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Hs(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(d.e(this,e),e.bounds&&(this.tileBounds=new ms(e.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new d.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return d.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return d._(this,void 0,void 0,function*(){const o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const u=yield re.getImage(this.map._requestManager.transformRequest(o,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){this.map._refreshExpiredTiles&&u.cacheControl&&u.expires&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const c=this.map.painter.context,p=c.gl,x=u.data;e.texture=this.map.painter.getTileTexture(x.width),e.texture?e.texture.update(x,{useMipmap:!0}):(e.texture=new ot(c,x,p.RGBA,{useMipmap:!0}),e.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}})}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class tr extends Dt{constructor(e,o,u,c){super(e,o,u,c),this.type="raster-dem",this.maxzoom=22,this._options=d.e({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox",this.redFactor=o.redFactor,this.greenFactor=o.greenFactor,this.blueFactor=o.blueFactor,this.baseShift=o.baseShift}loadTile(e){return d._(this,void 0,void 0,function*(){const o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(o,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const c=yield re.getImage(u,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(c&&c.data){const p=c.data;this.map._refreshExpiredTiles&&c.cacheControl&&c.expires&&e.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const x=d.b(p)&&d.U()?p:yield this.readImageNow(p),S={type:this.type,uid:e.uid,source:this.id,rawImageData:x,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const T=yield e.actor.sendAsync({type:"LDT",data:S});e.dem=T,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(c){if(delete e.abortController,e.aborted)e.state="unloaded";else if(c)throw e.state="errored",c}})}readImageNow(e){return d._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&d.V()){const o=e.width+2,u=e.height+2;try{return new d.R({width:o,height:u},yield d.W(e,-1,-1,o,u))}catch{}}return Z.getImageData(e,1)})}_getNeighboringTiles(e){const o=e.canonical,u=Math.pow(2,o.z),c=(o.x-1+u)%u,p=o.x===0?e.wrap-1:e.wrap,x=(o.x+1+u)%u,S=o.x+1===u?e.wrap+1:e.wrap,T={};return T[new d.S(e.overscaledZ,p,o.z,c,o.y).key]={backfilled:!1},T[new d.S(e.overscaledZ,S,o.z,x,o.y).key]={backfilled:!1},o.y>0&&(T[new d.S(e.overscaledZ,p,o.z,c,o.y-1).key]={backfilled:!1},T[new d.S(e.overscaledZ,e.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},T[new d.S(e.overscaledZ,S,o.z,x,o.y-1).key]={backfilled:!1}),o.y+1<u&&(T[new d.S(e.overscaledZ,p,o.z,c,o.y+1).key]={backfilled:!1},T[new d.S(e.overscaledZ,e.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},T[new d.S(e.overscaledZ,S,o.z,x,o.y+1).key]={backfilled:!1}),T}unloadTile(e){return d._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class Yo extends d.E{constructor(e,o,u,c){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=u.getActor(),this.setEventedParent(c),this._data=o.data,this._options=d.e({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const p=d.X/this.tileSize;o.clusterMaxZoom!==void 0&&this.maxzoom<=o.clusterMaxZoom&&d.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${o.clusterMaxZoom}".`),this.workerOptions=d.e({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*p,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*p,extent:d.X,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:d.X,radius:(o.clusterRadius||50)*p,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return d._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return d._(this,void 0,void 0,function*(){const e=d.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,o,u){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:o,offset:u}})}_updateWorkerData(e){return d._(this,void 0,void 0,function*(){const o=d.e({type:this.type},this.workerOptions);e?o.dataDiff=e:typeof this._data=="string"?(o.request=this.map._requestManager.transformRequest(Z.resolveURL(this._data),"Source"),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new d.k("dataloading",{dataType:"source"}));try{const u=yield this.actor.sendAsync({type:"LD",data:o});if(this._pendingLoads--,this._removed||u.abandoned)return void this.fire(new d.k("dataabort",{dataType:"source"}));let c=null;u.resourceTiming&&u.resourceTiming[this.id]&&(c=u.resourceTiming[this.id].slice(0));const p={dataType:"source"};this._collectResourceTiming&&c&&c.length>0&&d.e(p,{resourceTiming:c}),this.fire(new d.k("data",Object.assign(Object.assign({},p),{sourceDataType:"metadata"}))),this.fire(new d.k("data",Object.assign(Object.assign({},p),{sourceDataType:"content"})))}catch(u){if(this._pendingLoads--,this._removed)return void this.fire(new d.k("dataabort",{dataType:"source"}));this.fire(new d.j(u))}})}loaded(){return this._pendingLoads===0}loadTile(e){return d._(this,void 0,void 0,function*(){const o=e.actor?"RT":"LT";e.actor=this.actor;const u={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const c=yield this.actor.sendAsync({type:o,data:u},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(c,this.map.painter,o==="RT")})}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return d.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Ji=d.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Di extends d.E{constructor(e,o,u,c){super(),this.id=e,this.dispatcher=u,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(c),this.options=o}load(e){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const o=yield re.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,o&&o.data&&(this.image=o.data,e&&(this.coordinates=e),this._finishLoading())}catch(o){this._request=null,this._loaded=!0,this.fire(new d.j(o))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const o=e.map(d.Z.fromLngLat);this.tileID=function(c){let p=1/0,x=1/0,S=-1/0,T=-1/0;for(const F of c)p=Math.min(p,F.x),x=Math.min(x,F.y),S=Math.max(S,F.x),T=Math.max(T,F.y);const E=Math.max(S-p,T-x),M=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),z=Math.pow(2,M);return new d.a1(M,Math.floor((p+S)/2*z),Math.floor((x+T)/2*z))}(o),this.minzoom=this.maxzoom=this.tileID.z;const u=o.map(c=>this.tileID.getTilePoint(c)._round());return this._boundsArray=new d.$,this._boundsArray.emplaceBack(u[0].x,u[0].y,0,0),this._boundsArray.emplaceBack(u[1].x,u[1].y,d.X,0),this._boundsArray.emplaceBack(u[3].x,u[3].y,0,d.X),this._boundsArray.emplaceBack(u[2].x,u[2].y,d.X,d.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,o=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Ji.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ot(e,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let u=!1;for(const c in this.tiles){const p=this.tiles[c];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,u=!0)}u&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return d._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Ws extends Di{constructor(e,o,u,c){super(e,o,u,c),this.roundZoom=!0,this.type="video",this.options=o}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const o of e.urls)this.urls.push(this.map._requestManager.transformRequest(o,"Source").url);try{const o=yield d.a3(this.urls);if(this._loaded=!0,!o)return;this.video=o,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(o){this.fire(new d.j(o))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const o=this.video.seekable;e<o.start(0)||e>o.end(0)?this.fire(new d.j(new d.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,o=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Ji.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new ot(e,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let u=!1;for(const c in this.tiles){const p=this.tiles[c];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,u=!0)}u&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Dn extends Di{constructor(e,o,u,c){super(e,o,u,c),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(x=>typeof x!="number"))||this.fire(new d.j(new d.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.j(new d.a2(`sources.${e}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new d.j(new d.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new d.j(new d.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.j(new d.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){return d._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context,u=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Ji.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ot(o,this.canvas,u.RGBA,{premultiply:!0});let c=!1;for(const p in this.tiles){const x=this.tiles[p];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,c=!0)}c&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Qo={},ea=f=>{switch(f){case"geojson":return Yo;case"image":return Di;case"raster":return Dt;case"raster-dem":return tr;case"vector":return Jo;case"video":return Ws;case"canvas":return Dn}return Qo[f]},De="RTLPluginLoaded";class gi extends d.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ko()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(o=>{throw this.status="error",o})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return d._(this,arguments,void 0,function*(o,u=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Z.resolveURL(o),!this.url)throw new Error(`requested url ${o} is invalid`);if(this.status==="unavailable"){if(!u)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return d._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new d.k(De))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Hr=null;function yi(){return Hr||(Hr=new gi),Hr}class Yi{constructor(e,o){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=d.a4(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const o=e+this.timeAdded;o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,o,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,p){const x={};if(!p)return x;for(const S of c){const T=S.layerIds.map(E=>p.getLayer(E)).filter(Boolean);if(T.length!==0){S.layers=T,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(E=>T.filter(M=>M.id===E)[0]));for(const E of T)x[E.id]=S}}return x}(e.buckets,o.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const p=this.buckets[c];if(p instanceof d.a6){if(this.hasSymbolBuckets=!0,!u)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const p=this.buckets[c];if(p instanceof d.a6&&p.hasRTLText){this.hasRTLText=!0,yi().lazyLoad();break}}this.queryPadding=0;for(const c in this.buckets){const p=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(c).queryRadius(p))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new d.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const u in this.buckets){const c=this.buckets[u];c.uploadPending()&&c.upload(e)}const o=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ot(e,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ot(e,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,o,u,c,p,x,S,T,E,M){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:p,scale:x,tileSize:this.tileSize,pixelPosMatrix:M,transform:T,params:S,queryPadding:this.queryPadding*E},e,o,u):{}}querySourceFeatures(e,o){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const c=u.loadVTLayers(),p=o&&o.sourceLayer?o.sourceLayer:"",x=c._geojsonTileLayer||c[p];if(!x)return;const S=d.a7(o&&o.filter),{z:T,x:E,y:M}=this.tileID.canonical,z={z:T,x:E,y:M};for(let F=0;F<x.length;F++){const V=x.feature(F);if(S.needGeometry){const Q=d.a8(V,!0);if(!S.filter(new d.z(this.tileID.overscaledZ),Q,this.tileID.canonical))continue}else if(!S.filter(new d.z(this.tileID.overscaledZ),V))continue;const $=u.getId(V,p),X=new d.a9(V,T,E,M,$);X.tile=z,e.push(X)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const o=this.expirationTime;if(e.cacheControl){const u=d.aa(e.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const u=Date.now();let c=!1;if(this.expirationTime>u)c=!1;else if(o)if(this.expirationTime<o)c=!0;else{const p=this.expirationTime-o;p?this.expirationTime=u+Math.max(p,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const c in this.buckets){if(!o.style.hasLayer(c))continue;const p=this.buckets[c],x=p.layers[0].sourceLayer||"_geojsonTileLayer",S=u[x],T=e[x];if(!S||!T||Object.keys(T).length===0)continue;p.update(T,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});const E=o&&o.style&&o.style.getLayer(c);E&&(this.queryPadding=Math.max(this.queryPadding,E.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Z.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Z.now()+e}setDependencies(e,o){const u={};for(const c of o)u[c]=!0;this.dependencies[e]=u}hasDependency(e,o){for(const u of e){const c=this.dependencies[u];if(c){for(const p of o)if(c[p])return!0}}return!1}}class Oe{constructor(e,o){this.max=e,this.onRemove=o,this.reset()}reset(){for(const e in this.data)for(const o of this.data[e])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(e,o,u){const c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const p={value:o,timeout:void 0};if(u!==void 0&&(p.timeout=setTimeout(()=>{this.remove(e,p)},u)),this.data[c].push(p),this.order.push(c),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const o=this.data[e].shift();return o.timeout&&clearTimeout(o.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),o.value}getByKey(e){const o=this.data[e];return o?o[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,o){if(!this.has(e))return this;const u=e.wrapped().key,c=o===void 0?0:this.data[u].indexOf(o),p=this.data[u][c];return this.data[u].splice(c,1),p.timeout&&clearTimeout(p.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(p.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(e){const o=[];for(const u in this.data)for(const c of this.data[u])e(c.value)||o.push(c);for(const u of o)this.remove(u.value.tileID,u)}}class xt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,o,u){const c=String(o);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},d.e(this.stateChanges[e][c],u),this.deletedStates[e]===null){this.deletedStates[e]={};for(const p in this.state[e])p!==c&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(const p in this.state[e][c])u[p]||(this.deletedStates[e][c][p]=null)}else for(const p in u)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][p]===null&&delete this.deletedStates[e][c][p]}removeFeatureState(e,o,u){if(this.deletedStates[e]===null)return;const c=String(o);if(this.deletedStates[e]=this.deletedStates[e]||{},u&&o!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][u]=null);else if(o!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(u in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][u]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,o){const u=String(o),c=d.e({},(this.state[e]||{})[u],(this.stateChanges[e]||{})[u]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const p=this.deletedStates[e][o];if(p===null)return{};for(const x in p)delete c[x]}return c}initializeTileState(e,o){e.setFeatureState(this.state,o)}coalesceChanges(e,o){const u={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const p={};for(const x in this.stateChanges[c])this.state[c][x]||(this.state[c][x]={}),d.e(this.state[c][x],this.stateChanges[c][x]),p[x]=this.state[c][x];u[c]=p}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const p={};if(this.deletedStates[c]===null)for(const x in this.state[c])p[x]={},this.state[c][x]={};else for(const x in this.deletedStates[c]){if(this.deletedStates[c][x]===null)this.state[c][x]={};else for(const S of Object.keys(this.deletedStates[c][x]))delete this.state[c][x][S];p[x]=this.state[c][x]}u[c]=u[c]||{},d.e(u[c],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const c in e)e[c].setFeatureState(u,o)}}class ct extends d.E{constructor(e,o,u){super(),this.id=e,this.dispatcher=u,this.on("data",c=>this._dataHandler(c)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((c,p,x,S)=>{const T=new(ea(p.type))(c,p,x,S);if(T.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${T.id}`);return T})(e,o,u,this),this._tiles={},this._cache=new Oe(0,c=>this._unloadTile(c)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new xt,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const o=this._tiles[e];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,o,u){return d._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,o,u)}catch(c){e.state="errored",c.status!==404?this._source.fire(new d.j(c,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new d.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const u=this._tiles[o];u.upload(e),u.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(an).map(e=>e.key)}getRenderableIds(e){const o=[];for(const u in this._tiles)this._isIdRenderable(u,e)&&o.push(this._tiles[u]);return e?o.sort((u,c)=>{const p=u.tileID,x=c.tileID,S=new d.P(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),T=new d.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-x.overscaledZ||T.y-S.y||T.x-S.x}).map(u=>u.tileID.key):o.map(u=>u.tileID).sort(an).map(u=>u.key)}hasRenderableParent(e){const o=this.findLoadedParent(e,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(e,o){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(o||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,o){return d._(this,void 0,void 0,function*(){const u=this._tiles[e];u&&(u.state!=="loading"&&(u.state=o),yield this._loadTile(u,e,o))})}_tileLoaded(e,o,u){e.timeAdded=Z.now(),u==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(o,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new d.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const o=this.getRenderableIds();for(let c=0;c<o.length;c++){const p=o[c];if(e.neighboringTiles&&e.neighboringTiles[p]){const x=this.getTileByID(p);u(e,x),u(x,e)}}function u(c,p){c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0;let x=p.tileID.canonical.x-c.tileID.canonical.x;const S=p.tileID.canonical.y-c.tileID.canonical.y,T=Math.pow(2,c.tileID.canonical.z),E=p.tileID.key;x===0&&S===0||Math.abs(S)>1||(Math.abs(x)>1&&(Math.abs(x+T)===1?x+=T:Math.abs(x-T)===1&&(x-=T)),p.dem&&c.dem&&(c.dem.backfillBorder(p.dem,x,S),c.neighboringTiles&&c.neighboringTiles[E]&&(c.neighboringTiles[E].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,o,u,c){for(const p in this._tiles){let x=this._tiles[p];if(c[p]||!x.hasData()||x.tileID.overscaledZ<=o||x.tileID.overscaledZ>u)continue;let S=x.tileID;for(;x&&x.tileID.overscaledZ>o+1;){const E=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[E.key],x&&x.hasData()&&(S=E)}let T=S;for(;T.overscaledZ>o;)if(T=T.scaledTo(T.overscaledZ-1),e[T.key]){c[S.key]=S;break}}}findLoadedParent(e,o){if(e.key in this._loadedParentTiles){const u=this._loadedParentTiles[e.key];return u&&u.tileID.overscaledZ>=o?u:null}for(let u=e.overscaledZ-1;u>=o;u--){const c=e.scaledTo(u),p=this._getLoadedTile(c);if(p)return p}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const o=this._tiles[e.key];return o&&o.hasData()?o:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const o=Math.ceil(e.width/this._source.tileSize)+1,u=Math.ceil(e.height/this._source.tileSize)+1,c=Math.floor(o*u*(this._maxTileCacheZoomLevels===null?d.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),p=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(p)}handleWrapJump(e){const o=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,o){const u={};for(const c in this._tiles){const p=this._tiles[c];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+o),u[p.tileID.key]=p}this._tiles=u;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(c,this._tiles[c])}}_updateCoveredAndRetainedTiles(e,o,u,c,p,x){const S={},T={},E=Object.keys(e),M=Z.now();for(const z of E){const F=e[z],V=this._tiles[z];if(!V||V.fadeEndTime!==0&&V.fadeEndTime<=M)continue;const $=this.findLoadedParent(F,o),X=this.findLoadedSibling(F),Q=$||X||null;Q&&(this._addTile(Q.tileID),S[Q.tileID.key]=Q.tileID),T[z]=F}this._retainLoadedChildren(T,c,u,e);for(const z in S)e[z]||(this._coveredTiles[z]=!0,e[z]=S[z]);if(x){const z={},F={};for(const V of p)this._tiles[V.key].hasData()?z[V.key]=V:F[V.key]=V;for(const V in F){const $=F[V].children(this._source.maxzoom);this._tiles[$[0].key]&&this._tiles[$[1].key]&&this._tiles[$[2].key]&&this._tiles[$[3].key]&&(z[$[0].key]=e[$[0].key]=$[0],z[$[1].key]=e[$[1].key]=$[1],z[$[2].key]=e[$[2].key]=$[2],z[$[3].key]=e[$[3].key]=$[3],delete F[V])}for(const V in F){const $=F[V],X=this.findLoadedParent($,this._source.minzoom),Q=this.findLoadedSibling($),ee=X||Q||null;if(ee){z[ee.tileID.key]=e[ee.tileID.key]=ee.tileID;for(const se in z)z[se].isChildOf(ee.tileID)&&delete z[se]}}for(const V in this._tiles)z[V]||(this._coveredTiles[V]=!0)}}update(e,o){if(!this._sourceLoaded||this._paused)return;let u;this.transform=e,this.terrain=o,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new d.S(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(u=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:o}),this._source.hasTile&&(u=u.filter(M=>this._source.hasTile(M)))):u=[];const c=e.coveringZoomLevel(this._source),p=Math.max(c-ct.maxOverzooming,this._source.minzoom),x=Math.max(c+ct.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const M={};for(const z of u)if(z.canonical.z>this._source.minzoom){const F=z.scaledTo(z.canonical.z-1);M[F.key]=F;const V=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));M[V.key]=V}u=u.concat(Object.values(M))}const S=u.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,S&&this.fire(new d.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const T=this._updateRetainedTiles(u,c);Xn(this._source.type)&&this._updateCoveredAndRetainedTiles(T,p,x,c,u,o);for(const M in T)this._tiles[M].clearFadeHold();const E=d.ab(this._tiles,T);for(const M of E){const z=this._tiles[M];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(M)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,o){var u;const c={},p={},x=Math.max(o-ct.maxOverzooming,this._source.minzoom),S=Math.max(o+ct.maxUnderzooming,this._source.minzoom),T={};for(const E of e){const M=this._addTile(E);c[E.key]=E,M.hasData()||o<this._source.maxzoom&&(T[E.key]=E)}this._retainLoadedChildren(T,o,S,c);for(const E of e){let M=this._tiles[E.key];if(M.hasData())continue;if(o+1>this._source.maxzoom){const F=E.children(this._source.maxzoom)[0],V=this.getTile(F);if(V&&V.hasData()){c[F.key]=F;continue}}else{const F=E.children(this._source.maxzoom);if(c[F[0].key]&&c[F[1].key]&&c[F[2].key]&&c[F[3].key])continue}let z=M.wasRequested();for(let F=E.overscaledZ-1;F>=x;--F){const V=E.scaledTo(F);if(p[V.key])break;if(p[V.key]=!0,M=this.getTile(V),!M&&z&&(M=this._addTile(V)),M){const $=M.hasData();if(($||!(!((u=this.map)===null||u===void 0)&&u.cancelPendingTileRequestsWhileZooming)||z)&&(c[V.key]=V),z=M.wasRequested(),$)break}}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const o=[];let u,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){u=this._loadedParentTiles[c.key];break}o.push(c.key);const p=c.scaledTo(c.overscaledZ-1);if(u=this._getLoadedTile(p),u)break;c=p}for(const p of o)this._loadedParentTiles[p]=u}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const o=this._tiles[e].tileID,u=this._getLoadedTile(o);this._loadedSiblingTiles[o.key]=u}}_addTile(e){let o=this._tiles[e.key];if(o)return o;o=this._cache.getAndRemove(e),o&&(this._setTileReloadTimer(e.key,o),o.tileID=e,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,o)));const u=o;return o||(o=new Yi(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(o,e.key,o.state)),o.uses++,this._tiles[e.key]=o,u||this._source.fire(new d.k("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(e,o){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const u=o.getExpiryTimeout();u&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},u))}_removeTile(e){const o=this._tiles[e];o&&(o.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),o.uses>0||(o.hasData()&&o.state!=="reloading"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}_dataHandler(e){const o=e.sourceDataType;e.dataType==="source"&&o==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&o==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,o,u){const c=[],p=this.transform;if(!p)return c;const x=u?p.getCameraQueryGeometry(e):e,S=e.map($=>p.pointCoordinate($,this.terrain)),T=x.map($=>p.pointCoordinate($,this.terrain)),E=this.getIds();let M=1/0,z=1/0,F=-1/0,V=-1/0;for(const $ of T)M=Math.min(M,$.x),z=Math.min(z,$.y),F=Math.max(F,$.x),V=Math.max(V,$.y);for(let $=0;$<E.length;$++){const X=this._tiles[E[$]];if(X.holdingForFade())continue;const Q=X.tileID,ee=Math.pow(2,p.zoom-X.tileID.overscaledZ),se=o*X.queryPadding*d.X/X.tileSize/ee,G=[Q.getTilePoint(new d.Z(M,z)),Q.getTilePoint(new d.Z(F,V))];if(G[0].x-se<d.X&&G[0].y-se<d.X&&G[1].x+se>=0&&G[1].y+se>=0){const le=S.map(me=>Q.getTilePoint(me)),ce=T.map(me=>Q.getTilePoint(me));c.push({tile:X,tileID:Q,queryGeometry:le,cameraQueryGeometry:ce,scale:ee})}}return c}getVisibleCoordinates(e){const o=this.getRenderableIds(e).map(u=>this._tiles[u].tileID);for(const u of o)u.posMatrix=this.transform.calculatePosMatrix(u.toUnwrapped());return o}hasTransition(){if(this._source.hasTransition())return!0;if(Xn(this._source.type)){const e=Z.now();for(const o in this._tiles)if(this._tiles[o].fadeEndTime>=e)return!0}return!1}setFeatureState(e,o,u){this._state.updateState(e=e||"_geojsonTileLayer",o,u)}removeFeatureState(e,o,u){this._state.removeFeatureState(e=e||"_geojsonTileLayer",o,u)}getFeatureState(e,o){return this._state.getState(e=e||"_geojsonTileLayer",o)}setDependencies(e,o,u){const c=this._tiles[e];c&&c.setDependencies(o,u)}reloadTilesForDependencies(e,o){for(const u in this._tiles)this._tiles[u].hasDependency(e,o)&&this._reloadTile(u,"reloading");this._cache.filter(u=>!u.hasDependency(e,o))}}function an(f,e){const o=Math.abs(2*f.wrap)-+(f.wrap<0),u=Math.abs(2*e.wrap)-+(e.wrap<0);return f.overscaledZ-e.overscaledZ||u-o||e.canonical.y-f.canonical.y||e.canonical.x-f.canonical.x}function Xn(f){return f==="raster"||f==="image"||f==="video"}ct.maxOverzooming=10,ct.maxUnderzooming=3;class yt{constructor(e,o){this.reset(e,o)}reset(e,o){this.points=e||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=d.ac(e,0,1);let o=1,u=this._distances[o];const c=e*this.paddedLength+this.padding;for(;u<c&&o<this._distances.length;)u=this._distances[++o];const p=o-1,x=this._distances[p],S=u-x,T=S>0?(c-x)/S:0;return this.points[p].mult(1-T).add(this.points[o].mult(T))}}function _i(f,e){let o=!0;return f==="always"||f!=="never"&&e!=="never"||(o=!1),o}class Li{constructor(e,o,u){const c=this.boxCells=[],p=this.circleCells=[];this.xCellCount=Math.ceil(e/u),this.yCellCount=Math.ceil(o/u);for(let x=0;x<this.xCellCount*this.yCellCount;x++)c.push([]),p.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=o,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,o,u,c,p){this._forEachCell(o,u,c,p,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(c),this.bboxes.push(p)}insertCircle(e,o,u,c){this._forEachCell(o-c,u-c,o+c,u+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(o),this.circles.push(u),this.circles.push(c)}_insertBoxCell(e,o,u,c,p,x){this.boxCells[p].push(x)}_insertCircleCell(e,o,u,c,p,x){this.circleCells[p].push(x)}_query(e,o,u,c,p,x,S){if(u<0||e>this.width||c<0||o>this.height)return[];const T=[];if(e<=0&&o<=0&&this.width<=u&&this.height<=c){if(p)return[{key:null,x1:e,y1:o,x2:u,y2:c}];for(let E=0;E<this.boxKeys.length;E++)T.push({key:this.boxKeys[E],x1:this.bboxes[4*E],y1:this.bboxes[4*E+1],x2:this.bboxes[4*E+2],y2:this.bboxes[4*E+3]});for(let E=0;E<this.circleKeys.length;E++){const M=this.circles[3*E],z=this.circles[3*E+1],F=this.circles[3*E+2];T.push({key:this.circleKeys[E],x1:M-F,y1:z-F,x2:M+F,y2:z+F})}}else this._forEachCell(e,o,u,c,this._queryCell,T,{hitTest:p,overlapMode:x,seenUids:{box:{},circle:{}}},S);return T}query(e,o,u,c){return this._query(e,o,u,c,!1,null)}hitTest(e,o,u,c,p,x){return this._query(e,o,u,c,!0,p,x).length>0}hitTestCircle(e,o,u,c,p){const x=e-u,S=e+u,T=o-u,E=o+u;if(S<0||x>this.width||E<0||T>this.height)return!1;const M=[];return this._forEachCell(x,T,S,E,this._queryCellCircle,M,{hitTest:!0,overlapMode:c,circle:{x:e,y:o,radius:u},seenUids:{box:{},circle:{}}},p),M.length>0}_queryCell(e,o,u,c,p,x,S,T){const{seenUids:E,hitTest:M,overlapMode:z}=S,F=this.boxCells[p];if(F!==null){const $=this.bboxes;for(const X of F)if(!E.box[X]){E.box[X]=!0;const Q=4*X,ee=this.boxKeys[X];if(e<=$[Q+2]&&o<=$[Q+3]&&u>=$[Q+0]&&c>=$[Q+1]&&(!T||T(ee))&&(!M||!_i(z,ee.overlapMode))&&(x.push({key:ee,x1:$[Q],y1:$[Q+1],x2:$[Q+2],y2:$[Q+3]}),M))return!0}}const V=this.circleCells[p];if(V!==null){const $=this.circles;for(const X of V)if(!E.circle[X]){E.circle[X]=!0;const Q=3*X,ee=this.circleKeys[X];if(this._circleAndRectCollide($[Q],$[Q+1],$[Q+2],e,o,u,c)&&(!T||T(ee))&&(!M||!_i(z,ee.overlapMode))){const se=$[Q],G=$[Q+1],le=$[Q+2];if(x.push({key:ee,x1:se-le,y1:G-le,x2:se+le,y2:G+le}),M)return!0}}}return!1}_queryCellCircle(e,o,u,c,p,x,S,T){const{circle:E,seenUids:M,overlapMode:z}=S,F=this.boxCells[p];if(F!==null){const $=this.bboxes;for(const X of F)if(!M.box[X]){M.box[X]=!0;const Q=4*X,ee=this.boxKeys[X];if(this._circleAndRectCollide(E.x,E.y,E.radius,$[Q+0],$[Q+1],$[Q+2],$[Q+3])&&(!T||T(ee))&&!_i(z,ee.overlapMode))return x.push(!0),!0}}const V=this.circleCells[p];if(V!==null){const $=this.circles;for(const X of V)if(!M.circle[X]){M.circle[X]=!0;const Q=3*X,ee=this.circleKeys[X];if(this._circlesCollide($[Q],$[Q+1],$[Q+2],E.x,E.y,E.radius)&&(!T||T(ee))&&!_i(z,ee.overlapMode))return x.push(!0),!0}}}_forEachCell(e,o,u,c,p,x,S,T){const E=this._convertToXCellCoord(e),M=this._convertToYCellCoord(o),z=this._convertToXCellCoord(u),F=this._convertToYCellCoord(c);for(let V=E;V<=z;V++)for(let $=M;$<=F;$++)if(p.call(this,e,o,u,c,this.xCellCount*$+V,x,S,T))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,o,u,c,p,x){const S=c-e,T=p-o,E=u+x;return E*E>S*S+T*T}_circleAndRectCollide(e,o,u,c,p,x,S){const T=(x-c)/2,E=Math.abs(e-(c+T));if(E>T+u)return!1;const M=(S-p)/2,z=Math.abs(o-(p+M));if(z>M+u)return!1;if(E<=T||z<=M)return!0;const F=E-T,V=z-M;return F*F+V*V<=u*u}}function Qi(f,e,o,u,c){const p=d.H();return e?(d.K(p,p,[1/c,1/c,1]),o||d.ad(p,p,u.angle)):d.L(p,u.labelPlaneMatrix,f),p}function vi(f,e,o,u,c){if(e){const p=d.ae(f);return d.K(p,p,[c,c,1]),o||d.ad(p,p,-u.angle),p}return u.glCoordMatrix}function J(f,e,o,u){let c;u?(c=[f,e,u(f,e),1],d.af(c,c,o)):(c=[f,e,0,1],Et(c,c,o));const p=c[3];return{point:new d.P(c[0]/p,c[1]/p),signedDistanceFromCamera:p,isOccluded:!1}}function L(f,e){return .5+f/e*.5}function D(f,e){return f.x>=-e[0]&&f.x<=e[0]&&f.y>=-e[1]&&f.y<=e[1]}function j(f,e,o,u,c,p,x,S,T,E,M,z,F,V,$){const X=u?f.textSizeData:f.iconSizeData,Q=d.ag(X,o.transform.zoom),ee=[256/o.width*2+1,256/o.height*2+1],se=u?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;se.clear();const G=f.lineVertexArray,le=u?f.text.placedSymbolArray:f.icon.placedSymbolArray,ce=o.transform.width/o.transform.height;let me=!1;for(let Ie=0;Ie<le.length;Ie++){const Ae=le.get(Ie);if(Ae.hidden||Ae.writingMode===d.ah.vertical&&!me){st(Ae.numGlyphs,se);continue}me=!1;const Ve=J(Ae.anchorX,Ae.anchorY,e,$);if(!D(Ve.point,ee)){st(Ae.numGlyphs,se);continue}const Ge=L(o.transform.cameraToCenterDistance,Ve.signedDistanceFromCamera),Be=d.ai(X,Q,Ae),Fe=x?Be/Ge:Be*Ge,Ye={getElevation:$,labelPlaneMatrix:c,lineVertexArray:G,pitchWithMap:x,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:E,tileAnchorPoint:new d.P(Ae.anchorX,Ae.anchorY),unwrappedTileID:M,width:z,height:F,translation:V},pt=ue(Ye,Ae,Fe,!1,S,e,p,f.glyphOffsetArray,se,ce,T);me=pt.useVertical,(pt.notEnoughRoom||me||pt.needsFlipping&&ue(Ye,Ae,Fe,!0,S,e,p,f.glyphOffsetArray,se,ce,T).notEnoughRoom)&&st(Ae.numGlyphs,se)}u?f.text.dynamicLayoutVertexBuffer.updateData(se):f.icon.dynamicLayoutVertexBuffer.updateData(se)}function W(f,e,o,u,c,p,x,S){const T=p.glyphStartIndex+p.numGlyphs,E=p.lineStartIndex,M=p.lineStartIndex+p.lineLength,z=e.getoffsetX(p.glyphStartIndex),F=e.getoffsetX(T-1),V=Re(f*z,o,u,c,p.segment,E,M,S,x);if(!V)return null;const $=Re(f*F,o,u,c,p.segment,E,M,S,x);return $?S.projectionCache.anyProjectionOccluded?null:{first:V,last:$}:null}function ae(f,e,o,u){return f===d.ah.horizontal&&Math.abs(o.y-e.y)>Math.abs(o.x-e.x)*u?{useVertical:!0}:(f===d.ah.vertical?e.y<o.y:e.x>o.x)?{needsFlipping:!0}:null}function ue(f,e,o,u,c,p,x,S,T,E,M){const z=o/24,F=e.lineOffsetX*z,V=e.lineOffsetY*z;let $;if(e.numGlyphs>1){const X=e.glyphStartIndex+e.numGlyphs,Q=e.lineStartIndex,ee=e.lineStartIndex+e.lineLength,se=W(z,S,F,V,u,e,M,f);if(!se)return{notEnoughRoom:!0};const G=J(se.first.point.x,se.first.point.y,x,f.getElevation).point,le=J(se.last.point.x,se.last.point.y,x,f.getElevation).point;if(c&&!u){const ce=ae(e.writingMode,G,le,E);if(ce)return ce}$=[se.first];for(let ce=e.glyphStartIndex+1;ce<X-1;ce++)$.push(Re(z*S.getoffsetX(ce),F,V,u,e.segment,Q,ee,f,M));$.push(se.last)}else{if(c&&!u){const Q=J(f.tileAnchorPoint.x,f.tileAnchorPoint.y,p,f.getElevation).point,ee=e.lineStartIndex+e.segment+1,se=new d.P(f.lineVertexArray.getx(ee),f.lineVertexArray.gety(ee)),G=J(se.x,se.y,p,f.getElevation),le=G.signedDistanceFromCamera>0?G.point:function(me,Ie,Ae,Ve,Ge,Be){return pe(me,Ie,Ae,1,Ge,Be)}(f.tileAnchorPoint,se,Q,0,p,f),ce=ae(e.writingMode,Q,le,E);if(ce)return ce}const X=Re(z*S.getoffsetX(e.glyphStartIndex),F,V,u,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,f,M);if(!X||f.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};$=[X]}for(const X of $)d.aj(T,X.point,X.angle);return{}}function pe(f,e,o,u,c,p){const x=f.add(f.sub(e)._unit()),S=c!==void 0?J(x.x,x.y,c,p.getElevation).point:we(x.x,x.y,p).point,T=o.sub(S);return o.add(T._mult(u/T.mag()))}function ie(f,e,o){const u=e.projectionCache;if(u.projections[f])return u.projections[f];const c=new d.P(e.lineVertexArray.getx(f),e.lineVertexArray.gety(f)),p=we(c.x,c.y,e);if(p.signedDistanceFromCamera>0)return u.projections[f]=p.point,u.anyProjectionOccluded=u.anyProjectionOccluded||p.isOccluded,p.point;const x=f-o.direction;return function(S,T,E,M,z){return pe(S,T,E,M,void 0,z)}(o.distanceFromAnchor===0?e.tileAnchorPoint:new d.P(e.lineVertexArray.getx(x),e.lineVertexArray.gety(x)),c,o.previousVertex,o.absOffsetX-o.distanceFromAnchor+1,e)}function we(f,e,o){const u=f+o.translation[0],c=e+o.translation[1];let p;return!o.pitchWithMap&&o.projection.useSpecialProjectionForSymbols?(p=o.projection.projectTileCoordinates(u,c,o.unwrappedTileID,o.getElevation),p.point.x=(.5*p.point.x+.5)*o.width,p.point.y=(.5*-p.point.y+.5)*o.height):(p=J(u,c,o.labelPlaneMatrix,o.getElevation),p.isOccluded=!1),p}function Ee(f,e,o){return f._unit()._perp()._mult(e*o)}function _e(f,e,o,u,c,p,x,S,T){if(S.projectionCache.offsets[f])return S.projectionCache.offsets[f];const E=o.add(e);if(f+T.direction<u||f+T.direction>=c)return S.projectionCache.offsets[f]=E,E;const M=ie(f+T.direction,S,T),z=Ee(M.sub(o),x,T.direction),F=o.add(z),V=M.add(z);return S.projectionCache.offsets[f]=d.ak(p,E,F,V)||E,S.projectionCache.offsets[f]}function Re(f,e,o,u,c,p,x,S,T){const E=u?f-e:f+e;let M=E>0?1:-1,z=0;u&&(M*=-1,z=Math.PI),M<0&&(z+=Math.PI);let F,V=M>0?p+c:p+c+1;S.projectionCache.cachedAnchorPoint?F=S.projectionCache.cachedAnchorPoint:(F=we(S.tileAnchorPoint.x,S.tileAnchorPoint.y,S).point,S.projectionCache.cachedAnchorPoint=F);let $,X,Q=F,ee=F,se=0,G=0;const le=Math.abs(E),ce=[];let me;for(;se+G<=le;){if(V+=M,V<p||V>=x)return null;se+=G,ee=Q,X=$;const Ve={absOffsetX:le,direction:M,distanceFromAnchor:se,previousVertex:ee};if(Q=ie(V,S,Ve),o===0)ce.push(ee),me=Q.sub(ee);else{let Ge;const Be=Q.sub(ee);Ge=Be.mag()===0?Ee(ie(V+M,S,Ve).sub(Q),o,M):Ee(Be,o,M),X||(X=ee.add(Ge)),$=_e(V,Ge,Q,p,x,X,o,S,Ve),ce.push(X),me=$.sub(X)}G=me.mag()}const Ie=me._mult((le-se)/G)._add(X||ee),Ae=z+Math.atan2(Q.y-ee.y,Q.x-ee.x);return ce.push(Ie),{point:Ie,angle:T?Ae:0,path:ce}}const nt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function st(f,e){for(let o=0;o<f;o++){const u=e.length;e.resize(u+4),e.float32.set(nt,3*u)}}function Et(f,e,o){const u=e[0],c=e[1];return f[0]=o[0]*u+o[4]*c+o[12],f[1]=o[1]*u+o[5]*c+o[13],f[3]=o[3]*u+o[7]*c+o[15],f}const _t=100;class Pt{constructor(e,o,u=new Li(e.width+200,e.height+200,25),c=new Li(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=o,this.grid=u,this.ignoredGrid=c,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+_t,this.screenBottomBoundary=e.height+_t,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,o,u,c,p,x,S,T,E,M,z){const F=e.anchorPointX+T[0],V=e.anchorPointY+T[1],$=this.projectAndGetPerspectiveRatio(c,F,V,p,M),X=u*$.perspectiveRatio;let Q;if(x||S)Q=this._projectCollisionBox(e,X,c,p,x,S,T,$,M,z);else{const ce=$.point.x+(z?z.x*X:0),me=$.point.y+(z?z.y*X:0);Q={allPointsOccluded:!1,box:[ce+e.x1*X,me+e.y1*X,ce+e.x2*X,me+e.y2*X]}}const[ee,se,G,le]=Q.box;return this.mapProjection.useSpecialProjectionForSymbols&&(x?Q.allPointsOccluded:this.mapProjection.isOccluded(F,V,p))||$.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(ee,se,G,le)||o!=="always"&&this.grid.hitTest(ee,se,G,le,o,E)?{box:[ee,se,G,le],placeable:!1,offscreen:!1}:{box:[ee,se,G,le],placeable:!0,offscreen:this.isOffscreen(ee,se,G,le)}}placeCollisionCircles(e,o,u,c,p,x,S,T,E,M,z,F,V,$,X,Q){const ee=[],se=new d.P(o.anchorX,o.anchorY),G=this.getPerspectiveRatio(x,se.x,se.y,S,Q),le=(z?p/G:p*G)/d.ap,ce={getElevation:Q,labelPlaneMatrix:T,lineVertexArray:u,pitchWithMap:z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:se,unwrappedTileID:S,width:this.transform.width,height:this.transform.height,translation:X},me=W(le,c,o.lineOffsetX*le,o.lineOffsetY*le,!1,o,!1,ce);let Ie=!1,Ae=!1,Ve=!0;if(me){const Ge=.5*V*G+$,Be=new d.P(-100,-100),Fe=new d.P(this.screenRightBoundary,this.screenBottomBoundary),Ye=new yt,pt=me.first,Ne=me.last;let Ze=[];for(let vt=pt.path.length-1;vt>=1;vt--)Ze.push(pt.path[vt]);for(let vt=1;vt<Ne.path.length;vt++)Ze.push(Ne.path[vt]);const ht=2.5*Ge;if(E){const vt=this.projectPathToScreenSpace(Ze,ce,E);Ze=vt.some(kt=>kt.signedDistanceFromCamera<=0)?[]:vt.map(kt=>kt.point)}let Xt=[];if(Ze.length>0){const vt=Ze[0].clone(),kt=Ze[0].clone();for(let Kt=1;Kt<Ze.length;Kt++)vt.x=Math.min(vt.x,Ze[Kt].x),vt.y=Math.min(vt.y,Ze[Kt].y),kt.x=Math.max(kt.x,Ze[Kt].x),kt.y=Math.max(kt.y,Ze[Kt].y);Xt=vt.x>=Be.x&&kt.x<=Fe.x&&vt.y>=Be.y&&kt.y<=Fe.y?[Ze]:kt.x<Be.x||vt.x>Fe.x||kt.y<Be.y||vt.y>Fe.y?[]:d.al([Ze],Be.x,Be.y,Fe.x,Fe.y)}for(const vt of Xt){Ye.reset(vt,.25*Ge);let kt=0;kt=Ye.length<=.5*Ge?1:Math.ceil(Ye.paddedLength/ht)+1;for(let Kt=0;Kt<kt;Kt++){const Or=Kt/Math.max(kt-1,1),ti=Ye.lerp(Or),Jt=ti.x+_t,cn=ti.y+_t;ee.push(Jt,cn,Ge,0);const Xr=Jt-Ge,Nr=cn-Ge,Kr=Jt+Ge,Si=cn+Ge;if(Ve=Ve&&this.isOffscreen(Xr,Nr,Kr,Si),Ae=Ae||this.isInsideGrid(Xr,Nr,Kr,Si),e!=="always"&&this.grid.hitTestCircle(Jt,cn,Ge,e,F)&&(Ie=!0,!M))return{circles:[],offscreen:!1,collisionDetected:Ie}}}}return{circles:!M&&Ie||!Ae||G<this.perspectiveRatioCutoff?[]:ee,offscreen:Ve,collisionDetected:Ie}}projectPathToScreenSpace(e,o,u){return e.map(c=>J(c.x,c.y,u,o.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let u=1/0,c=1/0,p=-1/0,x=-1/0;for(const M of e){const z=new d.P(M.x+_t,M.y+_t);u=Math.min(u,z.x),c=Math.min(c,z.y),p=Math.max(p,z.x),x=Math.max(x,z.y),o.push(z)}const S=this.grid.query(u,c,p,x).concat(this.ignoredGrid.query(u,c,p,x)),T={},E={};for(const M of S){const z=M.key;if(T[z.bucketInstanceId]===void 0&&(T[z.bucketInstanceId]={}),T[z.bucketInstanceId][z.featureIndex])continue;const F=[new d.P(M.x1,M.y1),new d.P(M.x2,M.y1),new d.P(M.x2,M.y2),new d.P(M.x1,M.y2)];d.am(o,F)&&(T[z.bucketInstanceId][z.featureIndex]=!0,E[z.bucketInstanceId]===void 0&&(E[z.bucketInstanceId]=[]),E[z.bucketInstanceId].push(z.featureIndex))}return E}insertCollisionBox(e,o,u,c,p,x){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:p,collisionGroupID:x,overlapMode:o},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,o,u,c,p,x){const S=u?this.ignoredGrid:this.grid,T={bucketInstanceId:c,featureIndex:p,collisionGroupID:x,overlapMode:o};for(let E=0;E<e.length;E+=4)S.insertCircle(T,e[E],e[E+1],e[E+2])}projectAndGetPerspectiveRatio(e,o,u,c,p){let x;p?(x=[o,u,p(o,u),1],d.af(x,x,e)):(x=[o,u,0,1],Et(x,x,e));const S=x[3];return{point:new d.P((x[0]/S+1)/2*this.transform.width+_t,(-x[1]/S+1)/2*this.transform.height+_t),perspectiveRatio:.5+this.transform.cameraToCenterDistance/S*.5,isOccluded:!1,signedDistanceFromCamera:S}}getPerspectiveRatio(e,o,u,c,p){const x=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(o,u,c,p):J(o,u,e,p);return .5+this.transform.cameraToCenterDistance/x.signedDistanceFromCamera*.5}isOffscreen(e,o,u,c){return u<_t||e>=this.screenRightBoundary||c<_t||o>this.screenBottomBoundary}isInsideGrid(e,o,u,c){return u>=0&&e<this.gridRightBoundary&&c>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const e=d.an([]);return d.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,o,u,c,p,x,S,T,E,M){let z=new d.P(1,0),F=new d.P(0,1);const V=new d.P(e.anchorPointX+S[0],e.anchorPointY+S[1]);if(x&&!p){const Ve=this.projectAndGetPerspectiveRatio(u,V.x+1,V.y,c,E).point.sub(T.point).unit(),Ge=Math.atan(Ve.y/Ve.x)+(Ve.x<0?Math.PI:0),Be=Math.sin(Ge),Fe=Math.cos(Ge);z=new d.P(Fe,Be),F=new d.P(-Be,Fe)}else if(!x&&p){const Ve=-this.transform.angle,Ge=Math.sin(Ve),Be=Math.cos(Ve);z=new d.P(Be,Ge),F=new d.P(-Ge,Be)}let $=T.point,X=o;if(p){$=V;const Ve=this.transform.zoom-Math.floor(this.transform.zoom);X=Math.pow(2,-Ve),X*=this.mapProjection.getPitchedTextCorrection(this.transform,V,c),M||(X*=d.ac(.5+T.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}M&&($=$.add(z.mult(M.x*X)).add(F.mult(M.y*X)));const Q=e.x1*X,ee=e.x2*X,se=(Q+ee)/2,G=e.y1*X,le=e.y2*X,ce=(G+le)/2,me=[{offsetX:Q,offsetY:G},{offsetX:se,offsetY:G},{offsetX:ee,offsetY:G},{offsetX:ee,offsetY:ce},{offsetX:ee,offsetY:le},{offsetX:se,offsetY:le},{offsetX:Q,offsetY:le},{offsetX:Q,offsetY:ce}];let Ie=[];for(const{offsetX:Ve,offsetY:Ge}of me)Ie.push(new d.P($.x+z.x*Ve+F.x*Ge,$.y+z.y*Ve+F.y*Ge));let Ae=!1;if(p){const Ve=Ie.map(Ge=>this.projectAndGetPerspectiveRatio(u,Ge.x,Ge.y,c,E));Ae=Ve.some(Ge=>!Ge.isOccluded),Ie=Ve.map(Ge=>Ge.point)}else Ae=!0;return{box:d.ao(Ie),allPointsOccluded:!Ae}}}function St(f,e,o){return e*(d.X/(f.tileSize*Math.pow(2,o-f.tileID.overscaledZ)))}class yr{constructor(e,o,u,c){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?o:-o))):c&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class rr{constructor(e,o,u,c,p){this.text=new yr(e?e.text:null,o,u,p),this.icon=new yr(e?e.icon:null,o,c,p)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class wt{constructor(e,o,u){this.text=e,this.icon=o,this.skipFade=u}}class Ot{constructor(){this.invProjMatrix=d.H(),this.viewportMatrix=d.H(),this.circles=[]}}class Qt{constructor(e,o,u,c,p){this.bucketInstanceId=e,this.featureIndex=o,this.sourceLayerIndex=u,this.bucketIndex=c,this.tileID=p}}class Tr{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const o=++this.maxGroupID;this.collisionGroups[e]={ID:o,predicate:u=>u.collisionGroupID===o}}return this.collisionGroups[e]}}function Mr(f,e,o,u,c){const{horizontalAlign:p,verticalAlign:x}=d.au(f);return new d.P(-(p-.5)*e+u[0]*c,-(x-.5)*o+u[1]*c)}class Wr{constructor(e,o,u,c,p,x){this.transform=e.clone(),this.terrain=u,this.collisionIndex=new Pt(this.transform,o),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Tr(p),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const o=this.terrain;return o?(u,c)=>o.getElevation(e,u,c):null}getBucketParts(e,o,u,c){const p=u.getBucket(o),x=u.latestFeatureIndex;if(!p||!x||o.id!==p.layerIds[0])return;const S=u.collisionBoxArray,T=p.layers[0].layout,E=p.layers[0].paint,M=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),z=u.tileSize/d.X,F=u.tileID.toUnwrapped(),V=this.transform.calculatePosMatrix(F),$=T.get("text-pitch-alignment")==="map",X=T.get("text-rotation-alignment")==="map",Q=St(u,1,this.transform.zoom),ee=this.collisionIndex.mapProjection.translatePosition(this.transform,u,E.get("text-translate"),E.get("text-translate-anchor")),se=this.collisionIndex.mapProjection.translatePosition(this.transform,u,E.get("icon-translate"),E.get("icon-translate-anchor")),G=Qi(V,$,X,this.transform,Q);let le=null;if($){const me=vi(V,$,X,this.transform,Q);le=d.L([],this.transform.labelPlaneMatrix,me)}this.retainedQueryData[p.bucketInstanceId]=new Qt(p.bucketInstanceId,x,p.sourceLayerIndex,p.index,u.tileID);const ce={bucket:p,layout:T,translationText:ee,translationIcon:se,posMatrix:V,unwrappedTileID:F,textLabelPlaneMatrix:G,labelToScreenMatrix:le,scale:M,textPixelRatio:z,holdingForFade:u.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:d.ag(p.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(p.sourceID)};if(c)for(const me of p.sortKeyRanges){const{sortKey:Ie,symbolInstanceStart:Ae,symbolInstanceEnd:Ve}=me;e.push({sortKey:Ie,symbolInstanceStart:Ae,symbolInstanceEnd:Ve,parameters:ce})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:p.symbolInstances.length,parameters:ce})}attemptAnchorPlacement(e,o,u,c,p,x,S,T,E,M,z,F,V,$,X,Q,ee,se,G){const le=d.aq[e.textAnchor],ce=[e.textOffset0,e.textOffset1],me=Mr(le,u,c,ce,p),Ie=this.collisionIndex.placeCollisionBox(o,F,T,E,M,S,x,Q,z.predicate,G,me);if((!se||this.collisionIndex.placeCollisionBox(se,F,T,E,M,S,x,ee,z.predicate,G,me).placeable)&&Ie.placeable){let Ae;if(this.prevPlacement&&this.prevPlacement.variableOffsets[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID].text&&(Ae=this.prevPlacement.variableOffsets[V.crossTileID].anchor),V.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[V.crossTileID]={textOffset:ce,width:u,height:c,anchor:le,textBoxScale:p,prevAnchor:Ae},this.markUsedJustification($,le,V,X),$.allowVerticalPlacement&&(this.markUsedOrientation($,X,V),this.placedOrientations[V.crossTileID]=X),{shift:me,placedGlyphBoxes:Ie}}}placeLayerBucketPart(e,o,u){const{bucket:c,layout:p,translationText:x,translationIcon:S,posMatrix:T,unwrappedTileID:E,textLabelPlaneMatrix:M,labelToScreenMatrix:z,textPixelRatio:F,holdingForFade:V,collisionBoxArray:$,partiallyEvaluatedTextSize:X,collisionGroup:Q}=e.parameters,ee=p.get("text-optional"),se=p.get("icon-optional"),G=d.ar(p,"text-overlap","text-allow-overlap"),le=G==="always",ce=d.ar(p,"icon-overlap","icon-allow-overlap"),me=ce==="always",Ie=p.get("text-rotation-alignment")==="map",Ae=p.get("text-pitch-alignment")==="map",Ve=p.get("icon-text-fit")!=="none",Ge=p.get("symbol-z-order")==="viewport-y",Be=le&&(me||!c.hasIconData()||se),Fe=me&&(le||!c.hasTextData()||ee);!c.collisionArrays&&$&&c.deserializeCollisionBoxes($);const Ye=this._getTerrainElevationFunc(this.retainedQueryData[c.bucketInstanceId].tileID),pt=(Ne,Ze,ht)=>{var Xt,vt;if(o[Ne.crossTileID])return;if(V)return void(this.placements[Ne.crossTileID]=new wt(!1,!1,!1));let kt=!1,Kt=!1,Or=!0,ti=null,Jt={box:null,placeable:!1,offscreen:null},cn={placeable:!1},Xr=null,Nr=null,Kr=null,Si=0,yo=0,bl=0;Ze.textFeatureIndex?Si=Ze.textFeatureIndex:Ne.useRuntimeCollisionCircles&&(Si=Ne.featureIndex),Ze.verticalTextFeatureIndex&&(yo=Ze.verticalTextFeatureIndex);const _o=Ze.textBox;if(_o){const Nn=zr=>{let jr=d.ah.horizontal;if(c.allowVerticalPlacement&&!zr&&this.prevPlacement){const In=this.prevPlacement.placedOrientations[Ne.crossTileID];In&&(this.placedOrientations[Ne.crossTileID]=In,jr=In,this.markUsedOrientation(c,jr,Ne))}return jr},jn=(zr,jr)=>{if(c.allowVerticalPlacement&&Ne.numVerticalGlyphVertices>0&&Ze.verticalTextBox){for(const In of c.writingModes)if(In===d.ah.vertical?(Jt=jr(),cn=Jt):Jt=zr(),Jt&&Jt.placeable)break}else Jt=zr()},rs=Ne.textAnchorOffsetStartIndex,ri=Ne.textAnchorOffsetEndIndex;if(ri===rs){const zr=(jr,In)=>{const It=this.collisionIndex.placeCollisionBox(jr,G,F,T,E,Ae,Ie,x,Q.predicate,Ye);return It&&It.placeable&&(this.markUsedOrientation(c,In,Ne),this.placedOrientations[Ne.crossTileID]=In),It};jn(()=>zr(_o,d.ah.horizontal),()=>{const jr=Ze.verticalTextBox;return c.allowVerticalPlacement&&Ne.numVerticalGlyphVertices>0&&jr?zr(jr,d.ah.vertical):{box:null,offscreen:null}}),Nn(Jt&&Jt.placeable)}else{let zr=d.aq[(vt=(Xt=this.prevPlacement)===null||Xt===void 0?void 0:Xt.variableOffsets[Ne.crossTileID])===null||vt===void 0?void 0:vt.anchor];const jr=(It,Es,vo)=>{const xo=It.x2-It.x1,Jh=It.y2-It.y1,vf=Ne.textBoxScale,Yh=Ve&&ce==="never"?Es:null;let ns=null,Qh=G==="never"?1:2,kl="never";zr&&Qh++;for(let xa=0;xa<Qh;xa++){for(let Tl=rs;Tl<ri;Tl++){const Il=c.textAnchorOffsets.get(Tl);if(zr&&Il.textAnchor!==zr)continue;const wo=this.attemptAnchorPlacement(Il,It,xo,Jh,vf,Ie,Ae,F,T,E,Q,kl,Ne,c,vo,x,S,Yh,Ye);if(wo&&(ns=wo.placedGlyphBoxes,ns&&ns.placeable))return kt=!0,ti=wo.shift,ns}zr?zr=null:kl=G}return u&&!ns&&(ns={box:this.collisionIndex.placeCollisionBox(_o,"always",F,T,E,Ae,Ie,x,Q.predicate,Ye,new d.P(0,0)).box,offscreen:!1,placeable:!1}),ns};jn(()=>jr(_o,Ze.iconBox,d.ah.horizontal),()=>{const It=Ze.verticalTextBox;return c.allowVerticalPlacement&&(!Jt||!Jt.placeable)&&Ne.numVerticalGlyphVertices>0&&It?jr(It,Ze.verticalIconBox,d.ah.vertical):{box:null,occluded:!0,offscreen:null}}),Jt&&(kt=Jt.placeable,Or=Jt.offscreen);const In=Nn(Jt&&Jt.placeable);if(!kt&&this.prevPlacement){const It=this.prevPlacement.variableOffsets[Ne.crossTileID];It&&(this.variableOffsets[Ne.crossTileID]=It,this.markUsedJustification(c,It.anchor,Ne,In))}}}if(Xr=Jt,kt=Xr&&Xr.placeable,Or=Xr&&Xr.offscreen,Ne.useRuntimeCollisionCircles){const Nn=c.text.placedSymbolArray.get(Ne.centerJustifiedTextSymbolIndex),jn=d.ai(c.textSizeData,X,Nn),rs=p.get("text-padding");Nr=this.collisionIndex.placeCollisionCircles(G,Nn,c.lineVertexArray,c.glyphOffsetArray,jn,T,E,M,z,u,Ae,Q.predicate,Ne.collisionCircleDiameter,rs,x,Ye),Nr.circles.length&&Nr.collisionDetected&&!u&&d.w("Collisions detected, but collision boxes are not shown"),kt=le||Nr.circles.length>0&&!Nr.collisionDetected,Or=Or&&Nr.offscreen}if(Ze.iconFeatureIndex&&(bl=Ze.iconFeatureIndex),Ze.iconBox){const Nn=jn=>this.collisionIndex.placeCollisionBox(jn,ce,F,T,E,Ae,Ie,S,Q.predicate,Ye,Ve&&ti?ti:void 0);cn&&cn.placeable&&Ze.verticalIconBox?(Kr=Nn(Ze.verticalIconBox),Kt=Kr.placeable):(Kr=Nn(Ze.iconBox),Kt=Kr.placeable),Or=Or&&Kr.offscreen}const On=ee||Ne.numHorizontalGlyphVertices===0&&Ne.numVerticalGlyphVertices===0,Sl=se||Ne.numIconVertices===0;On||Sl?Sl?On||(Kt=Kt&&kt):kt=Kt&&kt:Kt=kt=Kt&&kt;const ic=Kt&&Kr.placeable;if(kt&&Xr.placeable&&this.collisionIndex.insertCollisionBox(Xr.box,G,p.get("text-ignore-placement"),c.bucketInstanceId,cn&&cn.placeable&&yo?yo:Si,Q.ID),ic&&this.collisionIndex.insertCollisionBox(Kr.box,ce,p.get("icon-ignore-placement"),c.bucketInstanceId,bl,Q.ID),Nr&&kt&&this.collisionIndex.insertCollisionCircles(Nr.circles,G,p.get("text-ignore-placement"),c.bucketInstanceId,Si,Q.ID),u&&this.storeCollisionData(c.bucketInstanceId,ht,Ze,Xr,Kr,Nr),Ne.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(c.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ne.crossTileID]=new wt(kt||Be,Kt||Fe,Or||c.justReloaded),o[Ne.crossTileID]=!0};if(Ge){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ne=c.getSortedSymbolIndexes(this.transform.angle);for(let Ze=Ne.length-1;Ze>=0;--Ze){const ht=Ne[Ze];pt(c.symbolInstances.get(ht),c.collisionArrays[ht],ht)}}else for(let Ne=e.symbolInstanceStart;Ne<e.symbolInstanceEnd;Ne++)pt(c.symbolInstances.get(Ne),c.collisionArrays[Ne],Ne);if(u&&c.bucketInstanceId in this.collisionCircleArrays){const Ne=this.collisionCircleArrays[c.bucketInstanceId];d.as(Ne.invProjMatrix,T),Ne.viewportMatrix=this.collisionIndex.getViewportMatrix()}c.justReloaded=!1}storeCollisionData(e,o,u,c,p,x){if(u.textBox||u.iconBox){let S,T;this.collisionBoxArrays.has(e)?S=this.collisionBoxArrays.get(e):(S=new Map,this.collisionBoxArrays.set(e,S)),S.has(o)?T=S.get(o):(T={text:null,icon:null},S.set(o,T)),u.textBox&&(T.text=c.box),u.iconBox&&(T.icon=p.box)}if(x){let S=this.collisionCircleArrays[e];S===void 0&&(S=this.collisionCircleArrays[e]=new Ot);for(let T=0;T<x.circles.length;T+=4)S.circles.push(x.circles[T+0]),S.circles.push(x.circles[T+1]),S.circles.push(x.circles[T+2]),S.circles.push(x.collisionDetected?1:0)}}markUsedJustification(e,o,u,c){let p;p=c===d.ah.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[d.at(o)];const x=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const S of x)S>=0&&(e.text.placedSymbolArray.get(S).crossTileID=p>=0&&S!==p?0:u.crossTileID)}markUsedOrientation(e,o,u){const c=o===d.ah.horizontal||o===d.ah.horizontalOnly?o:0,p=o===d.ah.vertical?o:0,x=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const S of x)e.text.placedSymbolArray.get(S).placedOrientation=c;u.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=p)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let u=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const c=o?o.symbolFadeChange(e):1,p=o?o.opacities:{},x=o?o.variableOffsets:{},S=o?o.placedOrientations:{};for(const T in this.placements){const E=this.placements[T],M=p[T];M?(this.opacities[T]=new rr(M,c,E.text,E.icon),u=u||E.text!==M.text.placed||E.icon!==M.icon.placed):(this.opacities[T]=new rr(null,c,E.text,E.icon,E.skipFade),u=u||E.text||E.icon)}for(const T in p){const E=p[T];if(!this.opacities[T]){const M=new rr(E,c,!1,!1);M.isHidden()||(this.opacities[T]=M,u=u||E.text.placed||E.icon.placed)}}for(const T in x)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=x[T]);for(const T in S)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=S[T]);if(o&&o.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:e)}updateLayerOpacities(e,o){const u={};for(const c of o){const p=c.getBucket(e);p&&c.latestFeatureIndex&&e.id===p.layerIds[0]&&this.updateBucketOpacities(p,c.tileID,u,c.collisionBoxArray)}}updateBucketOpacities(e,o,u,c){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const p=e.layers[0],x=p.layout,S=new rr(null,0,!1,!1,!0),T=x.get("text-allow-overlap"),E=x.get("icon-allow-overlap"),M=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),z=x.get("text-rotation-alignment")==="map",F=x.get("text-pitch-alignment")==="map",V=x.get("icon-text-fit")!=="none",$=new rr(null,0,T&&(E||!e.hasIconData()||x.get("icon-optional")),E&&(T||!e.hasTextData()||x.get("text-optional")),!0);!e.collisionArrays&&c&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(c);const X=(ee,se,G)=>{for(let le=0;le<se/4;le++)ee.opacityVertexArray.emplaceBack(G);ee.hasVisibleVertices=ee.hasVisibleVertices||G!==Ks},Q=this.collisionBoxArrays.get(e.bucketInstanceId);for(let ee=0;ee<e.symbolInstances.length;ee++){const se=e.symbolInstances.get(ee),{numHorizontalGlyphVertices:G,numVerticalGlyphVertices:le,crossTileID:ce}=se;let me=this.opacities[ce];u[ce]?me=S:me||(me=$,this.opacities[ce]=me),u[ce]=!0;const Ie=se.numIconVertices>0,Ae=this.placedOrientations[se.crossTileID],Ve=Ae===d.ah.vertical,Ge=Ae===d.ah.horizontal||Ae===d.ah.horizontalOnly;if(G>0||le>0){const Fe=Sn(me.text);X(e.text,G,Ve?Ks:Fe),X(e.text,le,Ge?Ks:Fe);const Ye=me.text.isHidden();[se.rightJustifiedTextSymbolIndex,se.centerJustifiedTextSymbolIndex,se.leftJustifiedTextSymbolIndex].forEach(Ze=>{Ze>=0&&(e.text.placedSymbolArray.get(Ze).hidden=Ye||Ve?1:0)}),se.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(se.verticalPlacedTextSymbolIndex).hidden=Ye||Ge?1:0);const pt=this.variableOffsets[se.crossTileID];pt&&this.markUsedJustification(e,pt.anchor,se,Ae);const Ne=this.placedOrientations[se.crossTileID];Ne&&(this.markUsedJustification(e,"left",se,Ne),this.markUsedOrientation(e,Ne,se))}if(Ie){const Fe=Sn(me.icon),Ye=!(V&&se.verticalPlacedIconSymbolIndex&&Ve);se.placedIconSymbolIndex>=0&&(X(e.icon,se.numIconVertices,Ye?Fe:Ks),e.icon.placedSymbolArray.get(se.placedIconSymbolIndex).hidden=me.icon.isHidden()),se.verticalPlacedIconSymbolIndex>=0&&(X(e.icon,se.numVerticalIconVertices,Ye?Ks:Fe),e.icon.placedSymbolArray.get(se.verticalPlacedIconSymbolIndex).hidden=me.icon.isHidden())}const Be=Q&&Q.has(ee)?Q.get(ee):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Fe=e.collisionArrays[ee];if(Fe){let Ye=new d.P(0,0);if(Fe.textBox||Fe.verticalTextBox){let pt=!0;if(M){const Ne=this.variableOffsets[ce];Ne?(Ye=Mr(Ne.anchor,Ne.width,Ne.height,Ne.textOffset,Ne.textBoxScale),z&&Ye._rotate(F?this.transform.angle:-this.transform.angle)):pt=!1}if(Fe.textBox||Fe.verticalTextBox){let Ne;Fe.textBox&&(Ne=Ve),Fe.verticalTextBox&&(Ne=Ge),Xs(e.textCollisionBox.collisionVertexArray,me.text.placed,!pt||Ne,Be.text,Ye.x,Ye.y)}}if(Fe.iconBox||Fe.verticalIconBox){const pt=!!(!Ge&&Fe.verticalIconBox);let Ne;Fe.iconBox&&(Ne=pt),Fe.verticalIconBox&&(Ne=!pt),Xs(e.iconCollisionBox.collisionVertexArray,me.icon.placed,Ne,Be.icon,V?Ye.x:0,V?Ye.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const ee=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=ee.invProjMatrix,e.placementViewportMatrix=ee.viewportMatrix,e.collisionCircleArray=ee.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,o){const u=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*u>e}setStale(){this.stale=!0}}function Xs(f,e,o,u,c,p){u&&u.length!==0||(u=[0,0,0,0]);const x=u[0]-_t,S=u[1]-_t,T=u[2]-_t,E=u[3]-_t;f.emplaceBack(e?1:0,o?1:0,c||0,p||0,x,S),f.emplaceBack(e?1:0,o?1:0,c||0,p||0,T,S),f.emplaceBack(e?1:0,o?1:0,c||0,p||0,T,E),f.emplaceBack(e?1:0,o?1:0,c||0,p||0,x,E)}const Nt=Math.pow(2,25),mu=Math.pow(2,24),gu=Math.pow(2,17),wn=Math.pow(2,16),bn=Math.pow(2,9),Gp=Math.pow(2,8),Ln=Math.pow(2,1);function Sn(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const e=f.placed?1:0,o=Math.floor(127*f.opacity);return o*Nt+e*mu+o*gu+e*wn+o*bn+e*Gp+o*Ln+e}const Ks=0;function gs(){return{isOccluded:(f,e,o)=>!1,getPitchedTextCorrection:(f,e,o)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(f,e,o,u){throw new Error("Not implemented.")},translatePosition:(f,e,o,u)=>function(c,p,x,S,T=!1){if(!x[0]&&!x[1])return[0,0];const E=T?S==="map"?c.angle:0:S==="viewport"?-c.angle:0;if(E){const M=Math.sin(E),z=Math.cos(E);x=[x[0]*z-x[1]*M,x[0]*M+x[1]*z]}return[T?x[0]:St(p,x[0],c.zoom),T?x[1]:St(p,x[1],c.zoom)]}(f,e,o,u),getCircleRadiusCorrection:f=>1}}class _r{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,o,u,c,p){const x=this._bucketParts;for(;this._currentTileIndex<e.length;)if(o.getBucketParts(x,c,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,p())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((S,T)=>S.sortKey-T.sortKey));this._currentPartIndex<x.length;)if(o.placeLayerBucketPart(x[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,p())return!0;return!1}}class ta{constructor(e,o,u,c,p,x,S,T){this.placement=new Wr(e,gs(),o,x,S,T),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(e,o,u){const c=Z.now(),p=()=>!this._forceFullPlacement&&Z.now()-c>2;for(;this._currentPlacementIndex>=0;){const x=o[e[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=S)&&(!x.maxzoom||x.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new _r(x)),this._inProgressLayer.continuePlacement(u[x.source],this.placement,this._showCollisionBoxes,x,p))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Kn=512/d.X/2;class hr{constructor(e,o,u){this.tileID=e,this.bucketInstanceId=u,this._symbolsByKey={};const c=new Map;for(let p=0;p<o.length;p++){const x=o.get(p),S=x.key,T=c.get(S);T?T.push(x):c.set(S,[x])}for(const[p,x]of c){const S={positions:x.map(T=>({x:Math.floor(T.anchorX*Kn),y:Math.floor(T.anchorY*Kn)})),crossTileIDs:x.map(T=>T.crossTileID)};if(S.positions.length>128){const T=new d.av(S.positions.length,16,Uint16Array);for(const{x:E,y:M}of S.positions)T.add(E,M);T.finish(),delete S.positions,S.index=T}this._symbolsByKey[p]=S}}getScaledCoordinates(e,o){const{x:u,y:c,z:p}=this.tileID.canonical,{x,y:S,z:T}=o.canonical,E=Kn/Math.pow(2,T-p),M=(S*d.X+e.anchorY)*E,z=c*d.X*Kn;return{x:Math.floor((x*d.X+e.anchorX)*E-u*d.X*Kn),y:Math.floor(M-z)}}findMatches(e,o,u){const c=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let p=0;p<e.length;p++){const x=e.get(p);if(x.crossTileID)continue;const S=this._symbolsByKey[x.key];if(!S)continue;const T=this.getScaledCoordinates(x,o);if(S.index){const E=S.index.range(T.x-c,T.y-c,T.x+c,T.y+c).sort();for(const M of E){const z=S.crossTileIDs[M];if(!u[z]){u[z]=!0,x.crossTileID=z;break}}}else if(S.positions)for(let E=0;E<S.positions.length;E++){const M=S.positions[E],z=S.crossTileIDs[E];if(Math.abs(M.x-T.x)<=c&&Math.abs(M.y-T.y)<=c&&!u[z]){u[z]=!0,x.crossTileID=z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class qa{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Jn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const o=Math.round((e-this.lng)/360);if(o!==0)for(const u in this.indexes){const c=this.indexes[u],p={};for(const x in c){const S=c[x];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+o),p[S.tileID.key]=S}this.indexes[u]=p}this.lng=e}addBucket(e,o,u){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let p=0;p<o.symbolInstances.length;p++)o.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const c=this.usedCrossTileIDs[e.overscaledZ];for(const p in this.indexes){const x=this.indexes[p];if(Number(p)>e.overscaledZ)for(const S in x){const T=x[S];T.tileID.isChildOf(e)&&T.findMatches(o.symbolInstances,e,c)}else{const S=x[e.scaledTo(Number(p)).key];S&&S.findMatches(o.symbolInstances,e,c)}}for(let p=0;p<o.symbolInstances.length;p++){const x=o.symbolInstances.get(p);x.crossTileID||(x.crossTileID=u.generate(),c[x.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new hr(e,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(e,o){for(const u of o.getCrossTileIDsLists())for(const c of u)delete this.usedCrossTileIDs[e][c]}removeStaleBuckets(e){let o=!1;for(const u in this.indexes){const c=this.indexes[u];for(const p in c)e[c[p].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,c[p]),delete c[p],o=!0)}return o}}class yu{constructor(){this.layerIndexes={},this.crossTileIDs=new qa,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,o,u){let c=this.layerIndexes[e.id];c===void 0&&(c=this.layerIndexes[e.id]=new Jn);let p=!1;const x={};c.handleWrapJump(u);for(const S of o){const T=S.getBucket(e);T&&e.id===T.layerIds[0]&&(T.bucketInstanceId||(T.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(S.tileID,T,this.crossTileIDs)&&(p=!0),x[T.bucketInstanceId]=!0)}return c.removeStaleBuckets(x)&&(p=!0),p}pruneUnusedLayers(e){const o={};e.forEach(u=>{o[u]=!0});for(const u in this.layerIndexes)o[u]||delete this.layerIndexes[u]}}const Yn=(f,e)=>d.t(f,e&&e.filter(o=>o.identifier!=="source.canvas")),Hp=d.aw();class Ga extends d.E{constructor(e,o={}){super(),this._rtlPluginLoaded=()=>{for(const u in this.sourceCaches){const c=this.sourceCaches[u].getSource().type;c!=="vector"&&c!=="geojson"||this.sourceCaches[u].reload()}},this.map=e,this.dispatcher=new fs(ps(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(u,c)=>this.getGlyphs(u,c)),this.dispatcher.registerMessageHandler("GI",(u,c)=>this.getImages(u,c)),this.imageManager=new Zt,this.imageManager.setEventedParent(this),this.glyphManager=new nn(e._requestManager,o.localIdeographFontFamily),this.lineAtlas=new Hn(256,512),this.crossTileSymbolIndex=new yu,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new d.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",d.ay()),yi().on(De,this._rtlPluginLoaded),this.on("data",u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;const c=this.sourceCaches[u.sourceId];if(!c)return;const p=c.getSource();if(p&&p.vectorLayerIds)for(const x in this._layers){const S=this._layers[x];S.source===p.id&&this._validateLayer(S)}})}loadURL(e,o={},u){this.fire(new d.k("dataloading",{dataType:"style"})),o.validate=typeof o.validate!="boolean"||o.validate;const c=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const p=this._loadStyleRequest;d.h(c,this._loadStyleRequest).then(x=>{this._loadStyleRequest=null,this._load(x.data,o,u)}).catch(x=>{this._loadStyleRequest=null,x&&!p.signal.aborted&&this.fire(new d.j(x))})}loadJSON(e,o={},u){this.fire(new d.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Z.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,o.validate=o.validate!==!1,this._load(e,o,u)}).catch(()=>{})}loadEmpty(){this.fire(new d.k("dataloading",{dataType:"style"})),this._load(Hp,{validate:!1})}_load(e,o,u){var c;const p=o.transformStyle?o.transformStyle(u,e):e;if(!o.validate||!Yn(this,d.u(p))){this._loaded=!0,this.stylesheet=p;for(const x in p.sources)this.addSource(x,p.sources[x],{validate:!1});p.sprite?this._loadSprite(p.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(p.glyphs),this._createLayers(),this.light=new gt(this.stylesheet.light),this.sky=new Bt(this.stylesheet.sky),this.map.setTerrain((c=this.stylesheet.terrain)!==null&&c!==void 0?c:null),this.fire(new d.k("data",{dataType:"style"})),this.fire(new d.k("style.load"))}}_createLayers(){const e=d.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(o=>o.id),this._layers={},this._serializedLayers=null;for(const o of e){const u=d.aA(o);u.setEventedParent(this,{layer:{id:o.id}}),this._layers[o.id]=u}}_loadSprite(e,o=!1,u=void 0){let c;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(p,x,S,T){return d._(this,void 0,void 0,function*(){const E=tt(p),M=S>1?"@2x":"",z={},F={};for(const{id:V,url:$}of E){const X=x.transformRequest(ut($,M,".json"),"SpriteJSON");z[V]=d.h(X,T);const Q=x.transformRequest(ut($,M,".png"),"SpriteImage");F[V]=re.getImage(Q,T)}return yield Promise.all([...Object.values(z),...Object.values(F)]),function(V,$){return d._(this,void 0,void 0,function*(){const X={};for(const Q in V){X[Q]={};const ee=Z.getImageCanvasContext((yield $[Q]).data),se=(yield V[Q]).data;for(const G in se){const{width:le,height:ce,x:me,y:Ie,sdf:Ae,pixelRatio:Ve,stretchX:Ge,stretchY:Be,content:Fe,textFitWidth:Ye,textFitHeight:pt}=se[G];X[Q][G]={data:null,pixelRatio:Ve,sdf:Ae,stretchX:Ge,stretchY:Be,content:Fe,textFitWidth:Ye,textFitHeight:pt,spriteData:{width:le,height:ce,x:me,y:Ie,context:ee}}}}return X})}(z,F)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(p=>{if(this._spriteRequest=null,p)for(const x in p){this._spritesImagesIds[x]=[];const S=this._spritesImagesIds[x]?this._spritesImagesIds[x].filter(T=>!(T in p)):[];for(const T of S)this.imageManager.removeImage(T),this._changedImages[T]=!0;for(const T in p[x]){const E=x==="default"?T:`${x}:${T}`;this._spritesImagesIds[x].push(E),E in this.imageManager.images?this.imageManager.updateImage(E,p[x][T],!1):this.imageManager.addImage(E,p[x][T]),o&&(this._changedImages[E]=!0)}}}).catch(p=>{this._spriteRequest=null,c=p,this.fire(new d.j(c))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),o&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"})),u&&u(c)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}_validateLayer(e){const o=this.sourceCaches[e.source];if(!o)return;const u=e.sourceLayer;if(!u)return;const c=o.getSource();(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(u)===-1)&&this.fire(new d.j(new Error(`Source layer "${u}" does not exist on source "${c.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,o=!1){const u=this._serializedAllLayers();if(!e||e.length===0)return Object.values(o?d.aB(u):u);const c=[];for(const p of e)if(u[p]){const x=o?d.aB(u[p]):u[p];c.push(x)}return c}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const o=Object.keys(this._layers);for(const u of o){const c=this._layers[u];c.type!=="custom"&&(e[u]=c.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const o=this._changed;if(o){const c=Object.keys(this._updatedLayers),p=Object.keys(this._removedLayers);(c.length||p.length)&&this._updateWorkerLayers(c,p);for(const x in this._updatedSources){const S=this._updatedSources[x];if(S==="reload")this._reloadSource(x);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(x)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const x in this._updatedPaintProps)this._layers[x].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const u={};for(const c in this.sourceCaches){const p=this.sourceCaches[c];u[c]=p.used,p.used=!1}for(const c of this._order){const p=this._layers[c];p.recalculate(e,this._availableImages),!p.isHidden(e.zoom)&&p.source&&(this.sourceCaches[p.source].used=!0)}for(const c in u){const p=this.sourceCaches[c];!!u[c]!=!!p.used&&p.fire(new d.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:c}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,o&&this.fire(new d.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,o){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,o={}){var u;this._checkLoaded();const c=this.serialize();if(e=o.transformStyle?o.transformStyle(c,e):e,((u=o.validate)===null||u===void 0||u)&&Yn(this,d.u(e)))return!1;(e=d.aB(e)).layers=d.az(e.layers);const p=d.aC(c,e),x=this._getOperationsToPerform(p);if(x.unimplemented.length>0)throw new Error(`Unimplemented: ${x.unimplemented.join(", ")}.`);if(x.operations.length===0)return!1;for(const S of x.operations)S();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const o=[],u=[];for(const c of e)switch(c.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":o.push(()=>this.addLayer.apply(this,c.args));break;case"removeLayer":o.push(()=>this.removeLayer.apply(this,c.args));break;case"setPaintProperty":o.push(()=>this.setPaintProperty.apply(this,c.args));break;case"setLayoutProperty":o.push(()=>this.setLayoutProperty.apply(this,c.args));break;case"setFilter":o.push(()=>this.setFilter.apply(this,c.args));break;case"addSource":o.push(()=>this.addSource.apply(this,c.args));break;case"removeSource":o.push(()=>this.removeSource.apply(this,c.args));break;case"setLayerZoomRange":o.push(()=>this.setLayerZoomRange.apply(this,c.args));break;case"setLight":o.push(()=>this.setLight.apply(this,c.args));break;case"setGeoJSONSourceData":o.push(()=>this.setGeoJSONSourceData.apply(this,c.args));break;case"setGlyphs":o.push(()=>this.setGlyphs.apply(this,c.args));break;case"setSprite":o.push(()=>this.setSprite.apply(this,c.args));break;case"setSky":o.push(()=>this.setSky.apply(this,c.args));break;case"setTerrain":o.push(()=>this.map.setTerrain.apply(this,c.args));break;case"setTransition":o.push(()=>{});break;default:u.push(c.command)}return{operations:o,unimplemented:u}}addImage(e,o){if(this.getImage(e))return this.fire(new d.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,o),this._afterImageUpdated(e)}updateImage(e,o){this.imageManager.updateImage(e,o)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new d.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,o,u={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(d.u.source,`sources.${e}`,o,null,u))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const c=this.sourceCaches[e]=new ct(e,o,this.dispatcher);c.style=this,c.setEventedParent(this,()=>({isSourceLoaded:c.loaded(),source:c.serialize(),sourceId:e})),c.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===e)return this.fire(new d.j(new Error(`Source "${e}" cannot be removed while layer "${u}" is using it.`)));const o=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],o.fire(new d.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),o.setEventedParent(null),o.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,o){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const u=this.sourceCaches[e].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(o),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,o,u={}){this._checkLoaded();const c=e.id;if(this.getLayer(c))return void this.fire(new d.j(new Error(`Layer "${c}" already exists on this map.`)));let p;if(e.type==="custom"){if(Yn(this,d.aD(e)))return;p=d.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(c,e.source),e=d.aB(e),e=d.e(e,{source:c})),this._validate(d.u.layer,`layers.${c}`,e,{arrayIndex:-1},u))return;p=d.aA(e),this._validateLayer(p),p.setEventedParent(this,{layer:{id:c}})}const x=o?this._order.indexOf(o):this._order.length;if(o&&x===-1)this.fire(new d.j(new Error(`Cannot add layer "${c}" before non-existing layer "${o}".`)));else{if(this._order.splice(x,0,c),this._layerOrderChanged=!0,this._layers[c]=p,this._removedLayers[c]&&p.source&&p.type!=="custom"){const S=this._removedLayers[c];delete this._removedLayers[c],S.type!==p.type?this._updatedSources[p.source]="clear":(this._updatedSources[p.source]="reload",this.sourceCaches[p.source].pause())}this._updateLayer(p),p.onAdd&&p.onAdd(this.map)}}moveLayer(e,o){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new d.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===o)return;const u=this._order.indexOf(e);this._order.splice(u,1);const c=o?this._order.indexOf(o):this._order.length;o&&c===-1?this.fire(new d.j(new Error(`Cannot move layer "${e}" before non-existing layer "${o}".`))):(this._order.splice(c,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const o=this._layers[e];if(!o)return void this.fire(new d.j(new Error(`Cannot remove non-existing layer "${e}".`)));o.setEventedParent(null);const u=this._order.indexOf(e);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=o,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],o.onRemove&&o.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,o,u){this._checkLoaded();const c=this.getLayer(e);c?c.minzoom===o&&c.maxzoom===u||(o!=null&&(c.minzoom=o),u!=null&&(c.maxzoom=u),this._updateLayer(c)):this.fire(new d.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,o,u={}){this._checkLoaded();const c=this.getLayer(e);if(c){if(!d.aE(c.filter,o))return o==null?(c.filter=void 0,void this._updateLayer(c)):void(this._validate(d.u.filter,`layers.${c.id}.filter`,o,null,u)||(c.filter=d.aB(o),this._updateLayer(c)))}else this.fire(new d.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return d.aB(this.getLayer(e).filter)}setLayoutProperty(e,o,u,c={}){this._checkLoaded();const p=this.getLayer(e);p?d.aE(p.getLayoutProperty(o),u)||(p.setLayoutProperty(o,u,c),this._updateLayer(p)):this.fire(new d.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,o){const u=this.getLayer(e);if(u)return u.getLayoutProperty(o);this.fire(new d.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,o,u,c={}){this._checkLoaded();const p=this.getLayer(e);p?d.aE(p.getPaintProperty(o),u)||(p.setPaintProperty(o,u,c)&&this._updateLayer(p),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new d.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,o){return this.getLayer(e).getPaintProperty(o)}setFeatureState(e,o){this._checkLoaded();const u=e.source,c=e.sourceLayer,p=this.sourceCaches[u];if(p===void 0)return void this.fire(new d.j(new Error(`The source '${u}' does not exist in the map's style.`)));const x=p.getSource().type;x==="geojson"&&c?this.fire(new d.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):x!=="vector"||c?(e.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),p.setFeatureState(c,e.id,o)):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,o){this._checkLoaded();const u=e.source,c=this.sourceCaches[u];if(c===void 0)return void this.fire(new d.j(new Error(`The source '${u}' does not exist in the map's style.`)));const p=c.getSource().type,x=p==="vector"?e.sourceLayer:void 0;p!=="vector"||x?o&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new d.j(new Error("A feature id is required to remove its specific state property."))):c.removeFeatureState(x,e.id,o):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const o=e.source,u=e.sourceLayer,c=this.sourceCaches[o];if(c!==void 0)return c.getSource().type!=="vector"||u?(e.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),c.getFeatureState(u,e.id)):void this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new d.j(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return d.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=d.aF(this.sourceCaches,p=>p.serialize()),o=this._serializeByIds(this._order,!0),u=this.map.getTerrain()||void 0,c=this.stylesheet;return d.aG({version:c.version,name:c.name,metadata:c.metadata,light:c.light,sky:c.sky,center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,sprite:c.sprite,glyphs:c.glyphs,transition:c.transition,sources:e,layers:o,terrain:u},p=>p!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const o=x=>this._layers[x].type==="fill-extrusion",u={},c=[];for(let x=this._order.length-1;x>=0;x--){const S=this._order[x];if(o(S)){u[S]=x;for(const T of e){const E=T[S];if(E)for(const M of E)c.push(M)}}}c.sort((x,S)=>S.intersectionZ-x.intersectionZ);const p=[];for(let x=this._order.length-1;x>=0;x--){const S=this._order[x];if(o(S))for(let T=c.length-1;T>=0;T--){const E=c[T].feature;if(u[E.layer.id]<x)break;p.push(E),c.pop()}else for(const T of e){const E=T[S];if(E)for(const M of E)p.push(M.feature)}}return p}queryRenderedFeatures(e,o,u){o&&o.filter&&this._validate(d.u.filter,"queryRenderedFeatures.filter",o.filter,null,o);const c={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new d.j(new Error("parameters.layers must be an Array."))),[];for(const S of o.layers){const T=this._layers[S];if(!T)return this.fire(new d.j(new Error(`The layer '${S}' does not exist in the map's style and cannot be queried for features.`))),[];c[T.source]=!0}}const p=[];o.availableImages=this._availableImages;const x=this._serializedAllLayers();for(const S in this.sourceCaches)o.layers&&!c[S]||p.push(Xi(this.sourceCaches[S],this._layers,x,e,o,u));return this.placement&&p.push(function(S,T,E,M,z,F,V){const $={},X=F.queryRenderedSymbols(M),Q=[];for(const ee of Object.keys(X).map(Number))Q.push(V[ee]);Q.sort(Ki);for(const ee of Q){const se=ee.featureIndex.lookupSymbolFeatures(X[ee.bucketInstanceId],T,ee.bucketIndex,ee.sourceLayerIndex,z.filter,z.layers,z.availableImages,S);for(const G in se){const le=$[G]=$[G]||[],ce=se[G];ce.sort((me,Ie)=>{const Ae=ee.featureSortOrder;if(Ae){const Ve=Ae.indexOf(me.featureIndex);return Ae.indexOf(Ie.featureIndex)-Ve}return Ie.featureIndex-me.featureIndex});for(const me of ce)le.push(me)}}for(const ee in $)$[ee].forEach(se=>{const G=se.feature,le=E[S[ee].source].getFeatureState(G.layer["source-layer"],G.id);G.source=G.layer.source,G.layer["source-layer"]&&(G.sourceLayer=G.layer["source-layer"]),G.state=le});return $}(this._layers,x,this.sourceCaches,e,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(p)}querySourceFeatures(e,o){o&&o.filter&&this._validate(d.u.filter,"querySourceFeatures.filter",o.filter,null,o);const u=this.sourceCaches[e];return u?function(c,p){const x=c.getRenderableIds().map(E=>c.getTileByID(E)),S=[],T={};for(let E=0;E<x.length;E++){const M=x[E],z=M.tileID.canonical.key;T[z]||(T[z]=!0,M.querySourceFeatures(S,p))}return S}(u,o):[]}getLight(){return this.light.getLight()}setLight(e,o={}){this._checkLoaded();const u=this.light.getLight();let c=!1;for(const x in e)if(!d.aE(e[x],u[x])){c=!0;break}if(!c)return;const p={now:Z.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,o),this.light.updateTransitions(p)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,o={}){const u=this.getSky();let c=!1;if(!e&&!u)return;if(e&&!u)c=!0;else if(!e&&u)c=!0;else for(const x in e)if(!d.aE(e[x],u[x])){c=!0;break}if(!c)return;const p={now:Z.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,o),this.sky.updateTransitions(p)}_validate(e,o,u,c,p={}){return(!p||p.validate!==!1)&&Yn(this,e.call(d.u,d.e({key:o,style:this.serialize(),value:u,styleSpec:d.v},c)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),yi().off(De,this._rtlPluginLoaded);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this.sourceCaches){const u=this.sourceCaches[o];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const o in this.sourceCaches)this.sourceCaches[o].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,o,u,c,p=!1){let x=!1,S=!1;const T={};for(const E of this._order){const M=this._layers[E];if(M.type!=="symbol")continue;if(!T[M.source]){const F=this.sourceCaches[M.source];T[M.source]=F.getRenderableIds(!0).map(V=>F.getTileByID(V)).sort((V,$)=>$.tileID.overscaledZ-V.tileID.overscaledZ||(V.tileID.isLessThan($.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(M,T[M.source],e.center.lng);x=x||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((p=p||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Z.now(),e.zoom))&&(this.pauseablePlacement=new ta(e,this.map.terrain,this._order,p,o,u,c,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Z.now()),S=!0),x&&this.pauseablePlacement.placement.setStale()),S||x)for(const E of this._order){const M=this._layers[E];M.type==="symbol"&&this.placement.updateLayerOpacities(M,T[M.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Z.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,o){return d._(this,void 0,void 0,function*(){const u=yield this.imageManager.getImages(o.icons);this._updateTilesForChangedImages();const c=this.sourceCaches[o.source];return c&&c.setDependencies(o.tileID.key,o.type,o.icons),u})}getGlyphs(e,o){return d._(this,void 0,void 0,function*(){const u=yield this.glyphManager.getGlyphs(o.stacks),c=this.sourceCaches[o.source];return c&&c.setDependencies(o.tileID.key,o.type,[""]),u})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,o={}){this._checkLoaded(),e&&this._validate(d.u.glyphs,"glyphs",e,null,o)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,o,u={},c){this._checkLoaded();const p=[{id:e,url:o}],x=[...tt(this.stylesheet.sprite),...p];this._validate(d.u.sprite,"sprite",x,null,u)||(this.stylesheet.sprite=x,this._loadSprite(p,!0,c))}removeSprite(e){this._checkLoaded();const o=tt(this.stylesheet.sprite);if(o.find(u=>u.id===e)){if(this._spritesImagesIds[e])for(const u of this._spritesImagesIds[e])this.imageManager.removeImage(u),this._changedImages[u]=!0;o.splice(o.findIndex(u=>u.id===e),1),this.stylesheet.sprite=o.length>0?o:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}else this.fire(new d.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return tt(this.stylesheet.sprite)}setSprite(e,o={},u){this._checkLoaded(),e&&this._validate(d.u.sprite,"sprite",e,null,o)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,u):(this._unloadSprite(),u&&u(null)))}}var ys=d.Y([{name:"a_pos",type:"Int16",components:2}]);const es={prelude:Lt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Lt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Lt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Lt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Lt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Lt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:Lt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Lt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Lt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Lt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Lt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Lt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Lt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Lt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Lt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Lt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Lt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Lt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Lt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Lt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Lt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Lt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Lt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Lt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Lt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Lt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Lt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Lt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Lt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:Lt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Lt(f,e){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=e.match(/attribute ([\w]+) ([\w]+)/g),c=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),p=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=p?p.concat(c):c,S={};return{fragmentSource:f=f.replace(o,(T,E,M,z,F)=>(S[F]=!0,E==="define"?`
#ifndef HAS_UNIFORM_u_${F}
varying ${M} ${z} ${F};
#else
uniform ${M} ${z} u_${F};
#endif
`:`
#ifdef HAS_UNIFORM_u_${F}
    ${M} ${z} ${F} = u_${F};
#endif
`)),vertexSource:e=e.replace(o,(T,E,M,z,F)=>{const V=z==="float"?"vec2":"vec4",$=F.match(/color/)?"color":V;return S[F]?E==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${M} ${V} a_${F};
varying ${M} ${z} ${F};
#else
uniform ${M} ${z} u_${F};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${M} ${z} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${$}(a_${F}, u_${F}_t);
#else
    ${M} ${z} ${F} = u_${F};
#endif
`:E==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${M} ${V} a_${F};
#else
uniform ${M} ${z} u_${F};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${M} ${z} ${F} = a_${F};
#else
    ${M} ${z} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${M} ${z} ${F} = unpack_mix_${$}(a_${F}, u_${F}_t);
#else
    ${M} ${z} ${F} = u_${F};
#endif
`}),staticAttributes:u,staticUniforms:x}}class _u{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,o,u,c,p,x,S,T,E){this.context=e;let M=this.boundPaintVertexBuffers.length!==c.length;for(let z=0;!M&&z<c.length;z++)this.boundPaintVertexBuffers[z]!==c[z]&&(M=!0);!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==u||M||this.boundIndexBuffer!==p||this.boundVertexOffset!==x||this.boundDynamicVertexBuffer!==S||this.boundDynamicVertexBuffer2!==T||this.boundDynamicVertexBuffer3!==E?this.freshBind(o,u,c,p,x,S,T,E):(e.bindVertexArray.set(this.vao),S&&S.bind(),p&&p.dynamicDraw&&p.bind(),T&&T.bind(),E&&E.bind())}freshBind(e,o,u,c,p,x,S,T){const E=e.numAttributes,M=this.context,z=M.gl;this.vao&&this.destroy(),this.vao=M.createVertexArray(),M.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=c,this.boundVertexOffset=p,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=T,o.enableAttributes(z,e);for(const F of u)F.enableAttributes(z,e);x&&x.enableAttributes(z,e),S&&S.enableAttributes(z,e),T&&T.enableAttributes(z,e),o.bind(),o.setVertexAttribPointers(z,e,p);for(const F of u)F.bind(),F.setVertexAttribPointers(z,e,p);x&&(x.bind(),x.setVertexAttribPointers(z,e,p)),c&&c.bind(),S&&(S.bind(),S.setVertexAttribPointers(z,e,p)),T&&(T.bind(),T.setVertexAttribPointers(z,e,p)),M.currentNumAttributes=E}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const vu=(f,e,o,u,c)=>({u_matrix:f,u_texture:0,u_ele_delta:e,u_fog_matrix:o,u_fog_color:u?u.properties.get("fog-color"):d.aM.white,u_fog_ground_blend:u?u.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:u?u.calculateFogBlendOpacity(c):0,u_horizon_color:u?u.properties.get("horizon-color"):d.aM.white,u_horizon_fog_blend:u?u.properties.get("horizon-fog-blend"):1});function Js(f){const e=[];for(let o=0;o<f.length;o++){if(f[o]===null)continue;const u=f[o].split(" ");e.push(u.pop())}return e}class xu{constructor(e,o,u,c,p,x){const S=e.gl;this.program=S.createProgram();const T=Js(o.staticAttributes),E=u?u.getBinderAttributes():[],M=T.concat(E),z=es.prelude.staticUniforms?Js(es.prelude.staticUniforms):[],F=o.staticUniforms?Js(o.staticUniforms):[],V=u?u.getBinderUniforms():[],$=z.concat(F).concat(V),X=[];for(const me of $)X.indexOf(me)<0&&X.push(me);const Q=u?u.defines():[];p&&Q.push("#define OVERDRAW_INSPECTOR;"),x&&Q.push("#define TERRAIN3D;");const ee=Q.concat(es.prelude.fragmentSource,o.fragmentSource).join(`
`),se=Q.concat(es.prelude.vertexSource,o.vertexSource).join(`
`),G=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);if(S.shaderSource(G,ee),S.compileShader(G),!S.getShaderParameter(G,S.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${S.getShaderInfoLog(G)}`);S.attachShader(this.program,G);const le=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);if(S.shaderSource(le,se),S.compileShader(le),!S.getShaderParameter(le,S.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${S.getShaderInfoLog(le)}`);S.attachShader(this.program,le),this.attributes={};const ce={};this.numAttributes=M.length;for(let me=0;me<this.numAttributes;me++)M[me]&&(S.bindAttribLocation(this.program,me,M[me]),this.attributes[M[me]]=me);if(S.linkProgram(this.program),!S.getProgramParameter(this.program,S.LINK_STATUS))throw new Error(`Program failed to link: ${S.getProgramInfoLog(this.program)}`);S.deleteShader(le),S.deleteShader(G);for(let me=0;me<X.length;me++){const Ie=X[me];if(Ie&&!ce[Ie]){const Ae=S.getUniformLocation(this.program,Ie);Ae&&(ce[Ie]=Ae)}}this.fixedUniforms=c(e,ce),this.terrainUniforms=((me,Ie)=>({u_depth:new d.aH(me,Ie.u_depth),u_terrain:new d.aH(me,Ie.u_terrain),u_terrain_dim:new d.aI(me,Ie.u_terrain_dim),u_terrain_matrix:new d.aJ(me,Ie.u_terrain_matrix),u_terrain_unpack:new d.aK(me,Ie.u_terrain_unpack),u_terrain_exaggeration:new d.aI(me,Ie.u_terrain_exaggeration)}))(e,ce),this.binderUniforms=u?u.getUniforms(e,ce):[]}draw(e,o,u,c,p,x,S,T,E,M,z,F,V,$,X,Q,ee,se){const G=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(u),e.setStencilMode(c),e.setColorMode(p),e.setCullFace(x),T){e.activeTexture.set(G.TEXTURE2),G.bindTexture(G.TEXTURE_2D,T.depthTexture),e.activeTexture.set(G.TEXTURE3),G.bindTexture(G.TEXTURE_2D,T.texture);for(const ce in this.terrainUniforms)this.terrainUniforms[ce].set(T[ce])}for(const ce in this.fixedUniforms)this.fixedUniforms[ce].set(S[ce]);X&&X.setUniforms(e,this.binderUniforms,V,{zoom:$});let le=0;switch(o){case G.LINES:le=2;break;case G.TRIANGLES:le=3;break;case G.LINE_STRIP:le=1}for(const ce of F.get()){const me=ce.vaos||(ce.vaos={});(me[E]||(me[E]=new _u)).bind(e,this,M,X?X.getPaintVertexBuffers():[],z,ce.vertexOffset,Q,ee,se),G.drawElements(o,ce.primitiveLength*le,G.UNSIGNED_SHORT,ce.primitiveOffset*le*2)}}}function Ha(f,e,o){const u=1/St(o,1,e.transform.tileZoom),c=Math.pow(2,o.tileID.overscaledZ),p=o.tileSize*Math.pow(2,e.transform.tileZoom)/c,x=p*(o.tileID.canonical.x+o.tileID.wrap*c),S=p*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[u,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[x>>16,S>>16],u_pixel_coord_lower:[65535&x,65535&S]}}const ra=(f,e,o,u)=>{const c=e.style.light,p=c.properties.get("position"),x=[p.x,p.y,p.z],S=function(){var E=new d.A(9);return d.A!=Float32Array&&(E[1]=0,E[2]=0,E[3]=0,E[5]=0,E[6]=0,E[7]=0),E[0]=1,E[4]=1,E[8]=1,E}();c.properties.get("anchor")==="viewport"&&function(E,M){var z=Math.sin(M),F=Math.cos(M);E[0]=F,E[1]=z,E[2]=0,E[3]=-z,E[4]=F,E[5]=0,E[6]=0,E[7]=0,E[8]=1}(S,-e.transform.angle),function(E,M,z){var F=M[0],V=M[1],$=M[2];E[0]=F*z[0]+V*z[3]+$*z[6],E[1]=F*z[1]+V*z[4]+$*z[7],E[2]=F*z[2]+V*z[5]+$*z[8]}(x,x,S);const T=c.properties.get("color");return{u_matrix:f,u_lightpos:x,u_lightintensity:c.properties.get("intensity"),u_lightcolor:[T.r,T.g,T.b],u_vertical_gradient:+o,u_opacity:u}},Wa=(f,e,o,u,c,p,x)=>d.e(ra(f,e,o,u),Ha(p,e,x),{u_height_factor:-Math.pow(2,c.overscaledZ)/x.tileSize/8}),Ys=f=>({u_matrix:f}),_h=(f,e,o,u)=>d.e(Ys(f),Ha(o,e,u)),Wp=(f,e)=>({u_matrix:f,u_world:e}),vh=(f,e,o,u,c)=>d.e(_h(f,e,o,u),{u_world:c}),Xp=(f,e,o,u)=>{const c=f.transform;let p,x;if(u.paint.get("circle-pitch-alignment")==="map"){const S=St(o,1,c.zoom);p=!0,x=[S,S]}else p=!1,x=c.pixelsToGLUnits;return{u_camera_to_center_distance:c.cameraToCenterDistance,u_scale_with_map:+(u.paint.get("circle-pitch-scale")==="map"),u_matrix:f.translatePosMatrix(e.posMatrix,o,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_pitch_with_map:+p,u_device_pixel_ratio:f.pixelRatio,u_extrude_scale:x}},_s=(f,e,o)=>({u_matrix:f,u_inv_matrix:e,u_camera_to_center_distance:o.cameraToCenterDistance,u_viewport_size:[o.width,o.height]}),na=(f,e,o=1)=>({u_matrix:f,u_color:e,u_overlay:0,u_overlay_scale:o}),ln=f=>({u_matrix:f}),un=(f,e,o,u)=>({u_matrix:f,u_extrude_scale:St(e,1,o),u_intensity:u}),Xa=(f,e,o,u)=>{const c=d.H();d.aP(c,0,f.width,f.height,0,0,1);const p=f.context.gl;return{u_matrix:c,u_world:[p.drawingBufferWidth,p.drawingBufferHeight],u_image:o,u_color_ramp:u,u_opacity:e.paint.get("heatmap-opacity")}};function Ka(f,e){const o=Math.pow(2,e.canonical.z),u=e.canonical.y;return[new d.Z(0,u/o).toLngLat().lat,new d.Z(0,(u+1)/o).toLngLat().lat]}const Ja=(f,e,o,u)=>{const c=f.transform;return{u_matrix:bh(f,e,o,u),u_ratio:1/St(e,1,c.zoom),u_device_pixel_ratio:f.pixelRatio,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},xh=(f,e,o,u,c)=>d.e(Ja(f,e,o,c),{u_image:0,u_image_height:u}),Qs=(f,e,o,u,c)=>{const p=f.transform,x=wh(e,p);return{u_matrix:bh(f,e,o,c),u_texsize:e.imageAtlasTexture.size,u_ratio:1/St(e,1,p.zoom),u_device_pixel_ratio:f.pixelRatio,u_image:0,u_scale:[x,u.fromScale,u.toScale],u_fade:u.t,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Kp=(f,e,o,u,c,p)=>{const x=f.lineAtlas,S=wh(e,f.transform),T=o.layout.get("line-cap")==="round",E=x.getDash(u.from,T),M=x.getDash(u.to,T),z=E.width*c.fromScale,F=M.width*c.toScale;return d.e(Ja(f,e,o,p),{u_patternscale_a:[S/z,-E.height/2],u_patternscale_b:[S/F,-M.height/2],u_sdfgamma:x.width/(256*Math.min(z,F)*f.pixelRatio)/2,u_image:0,u_tex_y_a:E.y,u_tex_y_b:M.y,u_mix:c.t})};function wh(f,e){return 1/St(f,1,e.tileZoom)}function bh(f,e,o,u){return f.translatePosMatrix(u?u.posMatrix:e.tileID.posMatrix,e,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const Jp=(f,e,o,u,c)=>{return{u_matrix:f,u_tl_parent:e,u_scale_parent:o,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(x=c.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(p=c.paint.get("raster-contrast"),p>0?1/(1-p):1+p),u_spin_weights:Yp(c.paint.get("raster-hue-rotate"))};var p,x};function Yp(f){f*=Math.PI/180;const e=Math.sin(f),o=Math.cos(f);return[(2*o+1)/3,(-Math.sqrt(3)*e-o+1)/3,(Math.sqrt(3)*e-o+1)/3]}const Sh=(f,e,o,u,c,p,x,S,T,E,M,z,F,V)=>{const $=x.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:$.cameraToCenterDistance,u_pitch:$.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:$.width/$.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:T,u_coord_matrix:E,u_is_text:+z,u_pitch_with_map:+u,u_is_along_line:c,u_is_variable_anchor:p,u_texsize:F,u_texture:0,u_translation:M,u_pitched_scale:V}},ia=(f,e,o,u,c,p,x,S,T,E,M,z,F,V,$)=>{const X=x.transform;return d.e(Sh(f,e,o,u,c,p,x,S,T,E,M,z,F,$),{u_gamma_scale:u?Math.cos(X._pitch)*X.cameraToCenterDistance:1,u_device_pixel_ratio:x.pixelRatio,u_is_halo:1})},wu=(f,e,o,u,c,p,x,S,T,E,M,z,F,V)=>d.e(ia(f,e,o,u,c,p,x,S,T,E,M,!0,z,!0,V),{u_texsize_icon:F,u_texture_icon:1}),Ya=(f,e,o)=>({u_matrix:f,u_opacity:e,u_color:o}),bu=(f,e,o,u,c,p)=>d.e(function(x,S,T,E){const M=T.imageManager.getPattern(x.from.toString()),z=T.imageManager.getPattern(x.to.toString()),{width:F,height:V}=T.imageManager.getPixelSize(),$=Math.pow(2,E.tileID.overscaledZ),X=E.tileSize*Math.pow(2,T.transform.tileZoom)/$,Q=X*(E.tileID.canonical.x+E.tileID.wrap*$),ee=X*E.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:M.tl,u_pattern_br_a:M.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[F,V],u_mix:S.t,u_pattern_size_a:M.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/St(E,1,T.transform.tileZoom),u_pixel_coord_upper:[Q>>16,ee>>16],u_pixel_coord_lower:[65535&Q,65535&ee]}}(u,p,o,c),{u_matrix:f,u_opacity:e}),Su={fillExtrusion:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_lightpos:new d.aN(f,e.u_lightpos),u_lightintensity:new d.aI(f,e.u_lightintensity),u_lightcolor:new d.aN(f,e.u_lightcolor),u_vertical_gradient:new d.aI(f,e.u_vertical_gradient),u_opacity:new d.aI(f,e.u_opacity)}),fillExtrusionPattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_lightpos:new d.aN(f,e.u_lightpos),u_lightintensity:new d.aI(f,e.u_lightintensity),u_lightcolor:new d.aN(f,e.u_lightcolor),u_vertical_gradient:new d.aI(f,e.u_vertical_gradient),u_height_factor:new d.aI(f,e.u_height_factor),u_image:new d.aH(f,e.u_image),u_texsize:new d.aO(f,e.u_texsize),u_pixel_coord_upper:new d.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(f,e.u_pixel_coord_lower),u_scale:new d.aN(f,e.u_scale),u_fade:new d.aI(f,e.u_fade),u_opacity:new d.aI(f,e.u_opacity)}),fill:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix)}),fillPattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_image:new d.aH(f,e.u_image),u_texsize:new d.aO(f,e.u_texsize),u_pixel_coord_upper:new d.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(f,e.u_pixel_coord_lower),u_scale:new d.aN(f,e.u_scale),u_fade:new d.aI(f,e.u_fade)}),fillOutline:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_world:new d.aO(f,e.u_world)}),fillOutlinePattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_world:new d.aO(f,e.u_world),u_image:new d.aH(f,e.u_image),u_texsize:new d.aO(f,e.u_texsize),u_pixel_coord_upper:new d.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(f,e.u_pixel_coord_lower),u_scale:new d.aN(f,e.u_scale),u_fade:new d.aI(f,e.u_fade)}),circle:(f,e)=>({u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_scale_with_map:new d.aH(f,e.u_scale_with_map),u_pitch_with_map:new d.aH(f,e.u_pitch_with_map),u_extrude_scale:new d.aO(f,e.u_extrude_scale),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_matrix:new d.aJ(f,e.u_matrix)}),collisionBox:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_pixel_extrude_scale:new d.aO(f,e.u_pixel_extrude_scale)}),collisionCircle:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_inv_matrix:new d.aJ(f,e.u_inv_matrix),u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_viewport_size:new d.aO(f,e.u_viewport_size)}),debug:(f,e)=>({u_color:new d.aL(f,e.u_color),u_matrix:new d.aJ(f,e.u_matrix),u_overlay:new d.aH(f,e.u_overlay),u_overlay_scale:new d.aI(f,e.u_overlay_scale)}),clippingMask:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix)}),heatmap:(f,e)=>({u_extrude_scale:new d.aI(f,e.u_extrude_scale),u_intensity:new d.aI(f,e.u_intensity),u_matrix:new d.aJ(f,e.u_matrix)}),heatmapTexture:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_world:new d.aO(f,e.u_world),u_image:new d.aH(f,e.u_image),u_color_ramp:new d.aH(f,e.u_color_ramp),u_opacity:new d.aI(f,e.u_opacity)}),hillshade:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_image:new d.aH(f,e.u_image),u_latrange:new d.aO(f,e.u_latrange),u_light:new d.aO(f,e.u_light),u_shadow:new d.aL(f,e.u_shadow),u_highlight:new d.aL(f,e.u_highlight),u_accent:new d.aL(f,e.u_accent)}),hillshadePrepare:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_image:new d.aH(f,e.u_image),u_dimension:new d.aO(f,e.u_dimension),u_zoom:new d.aI(f,e.u_zoom),u_unpack:new d.aK(f,e.u_unpack)}),line:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_ratio:new d.aI(f,e.u_ratio),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(f,e.u_units_to_pixels)}),lineGradient:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_ratio:new d.aI(f,e.u_ratio),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(f,e.u_units_to_pixels),u_image:new d.aH(f,e.u_image),u_image_height:new d.aI(f,e.u_image_height)}),linePattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_texsize:new d.aO(f,e.u_texsize),u_ratio:new d.aI(f,e.u_ratio),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_image:new d.aH(f,e.u_image),u_units_to_pixels:new d.aO(f,e.u_units_to_pixels),u_scale:new d.aN(f,e.u_scale),u_fade:new d.aI(f,e.u_fade)}),lineSDF:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_ratio:new d.aI(f,e.u_ratio),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(f,e.u_units_to_pixels),u_patternscale_a:new d.aO(f,e.u_patternscale_a),u_patternscale_b:new d.aO(f,e.u_patternscale_b),u_sdfgamma:new d.aI(f,e.u_sdfgamma),u_image:new d.aH(f,e.u_image),u_tex_y_a:new d.aI(f,e.u_tex_y_a),u_tex_y_b:new d.aI(f,e.u_tex_y_b),u_mix:new d.aI(f,e.u_mix)}),raster:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_tl_parent:new d.aO(f,e.u_tl_parent),u_scale_parent:new d.aI(f,e.u_scale_parent),u_buffer_scale:new d.aI(f,e.u_buffer_scale),u_fade_t:new d.aI(f,e.u_fade_t),u_opacity:new d.aI(f,e.u_opacity),u_image0:new d.aH(f,e.u_image0),u_image1:new d.aH(f,e.u_image1),u_brightness_low:new d.aI(f,e.u_brightness_low),u_brightness_high:new d.aI(f,e.u_brightness_high),u_saturation_factor:new d.aI(f,e.u_saturation_factor),u_contrast_factor:new d.aI(f,e.u_contrast_factor),u_spin_weights:new d.aN(f,e.u_spin_weights)}),symbolIcon:(f,e)=>({u_is_size_zoom_constant:new d.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(f,e.u_is_size_feature_constant),u_size_t:new d.aI(f,e.u_size_t),u_size:new d.aI(f,e.u_size),u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_pitch:new d.aI(f,e.u_pitch),u_rotate_symbol:new d.aH(f,e.u_rotate_symbol),u_aspect_ratio:new d.aI(f,e.u_aspect_ratio),u_fade_change:new d.aI(f,e.u_fade_change),u_matrix:new d.aJ(f,e.u_matrix),u_label_plane_matrix:new d.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(f,e.u_coord_matrix),u_is_text:new d.aH(f,e.u_is_text),u_pitch_with_map:new d.aH(f,e.u_pitch_with_map),u_is_along_line:new d.aH(f,e.u_is_along_line),u_is_variable_anchor:new d.aH(f,e.u_is_variable_anchor),u_texsize:new d.aO(f,e.u_texsize),u_texture:new d.aH(f,e.u_texture),u_translation:new d.aO(f,e.u_translation),u_pitched_scale:new d.aI(f,e.u_pitched_scale)}),symbolSDF:(f,e)=>({u_is_size_zoom_constant:new d.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(f,e.u_is_size_feature_constant),u_size_t:new d.aI(f,e.u_size_t),u_size:new d.aI(f,e.u_size),u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_pitch:new d.aI(f,e.u_pitch),u_rotate_symbol:new d.aH(f,e.u_rotate_symbol),u_aspect_ratio:new d.aI(f,e.u_aspect_ratio),u_fade_change:new d.aI(f,e.u_fade_change),u_matrix:new d.aJ(f,e.u_matrix),u_label_plane_matrix:new d.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(f,e.u_coord_matrix),u_is_text:new d.aH(f,e.u_is_text),u_pitch_with_map:new d.aH(f,e.u_pitch_with_map),u_is_along_line:new d.aH(f,e.u_is_along_line),u_is_variable_anchor:new d.aH(f,e.u_is_variable_anchor),u_texsize:new d.aO(f,e.u_texsize),u_texture:new d.aH(f,e.u_texture),u_gamma_scale:new d.aI(f,e.u_gamma_scale),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_is_halo:new d.aH(f,e.u_is_halo),u_translation:new d.aO(f,e.u_translation),u_pitched_scale:new d.aI(f,e.u_pitched_scale)}),symbolTextAndIcon:(f,e)=>({u_is_size_zoom_constant:new d.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(f,e.u_is_size_feature_constant),u_size_t:new d.aI(f,e.u_size_t),u_size:new d.aI(f,e.u_size),u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_pitch:new d.aI(f,e.u_pitch),u_rotate_symbol:new d.aH(f,e.u_rotate_symbol),u_aspect_ratio:new d.aI(f,e.u_aspect_ratio),u_fade_change:new d.aI(f,e.u_fade_change),u_matrix:new d.aJ(f,e.u_matrix),u_label_plane_matrix:new d.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(f,e.u_coord_matrix),u_is_text:new d.aH(f,e.u_is_text),u_pitch_with_map:new d.aH(f,e.u_pitch_with_map),u_is_along_line:new d.aH(f,e.u_is_along_line),u_is_variable_anchor:new d.aH(f,e.u_is_variable_anchor),u_texsize:new d.aO(f,e.u_texsize),u_texsize_icon:new d.aO(f,e.u_texsize_icon),u_texture:new d.aH(f,e.u_texture),u_texture_icon:new d.aH(f,e.u_texture_icon),u_gamma_scale:new d.aI(f,e.u_gamma_scale),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_is_halo:new d.aH(f,e.u_is_halo),u_translation:new d.aO(f,e.u_translation),u_pitched_scale:new d.aI(f,e.u_pitched_scale)}),background:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_opacity:new d.aI(f,e.u_opacity),u_color:new d.aL(f,e.u_color)}),backgroundPattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_opacity:new d.aI(f,e.u_opacity),u_image:new d.aH(f,e.u_image),u_pattern_tl_a:new d.aO(f,e.u_pattern_tl_a),u_pattern_br_a:new d.aO(f,e.u_pattern_br_a),u_pattern_tl_b:new d.aO(f,e.u_pattern_tl_b),u_pattern_br_b:new d.aO(f,e.u_pattern_br_b),u_texsize:new d.aO(f,e.u_texsize),u_mix:new d.aI(f,e.u_mix),u_pattern_size_a:new d.aO(f,e.u_pattern_size_a),u_pattern_size_b:new d.aO(f,e.u_pattern_size_b),u_scale_a:new d.aI(f,e.u_scale_a),u_scale_b:new d.aI(f,e.u_scale_b),u_pixel_coord_upper:new d.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(f,e.u_pixel_coord_lower),u_tile_units_to_pixels:new d.aI(f,e.u_tile_units_to_pixels)}),terrain:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_texture:new d.aH(f,e.u_texture),u_ele_delta:new d.aI(f,e.u_ele_delta),u_fog_matrix:new d.aJ(f,e.u_fog_matrix),u_fog_color:new d.aL(f,e.u_fog_color),u_fog_ground_blend:new d.aI(f,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new d.aI(f,e.u_fog_ground_blend_opacity),u_horizon_color:new d.aL(f,e.u_horizon_color),u_horizon_fog_blend:new d.aI(f,e.u_horizon_fog_blend)}),terrainDepth:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_ele_delta:new d.aI(f,e.u_ele_delta)}),terrainCoords:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_texture:new d.aH(f,e.u_texture),u_terrain_coords_id:new d.aI(f,e.u_terrain_coords_id),u_ele_delta:new d.aI(f,e.u_ele_delta)}),sky:(f,e)=>({u_sky_color:new d.aL(f,e.u_sky_color),u_horizon_color:new d.aL(f,e.u_horizon_color),u_horizon:new d.aI(f,e.u_horizon),u_sky_horizon_blend:new d.aI(f,e.u_sky_horizon_blend)})};class xi{constructor(e,o,u){this.context=e;const c=e.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const o=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Qp={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ku{constructor(e,o,u,c){this.length=o.length,this.attributes=u,this.itemSize=o.bytesPerElement,this.dynamicDraw=c,this.context=e;const p=e.gl;this.buffer=p.createBuffer(),e.bindVertexBuffer.set(this.buffer),p.bufferData(p.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,o){for(let u=0;u<this.attributes.length;u++){const c=o.attributes[this.attributes[u].name];c!==void 0&&e.enableVertexAttribArray(c)}}setVertexAttribPointers(e,o,u){for(let c=0;c<this.attributes.length;c++){const p=this.attributes[c],x=o.attributes[p.name];x!==void 0&&e.vertexAttribPointer(x,p.components,e[Qp[p.type]],!1,this.itemSize,p.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const vs=new WeakMap;function ts(f){var e;if(vs.has(f))return vs.get(f);{const o=(e=f.getParameter(f.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return vs.set(f,o),o}}class Rt{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Qa extends Rt{getDefault(){return d.aM.transparent}set(e){const o=this.current;(e.r!==o.r||e.g!==o.g||e.b!==o.b||e.a!==o.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class ef extends Rt{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class eo extends Rt{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class tf extends Rt{getDefault(){return[!0,!0,!0,!0]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||e[3]!==o[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class kh extends Rt{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class rf extends Rt{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Th extends Rt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const o=this.current;(e.func!==o.func||e.ref!==o.ref||e.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Tu extends Rt{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Ih extends Rt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=e,this.dirty=!1}}class Ch extends Rt{getDefault(){return[0,1]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Eh extends Rt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=e,this.dirty=!1}}class Ph extends Rt{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class xs extends Rt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.BLEND):o.disable(o.BLEND),this.current=e,this.dirty=!1}}class Mh extends Rt{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class nf extends Rt{getDefault(){return d.aM.transparent}set(e){const o=this.current;(e.r!==o.r||e.g!==o.g||e.b!==o.b||e.a!==o.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class zh extends Rt{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class sa extends Rt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=e,this.dirty=!1}}class sf extends Rt{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class el extends Rt{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class of extends Rt{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class af extends Rt{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Ah extends Rt{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||e[3]!==o[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Dh extends Rt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Lh extends Rt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Iu extends Rt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Rh extends Rt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class tl extends Rt{getDefault(){return null}set(e){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ri extends Rt{getDefault(){return null}set(e){var o;if(e===this.current&&!this.dirty)return;const u=this.gl;ts(u)?u.bindVertexArray(e):(o=u.getExtension("OES_vertex_array_object"))===null||o===void 0||o.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Cu extends Rt{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Eu extends Rt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Pu extends Rt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class rl extends Rt{constructor(e,o){super(e),this.context=e,this.parent=o}getDefault(){return null}}class Mu extends rl{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class ws extends rl{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class zu extends rl{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class lf{constructor(e,o,u,c,p){this.context=e,this.width=o,this.height=u;const x=e.gl,S=this.framebuffer=x.createFramebuffer();if(this.colorAttachment=new Mu(e,S),c)this.depthAttachment=p?new zu(e,S):new ws(e,S);else if(p)throw new Error("Stencil cannot be set without depth");if(x.checkFramebufferStatus(x.FRAMEBUFFER)!==x.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,o=this.colorAttachment.get();if(o&&e.deleteTexture(o),this.depthAttachment){const u=this.depthAttachment.get();u&&e.deleteRenderbuffer(u)}e.deleteFramebuffer(this.framebuffer)}}class ar{constructor(e,o,u){this.blendFunction=e,this.blendColor=o,this.mask=u}}ar.Replace=[1,0],ar.disabled=new ar(ar.Replace,d.aM.transparent,[!1,!1,!1,!1]),ar.unblended=new ar(ar.Replace,d.aM.transparent,[!0,!0,!0,!0]),ar.alphaBlended=new ar([1,771],d.aM.transparent,[!0,!0,!0,!0]);class uf{constructor(e){var o,u;if(this.gl=e,this.clearColor=new Qa(this),this.clearDepth=new ef(this),this.clearStencil=new eo(this),this.colorMask=new tf(this),this.depthMask=new kh(this),this.stencilMask=new rf(this),this.stencilFunc=new Th(this),this.stencilOp=new Tu(this),this.stencilTest=new Ih(this),this.depthRange=new Ch(this),this.depthTest=new Eh(this),this.depthFunc=new Ph(this),this.blend=new xs(this),this.blendFunc=new Mh(this),this.blendColor=new nf(this),this.blendEquation=new zh(this),this.cullFace=new sa(this),this.cullFaceSide=new sf(this),this.frontFace=new el(this),this.program=new of(this),this.activeTexture=new af(this),this.viewport=new Ah(this),this.bindFramebuffer=new Dh(this),this.bindRenderbuffer=new Lh(this),this.bindTexture=new Iu(this),this.bindVertexBuffer=new Rh(this),this.bindElementBuffer=new tl(this),this.bindVertexArray=new Ri(this),this.pixelStoreUnpack=new Cu(this),this.pixelStoreUnpackPremultiplyAlpha=new Eu(this),this.pixelStoreUnpackFlipY=new Pu(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),ts(e)){this.HALF_FLOAT=e.HALF_FLOAT;const c=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(o=e.RGBA16F)!==null&&o!==void 0?o:c==null?void 0:c.RGBA16F_EXT,this.RGB16F=(u=e.RGB16F)!==null&&u!==void 0?u:c==null?void 0:c.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const c=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=c==null?void 0:c.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,o){return new xi(this,e,o)}createVertexBuffer(e,o,u){return new ku(this,e,o,u)}createRenderbuffer(e,o,u){const c=this.gl,p=c.createRenderbuffer();return this.bindRenderbuffer.set(p),c.renderbufferStorage(c.RENDERBUFFER,e,o,u),this.bindRenderbuffer.set(null),p}createFramebuffer(e,o,u,c){return new lf(this,e,o,u,c)}clear({color:e,depth:o,stencil:u}){const c=this.gl;let p=0;e&&(p|=c.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(p|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),u!==void 0&&(p|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),c.clear(p)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){d.aE(e.blendFunction,ar.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return ts(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var o;return ts(this.gl)?this.gl.deleteVertexArray(e):(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class bt{constructor(e,o,u){this.func=e,this.mask=o,this.range=u}}bt.ReadOnly=!1,bt.ReadWrite=!0,bt.disabled=new bt(519,bt.ReadOnly,[0,1]);const nl=7680;class qt{constructor(e,o,u,c,p,x){this.test=e,this.ref=o,this.mask=u,this.fail=c,this.depthFail=p,this.pass=x}}qt.disabled=new qt({func:519,mask:0},0,0,nl,nl,nl);class jt{constructor(e,o,u){this.enable=e,this.mode=o,this.frontFace=u}}let bs;function oa(f,e,o,u,c){const p=f.context,x=p.gl,S=f.useProgram("collisionBox"),T=[];let E=0,M=0;for(let ee=0;ee<u.length;ee++){const se=u[ee],G=e.getTile(se).getBucket(o);if(!G)continue;const le=c?G.textCollisionBox:G.iconCollisionBox,ce=G.collisionCircleArray;if(ce.length>0){const me=d.H();d.aQ(me,G.placementInvProjMatrix,f.transform.glCoordMatrix),d.aQ(me,me,G.placementViewportMatrix),T.push({circleArray:ce,circleOffset:M,transform:se.posMatrix,invTransform:me,coord:se}),E+=ce.length/4,M=E}le&&S.draw(p,x.LINES,bt.disabled,qt.disabled,f.colorModeForRenderPass(),jt.disabled,{u_matrix:se.posMatrix,u_pixel_extrude_scale:[1/(z=f.transform).width,1/z.height]},f.style.map.terrain&&f.style.map.terrain.getTerrainData(se),o.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,null,f.transform.zoom,null,null,le.collisionVertexBuffer)}var z;if(!c||!T.length)return;const F=f.useProgram("collisionCircle"),V=new d.aR;V.resize(4*E),V._trim();let $=0;for(const ee of T)for(let se=0;se<ee.circleArray.length/4;se++){const G=4*se,le=ee.circleArray[G+0],ce=ee.circleArray[G+1],me=ee.circleArray[G+2],Ie=ee.circleArray[G+3];V.emplace($++,le,ce,me,Ie,0),V.emplace($++,le,ce,me,Ie,1),V.emplace($++,le,ce,me,Ie,2),V.emplace($++,le,ce,me,Ie,3)}(!bs||bs.length<2*E)&&(bs=function(ee){const se=2*ee,G=new d.aT;G.resize(se),G._trim();for(let le=0;le<se;le++){const ce=6*le;G.uint16[ce+0]=4*le+0,G.uint16[ce+1]=4*le+1,G.uint16[ce+2]=4*le+2,G.uint16[ce+3]=4*le+2,G.uint16[ce+4]=4*le+3,G.uint16[ce+5]=4*le+0}return G}(E));const X=p.createIndexBuffer(bs,!0),Q=p.createVertexBuffer(V,d.aS.members,!0);for(const ee of T){const se=_s(ee.transform,ee.invTransform,f.transform);F.draw(p,x.TRIANGLES,bt.disabled,qt.disabled,f.colorModeForRenderPass(),jt.disabled,se,f.style.map.terrain&&f.style.map.terrain.getTerrainData(ee.coord),o.id,Q,X,d.a0.simpleSegment(0,2*ee.circleOffset,ee.circleArray.length,ee.circleArray.length/2),null,f.transform.zoom,null,null,null)}Q.destroy(),X.destroy()}jt.disabled=new jt(!1,1029,2305),jt.backCCW=new jt(!0,1029,2305);const aa=d.an(new Float32Array(16));function Au(f,e,o,u,c,p){const{horizontalAlign:x,verticalAlign:S}=d.au(f);return new d.P((-(x-.5)*e/c+u[0])*p,(-(S-.5)*o/c+u[1])*p)}function Ss(f,e,o,u,c,p){const x=e.tileAnchorPoint.add(new d.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let S=u.mult(p);o||(S=S.rotate(-c));const T=x.add(S);return J(T.x,T.y,e.labelPlaneMatrix,e.getElevation).point}if(o){const S=we(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(f),T=Math.atan(S.y/S.x)+(S.x<0?Math.PI:0);return f.add(u.rotate(T))}return f.add(u)}function to(f,e,o,u,c,p,x,S,T,E,M,z,F,V){const $=f.text.placedSymbolArray,X=f.text.dynamicLayoutVertexArray,Q=f.icon.dynamicLayoutVertexArray,ee={};X.clear();for(let se=0;se<$.length;se++){const G=$.get(se),le=G.hidden||!G.crossTileID||f.allowVerticalPlacement&&!G.placedOrientation?null:u[G.crossTileID];if(le){const ce=new d.P(G.anchorX,G.anchorY),me={getElevation:V,width:c.width,height:c.height,labelPlaneMatrix:p,pitchWithMap:o,projection:M,tileAnchorPoint:ce,translation:z,unwrappedTileID:F},Ie=o?J(ce.x,ce.y,x,V):we(ce.x,ce.y,me),Ae=L(c.cameraToCenterDistance,Ie.signedDistanceFromCamera);let Ve=d.ai(f.textSizeData,T,G)*Ae/d.ap;o&&(Ve*=f.tilePixelRatio/S);const{width:Ge,height:Be,anchor:Fe,textOffset:Ye,textBoxScale:pt}=le,Ne=Au(Fe,Ge,Be,Ye,pt,Ve),Ze=M.getPitchedTextCorrection(c,ce.add(new d.P(z[0],z[1])),F),ht=Ss(Ie.point,me,e,Ne,c.angle,Ze),Xt=f.allowVerticalPlacement&&G.placedOrientation===d.ah.vertical?Math.PI/2:0;for(let vt=0;vt<G.numGlyphs;vt++)d.aj(X,ht,Xt);E&&G.associatedIconIndex>=0&&(ee[G.associatedIconIndex]={shiftedAnchor:ht,angle:Xt})}else st(G.numGlyphs,X)}if(E){Q.clear();const se=f.icon.placedSymbolArray;for(let G=0;G<se.length;G++){const le=se.get(G);if(le.hidden)st(le.numGlyphs,Q);else{const ce=ee[G];if(ce)for(let me=0;me<le.numGlyphs;me++)d.aj(Q,ce.shiftedAnchor,ce.angle);else st(le.numGlyphs,Q)}}f.icon.dynamicLayoutVertexBuffer.updateData(Q)}f.text.dynamicLayoutVertexBuffer.updateData(X)}function Rn(f,e,o){return o.iconsInText&&e?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function Du(f,e,o,u,c,p,x,S,T,E,M,z){const F=f.context,V=F.gl,$=f.transform,X=gs(),Q=S==="map",ee=T==="map",se=S!=="viewport"&&o.layout.get("symbol-placement")!=="point",G=Q&&!ee&&!se,le=!ee&&se,ce=!o.layout.get("symbol-sort-key").isConstant();let me=!1;const Ie=f.depthModeForSublayer(0,bt.ReadOnly),Ae=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ve=[],Ge=X.getCircleRadiusCorrection($);for(const Be of u){const Fe=e.getTile(Be),Ye=Fe.getBucket(o);if(!Ye)continue;const pt=c?Ye.text:Ye.icon;if(!pt||!pt.segments.get().length||!pt.hasVisibleVertices)continue;const Ne=pt.programConfigurations.get(o.id),Ze=c||Ye.sdfIcons,ht=c?Ye.textSizeData:Ye.iconSizeData,Xt=ee||$.pitch!==0,vt=f.useProgram(Rn(Ze,c,Ye),Ne),kt=d.ag(ht,$.zoom),Kt=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Be);let Or,ti,Jt,cn,Xr=[0,0],Nr=null;if(c)ti=Fe.glyphAtlasTexture,Jt=V.LINEAR,Or=Fe.glyphAtlasTexture.size,Ye.iconsInText&&(Xr=Fe.imageAtlasTexture.size,Nr=Fe.imageAtlasTexture,cn=Xt||f.options.rotating||f.options.zooming||ht.kind==="composite"||ht.kind==="camera"?V.LINEAR:V.NEAREST);else{const It=o.layout.get("icon-size").constantOr(0)!==1||Ye.iconsNeedLinear;ti=Fe.imageAtlasTexture,Jt=Ze||f.options.rotating||f.options.zooming||It||Xt?V.LINEAR:V.NEAREST,Or=Fe.imageAtlasTexture.size}const Kr=St(Fe,1,f.transform.zoom),Si=le?Be.posMatrix:aa,yo=Qi(Si,ee,Q,f.transform,Kr),bl=vi(Si,ee,Q,f.transform,Kr),_o=vi(Be.posMatrix,ee,Q,f.transform,Kr),On=X.translatePosition(f.transform,Fe,p,x),Sl=Ae&&Ye.hasTextData(),ic=o.layout.get("icon-text-fit")!=="none"&&Sl&&Ye.hasIconData();if(se){const It=f.style.map.terrain?(vo,xo)=>f.style.map.terrain.getElevation(Be,vo,xo):null,Es=o.layout.get("text-rotation-alignment")==="map";j(Ye,Be.posMatrix,f,c,yo,_o,ee,E,Es,X,Be.toUnwrapped(),$.width,$.height,On,It)}const Nn=Be.posMatrix,jn=c&&Ae||ic,rs=se||jn?aa:yo,ri=bl,zr=Ze&&o.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let jr;jr=Ze?Ye.iconsInText?wu(ht.kind,kt,G,ee,se,jn,f,Nn,rs,ri,On,Or,Xr,Ge):ia(ht.kind,kt,G,ee,se,jn,f,Nn,rs,ri,On,c,Or,!0,Ge):Sh(ht.kind,kt,G,ee,se,jn,f,Nn,rs,ri,On,c,Or,Ge);const In={program:vt,buffers:pt,uniformValues:jr,atlasTexture:ti,atlasTextureIcon:Nr,atlasInterpolation:Jt,atlasInterpolationIcon:cn,isSDF:Ze,hasHalo:zr};if(ce&&Ye.canOverlap){me=!0;const It=pt.segments.get();for(const Es of It)Ve.push({segments:new d.a0([Es]),sortKey:Es.sortKey,state:In,terrainData:Kt})}else Ve.push({segments:pt.segments,sortKey:0,state:In,terrainData:Kt})}me&&Ve.sort((Be,Fe)=>Be.sortKey-Fe.sortKey);for(const Be of Ve){const Fe=Be.state;if(F.activeTexture.set(V.TEXTURE0),Fe.atlasTexture.bind(Fe.atlasInterpolation,V.CLAMP_TO_EDGE),Fe.atlasTextureIcon&&(F.activeTexture.set(V.TEXTURE1),Fe.atlasTextureIcon&&Fe.atlasTextureIcon.bind(Fe.atlasInterpolationIcon,V.CLAMP_TO_EDGE)),Fe.isSDF){const Ye=Fe.uniformValues;Fe.hasHalo&&(Ye.u_is_halo=1,Lu(Fe.buffers,Be.segments,o,f,Fe.program,Ie,M,z,Ye,Be.terrainData)),Ye.u_is_halo=0}Lu(Fe.buffers,Be.segments,o,f,Fe.program,Ie,M,z,Fe.uniformValues,Be.terrainData)}}function Lu(f,e,o,u,c,p,x,S,T,E){const M=u.context;c.draw(M,M.gl.TRIANGLES,p,x,S,jt.disabled,T,E,o.id,f.layoutVertexBuffer,f.indexBuffer,e,o.paint,u.transform.zoom,f.programConfigurations.get(o.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function Ru(f,e,o,u){const c=f.context,p=c.gl,x=qt.disabled,S=new ar([p.ONE,p.ONE],d.aM.transparent,[!0,!0,!0,!0]),T=e.getBucket(o);if(!T)return;const E=u.key;let M=o.heatmapFbos.get(E);M||(M=la(c,e.tileSize,e.tileSize),o.heatmapFbos.set(E,M)),c.bindFramebuffer.set(M.framebuffer),c.viewport.set([0,0,e.tileSize,e.tileSize]),c.clear({color:d.aM.transparent});const z=T.programConfigurations.get(o.id),F=f.useProgram("heatmap",z),V=f.style.map.terrain.getTerrainData(u);F.draw(c,p.TRIANGLES,bt.disabled,x,S,jt.disabled,un(u.posMatrix,e,f.transform.zoom,o.paint.get("heatmap-intensity")),V,o.id,T.layoutVertexBuffer,T.indexBuffer,T.segments,o.paint,f.transform.zoom,z)}function ks(f,e,o){const u=f.context,c=u.gl;u.setColorMode(f.colorModeForRenderPass());const p=ua(u,e),x=o.key,S=e.heatmapFbos.get(x);S&&(u.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,S.colorAttachment.get()),u.activeTexture.set(c.TEXTURE1),p.bind(c.LINEAR,c.CLAMP_TO_EDGE),f.useProgram("heatmapTexture").draw(u,c.TRIANGLES,bt.disabled,qt.disabled,f.colorModeForRenderPass(),jt.disabled,Xa(f,e,0,1),null,e.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments,e.paint,f.transform.zoom),S.destroy(),e.heatmapFbos.delete(x))}function la(f,e,o){var u,c;const p=f.gl,x=p.createTexture();p.bindTexture(p.TEXTURE_2D,x),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR);const S=(u=f.HALF_FLOAT)!==null&&u!==void 0?u:p.UNSIGNED_BYTE,T=(c=f.RGBA16F)!==null&&c!==void 0?c:p.RGBA;p.texImage2D(p.TEXTURE_2D,0,T,e,o,0,p.RGBA,S,null);const E=f.createFramebuffer(e,o,!1,!1);return E.colorAttachment.set(x),E}function ua(f,e){return e.colorRampTexture||(e.colorRampTexture=new ot(f,e.colorRamp,f.gl.RGBA)),e.colorRampTexture}function ro(f,e,o,u,c){if(!o||!u||!u.imageAtlas)return;const p=u.imageAtlas.patternPositions;let x=p[o.to.toString()],S=p[o.from.toString()];if(!x&&S&&(x=S),!S&&x&&(S=x),!x||!S){const T=c.getPaintProperty(e);x=p[T],S=p[T]}x&&S&&f.setConstantPatternPositions(x,S)}function ca(f,e,o,u,c,p,x){const S=f.context.gl,T="fill-pattern",E=o.paint.get(T),M=E&&E.constantOr(1),z=o.getCrossfadeParameters();let F,V,$,X,Q;x?(V=M&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=S.LINES):(V=M?"fillPattern":"fill",F=S.TRIANGLES);const ee=E.constantOr(null);for(const se of u){const G=e.getTile(se);if(M&&!G.patternsLoaded())continue;const le=G.getBucket(o);if(!le)continue;const ce=le.programConfigurations.get(o.id),me=f.useProgram(V,ce),Ie=f.style.map.terrain&&f.style.map.terrain.getTerrainData(se);M&&(f.context.activeTexture.set(S.TEXTURE0),G.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),ce.updatePaintBuffers(z)),ro(ce,T,ee,G,o);const Ae=Ie?se:null,Ve=f.translatePosMatrix(Ae?Ae.posMatrix:se.posMatrix,G,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(x){X=le.indexBuffer2,Q=le.segments2;const Ge=[S.drawingBufferWidth,S.drawingBufferHeight];$=V==="fillOutlinePattern"&&M?vh(Ve,f,z,G,Ge):Wp(Ve,Ge)}else X=le.indexBuffer,Q=le.segments,$=M?_h(Ve,f,z,G):Ys(Ve);me.draw(f.context,F,c,f.stencilModeForClipping(se),p,jt.disabled,$,Ie,o.id,le.layoutVertexBuffer,X,Q,o.paint,f.transform.zoom,ce)}}function il(f,e,o,u,c,p,x){const S=f.context,T=S.gl,E="fill-extrusion-pattern",M=o.paint.get(E),z=M.constantOr(1),F=o.getCrossfadeParameters(),V=o.paint.get("fill-extrusion-opacity"),$=M.constantOr(null);for(const X of u){const Q=e.getTile(X),ee=Q.getBucket(o);if(!ee)continue;const se=f.style.map.terrain&&f.style.map.terrain.getTerrainData(X),G=ee.programConfigurations.get(o.id),le=f.useProgram(z?"fillExtrusionPattern":"fillExtrusion",G);z&&(f.context.activeTexture.set(T.TEXTURE0),Q.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),G.updatePaintBuffers(F)),ro(G,E,$,Q,o);const ce=f.translatePosMatrix(X.posMatrix,Q,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),me=o.paint.get("fill-extrusion-vertical-gradient"),Ie=z?Wa(ce,f,me,V,X,F,Q):ra(ce,f,me,V);le.draw(S,S.gl.TRIANGLES,c,p,x,jt.backCCW,Ie,se,o.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,o.paint,f.transform.zoom,G,f.style.map.terrain&&ee.centroidVertexBuffer)}}function no(f,e,o,u,c,p,x){const S=f.context,T=S.gl,E=o.fbo;if(!E)return;const M=f.useProgram("hillshade"),z=f.style.map.terrain&&f.style.map.terrain.getTerrainData(e);S.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,E.colorAttachment.get()),M.draw(S,T.TRIANGLES,c,p,x,jt.disabled,((F,V,$,X)=>{const Q=$.paint.get("hillshade-shadow-color"),ee=$.paint.get("hillshade-highlight-color"),se=$.paint.get("hillshade-accent-color");let G=$.paint.get("hillshade-illumination-direction")*(Math.PI/180);$.paint.get("hillshade-illumination-anchor")==="viewport"&&(G-=F.transform.angle);const le=!F.options.moving;return{u_matrix:X?X.posMatrix:F.transform.calculatePosMatrix(V.tileID.toUnwrapped(),le),u_image:0,u_latrange:Ka(0,V.tileID),u_light:[$.paint.get("hillshade-exaggeration"),G],u_shadow:Q,u_highlight:ee,u_accent:se}})(f,o,u,z?e:null),z,u.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}function io(f,e,o,u,c,p){const x=f.context,S=x.gl,T=e.dem;if(T&&T.data){const E=T.dim,M=T.stride,z=T.getPixels();if(x.activeTexture.set(S.TEXTURE1),x.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||f.getTileTexture(M),e.demTexture){const V=e.demTexture;V.update(z,{premultiply:!1}),V.bind(S.NEAREST,S.CLAMP_TO_EDGE)}else e.demTexture=new ot(x,z,S.RGBA,{premultiply:!1}),e.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);x.activeTexture.set(S.TEXTURE0);let F=e.fbo;if(!F){const V=new ot(x,{width:E,height:E,data:null},S.RGBA);V.bind(S.LINEAR,S.CLAMP_TO_EDGE),F=e.fbo=x.createFramebuffer(E,E,!0,!1),F.colorAttachment.set(V.texture)}x.bindFramebuffer.set(F.framebuffer),x.viewport.set([0,0,E,E]),f.useProgram("hillshadePrepare").draw(x,S.TRIANGLES,u,c,p,jt.disabled,((V,$)=>{const X=$.stride,Q=d.H();return d.aP(Q,0,d.X,-d.X,0,0,1),d.J(Q,Q,[0,-d.X,0]),{u_matrix:Q,u_image:1,u_dimension:[X,X],u_zoom:V.overscaledZ,u_unpack:$.getUnpackVector()}})(e.tileID,T),null,o.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function Fh(f,e,o,u,c,p){const x=u.paint.get("raster-fade-duration");if(!p&&x>0){const S=Z.now(),T=(S-f.timeAdded)/x,E=e?(S-e.timeAdded)/x:-1,M=o.getSource(),z=c.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),F=!e||Math.abs(e.tileID.overscaledZ-z)>Math.abs(f.tileID.overscaledZ-z),V=F&&f.refreshedUponExpiration?1:d.ac(F?T:1-E,0,1);return f.refreshedUponExpiration&&T>=1&&(f.refreshedUponExpiration=!1),e?{opacity:1,mix:1-V}:{opacity:V,mix:0}}return{opacity:1,mix:0}}const Fu=new d.aM(1,0,0,1),zt=new d.aM(0,1,0,1),sl=new d.aM(0,0,1,1),cf=new d.aM(1,0,1,1),Bh=new d.aM(0,1,1,1);function so(f,e,o,u){ol(f,0,e+o/2,f.transform.width,o,u)}function Oh(f,e,o,u){ol(f,e-o/2,0,o,f.transform.height,u)}function ol(f,e,o,u,c,p){const x=f.context,S=x.gl;S.enable(S.SCISSOR_TEST),S.scissor(e*f.pixelRatio,o*f.pixelRatio,u*f.pixelRatio,c*f.pixelRatio),x.clear({color:p}),S.disable(S.SCISSOR_TEST)}function Nh(f,e,o){const u=f.context,c=u.gl,p=o.posMatrix,x=f.useProgram("debug"),S=bt.disabled,T=qt.disabled,E=f.colorModeForRenderPass(),M="$debug",z=f.style.map.terrain&&f.style.map.terrain.getTerrainData(o);u.activeTexture.set(c.TEXTURE0);const F=e.getTileByID(o.key).latestRawTileData,V=Math.floor((F&&F.byteLength||0)/1024),$=e.getTile(o).tileSize,X=512/Math.min($,512)*(o.overscaledZ/f.transform.zoom)*.5;let Q=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(Q+=` => ${o.overscaledZ}`),function(ee,se){ee.initDebugOverlayCanvas();const G=ee.debugOverlayCanvas,le=ee.context.gl,ce=ee.debugOverlayCanvas.getContext("2d");ce.clearRect(0,0,G.width,G.height),ce.shadowColor="white",ce.shadowBlur=2,ce.lineWidth=1.5,ce.strokeStyle="white",ce.textBaseline="top",ce.font="bold 36px Open Sans, sans-serif",ce.fillText(se,5,5),ce.strokeText(se,5,5),ee.debugOverlayTexture.update(G),ee.debugOverlayTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE)}(f,`${Q} ${V}kB`),x.draw(u,c.TRIANGLES,S,T,ar.alphaBlended,jt.disabled,na(p,d.aM.transparent,X),null,M,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments),x.draw(u,c.LINE_STRIP,S,T,E,jt.disabled,na(p,d.aM.red),z,M,f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments)}function jh(f,e,o){const u=f.context,c=u.gl,p=f.colorModeForRenderPass(),x=new bt(c.LEQUAL,bt.ReadWrite,f.depthRangeFor3D),S=f.useProgram("terrain"),T=e.getTerrainMesh();u.bindFramebuffer.set(null),u.viewport.set([0,0,f.width,f.height]);for(const E of o){const M=f.renderToTexture.getTexture(E),z=e.getTerrainData(E.tileID);u.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,M.texture);const F=f.transform.calculatePosMatrix(E.tileID.toUnwrapped()),V=e.getMeshFrameDelta(f.transform.zoom),$=f.transform.calculateFogMatrix(E.tileID.toUnwrapped()),X=vu(F,V,$,f.style.sky,f.transform.pitch);S.draw(u,c.TRIANGLES,x,qt.disabled,p,jt.backCCW,X,z,"terrain",T.vertexBuffer,T.indexBuffer,T.segments)}}class al{constructor(e,o,u){this.vertexBuffer=e,this.indexBuffer=o,this.segments=u}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class ll{constructor(e,o){this.context=new uf(e),this.transform=o,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:d.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ct.maxUnderzooming+ct.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new yu}resize(e,o,u){if(this.width=Math.floor(e*u),this.height=Math.floor(o*u),this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style._order)this.style._layers[c].resize()}setup(){const e=this.context,o=new d.aX;o.emplaceBack(0,0),o.emplaceBack(d.X,0),o.emplaceBack(0,d.X),o.emplaceBack(d.X,d.X),this.tileExtentBuffer=e.createVertexBuffer(o,ys.members),this.tileExtentSegments=d.a0.simpleSegment(0,0,4,2);const u=new d.aX;u.emplaceBack(0,0),u.emplaceBack(d.X,0),u.emplaceBack(0,d.X),u.emplaceBack(d.X,d.X),this.debugBuffer=e.createVertexBuffer(u,ys.members),this.debugSegments=d.a0.simpleSegment(0,0,4,5);const c=new d.$;c.emplaceBack(0,0,0,0),c.emplaceBack(d.X,0,d.X,0),c.emplaceBack(0,d.X,0,d.X),c.emplaceBack(d.X,d.X,d.X,d.X),this.rasterBoundsBuffer=e.createVertexBuffer(c,Ji.members),this.rasterBoundsSegments=d.a0.simpleSegment(0,0,4,2);const p=new d.aX;p.emplaceBack(0,0),p.emplaceBack(1,0),p.emplaceBack(0,1),p.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(p,ys.members),this.viewportSegments=d.a0.simpleSegment(0,0,4,2);const x=new d.aZ;x.emplaceBack(0),x.emplaceBack(1),x.emplaceBack(3),x.emplaceBack(2),x.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(x);const S=new d.aY;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(S);const T=this.context.gl;this.stencilClearMode=new qt({func:T.ALWAYS,mask:0},0,255,T.ZERO,T.ZERO,T.ZERO)}clearStencil(){const e=this.context,o=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=d.H();d.aP(u,0,this.width,this.height,0,0,1),d.K(u,u,[o.drawingBufferWidth,o.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,o.TRIANGLES,bt.disabled,this.stencilClearMode,ar.disabled,jt.disabled,ln(u),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,o){if(this.currentStencilSource===e.source||!e.isTileClipped()||!o||!o.length)return;this.currentStencilSource=e.source;const u=this.context,c=u.gl;this.nextStencilID+o.length>256&&this.clearStencil(),u.setColorMode(ar.disabled),u.setDepthMode(bt.disabled);const p=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const x of o){const S=this._tileClippingMaskIDs[x.key]=this.nextStencilID++,T=this.style.map.terrain&&this.style.map.terrain.getTerrainData(x);p.draw(u,c.TRIANGLES,bt.disabled,new qt({func:c.ALWAYS,mask:0},S,255,c.KEEP,c.KEEP,c.REPLACE),ar.disabled,jt.disabled,ln(x.posMatrix),T,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,o=this.context.gl;return new qt({func:o.NOTEQUAL,mask:255},e,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(e){const o=this.context.gl;return new qt({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(e){const o=this.context.gl,u=e.sort((x,S)=>S.overscaledZ-x.overscaledZ),c=u[u.length-1].overscaledZ,p=u[0].overscaledZ-c+1;if(p>1){this.currentStencilSource=void 0,this.nextStencilID+p>256&&this.clearStencil();const x={};for(let S=0;S<p;S++)x[S+c]=new qt({func:o.GEQUAL,mask:255},S+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=p,[x,u]}return[{[c]:qt.disabled},u]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new ar([e.CONSTANT_COLOR,e.ONE],new d.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ar.unblended:ar.alphaBlended}depthModeForSublayer(e,o,u){if(!this.opaquePassEnabledForLayer())return bt.disabled;const c=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new bt(u||this.context.gl.LEQUAL,o,[c,c])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,o){this.style=e,this.options=o,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(Z.now()),this.imageManager.beginFrame();const u=this.style._order,c=this.style.sourceCaches,p={},x={},S={};for(const T in c){const E=c[T];E.used&&E.prepare(this.context),p[T]=E.getVisibleCoordinates(),x[T]=p[T].slice().reverse(),S[T]=E.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let T=0;T<u.length;T++)if(this.style._layers[u[T]].is3D()){this.opaquePassCutoff=T;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const T of u){const E=this.style._layers[T];if(!E.hasOffscreenPass()||E.isHidden(this.transform.zoom))continue;const M=x[E.source];(E.type==="custom"||M.length)&&this.renderLayer(this,c[E.source],E,M)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:o.showOverdrawInspector?d.aM.black:d.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(T,E){const M=T.context,z=M.gl,F=((ee,se,G)=>({u_sky_color:ee.properties.get("sky-color"),u_horizon_color:ee.properties.get("horizon-color"),u_horizon:(se.height/2+se.getHorizon())*G,u_sky_horizon_blend:ee.properties.get("sky-horizon-blend")*se.height/2*G}))(E,T.style.map.transform,T.pixelRatio),V=new bt(z.LEQUAL,bt.ReadWrite,[0,1]),$=qt.disabled,X=T.colorModeForRenderPass(),Q=T.useProgram("sky");if(!E.mesh){const ee=new d.aX;ee.emplaceBack(-1,-1),ee.emplaceBack(1,-1),ee.emplaceBack(1,1),ee.emplaceBack(-1,1);const se=new d.aY;se.emplaceBack(0,1,2),se.emplaceBack(0,2,3),E.mesh=new al(M.createVertexBuffer(ee,ys.members),M.createIndexBuffer(se),d.a0.simpleSegment(0,0,ee.length,se.length))}Q.draw(M,z.TRIANGLES,V,$,X,jt.disabled,F,void 0,"sky",E.mesh.vertexBuffer,E.mesh.indexBuffer,E.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=o.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=u.length-1;this.currentLayer>=0;this.currentLayer--){const T=this.style._layers[u[this.currentLayer]],E=c[T.source],M=p[T.source];this._renderTileClippingMasks(T,M),this.renderLayer(this,E,T,M)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const T=this.style._layers[u[this.currentLayer]],E=c[T.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(T))continue;const M=(T.type==="symbol"?S:x)[T.source];this._renderTileClippingMasks(T,p[T.source]),this.renderLayer(this,E,T,M)}if(this.options.showTileBoundaries){const T=function(E,M){let z=null;const F=Object.values(E._layers).flatMap(Q=>Q.source&&!Q.isHidden(M)?[E.sourceCaches[Q.source]]:[]),V=F.filter(Q=>Q.getSource().type==="vector"),$=F.filter(Q=>Q.getSource().type!=="vector"),X=Q=>{(!z||z.getSource().maxzoom<Q.getSource().maxzoom)&&(z=Q)};return V.forEach(Q=>X(Q)),z||$.forEach(Q=>X(Q)),z}(this.style,this.transform.zoom);T&&function(E,M,z){for(let F=0;F<z.length;F++)Nh(E,M,z[F])}(this,T,T.getVisibleCoordinates())}this.options.showPadding&&function(T){const E=T.transform.padding;so(T,T.transform.height-(E.top||0),3,Fu),so(T,E.bottom||0,3,zt),Oh(T,E.left||0,3,sl),Oh(T,T.transform.width-(E.right||0),3,cf);const M=T.transform.centerPoint;(function(z,F,V,$){ol(z,F-1,V-10,2,20,$),ol(z,F-10,V-1,20,2,$)})(T,M.x,T.transform.height-M.y,Bh)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const o=this.terrainFacilitator.matrix,u=this.transform.modelViewProjectionMatrix;let c=this.terrainFacilitator.dirty;c||(c=e?!d.a_(o,u):!d.a$(o,u)),c||(c=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),c&&(d.b0(o,u),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(p,x){const S=p.context,T=S.gl,E=ar.unblended,M=new bt(T.LEQUAL,bt.ReadWrite,[0,1]),z=x.getTerrainMesh(),F=x.sourceCache.getRenderableTiles(),V=p.useProgram("terrainDepth");S.bindFramebuffer.set(x.getFramebuffer("depth").framebuffer),S.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),S.clear({color:d.aM.transparent,depth:1});for(const $ of F){const X=x.getTerrainData($.tileID),Q={u_matrix:p.transform.calculatePosMatrix($.tileID.toUnwrapped()),u_ele_delta:x.getMeshFrameDelta(p.transform.zoom)};V.draw(S,T.TRIANGLES,M,qt.disabled,E,jt.backCCW,Q,X,"terrain",z.vertexBuffer,z.indexBuffer,z.segments)}S.bindFramebuffer.set(null),S.viewport.set([0,0,p.width,p.height])}(this,this.style.map.terrain),function(p,x){const S=p.context,T=S.gl,E=ar.unblended,M=new bt(T.LEQUAL,bt.ReadWrite,[0,1]),z=x.getTerrainMesh(),F=x.getCoordsTexture(),V=x.sourceCache.getRenderableTiles(),$=p.useProgram("terrainCoords");S.bindFramebuffer.set(x.getFramebuffer("coords").framebuffer),S.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),S.clear({color:d.aM.transparent,depth:1}),x.coordsIndex=[];for(const X of V){const Q=x.getTerrainData(X.tileID);S.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,F.texture);const ee={u_matrix:p.transform.calculatePosMatrix(X.tileID.toUnwrapped()),u_terrain_coords_id:(255-x.coordsIndex.length)/255,u_texture:0,u_ele_delta:x.getMeshFrameDelta(p.transform.zoom)};$.draw(S,T.TRIANGLES,M,qt.disabled,E,jt.backCCW,ee,Q,"terrain",z.vertexBuffer,z.indexBuffer,z.segments),x.coordsIndex.push(X.tileID.key)}S.bindFramebuffer.set(null),S.viewport.set([0,0,p.width,p.height])}(this,this.style.map.terrain))}renderLayer(e,o,u,c){if(!u.isHidden(this.transform.zoom)&&(u.type==="background"||u.type==="custom"||(c||[]).length))switch(this.id=u.id,u.type){case"symbol":(function(p,x,S,T,E){if(p.renderPass!=="translucent")return;const M=qt.disabled,z=p.colorModeForRenderPass();(S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(F,V,$,X,Q,ee,se,G,le){const ce=V.transform,me=gs(),Ie=Q==="map",Ae=ee==="map";for(const Ve of F){const Ge=X.getTile(Ve),Be=Ge.getBucket($);if(!Be||!Be.text||!Be.text.segments.get().length)continue;const Fe=d.ag(Be.textSizeData,ce.zoom),Ye=St(Ge,1,V.transform.zoom),pt=Qi(Ve.posMatrix,Ae,Ie,V.transform,Ye),Ne=$.layout.get("icon-text-fit")!=="none"&&Be.hasIconData();if(Fe){const Ze=Math.pow(2,ce.zoom-Ge.tileID.overscaledZ),ht=V.style.map.terrain?(vt,kt)=>V.style.map.terrain.getElevation(Ve,vt,kt):null,Xt=me.translatePosition(ce,Ge,se,G);to(Be,Ie,Ae,le,ce,pt,Ve.posMatrix,Ze,Fe,Ne,me,Xt,Ve.toUnwrapped(),ht)}}}(T,p,S,x,S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),E),S.paint.get("icon-opacity").constantOr(1)!==0&&Du(p,x,S,T,!1,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),S.layout.get("icon-rotation-alignment"),S.layout.get("icon-pitch-alignment"),S.layout.get("icon-keep-upright"),M,z),S.paint.get("text-opacity").constantOr(1)!==0&&Du(p,x,S,T,!0,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.layout.get("text-keep-upright"),M,z),x.map.showCollisionBoxes&&(oa(p,x,S,T,!0),oa(p,x,S,T,!1))})(e,o,u,c,this.style.placement.variableOffsets);break;case"circle":(function(p,x,S,T){if(p.renderPass!=="translucent")return;const E=S.paint.get("circle-opacity"),M=S.paint.get("circle-stroke-width"),z=S.paint.get("circle-stroke-opacity"),F=!S.layout.get("circle-sort-key").isConstant();if(E.constantOr(1)===0&&(M.constantOr(1)===0||z.constantOr(1)===0))return;const V=p.context,$=V.gl,X=p.depthModeForSublayer(0,bt.ReadOnly),Q=qt.disabled,ee=p.colorModeForRenderPass(),se=[];for(let G=0;G<T.length;G++){const le=T[G],ce=x.getTile(le),me=ce.getBucket(S);if(!me)continue;const Ie=me.programConfigurations.get(S.id),Ae=p.useProgram("circle",Ie),Ve=me.layoutVertexBuffer,Ge=me.indexBuffer,Be=p.style.map.terrain&&p.style.map.terrain.getTerrainData(le),Fe={programConfiguration:Ie,program:Ae,layoutVertexBuffer:Ve,indexBuffer:Ge,uniformValues:Xp(p,le,ce,S),terrainData:Be};if(F){const Ye=me.segments.get();for(const pt of Ye)se.push({segments:new d.a0([pt]),sortKey:pt.sortKey,state:Fe})}else se.push({segments:me.segments,sortKey:0,state:Fe})}F&&se.sort((G,le)=>G.sortKey-le.sortKey);for(const G of se){const{programConfiguration:le,program:ce,layoutVertexBuffer:me,indexBuffer:Ie,uniformValues:Ae,terrainData:Ve}=G.state;ce.draw(V,$.TRIANGLES,X,Q,ee,jt.disabled,Ae,Ve,S.id,me,Ie,G.segments,S.paint,p.transform.zoom,le)}})(e,o,u,c);break;case"heatmap":(function(p,x,S,T){if(S.paint.get("heatmap-opacity")===0)return;const E=p.context;if(p.style.map.terrain){for(const M of T){const z=x.getTile(M);x.hasRenderableParent(M)||(p.renderPass==="offscreen"?Ru(p,z,S,M):p.renderPass==="translucent"&&ks(p,S,M))}E.viewport.set([0,0,p.width,p.height])}else p.renderPass==="offscreen"?function(M,z,F,V){const $=M.context,X=$.gl,Q=qt.disabled,ee=new ar([X.ONE,X.ONE],d.aM.transparent,[!0,!0,!0,!0]);(function(se,G,le){const ce=se.gl;se.activeTexture.set(ce.TEXTURE1),se.viewport.set([0,0,G.width/4,G.height/4]);let me=le.heatmapFbos.get(d.aU);me?(ce.bindTexture(ce.TEXTURE_2D,me.colorAttachment.get()),se.bindFramebuffer.set(me.framebuffer)):(me=la(se,G.width/4,G.height/4),le.heatmapFbos.set(d.aU,me))})($,M,F),$.clear({color:d.aM.transparent});for(let se=0;se<V.length;se++){const G=V[se];if(z.hasRenderableParent(G))continue;const le=z.getTile(G),ce=le.getBucket(F);if(!ce)continue;const me=ce.programConfigurations.get(F.id),Ie=M.useProgram("heatmap",me),{zoom:Ae}=M.transform;Ie.draw($,X.TRIANGLES,bt.disabled,Q,ee,jt.disabled,un(G.posMatrix,le,Ae,F.paint.get("heatmap-intensity")),null,F.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,F.paint,M.transform.zoom,me)}$.viewport.set([0,0,M.width,M.height])}(p,x,S,T):p.renderPass==="translucent"&&function(M,z){const F=M.context,V=F.gl;F.setColorMode(M.colorModeForRenderPass());const $=z.heatmapFbos.get(d.aU);$&&(F.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,$.colorAttachment.get()),F.activeTexture.set(V.TEXTURE1),ua(F,z).bind(V.LINEAR,V.CLAMP_TO_EDGE),M.useProgram("heatmapTexture").draw(F,V.TRIANGLES,bt.disabled,qt.disabled,M.colorModeForRenderPass(),jt.disabled,Xa(M,z,0,1),null,z.id,M.viewportBuffer,M.quadTriangleIndexBuffer,M.viewportSegments,z.paint,M.transform.zoom))}(p,S)})(e,o,u,c);break;case"line":(function(p,x,S,T){if(p.renderPass!=="translucent")return;const E=S.paint.get("line-opacity"),M=S.paint.get("line-width");if(E.constantOr(1)===0||M.constantOr(1)===0)return;const z=p.depthModeForSublayer(0,bt.ReadOnly),F=p.colorModeForRenderPass(),V=S.paint.get("line-dasharray"),$=S.paint.get("line-pattern"),X=$.constantOr(1),Q=S.paint.get("line-gradient"),ee=S.getCrossfadeParameters(),se=X?"linePattern":V?"lineSDF":Q?"lineGradient":"line",G=p.context,le=G.gl;let ce=!0;for(const me of T){const Ie=x.getTile(me);if(X&&!Ie.patternsLoaded())continue;const Ae=Ie.getBucket(S);if(!Ae)continue;const Ve=Ae.programConfigurations.get(S.id),Ge=p.context.program.get(),Be=p.useProgram(se,Ve),Fe=ce||Be.program!==Ge,Ye=p.style.map.terrain&&p.style.map.terrain.getTerrainData(me),pt=$.constantOr(null);if(pt&&Ie.imageAtlas){const ht=Ie.imageAtlas,Xt=ht.patternPositions[pt.to.toString()],vt=ht.patternPositions[pt.from.toString()];Xt&&vt&&Ve.setConstantPatternPositions(Xt,vt)}const Ne=Ye?me:null,Ze=X?Qs(p,Ie,S,ee,Ne):V?Kp(p,Ie,S,V,ee,Ne):Q?xh(p,Ie,S,Ae.lineClipsArray.length,Ne):Ja(p,Ie,S,Ne);if(X)G.activeTexture.set(le.TEXTURE0),Ie.imageAtlasTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE),Ve.updatePaintBuffers(ee);else if(V&&(Fe||p.lineAtlas.dirty))G.activeTexture.set(le.TEXTURE0),p.lineAtlas.bind(G);else if(Q){const ht=Ae.gradients[S.id];let Xt=ht.texture;if(S.gradientVersion!==ht.version){let vt=256;if(S.stepInterpolant){const kt=x.getSource().maxzoom,Kt=me.canonical.z===kt?Math.ceil(1<<p.transform.maxZoom-me.canonical.z):1;vt=d.ac(d.aV(Ae.maxLineLength/d.X*1024*Kt),256,G.maxTextureSize)}ht.gradient=d.aW({expression:S.gradientExpression(),evaluationKey:"lineProgress",resolution:vt,image:ht.gradient||void 0,clips:Ae.lineClipsArray}),ht.texture?ht.texture.update(ht.gradient):ht.texture=new ot(G,ht.gradient,le.RGBA),ht.version=S.gradientVersion,Xt=ht.texture}G.activeTexture.set(le.TEXTURE0),Xt.bind(S.stepInterpolant?le.NEAREST:le.LINEAR,le.CLAMP_TO_EDGE)}Be.draw(G,le.TRIANGLES,z,p.stencilModeForClipping(me),F,jt.disabled,Ze,Ye,S.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,S.paint,p.transform.zoom,Ve,Ae.layoutVertexBuffer2),ce=!1}})(e,o,u,c);break;case"fill":(function(p,x,S,T){const E=S.paint.get("fill-color"),M=S.paint.get("fill-opacity");if(M.constantOr(1)===0)return;const z=p.colorModeForRenderPass(),F=S.paint.get("fill-pattern"),V=p.opaquePassEnabledForLayer()&&!F.constantOr(1)&&E.constantOr(d.aM.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===V){const $=p.depthModeForSublayer(1,p.renderPass==="opaque"?bt.ReadWrite:bt.ReadOnly);ca(p,x,S,T,$,z,!1)}if(p.renderPass==="translucent"&&S.paint.get("fill-antialias")){const $=p.depthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,bt.ReadOnly);ca(p,x,S,T,$,z,!0)}})(e,o,u,c);break;case"fill-extrusion":(function(p,x,S,T){const E=S.paint.get("fill-extrusion-opacity");if(E!==0&&p.renderPass==="translucent"){const M=new bt(p.context.gl.LEQUAL,bt.ReadWrite,p.depthRangeFor3D);if(E!==1||S.paint.get("fill-extrusion-pattern").constantOr(1))il(p,x,S,T,M,qt.disabled,ar.disabled),il(p,x,S,T,M,p.stencilModeFor3D(),p.colorModeForRenderPass());else{const z=p.colorModeForRenderPass();il(p,x,S,T,M,qt.disabled,z)}}})(e,o,u,c);break;case"hillshade":(function(p,x,S,T){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent")return;const E=p.context,M=p.depthModeForSublayer(0,bt.ReadOnly),z=p.colorModeForRenderPass(),[F,V]=p.renderPass==="translucent"?p.stencilConfigForOverlap(T):[{},T];for(const $ of V){const X=x.getTile($);X.needsHillshadePrepare!==void 0&&X.needsHillshadePrepare&&p.renderPass==="offscreen"?io(p,X,S,M,qt.disabled,z):p.renderPass==="translucent"&&no(p,$,X,S,M,F[$.overscaledZ],z)}E.viewport.set([0,0,p.width,p.height])})(e,o,u,c);break;case"raster":(function(p,x,S,T){if(p.renderPass!=="translucent"||S.paint.get("raster-opacity")===0||!T.length)return;const E=p.context,M=E.gl,z=x.getSource(),F=p.useProgram("raster"),V=p.colorModeForRenderPass(),[$,X]=z instanceof Di?[{},T]:p.stencilConfigForOverlap(T),Q=X[X.length-1].overscaledZ,ee=!p.options.moving;for(const se of X){const G=p.depthModeForSublayer(se.overscaledZ-Q,S.paint.get("raster-opacity")===1?bt.ReadWrite:bt.ReadOnly,M.LESS),le=x.getTile(se);le.registerFadeDuration(S.paint.get("raster-fade-duration"));const ce=x.findLoadedParent(se,0),me=x.findLoadedSibling(se),Ie=Fh(le,ce||me||null,x,S,p.transform,p.style.map.terrain);let Ae,Ve;const Ge=S.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;E.activeTexture.set(M.TEXTURE0),le.texture.bind(Ge,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(M.TEXTURE1),ce?(ce.texture.bind(Ge,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),Ae=Math.pow(2,ce.tileID.overscaledZ-le.tileID.overscaledZ),Ve=[le.tileID.canonical.x*Ae%1,le.tileID.canonical.y*Ae%1]):le.texture.bind(Ge,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),le.texture.useMipmap&&E.extTextureFilterAnisotropic&&p.transform.pitch>20&&M.texParameterf(M.TEXTURE_2D,E.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,E.extTextureFilterAnisotropicMax);const Be=p.style.map.terrain&&p.style.map.terrain.getTerrainData(se),Fe=Be?se:null,Ye=Fe?Fe.posMatrix:p.transform.calculatePosMatrix(se.toUnwrapped(),ee),pt=Jp(Ye,Ve||[0,0],Ae||1,Ie,S);z instanceof Di?F.draw(E,M.TRIANGLES,G,qt.disabled,V,jt.disabled,pt,Be,S.id,z.boundsBuffer,p.quadTriangleIndexBuffer,z.boundsSegments):F.draw(E,M.TRIANGLES,G,$[se.overscaledZ],V,jt.disabled,pt,Be,S.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}})(e,o,u,c);break;case"background":(function(p,x,S,T){const E=S.paint.get("background-color"),M=S.paint.get("background-opacity");if(M===0)return;const z=p.context,F=z.gl,V=p.transform,$=V.tileSize,X=S.paint.get("background-pattern");if(p.isPatternMissing(X))return;const Q=!X&&E.a===1&&M===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==Q)return;const ee=qt.disabled,se=p.depthModeForSublayer(0,Q==="opaque"?bt.ReadWrite:bt.ReadOnly),G=p.colorModeForRenderPass(),le=p.useProgram(X?"backgroundPattern":"background"),ce=T||V.coveringTiles({tileSize:$,terrain:p.style.map.terrain});X&&(z.activeTexture.set(F.TEXTURE0),p.imageManager.bind(p.context));const me=S.getCrossfadeParameters();for(const Ie of ce){const Ae=T?Ie.posMatrix:p.transform.calculatePosMatrix(Ie.toUnwrapped()),Ve=X?bu(Ae,M,p,X,{tileID:Ie,tileSize:$},me):Ya(Ae,M,E),Ge=p.style.map.terrain&&p.style.map.terrain.getTerrainData(Ie);le.draw(z,F.TRIANGLES,se,ee,G,jt.disabled,Ve,Ge,S.id,p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}})(e,0,u,c);break;case"custom":(function(p,x,S){const T=p.context,E=S.implementation;if(p.renderPass==="offscreen"){const M=E.prerender;M&&(p.setCustomLayerDefaults(),T.setColorMode(p.colorModeForRenderPass()),M.call(E,T.gl,p.transform.customLayerMatrix()),T.setDirty(),p.setBaseState())}else if(p.renderPass==="translucent"){p.setCustomLayerDefaults(),T.setColorMode(p.colorModeForRenderPass()),T.setStencilMode(qt.disabled);const M=E.renderingMode==="3d"?new bt(p.context.gl.LEQUAL,bt.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,bt.ReadOnly);T.setDepthMode(M),E.render(T.gl,p.transform.customLayerMatrix(),{farZ:p.transform.farZ,nearZ:p.transform.nearZ,fov:p.transform._fov,modelViewProjectionMatrix:p.transform.modelViewProjectionMatrix,projectionMatrix:p.transform.projectionMatrix}),T.setDirty(),p.setBaseState(),T.bindFramebuffer.set(null)}})(e,0,u)}}translatePosMatrix(e,o,u,c,p){if(!u[0]&&!u[1])return e;const x=p?c==="map"?this.transform.angle:0:c==="viewport"?-this.transform.angle:0;if(x){const E=Math.sin(x),M=Math.cos(x);u=[u[0]*M-u[1]*E,u[0]*E+u[1]*M]}const S=[p?u[0]:St(o,u[0],this.transform.zoom),p?u[1]:St(o,u[1],this.transform.zoom),0],T=new Float32Array(16);return d.J(T,e,S),T}saveTileTexture(e){const o=this._tileTextures[e.size[0]];o?o.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const o=this._tileTextures[e];return o&&o.length>0?o.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const o=this.imageManager.getPattern(e.from.toString()),u=this.imageManager.getPattern(e.to.toString());return!o||!u}useProgram(e,o){this.cache=this.cache||{};const u=e+(o?o.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[u]||(this.cache[u]=new xu(this.context,es[e],o,Su[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[u]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ot(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:o}=this.context.gl;return this.width!==e||this.height!==o}}class oo{constructor(e,o){this.points=e,this.planes=o}static fromInvProjectionMatrix(e,o,u){const c=Math.pow(2,u),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const T=1/(S=d.af([],S,e))[3]/o*c;return d.b1(S,S,[T,T,1/S[3],T])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const T=function(F,V){var $=V[0],X=V[1],Q=V[2],ee=$*$+X*X+Q*Q;return ee>0&&(ee=1/Math.sqrt(ee)),F[0]=V[0]*ee,F[1]=V[1]*ee,F[2]=V[2]*ee,F}([],function(F,V,$){var X=V[0],Q=V[1],ee=V[2],se=$[0],G=$[1],le=$[2];return F[0]=Q*le-ee*G,F[1]=ee*se-X*le,F[2]=X*G-Q*se,F}([],ze([],p[S[0]],p[S[1]]),ze([],p[S[2]],p[S[1]]))),E=-((M=T)[0]*(z=p[S[1]])[0]+M[1]*z[1]+M[2]*z[2]);var M,z;return T.concat(E)});return new oo(p,x)}}class ao{constructor(e,o){this.min=e,this.max=o,this.center=function(u,c,p){return u[0]=.5*c[0],u[1]=.5*c[1],u[2]=.5*c[2],u}([],function(u,c,p){return u[0]=c[0]+p[0],u[1]=c[1]+p[1],u[2]=c[2]+p[2],u}([],this.min,this.max))}quadrant(e){const o=[e%2==0,e<2],u=ye(this.min),c=ye(this.max);for(let p=0;p<o.length;p++)u[p]=o[p]?this.min[p]:this.center[p],c[p]=o[p]?this.center[p]:this.max[p];return c[2]=this.max[2],new ao(u,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const o=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let u=!0;for(let c=0;c<e.planes.length;c++){const p=e.planes[c];let x=0;for(let S=0;S<o.length;S++)d.b2(p,o[S])>=0&&x++;if(x===0)return 0;x!==o.length&&(u=!1)}if(u)return 2;for(let c=0;c<3;c++){let p=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let S=0;S<e.points.length;S++){const T=e.points[S][c]-this.min[c];p=Math.min(p,T),x=Math.max(x,T)}if(x<0||p>this.max[c]-this.min[c])return 0}return 1}}class lo{constructor(e=0,o=0,u=0,c=0){if(isNaN(e)||e<0||isNaN(o)||o<0||isNaN(u)||u<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=o,this.left=u,this.right=c}interpolate(e,o,u){return o.top!=null&&e.top!=null&&(this.top=d.y.number(e.top,o.top,u)),o.bottom!=null&&e.bottom!=null&&(this.bottom=d.y.number(e.bottom,o.bottom,u)),o.left!=null&&e.left!=null&&(this.left=d.y.number(e.left,o.left,u)),o.right!=null&&e.right!=null&&(this.right=d.y.number(e.right,o.right,u)),this}getCenter(e,o){const u=d.ac((this.left+e-this.right)/2,0,e),c=d.ac((this.top+o-this.bottom)/2,0,o);return new d.P(u,c)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new lo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Bu=85.051129;class uo{constructor(e,o,u,c,p){this.tileSize=512,this._renderWorldCopies=p===void 0||!!p,this._minZoom=e||0,this._maxZoom=o||22,this._minPitch=u??0,this._maxPitch=c??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new d.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new lo,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new uo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const o=-d.b3(e,-180,180)*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=function(){var u=new d.A(4);return d.A!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u}(),function(u,c,p){var x=c[0],S=c[1],T=c[2],E=c[3],M=Math.sin(p),z=Math.cos(p);u[0]=x*z+T*M,u[1]=S*z+E*M,u[2]=x*-M+T*z,u[3]=S*-M+E*z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const o=d.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const o=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._zoom=o,this.tileZoom=Math.max(0,Math.floor(o)),this.scale=this.zoomScale(o),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,o,u){this._unmodified=!1,this._edgeInsets.interpolate(e,o,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const o=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(e){const o=[new d.b4(0,e)];if(this._renderWorldCopies){const u=this.pointCoordinate(new d.P(0,0)),c=this.pointCoordinate(new d.P(this.width,0)),p=this.pointCoordinate(new d.P(this.width,this.height)),x=this.pointCoordinate(new d.P(0,this.height)),S=Math.floor(Math.min(u.x,c.x,p.x,x.x)),T=Math.floor(Math.max(u.x,c.x,p.x,x.x)),E=1;for(let M=S-E;M<=T+E;M++)M!==0&&o.push(new d.b4(M,e))}return o}coveringTiles(e){var o,u;let c=this.coveringZoomLevel(e);const p=c;if(e.minzoom!==void 0&&c<e.minzoom)return[];e.maxzoom!==void 0&&c>e.maxzoom&&(c=e.maxzoom);const x=this.pointCoordinate(this.getCameraPoint()),S=d.Z.fromLngLat(this.center),T=Math.pow(2,c),E=[T*x.x,T*x.y,0],M=[T*S.x,T*S.y,0],z=oo.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,c);let F=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(F=c);const V=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,$=G=>({aabb:new ao([G*T,0,0],[(G+1)*T,T,0]),zoom:0,x:0,y:0,wrap:G,fullyVisible:!1}),X=[],Q=[],ee=c,se=e.reparseOverscaled?p:c;if(this._renderWorldCopies)for(let G=1;G<=3;G++)X.push($(-G)),X.push($(G));for(X.push($(0));X.length>0;){const G=X.pop(),le=G.x,ce=G.y;let me=G.fullyVisible;if(!me){const Be=G.aabb.intersects(z);if(Be===0)continue;me=Be===2}const Ie=e.terrain?E:M,Ae=G.aabb.distanceX(Ie),Ve=G.aabb.distanceY(Ie),Ge=Math.max(Math.abs(Ae),Math.abs(Ve));if(G.zoom===ee||Ge>V+(1<<ee-G.zoom)-2&&G.zoom>=F){const Be=ee-G.zoom,Fe=E[0]-.5-(le<<Be),Ye=E[1]-.5-(ce<<Be);Q.push({tileID:new d.S(G.zoom===ee?se:G.zoom,G.wrap,G.zoom,le,ce),distanceSq:Ue([M[0]-.5-le,M[1]-.5-ce]),tileDistanceToCamera:Math.sqrt(Fe*Fe+Ye*Ye)})}else for(let Be=0;Be<4;Be++){const Fe=(le<<1)+Be%2,Ye=(ce<<1)+(Be>>1),pt=G.zoom+1;let Ne=G.aabb.quadrant(Be);if(e.terrain){const Ze=new d.S(pt,G.wrap,pt,Fe,Ye),ht=e.terrain.getMinMaxElevation(Ze),Xt=(o=ht.minElevation)!==null&&o!==void 0?o:this.elevation,vt=(u=ht.maxElevation)!==null&&u!==void 0?u:this.elevation;Ne=new ao([Ne.min[0],Ne.min[1],Xt],[Ne.max[0],Ne.max[1],vt])}X.push({aabb:Ne,zoom:pt,x:Fe,y:Ye,wrap:G.wrap,fullyVisible:me})}}return Q.sort((G,le)=>G.distanceSq-le.distanceSq).map(G=>G.tileID)}resize(e,o){this.width=e,this.height=o,this.pixelsToGLUnits=[2/e,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const o=d.ac(e.lat,-85.051129,Bu);return new d.P(d.O(e.lng)*this.worldSize,d.Q(o)*this.worldSize)}unproject(e){return new d.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const o=this.elevation,u=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,c=this.pointLocation(this.centerPoint,e),p=e.getElevationForLngLatZoom(c,this.tileZoom);if(!(this.elevation-p))return;const x=u+o-p,S=Math.cos(this._pitch)*this.cameraToCenterDistance/x/d.b5(1,c.lat),T=this.scaleZoom(S/this.tileSize);this._elevation=p,this._center=c,this.zoom=T}setLocationAtPoint(e,o){const u=this.pointCoordinate(o),c=this.pointCoordinate(this.centerPoint),p=this.locationCoordinate(e),x=new d.Z(p.x-(u.x-c.x),p.y-(u.y-c.y));this.center=this.coordinateLocation(x),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,o){return o?this.coordinatePoint(this.locationCoordinate(e),o.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,o){return this.coordinateLocation(this.pointCoordinate(e,o))}locationCoordinate(e){return d.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,o){if(o){const F=o.pointCoordinate(e);if(F!=null)return F}const u=[e.x,e.y,0,1],c=[e.x,e.y,1,1];d.af(u,u,this.pixelMatrixInverse),d.af(c,c,this.pixelMatrixInverse);const p=u[3],x=c[3],S=u[1]/p,T=c[1]/x,E=u[2]/p,M=c[2]/x,z=E===M?0:(0-E)/(M-E);return new d.Z(d.y.number(u[0]/p,c[0]/x,z)/this.worldSize,d.y.number(S,T,z)/this.worldSize)}coordinatePoint(e,o=0,u=this.pixelMatrix){const c=[e.x*this.worldSize,e.y*this.worldSize,o,1];return d.af(c,c,u),new d.P(c[0]/c[3],c[1]/c[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new ve().extend(this.pointLocation(new d.P(0,e))).extend(this.pointLocation(new d.P(this.width,e))).extend(this.pointLocation(new d.P(this.width,this.height))).extend(this.pointLocation(new d.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new ve([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Bu])}calculateTileMatrix(e){const o=e.canonical,u=this.worldSize/this.zoomScale(o.z),c=o.x+Math.pow(2,o.z)*e.wrap,p=d.an(new Float64Array(16));return d.J(p,p,[c*u,o.y*u,0]),d.K(p,p,[u/d.X,u/d.X,1]),p}calculatePosMatrix(e,o=!1){const u=e.key,c=o?this._alignedPosMatrixCache:this._posMatrixCache;if(c[u])return c[u];const p=this.calculateTileMatrix(e);return d.L(p,o?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,p),c[u]=new Float32Array(p),c[u]}calculateFogMatrix(e){const o=e.key,u=this._fogMatrixCache;if(u[o])return u[o];const c=this.calculateTileMatrix(e);return d.L(c,this.fogMatrix,c),u[o]=new Float32Array(c),u[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,o){o=d.ac(+o,this.minZoom,this.maxZoom);const u={center:new d.N(e.lng,e.lat),zoom:o};let c=this.lngRange;if(!this._renderWorldCopies&&c===null){const G=179.9999999999;c=[-G,G]}const p=this.tileSize*this.zoomScale(u.zoom);let x=0,S=p,T=0,E=p,M=0,z=0;const{x:F,y:V}=this.size;if(this.latRange){const G=this.latRange;x=d.Q(G[1])*p,S=d.Q(G[0])*p,S-x<V&&(M=V/(S-x))}c&&(T=d.b3(d.O(c[0])*p,0,p),E=d.b3(d.O(c[1])*p,0,p),E<T&&(E+=p),E-T<F&&(z=F/(E-T)));const{x:$,y:X}=this.project.call({worldSize:p},e);let Q,ee;const se=Math.max(z||0,M||0);if(se){const G=new d.P(z?(E+T)/2:$,M?(S+x)/2:X);return u.center=this.unproject.call({worldSize:p},G).wrap(),u.zoom+=this.scaleZoom(se),u}if(this.latRange){const G=V/2;X-G<x&&(ee=x+G),X+G>S&&(ee=S-G)}if(c){const G=(T+E)/2;let le=$;this._renderWorldCopies&&(le=d.b3($,G-p/2,G+p/2));const ce=F/2;le-ce<T&&(Q=T+ce),le+ce>E&&(Q=E-ce)}if(Q!==void 0||ee!==void 0){const G=new d.P(Q??$,ee??X);u.center=this.unproject.call({worldSize:p},G).wrap()}return u}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:o,zoom:u}=this.getConstrained(this.center,this.zoom);this.center=o,this.zoom=u,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,o=this.point.x,u=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=d.b5(1,this.center.lat)*this.worldSize;let c=d.an(new Float64Array(16));d.K(c,c,[this.width/2,-this.height/2,1]),d.J(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=d.an(new Float64Array(16)),d.K(c,c,[1,-1,1]),d.J(c,c,[-1,-1,0]),d.K(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c;const p=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),x=Math.min(this.elevation,this.minElevationForCurrentTile),S=p-x*this._pixelPerMeter/Math.cos(this._pitch),T=x<0?S:p,E=Math.PI/2+this._pitch,M=this._fov*(.5+e.y/this.height),z=Math.sin(M)*T/Math.sin(d.ac(Math.PI-E-M,.01,Math.PI-.01)),F=this.getHorizon(),V=2*Math.atan(F/this.cameraToCenterDistance)*(.5+e.y/(2*F)),$=Math.sin(V)*T/Math.sin(d.ac(Math.PI-E-V,.01,Math.PI-.01)),X=Math.min(z,$);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*X+T),this.nearZ=this.height/50,c=new Float64Array(16),d.b6(c,this._fov,this.width/this.height,this.nearZ,this.farZ),c[8]=2*-e.x/this.width,c[9]=2*e.y/this.height,this.projectionMatrix=d.ae(c),d.K(c,c,[1,-1,1]),d.J(c,c,[0,0,-this.cameraToCenterDistance]),d.b7(c,c,this._pitch),d.ad(c,c,this.angle),d.J(c,c,[-o,-u,0]),this.mercatorMatrix=d.K([],c,[this.worldSize,this.worldSize,this.worldSize]),d.K(c,c,[1,1,this._pixelPerMeter]),this.pixelMatrix=d.L(new Float64Array(16),this.labelPlaneMatrix,c),d.J(c,c,[0,0,-this.elevation]),this.modelViewProjectionMatrix=c,this.invModelViewProjectionMatrix=d.as([],c),this.fogMatrix=new Float64Array(16),d.b6(this.fogMatrix,this._fov,this.width/this.height,p,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,d.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),d.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),d.b7(this.fogMatrix,this.fogMatrix,this._pitch),d.ad(this.fogMatrix,this.fogMatrix,this.angle),d.J(this.fogMatrix,this.fogMatrix,[-o,-u,0]),d.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),d.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=d.L(new Float64Array(16),this.labelPlaneMatrix,c);const Q=this.width%2/2,ee=this.height%2/2,se=Math.cos(this.angle),G=Math.sin(this.angle),le=o-Math.round(o)+se*Q+G*ee,ce=u-Math.round(u)+se*ee+G*Q,me=new Float64Array(c);if(d.J(me,me,[le>.5?le-1:le,ce>.5?ce-1:ce,0]),this.alignedModelViewProjectionMatrix=me,c=d.as(new Float64Array(16),this.pixelMatrix),!c)throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new d.P(0,0)),o=[e.x*this.worldSize,e.y*this.worldSize,0,1];return d.af(o,o,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.P(0,e))}getCameraQueryGeometry(e){const o=this.getCameraPoint();if(e.length===1)return[e[0],o];{let u=o.x,c=o.y,p=o.x,x=o.y;for(const S of e)u=Math.min(u,S.x),c=Math.min(c,S.y),p=Math.max(p,S.x),x=Math.max(x,S.y);return[new d.P(u,c),new d.P(p,c),new d.P(p,x),new d.P(u,x),new d.P(u,c)]}}lngLatToCameraDepth(e,o){const u=this.locationCoordinate(e),c=[u.x*this.worldSize,u.y*this.worldSize,o,1];return d.af(c,c,this.modelViewProjectionMatrix),c[2]/c[3]}}function ha(f,e){let o,u=!1,c=null,p=null;const x=()=>{c=null,u&&(f.apply(p,o),c=setTimeout(x,e),u=!1)};return(...S)=>(u=!0,p=this,o=S,c||x(),c)}class ul{constructor(e){this._getCurrentHash=()=>{const o=window.location.hash.replace("#","");if(this._hashName){let u;return o.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(u=c)}),(u&&u[1]||"").split("/")}return o.split("/")},this._onHashChange=()=>{const o=this._getCurrentHash();if(o.length>=3&&!o.some(u=>isNaN(u))){const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:u,pitch:+(o[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const o=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,o)},this._removeHash=()=>{const o=this._getCurrentHash();if(o.length===0)return;const u=o.join("/");let c=u;c.split("&").length>0&&(c=c.split("&")[0]),this._hashName&&(c=`${this._hashName}=${u}`);let p=window.location.hash.replace(c,"");p.startsWith("#&")?p=p.slice(0,1)+p.slice(2):p==="#"&&(p="");let x=window.location.href.replace(/(#.+)?$/,p);x=x.replace("&&","&"),window.history.replaceState(window.history.state,null,x)},this._updateHash=ha(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const o=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,c=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,c),x=Math.round(o.lng*p)/p,S=Math.round(o.lat*p)/p,T=this._map.getBearing(),E=this._map.getPitch();let M="";if(M+=e?`/${x}/${S}/${u}`:`${u}/${S}/${x}`,(T||E)&&(M+="/"+Math.round(10*T)/10),E&&(M+=`/${Math.round(E)}`),this._hashName){const z=this._hashName;let F=!1;const V=window.location.hash.slice(1).split("&").map($=>{const X=$.split("=")[0];return X===z?(F=!0,`${X}=${M}`):$}).filter($=>$);return F||V.push(`${z}=${M}`),`#${V.join("&")}`}return`#${M}`}}const cl={linearity:.3,easing:d.b8(0,0,.3,1)},Ou=d.e({deceleration:2500,maxSpeed:1400},cl),hf=d.e({deceleration:20,maxSpeed:1400},cl),Vh=d.e({deceleration:1e3,maxSpeed:360},cl),hl=d.e({deceleration:1e3,maxSpeed:90},cl);class Nu{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Z.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,o=Z.now();for(;e.length>0&&o-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const o={zoom:0,bearing:0,pitch:0,pan:new d.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:p}of this._inertiaBuffer)o.zoom+=p.zoomDelta||0,o.bearing+=p.bearingDelta||0,o.pitch+=p.pitchDelta||0,p.panDelta&&o.pan._add(p.panDelta),p.around&&(o.around=p.around),p.pinchAround&&(o.pinchAround=p.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(o.pan.mag()){const p=pa(o.pan.mag(),u,d.e({},Ou,e||{}));c.offset=o.pan.mult(p.amount/o.pan.mag()),c.center=this._map.transform.center,da(c,p)}if(o.zoom){const p=pa(o.zoom,u,hf);c.zoom=this._map.transform.zoom+p.amount,da(c,p)}if(o.bearing){const p=pa(o.bearing,u,Vh);c.bearing=this._map.transform.bearing+d.ac(p.amount,-179,179),da(c,p)}if(o.pitch){const p=pa(o.pitch,u,hl);c.pitch=this._map.transform.pitch+p.amount,da(c,p)}if(c.zoom||c.bearing){const p=o.pinchAround===void 0?o.around:o.pinchAround;c.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),d.e(c,{noMoveStart:!0})}}function da(f,e){(!f.duration||f.duration<e.duration)&&(f.duration=e.duration,f.easing=e.easing)}function pa(f,e,o){const{maxSpeed:u,linearity:c,deceleration:p}=o,x=d.ac(f*c/(e/1e3),-u,u),S=Math.abs(x)/(p*c);return{easing:o.easing,duration:1e3*S,amount:x*(S/2)}}class Br extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,u,c={}){const p=U.mousePos(o.getCanvas(),u),x=o.unproject(p);super(e,d.e({point:p,lngLat:x,originalEvent:u},c)),this._defaultPrevented=!1,this.target=o}}class Ts extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,u){const c=e==="touchend"?u.changedTouches:u.touches,p=U.touchPos(o.getCanvasContainer(),c),x=p.map(T=>o.unproject(T)),S=p.reduce((T,E,M,z)=>T.add(E.div(z.length)),new d.P(0,0));super(e,{points:p,point:S,lngLats:x,lngLat:o.unproject(S),originalEvent:u}),this._defaultPrevented=!1}}class Uh extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,u){super(e,{originalEvent:u}),this._defaultPrevented=!1}}class $h{constructor(e,o){this._map=e,this._clickTolerance=o.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Uh(e.type,this._map,e))}mousedown(e,o){return this._mousedownPos=o,this._firePreventable(new Br(e.type,this._map,e))}mouseup(e){this._map.fire(new Br(e.type,this._map,e))}click(e,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||this._map.fire(new Br(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Br(e.type,this._map,e))}mouseover(e){this._map.fire(new Br(e.type,this._map,e))}mouseout(e){this._map.fire(new Br(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Ts(e.type,this._map,e))}touchmove(e){this._map.fire(new Ts(e.type,this._map,e))}touchend(e){this._map.fire(new Ts(e.type,this._map,e))}touchcancel(e){this._map.fire(new Ts(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class lr{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Br(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Br("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Br(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qn{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(d.P.convert(e),this._map.terrain)}}class kn{constructor(e,o){this._map=e,this._tr=new Qn(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,o){this.isEnabled()&&e.shiftKey&&e.button===0&&(U.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(e,o){if(!this._active)return;const u=o;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const c=this._startPos;this._lastPos=u,this._box||(this._box=U.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const p=Math.min(c.x,u.x),x=Math.max(c.x,u.x),S=Math.min(c.y,u.y),T=Math.max(c.y,u.y);U.setTransform(this._box,`translate(${p}px,${S}px)`),this._box.style.width=x-p+"px",this._box.style.height=T-S+"px"}mouseupWindow(e,o){if(!this._active||e.button!==0)return;const u=this._startPos,c=o;if(this.reset(),U.suppressClick(),u.x!==c.x||u.y!==c.y)return this._map.fire(new d.k("boxzoomend",{originalEvent:e})),{cameraAnimation:p=>p.fitScreenCoordinates(u,c,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(U.remove(this._box),this._box=null),U.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,o){return this._map.fire(new d.k(e,{originalEvent:o}))}}function fa(f,e){if(f.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${f.length}, points ${e.length}`);const o={};for(let u=0;u<f.length;u++)o[f[u].identifier]=e[u];return o}class ju{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,o,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),u.length===this.numTouches&&(this.centroid=function(c){const p=new d.P(0,0);for(const x of c)p._add(x);return p.div(c.length)}(o),this.touches=fa(u,o)))}touchmove(e,o,u){if(this.aborted||!this.centroid)return;const c=fa(u,o);for(const p in this.touches){const x=c[p];(!x||x.dist(this.touches[p])>30)&&(this.aborted=!0)}}touchend(e,o,u){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class dl{constructor(e){this.singleTap=new ju(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,o,u){this.singleTap.touchstart(e,o,u)}touchmove(e,o,u){this.singleTap.touchmove(e,o,u)}touchend(e,o,u){const c=this.singleTap.touchend(e,o,u);if(c){const p=e.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(c)<30;if(p&&x||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class co{constructor(e){this._tr=new Qn(e),this._zoomIn=new dl({numTouches:1,numTaps:2}),this._zoomOut=new dl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,o,u){this._zoomIn.touchstart(e,o,u),this._zoomOut.touchstart(e,o,u)}touchmove(e,o,u){this._zoomIn.touchmove(e,o,u),this._zoomOut.touchmove(e,o,u)}touchend(e,o,u){const c=this._zoomIn.touchend(e,o,u),p=this._zoomOut.touchend(e,o,u),x=this._tr;return c?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:x.zoom+1,around:x.unproject(c)},{originalEvent:e})}):p?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:x.zoom-1,around:x.unproject(p)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fi{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const o=this._moveFunction(...e);if(o.bearingDelta||o.pitchDelta||o.around||o.panDelta)return this._active=!0,o}dragStart(e,o){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=o.length?o[0]:o,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,o){if(!this.isEnabled())return;const u=this._lastPoint;if(!u)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const c=o.length?o[0]:o;return!this._moved&&c.dist(u)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=c,this._move(u,c))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&U.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Vu={0:1,2:2};class pl{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const o=U.mouseButton(e);this._eventButton=o}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(o,u){const c=Vu[u];return o.buttons===void 0||(o.buttons&c)!==c}(e,this._eventButton)}isValidEndEvent(e){return U.mouseButton(e)===this._eventButton}}class Uu{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const fl=f=>{f.mousedown=f.dragStart,f.mousemoveWindow=f.dragMove,f.mouseup=f.dragEnd,f.contextmenu=e=>{e.preventDefault()}},$u=({enable:f,clickTolerance:e,bearingDegreesPerPixelMoved:o=.8})=>{const u=new pl({checkCorrectEvent:c=>U.mouseButton(c)===0&&c.ctrlKey||U.mouseButton(c)===2});return new Fi({clickTolerance:e,move:(c,p)=>({bearingDelta:(p.x-c.x)*o}),moveStateManager:u,enable:f,assignEvents:fl})},Zu=({enable:f,clickTolerance:e,pitchDegreesPerPixelMoved:o=-.5})=>{const u=new pl({checkCorrectEvent:c=>U.mouseButton(c)===0&&c.ctrlKey||U.mouseButton(c)===2});return new Fi({clickTolerance:e,move:(c,p)=>({pitchDelta:(p.y-c.y)*o}),moveStateManager:u,enable:f,assignEvents:fl})};class Is{constructor(e,o){this._clickTolerance=e.clickTolerance||1,this._map=o,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new d.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,o,u){return this._calculateTransform(e,o,u)}touchmove(e,o,u){if(this._active){if(!this._shouldBePrevented(u.length))return e.preventDefault(),this._calculateTransform(e,o,u);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,o,u){this._calculateTransform(e,o,u),this._active&&this._shouldBePrevented(u.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,o,u){u.length>0&&(this._active=!0);const c=fa(u,o),p=new d.P(0,0),x=new d.P(0,0);let S=0;for(const E in c){const M=c[E],z=this._touches[E];z&&(p._add(M),x._add(M.sub(z)),S++,c[E]=M)}if(this._touches=c,this._shouldBePrevented(S)||!x.mag())return;const T=x.div(S);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:p.div(S),panDelta:T}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ml{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,o,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([o[0],o[1]]))}touchmove(e,o,u){if(!this._firstTwoTouches)return;e.preventDefault();const[c,p]=this._firstTwoTouches,x=ma(u,o,c),S=ma(u,o,p);if(!x||!S)return;const T=this._aroundCenter?null:x.add(S).div(2);return this._move([x,S],T,e)}touchend(e,o,u){if(!this._firstTwoTouches)return;const[c,p]=this._firstTwoTouches,x=ma(u,o,c),S=ma(u,o,p);x&&S||(this._active&&U.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ma(f,e,o){for(let u=0;u<f.length;u++)if(f[u].identifier===o)return e[u]}function qu(f,e){return Math.log(f/e)/Math.LN2}class Gu extends ml{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,o){const u=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(qu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:qu(this._distance,u),pinchAround:o}}}function Hu(f,e){return 180*f.angleWith(e)/Math.PI}class Wu extends ml{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,o,u){const c=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Hu(this._vector,c),pinchAround:o}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const o=25/(Math.PI*this._minDiameter)*360,u=Hu(e,this._startVector);return Math.abs(u)<o}}function gl(f){return Math.abs(f.y)>Math.abs(f.x)}class ga extends ml{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,o,u){super.touchstart(e,o,u),this._currentTouchCount=u.length}_start(e){this._lastPoints=e,gl(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,o,u){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const c=e[0].sub(this._lastPoints[0]),p=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(c,p,u.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(c.y+p.y)/2*-.5}):void 0}gestureBeginsVertically(e,o,u){if(this._valid!==void 0)return this._valid;const c=e.mag()>=2,p=o.mag()>=2;if(!c&&!p)return;if(!c||!p)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const x=e.y>0==o.y>0;return gl(e)&&gl(o)&&x}}const Zh={panStep:100,bearingStep:15,pitchStep:10};class Fn{constructor(e){this._tr=new Qn(e);const o=Zh;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let o=0,u=0,c=0,p=0,x=0;switch(e.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:e.shiftKey?u=-1:(e.preventDefault(),p=-1);break;case 39:e.shiftKey?u=1:(e.preventDefault(),p=1);break;case 38:e.shiftKey?c=1:(e.preventDefault(),x=-1);break;case 40:e.shiftKey?c=-1:(e.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(u=0,c=0),{cameraAnimation:S=>{const T=this._tr;S.easeTo({duration:300,easeId:"keyboardHandler",easing:wi,zoom:o?Math.round(T.zoom)+o*(e.shiftKey?2:1):T.zoom,bearing:T.bearing+u*this._bearingStep,pitch:T.pitch+c*this._pitchStep,offset:[-p*this._panStep,-x*this._panStep],center:T.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function wi(f){return f*(2-f)}const Xu=4.000244140625;class ei{constructor(e,o){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=e,this._tr=new Qn(e),this._triggerRenderFrame=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let o=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const u=Z.now(),c=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,o!==0&&o%Xu==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(c*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),e.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=e,this._delta-=o,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=U.mousePos(this._map.getCanvas(),e),u=this._tr;this._around=o.y>u.transform.height/2-u.transform.getHorizon()?d.N.convert(this._aroundCenter?u.center:u.unproject(o)):d.N.convert(u.center),this._aroundPoint=u.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const T=this._type==="wheel"&&Math.abs(this._delta)>Xu?this._wheelZoomRate:this._defaultZoomRate;let E=2/(1+Math.exp(-Math.abs(this._delta*T)));this._delta<0&&E!==0&&(E=1/E);const M=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(M*E))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const o=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,u=this._startZoom,c=this._easing;let p,x=!1;const S=Z.now()-this._lastWheelEventTime;if(this._type==="wheel"&&u&&c&&S){const T=Math.min(S/200,1),E=c(T);p=d.y.number(u,o,E),T<1?this._frameId||(this._frameId=!0):x=!0}else p=o,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!x,zoomDelta:p-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let o=d.b9;if(this._prevEase){const u=this._prevEase,c=(Z.now()-u.start)/u.duration,p=u.easing(c+.01)-u.easing(c),x=.27/Math.sqrt(p*p+1e-4)*.01,S=Math.sqrt(.0729-x*x);o=d.b8(x,S,.25,1)}return this._prevEase={start:Z.now(),duration:e,easing:o},o}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Cs{constructor(e,o){this._clickZoom=e,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class df{constructor(e){this._tr=new Qn(e),this.reset()}reset(){this._active=!1}dblclick(e,o){return e.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(o)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pf{constructor(){this._tap=new dl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,o,u){if(!this._swipePoint)if(this._tapTime){const c=o[0],p=e.timeStamp-this._tapTime<500,x=this._tapPoint.dist(c)<30;p&&x?u.length>0&&(this._swipePoint=c,this._swipeTouch=u[0].identifier):this.reset()}else this._tap.touchstart(e,o,u)}touchmove(e,o,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const c=o[0],p=c.y-this._swipePoint.y;return this._swipePoint=c,e.preventDefault(),this._active=!0,{zoomDelta:p/128}}}else this._tap.touchmove(e,o,u)}touchend(e,o,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{const c=this._tap.touchend(e,o,u);c&&(this._tapTime=e.timeStamp,this._tapPoint=c)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qh{constructor(e,o,u){this._el=e,this._mousePan=o,this._touchPan=u}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Gh{constructor(e,o,u){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=o,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ku{constructor(e,o,u,c){this._el=e,this._touchZoom=o,this._touchRotate=u,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ho{constructor(e,o){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=o,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=U.create("div","maplibregl-cooperative-gesture-screen",e);let o=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(o=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const u=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),c=document.createElement("div");c.className="maplibregl-desktop-message",c.textContent=o,this._container.appendChild(c);const p=document.createElement("div");p.className="maplibregl-mobile-message",p.textContent=u,this._container.appendChild(p),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(U.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,o){this._enabled&&(this._map.fire(new d.k("cooperativegestureprevented",{gestureType:e,originalEvent:o})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Bn=f=>f.zoom||f.drag||f.pitch||f.rotate;class We extends d.k{}function yl(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Ju{constructor(e,o){this.handleWindowEvent=c=>{this.handleEvent(c,`${c.type}Window`)},this.handleEvent=(c,p)=>{if(c.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const x=c.type==="renderFrame"?void 0:c,S={needsRenderFrame:!1},T={},E={},M=c.touches,z=M?this._getMapTouches(M):void 0,F=z?U.touchPos(this._map.getCanvas(),z):U.mousePos(this._map.getCanvas(),c);for(const{handlerName:X,handler:Q,allowed:ee}of this._handlers){if(!Q.isEnabled())continue;let se;this._blockedByActive(E,ee,X)?Q.reset():Q[p||c.type]&&(se=Q[p||c.type](c,F,z),this.mergeHandlerResult(S,T,se,X,x),se&&se.needsRenderFrame&&this._triggerRenderFrame()),(se||Q.isActive())&&(E[X]=Q)}const V={};for(const X in this._previousActiveHandlers)E[X]||(V[X]=x);this._previousActiveHandlers=E,(Object.keys(V).length||yl(S))&&(this._changes.push([S,T,V]),this._triggerRenderFrame()),(Object.keys(E).length||yl(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:$}=S;$&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],$(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Nu(e),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(o);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[c,p,x]of this._listeners)U.addEventListener(c,p,c===document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(const[e,o,u]of this._listeners)U.removeEventListener(e,o,e===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(e){const o=this._map,u=o.getCanvasContainer();this._add("mapEvent",new $h(o,e));const c=o.boxZoom=new kn(o,e);this._add("boxZoom",c),e.interactive&&e.boxZoom&&c.enable();const p=o.cooperativeGestures=new ho(o,e.cooperativeGestures);this._add("cooperativeGestures",p),e.cooperativeGestures&&p.enable();const x=new co(o),S=new df(o);o.doubleClickZoom=new Cs(S,x),this._add("tapZoom",x),this._add("clickZoom",S),e.interactive&&e.doubleClickZoom&&o.doubleClickZoom.enable();const T=new pf;this._add("tapDragZoom",T);const E=o.touchPitch=new ga(o);this._add("touchPitch",E),e.interactive&&e.touchPitch&&o.touchPitch.enable(e.touchPitch);const M=$u(e),z=Zu(e);o.dragRotate=new Gh(e,M,z),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]),e.interactive&&e.dragRotate&&o.dragRotate.enable();const F=(({enable:se,clickTolerance:G})=>{const le=new pl({checkCorrectEvent:ce=>U.mouseButton(ce)===0&&!ce.ctrlKey});return new Fi({clickTolerance:G,move:(ce,me)=>({around:me,panDelta:me.sub(ce)}),activateOnStart:!0,moveStateManager:le,enable:se,assignEvents:fl})})(e),V=new Is(e,o);o.dragPan=new qh(u,F,V),this._add("mousePan",F),this._add("touchPan",V,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&o.dragPan.enable(e.dragPan);const $=new Wu,X=new Gu;o.touchZoomRotate=new Ku(u,X,$,T),this._add("touchRotate",$,["touchPan","touchZoom"]),this._add("touchZoom",X,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&o.touchZoomRotate.enable(e.touchZoomRotate);const Q=o.scrollZoom=new ei(o,()=>this._triggerRenderFrame());this._add("scrollZoom",Q,["mousePan"]),e.interactive&&e.scrollZoom&&o.scrollZoom.enable(e.scrollZoom);const ee=o.keyboard=new Fn(o);this._add("keyboard",ee),e.interactive&&e.keyboard&&o.keyboard.enable(),this._add("blockableMapEvent",new lr(o))}_add(e,o,u){this._handlers.push({handlerName:e,handler:o,allowed:u}),this._handlersById[e]=o}stop(e){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Bn(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,o,u){for(const c in e)if(c!==u&&(!o||o.indexOf(c)<0))return!0;return!1}_getMapTouches(e){const o=[];for(const u of e)this._el.contains(u.target)&&o.push(u);return o}mergeHandlerResult(e,o,u,c,p){if(!u)return;d.e(e,u);const x={handlerName:c,originalEvent:u.originalEvent||p};u.zoomDelta!==void 0&&(o.zoom=x),u.panDelta!==void 0&&(o.drag=x),u.pitchDelta!==void 0&&(o.pitch=x),u.bearingDelta!==void 0&&(o.rotate=x)}_applyChanges(){const e={},o={},u={};for(const[c,p,x]of this._changes)c.panDelta&&(e.panDelta=(e.panDelta||new d.P(0,0))._add(c.panDelta)),c.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+c.pitchDelta),c.around!==void 0&&(e.around=c.around),c.pinchAround!==void 0&&(e.pinchAround=c.pinchAround),c.noInertia&&(e.noInertia=c.noInertia),d.e(o,p),d.e(u,x);this._updateMapTransform(e,o,u),this._changes=[]}_updateMapTransform(e,o,u){const c=this._map,p=c._getTransformForUpdate(),x=c.terrain;if(!(yl(e)||x&&this._terrainMovement))return this._fireEvents(o,u,!0);let{panDelta:S,zoomDelta:T,bearingDelta:E,pitchDelta:M,around:z,pinchAround:F}=e;F!==void 0&&(z=F),c._stop(!0),z=z||c.transform.centerPoint;const V=p.pointLocation(S?z.sub(S):z);E&&(p.bearing+=E),M&&(p.pitch+=M),T&&(p.zoom+=T),x?this._terrainMovement||!o.drag&&!o.zoom?o.drag&&this._terrainMovement?p.center=p.pointLocation(p.centerPoint.sub(S)):p.setLocationAtPoint(V,z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,p.setLocationAtPoint(V,z)):p.setLocationAtPoint(V,z),c._applyUpdatedTransform(p),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(o,u,!0)}_fireEvents(e,o,u){const c=Bn(this._eventsInProgress),p=Bn(e),x={};for(const z in e){const{originalEvent:F}=e[z];this._eventsInProgress[z]||(x[`${z}start`]=F),this._eventsInProgress[z]=e[z]}!c&&p&&this._fireEvent("movestart",p.originalEvent);for(const z in x)this._fireEvent(z,x[z]);p&&this._fireEvent("move",p.originalEvent);for(const z in e){const{originalEvent:F}=e[z];this._fireEvent(z,F)}const S={};let T;for(const z in this._eventsInProgress){const{handlerName:F,originalEvent:V}=this._eventsInProgress[z];this._handlersById[F].isActive()||(delete this._eventsInProgress[z],T=o[F]||V,S[`${z}end`]=T)}for(const z in S)this._fireEvent(z,S[z]);const E=Bn(this._eventsInProgress),M=(c||p)&&!E;if(M&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const z=this._map._getTransformForUpdate();z.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(z)}if(u&&M){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;!z||!z.essential&&Z.prefersReducedMotion?(this._map.fire(new d.k("moveend",{originalEvent:T})),F(this._map.getBearing())&&this._map.resetNorth()):(F(z.bearing||this._map.getBearing())&&(z.bearing=0),z.freezeElevation=!0,this._map.easeTo(z,{originalEvent:T})),this._updatingCamera=!1}}_fireEvent(e,o){this._map.fire(new d.k(e,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new We("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Hh extends d.E{constructor(e,o){super(),this._renderFrameCallback=()=>{const u=Math.min((Z.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(u)),u<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=o.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new d.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,o){return this.jumpTo({center:e},o)}panBy(e,o,u){return e=d.P.convert(e).mult(-1),this.panTo(this.transform.center,d.e({offset:e},o),u)}panTo(e,o,u){return this.easeTo(d.e({center:e},o),u)}getZoom(){return this.transform.zoom}setZoom(e,o){return this.jumpTo({zoom:e},o),this}zoomTo(e,o,u){return this.easeTo(d.e({zoom:e},o),u)}zoomIn(e,o){return this.zoomTo(this.getZoom()+1,e,o),this}zoomOut(e,o){return this.zoomTo(this.getZoom()-1,e,o),this}getBearing(){return this.transform.bearing}setBearing(e,o){return this.jumpTo({bearing:e},o),this}getPadding(){return this.transform.padding}setPadding(e,o){return this.jumpTo({padding:e},o),this}rotateTo(e,o,u){return this.easeTo(d.e({bearing:e},o),u)}resetNorth(e,o){return this.rotateTo(0,d.e({duration:1e3},e),o),this}resetNorthPitch(e,o){return this.easeTo(d.e({bearing:0,pitch:0,duration:1e3},e),o),this}snapToNorth(e,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,o):this}getPitch(){return this.transform.pitch}setPitch(e,o){return this.jumpTo({pitch:e},o),this}cameraForBounds(e,o){e=ve.convert(e).adjustAntiMeridian();const u=o&&o.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),u,o)}_cameraForBoxAndBearing(e,o,u,c){const p={top:0,bottom:0,right:0,left:0};if(typeof(c=d.e({padding:p,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const Be=c.padding;c.padding={top:Be,bottom:Be,right:Be,left:Be}}c.padding=d.e(p,c.padding);const x=this.transform,S=x.padding,T=new ve(e,o),E=x.project(T.getNorthWest()),M=x.project(T.getNorthEast()),z=x.project(T.getSouthEast()),F=x.project(T.getSouthWest()),V=d.ba(-u),$=E.rotate(V),X=M.rotate(V),Q=z.rotate(V),ee=F.rotate(V),se=new d.P(Math.max($.x,X.x,ee.x,Q.x),Math.max($.y,X.y,ee.y,Q.y)),G=new d.P(Math.min($.x,X.x,ee.x,Q.x),Math.min($.y,X.y,ee.y,Q.y)),le=se.sub(G),ce=(x.width-(S.left+S.right+c.padding.left+c.padding.right))/le.x,me=(x.height-(S.top+S.bottom+c.padding.top+c.padding.bottom))/le.y;if(me<0||ce<0)return void d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Ie=Math.min(x.scaleZoom(x.scale*Math.min(ce,me)),c.maxZoom),Ae=d.P.convert(c.offset),Ve=new d.P((c.padding.left-c.padding.right)/2,(c.padding.top-c.padding.bottom)/2).rotate(d.ba(u)),Ge=Ae.add(Ve).mult(x.scale/x.zoomScale(Ie));return{center:x.unproject(E.add(z).div(2).sub(Ge)),zoom:Ie,bearing:u}}fitBounds(e,o,u){return this._fitInternal(this.cameraForBounds(e,o),o,u)}fitScreenCoordinates(e,o,u,c,p){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(d.P.convert(e)),this.transform.pointLocation(d.P.convert(o)),u,c),c,p)}_fitInternal(e,o,u){return e?(delete(o=d.e(e,o)).padding,o.linear?this.easeTo(o,u):this.flyTo(o,u)):this}jumpTo(e,o){this.stop();const u=this._getTransformForUpdate();let c=!1,p=!1,x=!1;return"zoom"in e&&u.zoom!==+e.zoom&&(c=!0,u.zoom=+e.zoom),e.center!==void 0&&(u.center=d.N.convert(e.center)),"bearing"in e&&u.bearing!==+e.bearing&&(p=!0,u.bearing=+e.bearing),"pitch"in e&&u.pitch!==+e.pitch&&(x=!0,u.pitch=+e.pitch),e.padding==null||u.isPaddingEqual(e.padding)||(u.padding=e.padding),this._applyUpdatedTransform(u),this.fire(new d.k("movestart",o)).fire(new d.k("move",o)),c&&this.fire(new d.k("zoomstart",o)).fire(new d.k("zoom",o)).fire(new d.k("zoomend",o)),p&&this.fire(new d.k("rotatestart",o)).fire(new d.k("rotate",o)).fire(new d.k("rotateend",o)),x&&this.fire(new d.k("pitchstart",o)).fire(new d.k("pitch",o)).fire(new d.k("pitchend",o)),this.fire(new d.k("moveend",o))}calculateCameraOptionsFromTo(e,o,u,c=0){const p=d.Z.fromLngLat(e,o),x=d.Z.fromLngLat(u,c),S=x.x-p.x,T=x.y-p.y,E=x.z-p.z,M=Math.hypot(S,T,E);if(M===0)throw new Error("Can't calculate camera options with same From and To");const z=Math.hypot(S,T),F=this.transform.scaleZoom(this.transform.cameraToCenterDistance/M/this.transform.tileSize),V=180*Math.atan2(S,-T)/Math.PI;let $=180*Math.acos(z/M)/Math.PI;return $=E<0?90-$:90+$,{center:x.toLngLat(),zoom:F,pitch:$,bearing:V}}easeTo(e,o){var u;this._stop(!1,e.easeId),((e=d.e({offset:[0,0],duration:500,easing:d.b9},e)).animate===!1||!e.essential&&Z.prefersReducedMotion)&&(e.duration=0);const c=this._getTransformForUpdate(),p=c.zoom,x=c.bearing,S=c.pitch,T=c.padding,E="bearing"in e?this._normalizeBearing(e.bearing,x):x,M="pitch"in e?+e.pitch:S,z="padding"in e?e.padding:c.padding,F=d.P.convert(e.offset);let V=c.centerPoint.add(F);const $=c.pointLocation(V),{center:X,zoom:Q}=c.getConstrained(d.N.convert(e.center||$),(u=e.zoom)!==null&&u!==void 0?u:p);this._normalizeCenter(X,c);const ee=c.project($),se=c.project(X).sub(ee),G=c.zoomScale(Q-p);let le,ce;e.around&&(le=d.N.convert(e.around),ce=c.locationPoint(le));const me={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Q!==p,this._rotating=this._rotating||x!==E,this._pitching=this._pitching||M!==S,this._padding=!c.isPaddingEqual(z),this._easeId=e.easeId,this._prepareEase(o,e.noMoveStart,me),this.terrain&&this._prepareElevation(X),this._ease(Ie=>{if(this._zooming&&(c.zoom=d.y.number(p,Q,Ie)),this._rotating&&(c.bearing=d.y.number(x,E,Ie)),this._pitching&&(c.pitch=d.y.number(S,M,Ie)),this._padding&&(c.interpolatePadding(T,z,Ie),V=c.centerPoint.add(F)),this.terrain&&!e.freezeElevation&&this._updateElevation(Ie),le)c.setLocationAtPoint(le,ce);else{const Ae=c.zoomScale(c.zoom-p),Ve=Q>p?Math.min(2,G):Math.max(.5,G),Ge=Math.pow(Ve,1-Ie),Be=c.unproject(ee.add(se.mult(Ie*Ge)).mult(Ae));c.setLocationAtPoint(c.renderWorldCopies?Be.wrap():Be,V)}this._applyUpdatedTransform(c),this._fireMoveEvents(o)},Ie=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(o,Ie)},e),this}_prepareEase(e,o,u={}){this._moving=!0,o||u.moving||this.fire(new d.k("movestart",e)),this._zooming&&!u.zooming&&this.fire(new d.k("zoomstart",e)),this._rotating&&!u.rotating&&this.fire(new d.k("rotatestart",e)),this._pitching&&!u.pitching&&this.fire(new d.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const o=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&o!==this._elevationTarget){const u=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(u-(o-(u*e+this._elevationStart))/(1-e)),this._elevationTarget=o}this.transform.elevation=d.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const o=e.getCameraPosition(),u=this.terrain.getElevationForLngLatZoom(o.lngLat,e.zoom);if(o.altitude<u){const c=this.calculateCameraOptionsFromTo(o.lngLat,u,e.center,e.elevation);return{pitch:c.pitch,zoom:c.zoom}}return{}}_applyUpdatedTransform(e){const o=[];if(this.terrain&&o.push(c=>this._elevateCameraIfInsideTerrain(c)),this.transformCameraUpdate&&o.push(c=>this.transformCameraUpdate(c)),!o.length)return;const u=e.clone();for(const c of o){const p=u.clone(),{center:x,zoom:S,pitch:T,bearing:E,elevation:M}=c(p);x&&(p.center=x),S!==void 0&&(p.zoom=S),T!==void 0&&(p.pitch=T),E!==void 0&&(p.bearing=E),M!==void 0&&(p.elevation=M),u.apply(p)}this.transform.apply(u)}_fireMoveEvents(e){this.fire(new d.k("move",e)),this._zooming&&this.fire(new d.k("zoom",e)),this._rotating&&this.fire(new d.k("rotate",e)),this._pitching&&this.fire(new d.k("pitch",e))}_afterEase(e,o){if(this._easeId&&o&&this._easeId===o)return;delete this._easeId;const u=this._zooming,c=this._rotating,p=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new d.k("zoomend",e)),c&&this.fire(new d.k("rotateend",e)),p&&this.fire(new d.k("pitchend",e)),this.fire(new d.k("moveend",e))}flyTo(e,o){var u;if(!e.essential&&Z.prefersReducedMotion){const Ze=d.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ze,o)}this.stop(),e=d.e({offset:[0,0],speed:1.2,curve:1.42,easing:d.b9},e);const c=this._getTransformForUpdate(),p=c.zoom,x=c.bearing,S=c.pitch,T=c.padding,E="bearing"in e?this._normalizeBearing(e.bearing,x):x,M="pitch"in e?+e.pitch:S,z="padding"in e?e.padding:c.padding,F=d.P.convert(e.offset);let V=c.centerPoint.add(F);const $=c.pointLocation(V),{center:X,zoom:Q}=c.getConstrained(d.N.convert(e.center||$),(u=e.zoom)!==null&&u!==void 0?u:p);this._normalizeCenter(X,c);const ee=c.zoomScale(Q-p),se=c.project($),G=c.project(X).sub(se);let le=e.curve;const ce=Math.max(c.width,c.height),me=ce/ee,Ie=G.mag();if("minZoom"in e){const Ze=d.ac(Math.min(e.minZoom,p,Q),c.minZoom,c.maxZoom),ht=ce/c.zoomScale(Ze-p);le=Math.sqrt(ht/Ie*2)}const Ae=le*le;function Ve(Ze){const ht=(me*me-ce*ce+(Ze?-1:1)*Ae*Ae*Ie*Ie)/(2*(Ze?me:ce)*Ae*Ie);return Math.log(Math.sqrt(ht*ht+1)-ht)}function Ge(Ze){return(Math.exp(Ze)-Math.exp(-Ze))/2}function Be(Ze){return(Math.exp(Ze)+Math.exp(-Ze))/2}const Fe=Ve(!1);let Ye=function(Ze){return Be(Fe)/Be(Fe+le*Ze)},pt=function(Ze){return ce*((Be(Fe)*(Ge(ht=Fe+le*Ze)/Be(ht))-Ge(Fe))/Ae)/Ie;var ht},Ne=(Ve(!0)-Fe)/le;if(Math.abs(Ie)<1e-6||!isFinite(Ne)){if(Math.abs(ce-me)<1e-6)return this.easeTo(e,o);const Ze=me<ce?-1:1;Ne=Math.abs(Math.log(me/ce))/le,pt=()=>0,Ye=ht=>Math.exp(Ze*le*ht)}return e.duration="duration"in e?+e.duration:1e3*Ne/("screenSpeed"in e?+e.screenSpeed/le:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=x!==E,this._pitching=M!==S,this._padding=!c.isPaddingEqual(z),this._prepareEase(o,!1),this.terrain&&this._prepareElevation(X),this._ease(Ze=>{const ht=Ze*Ne,Xt=1/Ye(ht);c.zoom=Ze===1?Q:p+c.scaleZoom(Xt),this._rotating&&(c.bearing=d.y.number(x,E,Ze)),this._pitching&&(c.pitch=d.y.number(S,M,Ze)),this._padding&&(c.interpolatePadding(T,z,Ze),V=c.centerPoint.add(F)),this.terrain&&!e.freezeElevation&&this._updateElevation(Ze);const vt=Ze===1?X:c.unproject(se.add(G.mult(pt(ht))).mult(Xt));c.setLocationAtPoint(c.renderWorldCopies?vt.wrap():vt,V),this._applyUpdatedTransform(c),this._fireMoveEvents(o)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(o)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,o){var u;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const c=this._onEaseEnd;delete this._onEaseEnd,c.call(this,o)}return e||(u=this.handlers)===null||u===void 0||u.stop(!1),this}_ease(e,o,u){u.animate===!1||u.duration===0?(e(1),o()):(this._easeStart=Z.now(),this._easeOptions=u,this._onEaseFrame=e,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,o){e=d.b3(e,-180,180);const u=Math.abs(e-o);return Math.abs(e-360-o)<u&&(e-=360),Math.abs(e+360-o)<u&&(e+=360),e}_normalizeCenter(e,o){if(!o.renderWorldCopies||o.lngRange)return;const u=e.lng-o.center.lng;e.lng+=u>180?-360:u<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(d.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const po={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class fo{constructor(e=po){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=o=>{!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"&&o.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=U.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=U.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=U.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){U.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,o){const u=this._map._getUIString(`AttributionControl.${o}`);e.title=u,e.setAttribute("aria-label",u)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(c=>typeof c!="string"?"":c)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}const o=this._map.style.sourceCaches;for(const c in o){const p=o[c];if(p.used||p.usedForTerrain){const x=p.getSource();x.attribution&&e.indexOf(x.attribution)<0&&e.push(x.attribution)}}e=e.filter(c=>String(c).trim()),e.sort((c,p)=>c.length-p.length),e=e.filter((c,p)=>{for(let x=p+1;x<e.length;x++)if(e[x].indexOf(c)>=0)return!1;return!0});const u=e.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,e.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Yu{constructor(e={}){this._updateCompact=()=>{const o=this._container.children;if(o.length){const u=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact"):u.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=U.create("div","maplibregl-ctrl");const o=U.create("a","maplibregl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://maplibre.org/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){U.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Tt{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const o=++this._id;return this._queue.push({callback:e,id:o,cancelled:!1}),o}remove(e){const o=this._currentlyRunning,u=o?this._queue.concat(o):this._queue;for(const c of u)if(c.id===e)return void(c.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const o=this._currentlyRunning=this._queue;this._queue=[];for(const u of o)if(!u.cancelled&&(u.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Qu=d.Y([{name:"a_pos3d",type:"Int16",components:3}]);class ff extends d.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,o){this.sourceCache.update(e,o),this._renderableTilesKeys=[];const u={};for(const c of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:o}))u[c.key]=!0,this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.posMatrix=new Float64Array(16),d.aP(c.posMatrix,0,d.X,0,d.X,0,1),this._tiles[c.key]=new Yi(c,this.tileSize));for(const c in this._tiles)u[c]||delete this._tiles[c]}freeRtt(e){for(const o in this._tiles){const u=this._tiles[o];(!e||u.tileID.equals(e)||u.tileID.isChildOf(e)||e.isChildOf(u.tileID))&&(u.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const o={};for(const u of this._renderableTilesKeys){const c=this._tiles[u].tileID;if(c.canonical.equals(e.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16),d.aP(p.posMatrix,0,d.X,0,d.X,0,1),o[u]=p}else if(c.canonical.isChildOf(e.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16);const x=c.canonical.z-e.canonical.z,S=c.canonical.x-(c.canonical.x>>x<<x),T=c.canonical.y-(c.canonical.y>>x<<x),E=d.X>>x;d.aP(p.posMatrix,0,E,0,E,0,1),d.J(p.posMatrix,p.posMatrix,[-S*E,-T*E,0]),o[u]=p}else if(e.canonical.isChildOf(c.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16);const x=e.canonical.z-c.canonical.z,S=e.canonical.x-(e.canonical.x>>x<<x),T=e.canonical.y-(e.canonical.y>>x<<x),E=d.X>>x;d.aP(p.posMatrix,0,d.X,0,d.X,0,1),d.J(p.posMatrix,p.posMatrix,[S*E,T*E,0]),d.K(p.posMatrix,p.posMatrix,[1/2**x,1/2**x,0]),o[u]=p}}return o}getSourceTile(e,o){const u=this.sourceCache._source;let c=e.overscaledZ-this.deltaZoom;if(c>u.maxzoom&&(c=u.maxzoom),c<u.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(c).key);let p=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!p||!p.dem)&&o)for(;c>=u.minzoom&&(!p||!p.dem);)p=this.sourceCache.getTileByID(e.scaledTo(c--).key);return p}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(o=>o.timeAdded>=e)}}class ec{constructor(e,o,u){this.painter=e,this.sourceCache=new ff(o),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,o,u,c=d.X){var p;if(!(o>=0&&o<c&&u>=0&&u<c))return 0;const x=this.getTerrainData(e),S=(p=x.tile)===null||p===void 0?void 0:p.dem;if(!S)return 0;const T=function($,X,Q){var ee=X[0],se=X[1];return $[0]=Q[0]*ee+Q[4]*se+Q[12],$[1]=Q[1]*ee+Q[5]*se+Q[13],$}([],[o/c*d.X,u/c*d.X],x.u_terrain_matrix),E=[T[0]*S.dim,T[1]*S.dim],M=Math.floor(E[0]),z=Math.floor(E[1]),F=E[0]-M,V=E[1]-z;return S.get(M,z)*(1-F)*(1-V)+S.get(M+1,z)*F*(1-V)+S.get(M,z+1)*(1-F)*V+S.get(M+1,z+1)*F*V}getElevationForLngLatZoom(e,o){if(!d.bb(o,e.wrap()))return 0;const{tileID:u,mercatorX:c,mercatorY:p}=this._getOverscaledTileIDFromLngLatZoom(e,o);return this.getElevation(u,c%d.X,p%d.X,d.X)}getElevation(e,o,u,c=d.X){return this.getDEMElevation(e,o,u,c)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const c=this.painter.context,p=new d.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ot(c,p,c.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ot(c,new d.R({width:1,height:1}),c.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=d.an([])}const o=this.sourceCache.getSourceTile(e,!0);if(o&&o.dem&&(!o.demTexture||o.needsTerrainPrepare)){const c=this.painter.context;o.demTexture=this.painter.getTileTexture(o.dem.stride),o.demTexture?o.demTexture.update(o.dem.getPixels(),{premultiply:!1}):o.demTexture=new ot(c,o.dem.getPixels(),c.gl.RGBA,{premultiply:!1}),o.demTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),o.needsTerrainPrepare=!1}const u=o&&o+o.tileID.key+e.key;if(u&&!this._demMatrixCache[u]){const c=this.sourceCache.sourceCache._source.maxzoom;let p=e.canonical.z-o.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=c?p=e.canonical.z-c:d.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const x=e.canonical.x-(e.canonical.x>>p<<p),S=e.canonical.y-(e.canonical.y>>p<<p),T=d.bc(new Float64Array(16),[1/(d.X<<p),1/(d.X<<p),0]);d.J(T,T,[x*d.X,S*d.X,0]),this._demMatrixCache[e.key]={matrix:T,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:o&&o.dem&&o.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:o&&o.dem&&o.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(o&&o.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:o}}getFramebuffer(e){const o=this.painter,u=o.width/devicePixelRatio,c=o.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===c||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ot(o.context,{width:u,height:c,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ot(o.context,{width:u,height:c,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=o.context.createFramebuffer(u,c,!0,!1),this._fbo.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,u,c))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const o=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let p=0,x=0;p<this._coordsTextureSize;p++)for(let S=0;S<this._coordsTextureSize;S++,x+=4)o[x+0]=255&S,o[x+1]=255&p,o[x+2]=S>>8<<4|p>>8,o[x+3]=0;const u=new d.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(o.buffer)),c=new ot(e,u,e.gl.RGBA,{premultiply:!1});return c.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=c,c}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const o=new Uint8Array(4),u=this.painter.context,c=u.gl,p=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),x=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),S=Math.round(this.painter.height/devicePixelRatio);u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),c.readPixels(p,S-x-1,1,1,c.RGBA,c.UNSIGNED_BYTE,o),u.bindFramebuffer.set(null);const T=o[0]+(o[2]>>4<<8),E=o[1]+((15&o[2])<<8),M=this.coordsIndex[255-o[3]],z=M&&this.sourceCache.getTileByID(M);if(!z)return null;const F=this._coordsTextureSize,V=(1<<z.tileID.canonical.z)*F;return new d.Z((z.tileID.canonical.x*F+T)/V+z.tileID.wrap,(z.tileID.canonical.y*F+E)/V,this.getElevation(z.tileID,T,E,F))}depthAtPoint(e){const o=new Uint8Array(4),u=this.painter.context,c=u.gl;return u.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),c.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,o),u.bindFramebuffer.set(null),(o[0]/16777216+o[1]/65536+o[2]/256+o[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,o=new d.bd,u=new d.aY,c=this.meshSize,p=d.X/c,x=c*c;for(let z=0;z<=c;z++)for(let F=0;F<=c;F++)o.emplaceBack(F*p,z*p,0);for(let z=0;z<x;z+=c+1)for(let F=0;F<c;F++)u.emplaceBack(F+z,c+F+z+1,c+F+z+2),u.emplaceBack(F+z,c+F+z+2,F+z+1);const S=o.length,T=S+2*(c+1);for(const z of[0,1])for(let F=0;F<=c;F++)for(const V of[0,1])o.emplaceBack(F*p,z*d.X,V);for(let z=0;z<2*c;z+=2)u.emplaceBack(T+z,T+z+1,T+z+3),u.emplaceBack(T+z,T+z+3,T+z+2),u.emplaceBack(S+z,S+z+3,S+z+1),u.emplaceBack(S+z,S+z+2,S+z+3);const E=o.length,M=E+2*(c+1);for(const z of[0,1])for(let F=0;F<=c;F++)for(const V of[0,1])o.emplaceBack(z*d.X,F*p,V);for(let z=0;z<2*c;z+=2)u.emplaceBack(E+z,E+z+1,E+z+3),u.emplaceBack(E+z,E+z+3,E+z+2),u.emplaceBack(M+z,M+z+3,M+z+1),u.emplaceBack(M+z,M+z+2,M+z+3);return this._mesh=new al(e.createVertexBuffer(o,Qu.members),e.createIndexBuffer(u),d.a0.simpleSegment(0,0,o.length,u.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*d.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,o){var u;const{tileID:c}=this._getOverscaledTileIDFromLngLatZoom(e,o);return(u=this.getMinMaxElevation(c).minElevation)!==null&&u!==void 0?u:0}getMinMaxElevation(e){const o=this.getTerrainData(e).tile,u={minElevation:null,maxElevation:null};return o&&o.dem&&(u.minElevation=o.dem.min*this.exaggeration,u.maxElevation=o.dem.max*this.exaggeration),u}_getOverscaledTileIDFromLngLatZoom(e,o){const u=d.Z.fromLngLat(e.wrap()),c=(1<<o)*d.X,p=u.x*c,x=u.y*c,S=Math.floor(p/d.X),T=Math.floor(x/d.X);return{tileID:new d.S(o,0,o,S,T),mercatorX:p,mercatorY:x}}}class mf{constructor(e,o,u){this._context=e,this._size=o,this._tileSize=u,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const o=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),u=new ot(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return u.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),o.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),o.colorAttachment.set(u.texture),{id:e,fbo:o,texture:u,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(o=>e.id!==o),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const o of this._recentlyUsed)if(!this._objects[o].inUse)return this._objects[o];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const mo={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Wh{constructor(e,o){this.painter=e,this.terrain=o,this.pool=new mf(e.context,30,o.sourceCache.tileSize*o.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,o){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(u=>!e._layers[u].isHidden(o)),this._coordsDescendingInv={};for(const u in e.sourceCaches){this._coordsDescendingInv[u]={};const c=e.sourceCaches[u].getVisibleCoordinates();for(const p of c){const x=this.terrain.sourceCache.getTerrainCoords(p);for(const S in x)this._coordsDescendingInv[u][S]||(this._coordsDescendingInv[u][S]=[]),this._coordsDescendingInv[u][S].push(x[S])}}this._coordsDescendingInvStr={};for(const u of e._order){const c=e._layers[u],p=c.source;if(mo[c.type]&&!this._coordsDescendingInvStr[p]){this._coordsDescendingInvStr[p]={};for(const x in this._coordsDescendingInv[p])this._coordsDescendingInvStr[p][x]=this._coordsDescendingInv[p][x].map(S=>S.key).sort().join()}}for(const u of this._renderableTiles)for(const c in this._coordsDescendingInvStr){const p=this._coordsDescendingInvStr[c][u.tileID.key];p&&p!==u.rttCoords[c]&&(u.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const o=e.type,u=this.painter,c=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(mo[o]&&(this._prevType&&mo[this._prevType]||this._stacks.push([]),this._prevType=o,this._stacks[this._stacks.length-1].push(e.id),!c))return!0;if(mo[this._prevType]||mo[o]&&c){this._prevType=o;const p=this._stacks.length-1,x=this._stacks[p]||[];for(const S of this._renderableTiles){if(this.pool.isFull()&&(jh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(S),S.rtt[p]){const E=this.pool.getObjectForId(S.rtt[p].id);if(E.stamp===S.rtt[p].stamp){this.pool.useObject(E);continue}}const T=this.pool.getOrCreateFreeObject();this.pool.useObject(T),this.pool.stampObject(T),S.rtt[p]={id:T.id,stamp:T.stamp},u.context.bindFramebuffer.set(T.fbo.framebuffer),u.context.clear({color:d.aM.transparent,stencil:0}),u.currentStencilSource=void 0;for(let E=0;E<x.length;E++){const M=u.style._layers[x[E]],z=M.source?this._coordsDescendingInv[M.source][S.tileID.key]:[S.tileID];u.context.viewport.set([0,0,T.fbo.width,T.fbo.height]),u._renderTileClippingMasks(M,z),u.renderLayer(u,u.style.sourceCaches[M.source],M,z),M.source&&(S.rttCoords[M.source]=this._coordsDescendingInvStr[M.source][S.tileID.key])}}return jh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),mo[o]}return!1}}const tc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Xh=B,gf={hash:!1,interactive:!0,bearingSnap:7,attributionControl:po,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:d.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},rc=f=>{f.touchstart=f.dragStart,f.touchmoveWindow=f.dragMove,f.touchend=f.dragEnd},yf={showCompass:!0,showZoom:!0,visualizePitch:!1};class _f{constructor(e,o,u=!1){this.mousedown=x=>{this.startMouse(d.e({},x,{ctrlKey:!0,preventDefault:()=>x.preventDefault()}),U.mousePos(this.element,x)),U.addEventListener(window,"mousemove",this.mousemove),U.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=x=>{this.moveMouse(x,U.mousePos(this.element,x))},this.mouseup=x=>{this.mouseRotate.dragEnd(x),this.mousePitch&&this.mousePitch.dragEnd(x),this.offTemp()},this.touchstart=x=>{x.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=U.touchPos(this.element,x.targetTouches)[0],this.startTouch(x,this._startPos),U.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),U.addEventListener(window,"touchend",this.touchend))},this.touchmove=x=>{x.targetTouches.length!==1?this.reset():(this._lastPos=U.touchPos(this.element,x.targetTouches)[0],this.moveTouch(x,this._lastPos))},this.touchend=x=>{x.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const c=e.dragRotate._mouseRotate.getClickTolerance(),p=e.dragRotate._mousePitch.getClickTolerance();this.element=o,this.mouseRotate=$u({clickTolerance:c,enable:!0}),this.touchRotate=(({enable:x,clickTolerance:S,bearingDegreesPerPixelMoved:T=.8})=>{const E=new Uu;return new Fi({clickTolerance:S,move:(M,z)=>({bearingDelta:(z.x-M.x)*T}),moveStateManager:E,enable:x,assignEvents:rc})})({clickTolerance:c,enable:!0}),this.map=e,u&&(this.mousePitch=Zu({clickTolerance:p,enable:!0}),this.touchPitch=(({enable:x,clickTolerance:S,pitchDegreesPerPixelMoved:T=-.5})=>{const E=new Uu;return new Fi({clickTolerance:S,move:(M,z)=>({pitchDelta:(z.y-M.y)*T}),moveStateManager:E,enable:x,assignEvents:rc})})({clickTolerance:p,enable:!0})),U.addEventListener(o,"mousedown",this.mousedown),U.addEventListener(o,"touchstart",this.touchstart,{passive:!1}),U.addEventListener(o,"touchcancel",this.reset)}startMouse(e,o){this.mouseRotate.dragStart(e,o),this.mousePitch&&this.mousePitch.dragStart(e,o),U.disableDrag()}startTouch(e,o){this.touchRotate.dragStart(e,o),this.touchPitch&&this.touchPitch.dragStart(e,o),U.disableDrag()}moveMouse(e,o){const u=this.map,{bearingDelta:c}=this.mouseRotate.dragMove(e,o)||{};if(c&&u.setBearing(u.getBearing()+c),this.mousePitch){const{pitchDelta:p}=this.mousePitch.dragMove(e,o)||{};p&&u.setPitch(u.getPitch()+p)}}moveTouch(e,o){const u=this.map,{bearingDelta:c}=this.touchRotate.dragMove(e,o)||{};if(c&&u.setBearing(u.getBearing()+c),this.touchPitch){const{pitchDelta:p}=this.touchPitch.dragMove(e,o)||{};p&&u.setPitch(u.getPitch()+p)}}off(){const e=this.element;U.removeEventListener(e,"mousedown",this.mousedown),U.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),U.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),U.removeEventListener(window,"touchend",this.touchend),U.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){U.enableDrag(),U.removeEventListener(window,"mousemove",this.mousemove),U.removeEventListener(window,"mouseup",this.mouseup),U.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),U.removeEventListener(window,"touchend",this.touchend)}}let Tn;function Wt(f,e,o){const u=new d.N(f.lng,f.lat);if(f=new d.N(f.lng,f.lat),e){const c=new d.N(f.lng-360,f.lat),p=new d.N(f.lng+360,f.lat),x=o.locationPoint(f).distSqr(e);o.locationPoint(c).distSqr(e)<x?f=c:o.locationPoint(p).distSqr(e)<x&&(f=p)}for(;Math.abs(f.lng-o.center.lng)>180;){const c=o.locationPoint(f);if(c.x>=0&&c.y>=0&&c.x<=o.width&&c.y<=o.height)break;f.lng>o.center.lng?f.lng-=360:f.lng+=360}return f.lng!==u.lng&&o.locationPoint(f).y>o.height/2-o.getHorizon()?f:u}const go={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function _l(f,e,o){const u=f.classList;for(const c in go)u.remove(`maplibregl-${o}-anchor-${c}`);u.add(`maplibregl-${o}-anchor-${e}`)}class vl extends d.E{constructor(e){if(super(),this._onKeyPress=o=>{const u=o.code,c=o.charCode||o.keyCode;u!=="Space"&&u!=="Enter"&&c!==32&&c!==13||this.togglePopup()},this._onMapClick=o=>{const u=o.originalEvent.target,c=this._element;this._popup&&(u===c||c.contains(u))&&this.togglePopup()},this._update=o=>{var u;if(!this._map)return;const c=this._map.loaded()&&!this._map.isMoving();((o==null?void 0:o.type)==="terrain"||(o==null?void 0:o.type)==="render"&&!c)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Wt(this._lngLat,this._flatPos,this._map.transform):(u=this._lngLat)===null||u===void 0?void 0:u.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let x="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?x="rotateX(0deg)":this._pitchAlignment==="map"&&(x=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||o&&o.type!=="moveend"||(this._pos=this._pos.round()),U.setTransform(this._element,`${go[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${x} ${p}`),Z.frameAsync(new AbortController).then(()=>{this._updateOpacity(o&&o.type==="moveend")}).catch(()=>{})},this._onMove=o=>{if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new d.k("dragstart"))),this.fire(new d.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new d.k("dragend")),this._state="inactive"},this._addDragHandler=o=>{this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=d.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=U.create("div");const o=U.createNS("http://www.w3.org/2000/svg","svg"),u=41,c=27;o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height",`${u}px`),o.setAttributeNS(null,"width",`${c}px`),o.setAttributeNS(null,"viewBox",`0 0 ${c} ${u}`);const p=U.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"stroke","none"),p.setAttributeNS(null,"stroke-width","1"),p.setAttributeNS(null,"fill","none"),p.setAttributeNS(null,"fill-rule","evenodd");const x=U.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"fill-rule","nonzero");const S=U.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");const T=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ee of T){const se=U.createNS("http://www.w3.org/2000/svg","ellipse");se.setAttributeNS(null,"opacity","0.04"),se.setAttributeNS(null,"cx","10.5"),se.setAttributeNS(null,"cy","5.80029008"),se.setAttributeNS(null,"rx",ee.rx),se.setAttributeNS(null,"ry",ee.ry),S.appendChild(se)}const E=U.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill",this._color);const M=U.createNS("http://www.w3.org/2000/svg","path");M.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),E.appendChild(M);const z=U.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"opacity","0.25"),z.setAttributeNS(null,"fill","#000000");const F=U.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),z.appendChild(F);const V=U.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"transform","translate(6.0, 7.0)"),V.setAttributeNS(null,"fill","#FFFFFF");const $=U.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"transform","translate(8.0, 8.0)");const X=U.createNS("http://www.w3.org/2000/svg","circle");X.setAttributeNS(null,"fill","#000000"),X.setAttributeNS(null,"opacity","0.25"),X.setAttributeNS(null,"cx","5.5"),X.setAttributeNS(null,"cy","5.5"),X.setAttributeNS(null,"r","5.4999962");const Q=U.createNS("http://www.w3.org/2000/svg","circle");Q.setAttributeNS(null,"fill","#FFFFFF"),Q.setAttributeNS(null,"cx","5.5"),Q.setAttributeNS(null,"cy","5.5"),Q.setAttributeNS(null,"r","5.4999962"),$.appendChild(X),$.appendChild(Q),x.appendChild(S),x.appendChild(E),x.appendChild(z),x.appendChild(V),x.appendChild($),o.appendChild(x),o.setAttributeNS(null,"height",u*this._scale+"px"),o.setAttributeNS(null,"width",c*this._scale+"px"),this._element.appendChild(o),this._offset=d.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",o=>{o.preventDefault()}),this._element.addEventListener("mousedown",o=>{o.preventDefault()}),_l(this._element,this._anchor,"marker"),e&&e.className)for(const o of e.className.split(" "))this._element.classList.add(o);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),U.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=d.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const c=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[c,-1*(38.1-13.5+c)],"bottom-right":[-c,-1*(38.1-13.5+c)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var o,u;if(!(!((o=this._map)===null||o===void 0)&&o.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const c=this._map,p=c.terrain.depthAtPoint(this._pos),x=c.terrain.getElevationForLngLatZoom(this._lngLat,c.transform.tileZoom);if(c.transform.lngLatToCameraDepth(this._lngLat,x)-p<.006)return void(this._element.style.opacity=this._opacity);const S=-this._offset.y/c.transform._pixelPerMeter,T=Math.sin(c.getPitch()*Math.PI/180)*S,E=c.terrain.depthAtPoint(new d.P(this._pos.x,this._pos.y-this._offset.y)),M=c.transform.lngLatToCameraDepth(this._lngLat,x+T)-E>.006;!((u=this._popup)===null||u===void 0)&&u.isOpen()&&M&&this._popup.remove(),this._element.style.opacity=M?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=d.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,o){return e===void 0&&o===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),o!==void 0&&(this._opacityWhenCovered=o),this._map&&this._updateOpacity(!0),this}}const Kh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ya=0,_a=!1;const bi={maxWidth:100,unit:"metric"};function va(f,e,o){const u=o&&o.maxWidth||100,c=f._container.clientHeight/2,p=f.unproject([0,c]),x=f.unproject([u,c]),S=p.distanceTo(x);if(o&&o.unit==="imperial"){const T=3.2808*S;T>5280?Je(e,u,T/5280,f._getUIString("ScaleControl.Miles")):Je(e,u,T,f._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?Je(e,u,S/1852,f._getUIString("ScaleControl.NauticalMiles")):S>=1e3?Je(e,u,S/1e3,f._getUIString("ScaleControl.Kilometers")):Je(e,u,S,f._getUIString("ScaleControl.Meters"))}function Je(f,e,o,u){const c=function(p){const x=Math.pow(10,`${Math.floor(p)}`.length-1);let S=p/x;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(T){const E=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*E)/E}(S),x*S}(o);f.style.width=e*(c/o)+"px",f.innerHTML=`${c}&nbsp;${u}`}const lt={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},xl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function wl(f){if(f){if(typeof f=="number"){const e=Math.round(Math.abs(f)/Math.SQRT2);return{center:new d.P(0,0),top:new d.P(0,f),"top-left":new d.P(e,e),"top-right":new d.P(-e,e),bottom:new d.P(0,-f),"bottom-left":new d.P(e,-e),"bottom-right":new d.P(-e,-e),left:new d.P(f,0),right:new d.P(-f,0)}}if(f instanceof d.P||Array.isArray(f)){const e=d.P.convert(f);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:d.P.convert(f.center||[0,0]),top:d.P.convert(f.top||[0,0]),"top-left":d.P.convert(f["top-left"]||[0,0]),"top-right":d.P.convert(f["top-right"]||[0,0]),bottom:d.P.convert(f.bottom||[0,0]),"bottom-left":d.P.convert(f["bottom-left"]||[0,0]),"bottom-right":d.P.convert(f["bottom-right"]||[0,0]),left:d.P.convert(f.left||[0,0]),right:d.P.convert(f.right||[0,0])}}return wl(new d.P(0,0))}const nc=B;w.AJAXError=d.bh,w.Evented=d.E,w.LngLat=d.N,w.MercatorCoordinate=d.Z,w.Point=d.P,w.addProtocol=d.bi,w.config=d.a,w.removeProtocol=d.bj,w.AttributionControl=fo,w.BoxZoomHandler=kn,w.CanvasSource=Dn,w.CooperativeGesturesHandler=ho,w.DoubleClickZoomHandler=Cs,w.DragPanHandler=qh,w.DragRotateHandler=Gh,w.EdgeInsets=lo,w.FullscreenControl=class extends d.E{constructor(f={}){super(),this._onFullscreenChange=()=>{var e;let o=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=o==null?void 0:o.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)o=o.shadowRoot.fullscreenElement;o===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:d.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){U.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const f=this._fullscreenButton=U.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);U.create("span","maplibregl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new d.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new d.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},w.GeoJSONSource=Yo,w.GeolocateControl=class extends d.E{constructor(f){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new d.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new d.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const o=new d.N(e.coords.longitude,e.coords.latitude),u=e.coords.accuracy,c=this._map.getBearing(),p=d.e({bearing:c},this.options.fitBoundsOptions),x=ve.fromLngLat(o,u);this._map.fitBounds(x,p,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const o=new d.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&_a)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new d.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=U.create("button","maplibregl-ctrl-geolocate",this._container),U.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){d.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=U.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new vl({element:this._dotElement}),this._circleElement=U.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new vl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new d.k("trackuserlocationend")),this.fire(new d.k("userlocationlostfocus")))})}},this.options=d.e({},Kh,f)}onAdd(f){return this._map=f,this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return d._(this,arguments,void 0,function*(e=!1){if(Tn!==void 0&&!e)return Tn;if(window.navigator.permissions===void 0)return Tn=!!window.navigator.geolocation,Tn;try{Tn=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Tn=!!window.navigator.geolocation}return Tn})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),U.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ya=0,_a=!1}_isOutOfMapMaxBounds(f){const e=this._map.getMaxBounds(),o=f.coords;return e&&(o.longitude<e.getWest()||o.longitude>e.getEast()||o.latitude<e.getSouth()||o.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const f=this._map.getBounds(),e=f.getSouthEast(),o=f.getNorthEast(),u=e.distanceTo(o),c=Math.ceil(this._accuracy/(u/this._map._container.clientHeight)*2);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}trigger(){if(!this._setup)return d.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ya--,_a=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new d.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.k("trackuserlocationstart")),this.fire(new d.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ya++,ya>1?(f={maximumAge:6e5,timeout:0},_a=!0):(f=this.options.positionOptions,_a=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},w.Hash=ul,w.ImageSource=Di,w.KeyboardHandler=Fn,w.LngLatBounds=ve,w.LogoControl=Yu,w.Map=class extends Hh{constructor(f){d.bf.mark(d.bg.create);const e=Object.assign(Object.assign({},gf),f);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new uo(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Tt,this._controls=[],this._mapId=d.a4(),this._contextLost=o=>{o.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new d.k("webglcontextlost",{originalEvent:o}))},this._contextRestored=o=>{this._setupPainter(),this.resize(),this._update(),this.fire(new d.k("webglcontextrestored",{originalEvent:o}))},this._onMapScroll=o=>{if(o.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},tc),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=re.addThrottleControl(()=>this.isMoving()),this._requestManager=new de(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let o=!1;const u=ha(c=>{this._trackResize&&!this._removed&&(this.resize(c),this.redraw())},50);this._resizeObserver=new ResizeObserver(c=>{o?u(c):o=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Ju(this,e),this._hash=e.hash&&new ul(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,d.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new fo(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new Yu,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new d.k(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new d.k(`${o.dataType}dataloading`,o))}),this.on("dataabort",o=>{this.fire(new d.k("sourcedataabort",o))})}_getMapId(){return this._mapId}addControl(f,e){if(e===void 0&&(e=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new d.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=f.onAdd(this);this._controls.push(f);const u=this._controlPositions[e];return e.indexOf("bottom")!==-1?u.insertBefore(o,u.firstChild):u.appendChild(o),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new d.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(f);return e>-1&&this._controls.splice(e,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}calculateCameraOptionsFromTo(f,e,o,u){return u==null&&this.terrain&&(u=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(f,e,o,u)}resize(f){var e;const o=this._containerDimensions(),u=o[0],c=o[1],p=this._getClampedPixelRatio(u,c);if(this._resizeCanvas(u,c,p),this.painter.resize(u,c,p),this.painter.overLimit()){const S=this.painter.context.gl;this._maxCanvasSize=[S.drawingBufferWidth,S.drawingBufferHeight];const T=this._getClampedPixelRatio(u,c);this._resizeCanvas(u,c,T),this.painter.resize(u,c,T)}this.transform.resize(u,c),(e=this._requestedCameraState)===null||e===void 0||e.resize(u,c);const x=!this._moving;return x&&(this.stop(),this.fire(new d.k("movestart",f)).fire(new d.k("move",f))),this.fire(new d.k("resize",f)),x&&this.fire(new d.k("moveend",f)),this}_getClampedPixelRatio(f,e){const{0:o,1:u}=this._maxCanvasSize,c=this.getPixelRatio(),p=f*c,x=e*c;return Math.min(p>o?o/p:1,x>u?u/x:1)*c}getPixelRatio(){var f;return(f=this._overridePixelRatio)!==null&&f!==void 0?f:devicePixelRatio}setPixelRatio(f){this._overridePixelRatio=f,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(f){return this.transform.setMaxBounds(ve.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f&&this.setZoom(f),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f&&this.setZoom(f),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f&&this.setPitch(f),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f&&this.setPitch(f),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}project(f){return this.transform.locationPoint(d.N.convert(f),this.style&&this.terrain)}unproject(f){return this.transform.pointLocation(d.P.convert(f),this.terrain)}isMoving(){var f;return this._moving||((f=this.handlers)===null||f===void 0?void 0:f.isMoving())}isZooming(){var f;return this._zooming||((f=this.handlers)===null||f===void 0?void 0:f.isZooming())}isRotating(){var f;return this._rotating||((f=this.handlers)===null||f===void 0?void 0:f.isRotating())}_createDelegatedListener(f,e,o){if(f==="mouseenter"||f==="mouseover"){let u=!1;return{layers:e,listener:o,delegates:{mousemove:p=>{const x=e.filter(T=>this.getLayer(T)),S=x.length!==0?this.queryRenderedFeatures(p.point,{layers:x}):[];S.length?u||(u=!0,o.call(this,new Br(f,this,p.originalEvent,{features:S}))):u=!1},mouseout:()=>{u=!1}}}}if(f==="mouseleave"||f==="mouseout"){let u=!1;return{layers:e,listener:o,delegates:{mousemove:x=>{const S=e.filter(T=>this.getLayer(T));(S.length!==0?this.queryRenderedFeatures(x.point,{layers:S}):[]).length?u=!0:u&&(u=!1,o.call(this,new Br(f,this,x.originalEvent)))},mouseout:x=>{u&&(u=!1,o.call(this,new Br(f,this,x.originalEvent)))}}}}{const u=c=>{const p=e.filter(S=>this.getLayer(S)),x=p.length!==0?this.queryRenderedFeatures(c.point,{layers:p}):[];x.length&&(c.features=x,o.call(this,c),delete c.features)};return{layers:e,listener:o,delegates:{[f]:u}}}}_saveDelegatedListener(f,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(e)}_removeDelegatedListener(f,e,o){if(!this._delegatedListeners||!this._delegatedListeners[f])return;const u=this._delegatedListeners[f];for(let c=0;c<u.length;c++){const p=u[c];if(p.listener===o&&p.layers.length===e.length&&p.layers.every(x=>e.includes(x))){for(const x in p.delegates)this.off(x,p.delegates[x]);return void u.splice(c,1)}}}on(f,e,o){if(o===void 0)return super.on(f,e);const u=this._createDelegatedListener(f,typeof e=="string"?[e]:e,o);this._saveDelegatedListener(f,u);for(const c in u.delegates)this.on(c,u.delegates[c]);return this}once(f,e,o){if(o===void 0)return super.once(f,e);const u=typeof e=="string"?[e]:e,c=this._createDelegatedListener(f,u,o);for(const p in c.delegates){const x=c.delegates[p];c.delegates[p]=(...S)=>{this._removeDelegatedListener(f,u,o),x(...S)}}this._saveDelegatedListener(f,c);for(const p in c.delegates)this.once(p,c.delegates[p]);return this}off(f,e,o){return o===void 0?super.off(f,e):(this._removeDelegatedListener(f,typeof e=="string"?[e]:e,o),this)}queryRenderedFeatures(f,e){if(!this.style)return[];let o;const u=f instanceof d.P||Array.isArray(f),c=u?f:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(u?{}:f)||{},c instanceof d.P||typeof c[0]=="number")o=[d.P.convert(c)];else{const p=d.P.convert(c[0]),x=d.P.convert(c[1]);o=[p,new d.P(x.x,p.y),x,new d.P(p.x,x.y),p]}return this.style.queryRenderedFeatures(o,e,this.transform)}querySourceFeatures(f,e){return this.style.querySourceFeatures(f,e)}setStyle(f,e){return(e=d.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&f?(this._diffStyle(f,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(f,e))}setTransformRequest(f){return this._requestManager.setTransformRequest(f),this}_getUIString(f){const e=this._locale[f];if(e==null)throw new Error(`Missing UI string '${f}'`);return e}_updateStyle(f,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(f,e));const o=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!f)),f?(this.style=new Ga(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f,e,o):this.style.loadJSON(f,e,o),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Ga(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,e){if(typeof f=="string"){const o=this._requestManager.transformRequest(f,"Style");d.h(o,new AbortController).then(u=>{this._updateDiff(u.data,e)}).catch(u=>{u&&this.fire(new d.j(u))})}else typeof f=="object"&&this._updateDiff(f,e)}_updateDiff(f,e){try{this.style.setState(f,e)&&this._update(!0)}catch(o){d.w(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(f,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():d.w("There is no style added to the map.")}addSource(f,e){return this._lazyInitEmptyStyle(),this.style.addSource(f,e),this._update(!0)}isSourceLoaded(f){const e=this.style&&this.style.sourceCaches[f];if(e!==void 0)return e.loaded();this.fire(new d.j(new Error(`There is no source with ID '${f}'`)))}setTerrain(f){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),f){const e=this.style.sourceCaches[f.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${f.source}`);this.terrain===null&&e.reload();for(const o in this.style._layers){const u=this.style._layers[o];u.type==="hillshade"&&u.source===f.source&&d.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ec(this.painter,e,f),this.painter.renderToTexture=new Wh(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=o=>{o.dataType==="style"?this.terrain.sourceCache.freeRtt():o.dataType==="source"&&o.tile&&(o.sourceId!==f.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(o.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new d.k("terrain",{terrain:f})),this}getTerrain(){var f,e;return(e=(f=this.terrain)===null||f===void 0?void 0:f.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const f=this.style&&this.style.sourceCaches;for(const e in f){const o=f[e]._tiles;for(const u in o){const c=o[u];if(c.state!=="loaded"&&c.state!=="errored")return!1}}return!0}removeSource(f){return this.style.removeSource(f),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,e,o={}){const{pixelRatio:u=1,sdf:c=!1,stretchX:p,stretchY:x,content:S,textFitWidth:T,textFitHeight:E}=o;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||d.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:M,height:z,data:F}=e,V=e;return this.style.addImage(f,{data:new d.R({width:M,height:z},new Uint8Array(F)),pixelRatio:u,stretchX:p,stretchY:x,content:S,textFitWidth:T,textFitHeight:E,sdf:c,version:0,userImage:V}),V.onAdd&&V.onAdd(this,f),this}}{const{width:M,height:z,data:F}=Z.getImageData(e);this.style.addImage(f,{data:new d.R({width:M,height:z},F),pixelRatio:u,stretchX:p,stretchY:x,content:S,textFitWidth:T,textFitHeight:E,sdf:c,version:0})}}updateImage(f,e){const o=this.style.getImage(f);if(!o)return this.fire(new d.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=e instanceof HTMLImageElement||d.b(e)?Z.getImageData(e):e,{width:c,height:p,data:x}=u;if(c===void 0||p===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(c!==o.data.width||p!==o.data.height)return this.fire(new d.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(e instanceof HTMLImageElement||d.b(e));return o.data.replace(x,S),this.style.updateImage(f,o),this}getImage(f){return this.style.getImage(f)}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new d.j(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f){return re.getImage(this._requestManager.transformRequest(f,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(f,e){return this._lazyInitEmptyStyle(),this.style.addLayer(f,e),this._update(!0)}moveLayer(f,e){return this.style.moveLayer(f,e),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(f,e,o){return this.style.setLayerZoomRange(f,e,o),this._update(!0)}setFilter(f,e,o={}){return this.style.setFilter(f,e,o),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,e,o,u={}){return this.style.setPaintProperty(f,e,o,u),this._update(!0)}getPaintProperty(f,e){return this.style.getPaintProperty(f,e)}setLayoutProperty(f,e,o,u={}){return this.style.setLayoutProperty(f,e,o,u),this._update(!0)}getLayoutProperty(f,e){return this.style.getLayoutProperty(f,e)}setGlyphs(f,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(f,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(f,e,o={}){return this._lazyInitEmptyStyle(),this.style.addSprite(f,e,o,u=>{u||this._update(!0)}),this}removeSprite(f){return this._lazyInitEmptyStyle(),this.style.removeSprite(f),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(f,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(f,e,o=>{o||this._update(!0)}),this}setLight(f,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(f){return this._lazyInitEmptyStyle(),this.style.setSky(f),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(f,e){return this.style.setFeatureState(f,e),this._update()}removeFeatureState(f,e){return this.style.removeFeatureState(f,e),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let f=0,e=0;return this._container&&(f=this._container.clientWidth||400,e=this._container.clientHeight||300),[f,e]}_setupContainer(){const f=this._container;f.classList.add("maplibregl-map");const e=this._canvasContainer=U.create("div","maplibregl-canvas-container",f);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=U.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const o=this._containerDimensions(),u=this._getClampedPixelRatio(o[0],o[1]);this._resizeCanvas(o[0],o[1],u);const c=this._controlContainer=U.create("div","maplibregl-control-container",f),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{p[x]=U.create("div",`maplibregl-ctrl-${x} `,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,e,o){this._canvas.width=Math.floor(o*f),this._canvas.height=Math.floor(o*e),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const f={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",u=>{e={requestedAttributes:f},u&&(e.statusMessage=u.statusMessage,e.type=u.type)},{once:!0});const o=this._canvas.getContext("webgl2",f)||this._canvas.getContext("webgl",f);if(!o){const u="Failed to initialize WebGL";throw e?(e.message=u,new Error(JSON.stringify(e))):new Error(u)}this.painter=new ll(o,this.transform),Se.testSupport(o)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_render(f){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._removed)return;let o=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const c=this.transform.zoom,p=Z.now();this.style.zoomHistory.update(c,p);const x=new d.z(c,{now:p,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),S=x.crossFadingFactor();S===1&&S===this._crossFadingFactor||(o=!0,this._crossFadingFactor=S),this.style.update(x)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new d.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,d.bf.mark(d.bg.load),this.fire(new d.k("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const u=this._sourcesDirty||this._styleDirty||this._placementDirty;return u||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new d.k("idle")),!this._loaded||this._fullyLoaded||u||(this._fullyLoaded=!0,d.bf.mark(d.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var f;this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),re.removeThrottleControl(this._imageQueueHandle),(f=this._resizeObserver)===null||f===void 0||f.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),U.remove(this._canvasContainer),U.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),d.bf.clearMetrics(),this._removed=!0,this.fire(new d.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Z.frameAsync(this._frameRequest).then(f=>{d.bf.frame(f),this._frameRequest=null,this._render(f)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get version(){return Xh}getCameraTargetElevation(){return this.transform.elevation}},w.MapMouseEvent=Br,w.MapTouchEvent=Ts,w.MapWheelEvent=Uh,w.Marker=vl,w.NavigationControl=class{constructor(f){this._updateZoomButtons=()=>{const e=this._map.getZoom(),o=e===this._map.getMaxZoom(),u=e===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,o)=>{const u=this._map._getUIString(`NavigationControl.${o}`);e.title=u,e.setAttribute("aria-label",u)},this.options=d.e({},yf,f),this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),U.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),U.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=U.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new _f(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){U.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,e){const o=U.create("button",f,this._container);return o.type="button",o.addEventListener("click",e),o}},w.Popup=class extends d.E{constructor(f){super(),this.remove=()=>(this._content&&U.remove(this._content),this._container&&(U.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new d.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var o;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=U.create("div","maplibregl-popup",this._map.getContainer()),this._tip=U.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const S of this.options.className.split(" "))this._container.classList.add(S);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Wt(this._lngLat,this._flatPos,this._map.transform):(o=this._lngLat)===null||o===void 0?void 0:o.wrap(),this._trackPointer&&!e)return;const u=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let c=this.options.anchor;const p=wl(this.options.offset);if(!c){const S=this._container.offsetWidth,T=this._container.offsetHeight;let E;E=u.y+p.bottom.y<T?["top"]:u.y>this._map.transform.height-T?["bottom"]:[],u.x<S/2?E.push("left"):u.x>this._map.transform.width-S/2&&E.push("right"),c=E.length===0?"bottom":E.join("-")}let x=u.add(p[c]);this.options.subpixelPositioning||(x=x.round()),U.setTransform(this._container,`${go[c]} translate(${x.x}px,${x.y}px)`),_l(this._container,c,"popup")},this._onClose=()=>{this.remove()},this.options=d.e(Object.create(lt),f)}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new d.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=d.N.convert(f),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const e=document.createDocumentFragment(),o=document.createElement("body");let u;for(o.innerHTML=f;u=o.firstChild,u;)e.appendChild(u);return this.setDOMContent(e)}getMaxWidth(){var f;return(f=this._container)===null||f===void 0?void 0:f.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=U.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){return this._container&&this._container.classList.add(f),this}removeClassName(f){return this._container&&this._container.classList.remove(f),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){if(this._container)return this._container.classList.toggle(f)}setSubpixelPositioning(f){this.options.subpixelPositioning=f}_createCloseButton(){this.options.closeButton&&(this._closeButton=U.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(xl);f&&f.focus()}},w.RasterDEMTileSource=tr,w.RasterTileSource=Dt,w.ScaleControl=class{constructor(f){this._onMove=()=>{va(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,va(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},bi),f)}getDefaultPosition(){return"bottom-left"}onAdd(f){return this._map=f,this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){U.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},w.ScrollZoomHandler=ei,w.Style=Ga,w.TerrainControl=class{constructor(f){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=f}onAdd(f){return this._map=f,this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=U.create("button","maplibregl-ctrl-terrain",this._container),U.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){U.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},w.TwoFingersTouchPitchHandler=ga,w.TwoFingersTouchRotateHandler=Wu,w.TwoFingersTouchZoomHandler=Gu,w.TwoFingersTouchZoomRotateHandler=Ku,w.VectorTileSource=Jo,w.VideoSource=Ws,w.addSourceType=(f,e)=>d._(void 0,void 0,void 0,function*(){if(ea(f))throw new Error(`A source type called "${f}" already exists.`);((o,u)=>{Qo[o]=u})(f,e)}),w.clearPrewarmedResources=function(){const f=kr;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(Fr),kr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},w.getMaxParallelImageRequests=function(){return d.a.MAX_PARALLEL_IMAGE_REQUESTS},w.getRTLTextPluginStatus=function(){return yi().getRTLTextPluginStatus()},w.getVersion=function(){return nc},w.getWorkerCount=function(){return sn.workerCount},w.getWorkerUrl=function(){return d.a.WORKER_URL},w.importScriptInWorkers=function(f){return Ko().broadcast("IS",f)},w.prewarm=function(){ps().acquire(Fr)},w.setMaxParallelImageRequests=function(f){d.a.MAX_PARALLEL_IMAGE_REQUESTS=f},w.setRTLTextPlugin=function(f,e){return yi().setRTLTextPlugin(f,e)},w.setWorkerCount=function(f){sn.workerCount=f},w.setWorkerUrl=function(f){d.a.WORKER_URL=f}});var k=l;return k})})(Iw);var fI=Iw.exports;const mI=qx(fI);function jx(r,s,l=64){const[m,_]=r,k=[],w=6378137;for(let d=0;d<=l;d++){const B=d/l*2*Math.PI,K=s*Math.cos(B),te=s*Math.sin(B),Z=K/(w*Math.cos(_*Math.PI/180))*(180/Math.PI),U=te/w*(180/Math.PI);k.push([m+Z,_+U])}return k}function Vx(r,s){const[l,m]=r,[_,k]=s,w=[Math.min(l,_),Math.min(m,k)],d=[Math.max(l,_),Math.max(m,k)],B=[d[0],w[1]],K=[w[0],d[1]];return[w,B,d,K,w]}function gI(r){const s=Wi(),l=sr(ke=>ke.ui.activeDrawMode),m=sr(ke=>ke.ui.measurementMode),[_,k]=ft.useState([]),w=ft.useRef({entityId:null,startLngLat:null,originalCoords:null}),d=ft.useRef(null),B=ft.useRef(0),K=ft.useRef(null),te=ft.useRef(!1),Z=ft.useRef(new Set),U=sr(ke=>ke.ui.editingEntityId),Se=sr(ke=>ke.ui.editingVertexIndex);ft.useEffect(()=>{if(!r||m||l==="none"||l==="select"||l==="edit")return;const ke=ne=>{var Ue;if((Ue=ne.preventDefault)==null||Ue.call(ne),te.current)return;const q=Date.now(),re=q-B.current;if(K.current&&(clearTimeout(d.current),K.current=null,d.current=null),re<300&&re>0){B.current=0;return}B.current=q;const{lng:de,lat:ye}=ne.lngLat,Ce=()=>{if(!te.current){if(te.current=!0,l==="draw_point"){s(Fs({kind:"point",data:{coordinates:[de,ye]}})),s(Dr("select")),setTimeout(()=>{te.current=!1},100);return}if(l==="draw_line"||l==="draw_polygon"){k(tt=>[...tt,[de,ye]]),setTimeout(()=>{te.current=!1},100);return}if(l==="draw_circle"){k(tt=>{if(tt.length===0)return setTimeout(()=>{te.current=!1},100),[[de,ye]];if(tt.length===1){const[ut,ot]=tt[0],wr=Ux([ut,ot],[de,ye]);return s(Fs({kind:"circle",data:{center:[ut,ot],radiusMeters:wr}})),s(Dr("select")),setTimeout(()=>{te.current=!1},100),[]}return setTimeout(()=>{te.current=!1},100),tt});return}if(l==="draw_rectangle"){k(tt=>{if(tt.length===0)return setTimeout(()=>{te.current=!1},100),[[de,ye]];if(tt.length===1){const ut=Vx(tt[0],[de,ye]);return s(Fs({kind:"rectangle",data:{coordinates:ut}})),s(Dr("select")),setTimeout(()=>{te.current=!1},100),[]}return setTimeout(()=>{te.current=!1},100),tt});return}setTimeout(()=>{te.current=!1},100)}},ze=()=>{if(!K.current)return;const tt=K.current;K.current=null,d.current=null,tt()};K.current=Ce,d.current=window.setTimeout(ze,300)},Pe="draw-click";return Z.current.has(Pe)&&(r.off("click",ke),Z.current.delete(Pe)),r.on("click",ke),Z.current.add(Pe),()=>{Z.current.has(Pe)&&(r.off("click",ke),Z.current.delete(Pe)),d.current&&(clearTimeout(d.current),d.current=null),K.current=null,te.current=!1}},[r,l,m,s]),ft.useEffect(()=>{if(!r||l!=="draw_line"&&l!=="draw_polygon")return;const ke=ne=>{var q;(q=ne.preventDefault)==null||q.call(ne),d.current&&(clearTimeout(d.current),d.current=null),K.current&&(K.current=null),B.current=0,k(re=>l==="draw_line"&&re.length>=2?(setTimeout(()=>{s(Fs({kind:"line",data:{coordinates:re}})),s(Dr("select"))},0),[]):l==="draw_polygon"&&re.length>=3?(setTimeout(()=>{s(Fs({kind:"polygon",data:{coordinates:[...re,re[0]]}})),s(Dr("select"))},0),[]):re)},Pe="draw-dblclick";return Z.current.has(Pe)&&(r.off("dblclick",ke),Z.current.delete(Pe)),r.on("dblclick",ke),Z.current.add(Pe),()=>{Z.current.has(Pe)&&(r.off("dblclick",ke),Z.current.delete(Pe)),d.current&&(clearTimeout(d.current),d.current=null),K.current=null}},[r,l,s]);const be=sr(ke=>U?ke.entities.byId[U]:null);return ft.useEffect(()=>{if(!r||l!=="edit"||!U||!be)return;const ke=ne=>{if(Se===null)return;const{lng:q,lat:re}=ne.lngLat,de=Se;if(be.kind==="point")s(Ds({id:be.id,changes:{coordinates:[q,re]}})),s(jl({entityId:null})),s(Dr("select"));else if(be.kind==="line"){const ye=[...be.coordinates];ye[de]=[q,re],s(Ds({id:be.id,changes:{coordinates:ye}})),s(jl({entityId:null})),s(Dr("select"))}else if(be.kind==="polygon"){const ye=[...be.coordinates];ye[de]=[q,re],de===ye.length-1&&(ye[0]=[q,re]),s(Ds({id:be.id,changes:{coordinates:ye}})),s(jl({entityId:null})),s(Dr("select"))}else if(be.kind==="circle"){if(Se===-1)s(Ds({id:be.id,changes:{center:[q,re]}}));else{const ye=Ux(be.center,[q,re]);s(Ds({id:be.id,changes:{radiusMeters:ye}}))}s(jl({entityId:null})),s(Dr("select"))}else if(be.kind==="rectangle"){const ye=[...be.coordinates];ye[de]=[q,re];const Ce=Vx(ye[0],ye[2]||ye[0]);s(Ds({id:be.id,changes:{coordinates:Ce}})),s(jl({entityId:null})),s(Dr("select"))}},Pe="edit-click";return Z.current.has(Pe)||(r.on("click",ke),Z.current.add(Pe)),()=>{Z.current.has(Pe)&&(r.off("click",ke),Z.current.delete(Pe))}},[r,l,U,Se,be,s]),ft.useEffect(()=>{if(!r||l!=="edit")return;const ke=Pe=>{var de,ye,Ce,ze;(de=Pe.preventDefault)==null||de.call(Pe);const ne=(ye=Pe.features)==null?void 0:ye[0];if(!ne)return;const q=(Ce=ne.properties)==null?void 0:Ce.entityId,re=(ze=ne.properties)==null?void 0:ze.vertexIndex;!q||re===void 0||(s(jl({entityId:q,vertexIndex:re})),r.getCanvas().style.cursor="crosshair")};if(r.getLayer("vertices-point")){const Pe="vertex-click";return Z.current.has(Pe)||(r.on("click","vertices-point",ke),Z.current.add(Pe)),()=>{Z.current.has(Pe)&&(r.off("click","vertices-point",ke),Z.current.delete(Pe))}}},[r,l,s]),ft.useEffect(()=>{if(!r||l!=="select"&&l!=="none")return;const ke=re=>{var Ce,ze;const de=(Ce=re.features)==null?void 0:Ce[0];if(!de)return;const ye=(ze=de.properties)==null?void 0:ze.id;ye&&(w.current.entityId=ye,w.current.startLngLat=re.lngLat,w.current.originalCoords=de.geometry,r.getCanvas().style.cursor="grabbing",s(bw(ye)))},Pe=re=>{if(!w.current.entityId||!w.current.startLngLat)return;const{lng:de,lat:ye}=re.lngLat,{lng:Ce,lat:ze}=w.current.startLngLat,Ue=de-Ce,tt=ye-ze,ut=w.current.entityId,ot=w.current.originalCoords;if(ot){if(ot.type==="Point"){const[wr,Zt]=ot.coordinates;s(Ds({id:ut,changes:{coordinates:[wr+Ue,Zt+tt]}}))}else if(ot.type==="LineString"||ot.type==="Polygon"){const Zt=(ot.type==="LineString"?ot.coordinates:ot.coordinates[0]).map(([gr,xn])=>[gr+Ue,xn+tt]);ot.type==="LineString"?s(Ds({id:ut,changes:{coordinates:Zt}})):s(Ds({id:ut,changes:{coordinates:Zt}}))}}},ne=()=>{w.current={entityId:null,startLngLat:null,originalCoords:null},r.getCanvas().style.cursor=""},q=["entities-fill","entities-line","entities-point"];return q.forEach(re=>{r.getLayer(re)&&r.on("mousedown",re,ke)}),r.on("mousemove",Pe),r.on("mouseup",ne),()=>{q.forEach(re=>{r.getLayer(re)&&r.off("mousedown",re,ke)}),r.off("mousemove",Pe),r.off("mouseup",ne)}},[r,l,s]),{draftCoords:_}}function Ux(r,s){const[l,m]=r,[_,k]=s,w=6378137,d=(k-m)*Math.PI/180,B=(_-l)*Math.PI/180,K=m*Math.PI/180,te=k*Math.PI/180,Z=Math.sin(d/2),U=Math.sin(B/2),Se=Z*Z+Math.cos(K)*Math.cos(te)*U*U;return 2*w*Math.asin(Math.sqrt(Se))}function yI(r){const s=sr(d=>d.ui.measurementMode),[l,m]=ft.useState([]),_=ft.useRef(null);ft.useEffect(()=>{if(!r||!s){_.current&&(r!=null&&r.getSource("measurement"))&&r.getSource("measurement").setData({type:"FeatureCollection",features:[]}),m([]);return}r.getSource("measurement")||(r.addSource("measurement",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),r.addLayer({id:"measurement-line",type:"line",source:"measurement",paint:{"line-color":"#ff6b6b","line-width":2,"line-dasharray":[2,2]}}),r.addLayer({id:"measurement-point",type:"circle",source:"measurement",paint:{"circle-radius":5,"circle-color":"#ff6b6b","circle-stroke-width":2,"circle-stroke-color":"#ffffff"}}));const d=B=>{const{lng:K,lat:te}=B.lngLat;m(Z=>[...Z,[K,te]])};return r.on("click",d),()=>{r.off("click",d)}},[r,s]),ft.useEffect(()=>{if(!r||!s||l.length<2){const K=r==null?void 0:r.getSource("measurement");K&&K.setData({type:"FeatureCollection",features:[]});return}const d=r.getSource("measurement");if(!d)return;const B=[];l.length>=2&&B.push({type:"Feature",geometry:{type:"LineString",coordinates:l},properties:{}}),l.forEach((K,te)=>{B.push({type:"Feature",geometry:{type:"Point",coordinates:K},properties:{index:te}})}),d.setData({type:"FeatureCollection",features:B})},[r,s,l]);const k=l.length>=2?l.slice(1).map((d,B)=>{const K=l[B];return _I(K,d)}):[],w=k.reduce((d,B)=>d+B,0);return ft.useEffect(()=>{s||m([])},[s]),{measurementPoints:l,distances:k,totalDistance:w}}function _I(r,s){const[l,m]=r,[_,k]=s,w=6378137,d=(k-m)*Math.PI/180,B=(_-l)*Math.PI/180,K=m*Math.PI/180,te=k*Math.PI/180,Z=Math.sin(d/2),U=Math.sin(B/2),Se=Z*Z+Math.cos(K)*Math.cos(te)*U*U;return 2*w*Math.asin(Math.sqrt(Se))}const vI=({map:r})=>{const s=Wi(),l=sr(te=>te.ui.darkMode),m=sr(te=>te.ui.measurementMode);sr(te=>te.ui.showCoordinates);const _=()=>{r&&r.zoomIn()},k=()=>{r&&r.zoomOut()},w=()=>{r&&r.resetNorthPitch()},d=()=>{if(!r)return;const te=r.getBearing();r.rotateTo(te-15,{duration:300})},B=()=>{if(!r)return;const te=r.getBearing();r.rotateTo(te+15,{duration:300})},K=()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()};return ge.jsxs("div",{className:"absolute top-20 right-4 z-20 flex flex-col gap-2",children:[ge.jsxs("div",{className:"bg-slate-800/80 border border-slate-600 rounded-md overflow-hidden",children:[ge.jsx("button",{onClick:_,className:"w-8 h-8 flex items-center justify-center text-slate-200 hover:bg-slate-700 border-b border-slate-600",title:"Zoom In",children:ge.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:ge.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),ge.jsx("button",{onClick:k,className:"w-8 h-8 flex items-center justify-center text-slate-200 hover:bg-slate-700",title:"Zoom Out",children:ge.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:ge.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})})]}),ge.jsx("button",{onClick:w,className:"w-8 h-8 bg-slate-800/80 border border-slate-600 rounded-md text-slate-200 hover:bg-slate-700 flex items-center justify-center",title:"Reset North",children:ge.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:ge.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})})}),ge.jsxs("div",{className:"bg-slate-800/80 border border-slate-600 rounded-md overflow-hidden",children:[ge.jsx("button",{onClick:d,className:"w-8 h-8 flex items-center justify-center text-slate-200 hover:bg-slate-700 border-b border-slate-600",title:"Rotate Left",children:ge.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:ge.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),ge.jsx("button",{onClick:B,className:"w-8 h-8 flex items-center justify-center text-slate-200 hover:bg-slate-700",title:"Rotate Right",children:ge.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:ge.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15",transform:"scale(-1,1) translate(-24,0)"})})})]}),ge.jsx("button",{onClick:()=>s(aI(!l)),className:`w-8 h-8 border rounded-md flex items-center justify-center ${l?"bg-yellow-500/20 border-yellow-500 text-yellow-300":"bg-slate-800/80 border-slate-600 text-slate-200 hover:bg-slate-700"}`,title:l?"Light Mode":"Dark Mode",children:l?ge.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:ge.jsx("path",{fillRule:"evenodd",d:"M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z",clipRule:"evenodd"})}):ge.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:ge.jsx("path",{d:"M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"})})}),ge.jsx("button",{onClick:()=>s(kw(!m)),className:`w-8 h-8 border rounded-md flex items-center justify-center ${m?"bg-accent/20 border-accent text-accent":"bg-slate-800/80 border-slate-600 text-slate-200 hover:bg-slate-700"}`,title:"Measurement Tool",children:ge.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:ge.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),ge.jsx("button",{onClick:K,className:"w-8 h-8 bg-slate-800/80 border border-slate-600 rounded-md text-slate-200 hover:bg-slate-700 flex items-center justify-center",title:"Fullscreen",children:ge.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:ge.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]})},xI=({map:r,visible:s})=>{const[l,m]=ft.useState(null);return ft.useEffect(()=>{if(!r||!s)return;const _=()=>{const w=r.getCenter();m({lng:w.lng,lat:w.lat})},k=w=>{m({lng:w.lngLat.lng,lat:w.lngLat.lat})};return r.on("move",_),r.on("mousemove",k),_(),()=>{r.off("move",_),r.off("mousemove",k)}},[r,s]),!s||!l?null:ge.jsxs("div",{className:"absolute bottom-4 right-4 z-20 bg-slate-900/90 border border-slate-700 rounded-md px-3 py-2 text-xs text-slate-200 font-mono",children:[ge.jsxs("div",{children:["Lng: ",l.lng.toFixed(6)]}),ge.jsxs("div",{children:["Lat: ",l.lat.toFixed(6)]})]})},wI=({points:r,distances:s,totalDistance:l})=>{const m=Wi(),_=k=>k<1e3?`${k.toFixed(2)} m`:`${(k/1e3).toFixed(2)} km`;return r.length===0?null:ge.jsxs("div",{className:"absolute top-20 left-64 z-20 bg-slate-900/90 border border-slate-700 rounded-md p-3 text-xs text-slate-200 min-w-[200px]",children:[ge.jsxs("div",{className:"flex items-center justify-between mb-2",children:[ge.jsx("div",{className:"font-semibold",children:"Measurement"}),ge.jsx("button",{onClick:()=>m(kw(!1)),className:"text-slate-400 hover:text-slate-200",children:""})]}),ge.jsxs("div",{className:"space-y-1",children:[ge.jsxs("div",{children:["Points: ",r.length]}),s.map((k,w)=>ge.jsxs("div",{className:"text-slate-400",children:["Segment ",w+1,": ",_(k)]},w)),l>0&&ge.jsxs("div",{className:"font-semibold text-accent mt-2 pt-2 border-t border-slate-700",children:["Total Distance: ",_(l)]}),ge.jsx("div",{className:"text-[10px] text-slate-400 mt-2 pt-2 border-t border-slate-700",children:" Double-click to finish measurement"})]})]})},bI=({map:r})=>{const s=Wi(),l=sr(te=>te.entities),m=ft.useRef(null),_=()=>{const Z={type:"FeatureCollection",features:l.allIds.map(ke=>{const Pe=l.byId[ke];if(!Pe||!Pe.visible)return null;let ne;if(Pe.kind==="point")ne={type:"Point",coordinates:Pe.coordinates};else if(Pe.kind==="line")ne={type:"LineString",coordinates:Pe.coordinates};else if(Pe.kind==="polygon")ne={type:"Polygon",coordinates:[Pe.coordinates]};else if(Pe.kind==="circle"){const[re,de]=Pe.center,ye=64,Ce=[];for(let ze=0;ze<=ye;ze++){const Ue=ze/ye*2*Math.PI,tt=Pe.radiusMeters*Math.cos(Ue),ut=Pe.radiusMeters*Math.sin(Ue),ot=tt/(6378137*Math.cos(de*Math.PI/180))*(180/Math.PI),wr=ut/6378137*(180/Math.PI);Ce.push([re+ot,de+wr])}ne={type:"Polygon",coordinates:[Ce]}}else if(Pe.kind==="rectangle")ne={type:"Polygon",coordinates:[Pe.coordinates]};else return null;return{type:"Feature",geometry:ne,properties:{id:Pe.id,kind:Pe.kind,name:Pe.name,color:Pe.color,visible:Pe.visible}}}).filter(ke=>ke!==null)},U=new Blob([JSON.stringify(Z,null,2)],{type:"application/json"}),Se=URL.createObjectURL(U),be=document.createElement("a");be.href=Se,be.download=`map-export-${new Date().toISOString().split("T")[0]}.geojson`,be.click(),URL.revokeObjectURL(Se)},k=()=>{var te;(te=m.current)==null||te.click()},w=te=>{var Se;const Z=(Se=te.target.files)==null?void 0:Se[0];if(!Z)return;const U=new FileReader;U.onload=be=>{var ke;try{JSON.parse((ke=be.target)==null?void 0:ke.result).features.forEach(ne=>{const q=ne.properties||{};let re;ne.geometry.type==="Point"?(re={coordinates:ne.geometry.coordinates},s(Fs({kind:"point",data:re,name:q.name,color:q.color}))):ne.geometry.type==="LineString"?(re={coordinates:ne.geometry.coordinates},s(Fs({kind:"line",data:re,name:q.name,color:q.color}))):ne.geometry.type==="Polygon"&&(re={coordinates:ne.geometry.coordinates[0]},s(Fs({kind:"polygon",data:re,name:q.name,color:q.color})))})}catch(Pe){alert("Error reading file"),console.error(Pe)}},U.readAsText(Z),te.target.value=""},d=()=>{r&&r.getCanvas().toBlob(te=>{if(!te)return;const Z=URL.createObjectURL(te),U=document.createElement("a");U.href=Z,U.download=`map-screenshot-${new Date().toISOString().split("T")[0]}.png`,U.click(),URL.revokeObjectURL(Z)},"image/png")},B=()=>{const te=l.selectedId;if(!te){alert("Please select an entity to copy");return}const Z=l.byId[te];if(!Z)return;const U=JSON.stringify({kind:Z.kind,data:Z.kind==="circle"?{center:Z.center,radiusMeters:Z.radiusMeters}:{coordinates:Z.coordinates},name:`${Z.name} (Copy)`,color:Z.color});navigator.clipboard.writeText(U),alert("Entity copied! Use Paste to paste it")},K=async()=>{try{const te=await navigator.clipboard.readText(),Z=JSON.parse(te);s(Fs(Z))}catch{alert("No copied entity found")}};return ge.jsxs("div",{className:"absolute left-4 bottom-4 z-20 flex flex-col gap-2",children:[ge.jsx("input",{ref:m,type:"file",accept:".geojson,.json",onChange:w,className:"hidden"}),ge.jsxs("div",{className:"bg-slate-800/90 border border-slate-600 rounded-md p-2 flex flex-col gap-2",children:[ge.jsx("div",{className:"text-xs font-semibold text-slate-300 mb-1",children:"Advanced Tools"}),ge.jsx("button",{onClick:_,className:"px-3 py-1.5 text-xs bg-slate-700 hover:bg-slate-600 text-slate-200 rounded border border-slate-600",title:"Export to GeoJSON",children:" Export GeoJSON"}),ge.jsx("button",{onClick:k,className:"px-3 py-1.5 text-xs bg-slate-700 hover:bg-slate-600 text-slate-200 rounded border border-slate-600",title:"Import from GeoJSON",children:" Import GeoJSON"}),ge.jsx("button",{onClick:d,className:"px-3 py-1.5 text-xs bg-slate-700 hover:bg-slate-600 text-slate-200 rounded border border-slate-600",title:"Export as Image",children:" Screenshot"}),ge.jsx("div",{className:"border-t border-slate-600 my-1"}),ge.jsx("button",{onClick:B,className:"px-3 py-1.5 text-xs bg-slate-700 hover:bg-slate-600 text-slate-200 rounded border border-slate-600",title:"Copy Selected Entity",children:" Copy"}),ge.jsx("button",{onClick:K,className:"px-3 py-1.5 text-xs bg-slate-700 hover:bg-slate-600 text-slate-200 rounded border border-slate-600",title:"Paste Entity",children:" Paste"})]})]})};function SI(){const r=Wi(),s=sr(l=>l.entities.selectedId);ft.useEffect(()=>{const l=m=>{if((m.ctrlKey||m.metaKey)&&m.key==="z"&&!m.shiftKey&&m.preventDefault(),(m.ctrlKey||m.metaKey)&&m.key==="z"&&m.shiftKey&&m.preventDefault(),(m.key==="Delete"||m.key==="Backspace")&&s&&r(ww(s)),m.key==="Escape"&&r(Dr("select")),!(m.ctrlKey||m.metaKey))switch(m.key){case"s":r(Dr("select"));break;case"e":r(Dr("edit"));break;case"p":r(Dr("draw_point"));break;case"l":r(Dr("draw_line"));break;case"g":r(Dr("draw_polygon"));break;case"c":r(Dr("draw_circle"));break;case"r":r(Dr("draw_rectangle"));break}};return window.addEventListener("keydown",l),()=>{window.removeEventListener("keydown",l)}},[r,s])}const kI=()=>{const r=Wi(),s=sr(m=>m.ui.mapType),l=[{value:"default",label:" ",icon:""},{value:"satellite",label:"",icon:""},{value:"terrain",label:"",icon:""},{value:"dark",label:"",icon:""},{value:"osm",label:"OpenStreetMap",icon:""}];return ge.jsxs("div",{className:"bg-slate-800/90 border border-slate-600 rounded-md p-2",children:[ge.jsx("div",{className:"text-xs font-semibold text-slate-300 mb-2",children:" "}),ge.jsx("div",{className:"flex flex-col gap-1",children:l.map(m=>ge.jsxs("button",{onClick:()=>r(uI(m.value)),className:`px-3 py-1.5 text-xs rounded border transition-colors ${s===m.value?"bg-blue-600 hover:bg-blue-700 text-white border-blue-500":"bg-slate-700 hover:bg-slate-600 text-slate-200 border-slate-600"}`,title:m.label,children:[ge.jsx("span",{className:"mr-2",children:m.icon}),m.label]},m.value))})]})},TI="https://demotiles.maplibre.org/style.json",$x=r=>{switch(r){case"satellite":return"https://api.maptiler.com/maps/satellite/style.json?key=get_your_own_OpIi9ZULNHzrESv6T2vL";case"terrain":return"https://api.maptiler.com/maps/topo-v2/style.json?key=get_your_own_OpIi9ZULNHzrESv6T2vL";case"dark":return"https://api.maptiler.com/maps/dark-matter/style.json?key=get_your_own_OpIi9ZULNHzrESv6T2vL";case"osm":return"https://api.maptiler.com/maps/openstreetmap/style.json?key=get_your_own_OpIi9ZULNHzrESv6T2vL";case"default":default:return TI}},Zx=r=>{r.getSource("entities")||(r.addSource("entities",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),r.addLayer({id:"entities-fill",type:"fill",source:"entities",filter:["==",["get","fill"],!0],paint:{"fill-color":["get","color"],"fill-opacity":.25}}),r.addLayer({id:"entities-line",type:"line",source:"entities",paint:{"line-color":["get","color"],"line-width":2}}),r.addLayer({id:"entities-point",type:"circle",source:"entities",filter:["==",["geometry-type"],"Point"],paint:{"circle-radius":6,"circle-color":["get","color"],"circle-stroke-width":1,"circle-stroke-color":"#000000"}}),r.addSource("draft",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),r.addLayer({id:"draft-line",type:"line",source:"draft",paint:{"line-color":"#ff0000","line-width":2,"line-dasharray":[2,2]}}),r.addLayer({id:"draft-point",type:"circle",source:"draft",paint:{"circle-radius":4,"circle-color":"#ff0000","circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}),r.addSource("vertices",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),r.addLayer({id:"vertices-point",type:"circle",source:"vertices",paint:{"circle-radius":8,"circle-color":"#00ff00","circle-stroke-width":2,"circle-stroke-color":"#000000"}}))},II=()=>{const r=ft.useRef(null),s=ft.useRef(null),[l,m]=ft.useState(!1),_=ft.useRef("default"),k=sr(q=>q.entities.allIds),w=sr(q=>q.entities.byId),d=ft.useMemo(()=>k.map(q=>w[q]).filter(q=>q&&q.visible),[k,w]);ft.useEffect(()=>{if(!r.current||s.current)return;const q=new mI.Map({container:r.current,style:$x("default"),center:[35,31],zoom:7,pitch:0,bearing:0});return s.current=q,q.doubleClickZoom.disable(),q.on("load",()=>{Zx(q),m(!0)}),()=>{q.remove(),s.current=null,m(!1)}},[]);const{draftCoords:B}=gI(l?s.current:null),{measurementPoints:K,distances:te,totalDistance:Z}=yI(l?s.current:null),U=sr(q=>q.ui.activeDrawMode),Se=sr(q=>q.entities.selectedId),be=sr(q=>q.ui.darkMode),ke=sr(q=>q.ui.measurementMode),Pe=sr(q=>q.ui.showCoordinates),ne=sr(q=>q.ui.mapType);return SI(),ft.useEffect(()=>{const q=s.current;if(!q||!l||_.current===ne)return;const re=$x(ne);_.current=ne;const de=q.getCenter(),ye=q.getZoom(),Ce=q.getBearing(),ze=q.getPitch();q.setStyle(re),q.once("style.load",()=>{Zx(q),q.setCenter(de),q.setZoom(ye),q.setBearing(Ce),q.setPitch(ze)})},[ne,l]),ft.useEffect(()=>{const q=s.current;if(!q)return;const re=q.getSource("entities");if(!re)return;const de=d.map(ye=>{const Ce={id:ye.id,kind:ye.kind,name:ye.name,color:ye.color};return ye.kind==="point"?{type:"Feature",geometry:{type:"Point",coordinates:ye.coordinates},properties:Ce}:ye.kind==="line"?{type:"Feature",geometry:{type:"LineString",coordinates:ye.coordinates},properties:Ce}:ye.kind==="polygon"?{type:"Feature",geometry:{type:"Polygon",coordinates:[ye.coordinates]},properties:{...Ce,fill:!0}}:ye.kind==="circle"?{type:"Feature",geometry:{type:"Polygon",coordinates:[jx(ye.center,ye.radiusMeters)]},properties:{...Ce,fill:!0}}:ye.kind==="rectangle"?{type:"Feature",geometry:{type:"Polygon",coordinates:[ye.coordinates]},properties:{...Ce,fill:!0}}:{type:"Feature",geometry:{type:"Point",coordinates:[0,0]},properties:Ce}});re.setData({type:"FeatureCollection",features:de})},[d]),ft.useEffect(()=>{const q=s.current;if(!q||!l)return;const re=q.getSource("draft");if(!re)return;if(B.length===0){re.setData({type:"FeatureCollection",features:[]});return}const de=[];U==="draw_line"||U==="draw_polygon"?(B.length>=2&&de.push({type:"Feature",geometry:{type:"LineString",coordinates:B},properties:{}}),B.forEach(ye=>{de.push({type:"Feature",geometry:{type:"Point",coordinates:ye},properties:{}})})):U==="draw_circle"&&B.length===1?de.push({type:"Feature",geometry:{type:"Point",coordinates:B[0]},properties:{}}):U==="draw_rectangle"&&B.length===1&&de.push({type:"Feature",geometry:{type:"Point",coordinates:B[0]},properties:{}}),re.setData({type:"FeatureCollection",features:de})},[B,U,l]),ft.useEffect(()=>{const q=s.current;if(!q||!l)return;const re=q.getSource("vertices");if(!re)return;if(U!=="edit"||!Se){re.setData({type:"FeatureCollection",features:[]});return}const de=d.find(Ce=>Ce.id===Se);if(!de){re.setData({type:"FeatureCollection",features:[]});return}const ye=[];if(de.kind==="point")ye.push({type:"Feature",geometry:{type:"Point",coordinates:de.coordinates},properties:{entityId:de.id,vertexIndex:0}});else if(de.kind==="line")de.coordinates.forEach((Ce,ze)=>{ye.push({type:"Feature",geometry:{type:"Point",coordinates:Ce},properties:{entityId:de.id,vertexIndex:ze}})});else if(de.kind==="polygon")de.coordinates.slice(0,-1).forEach((ze,Ue)=>{ye.push({type:"Feature",geometry:{type:"Point",coordinates:ze},properties:{entityId:de.id,vertexIndex:Ue}})});else if(de.kind==="circle"){ye.push({type:"Feature",geometry:{type:"Point",coordinates:de.center},properties:{entityId:de.id,vertexIndex:-1,type:"center"}});const Ce=jx(de.center,de.radiusMeters,64);Ce.length>0&&ye.push({type:"Feature",geometry:{type:"Point",coordinates:Ce[Math.floor(Ce.length/4)]},properties:{entityId:de.id,vertexIndex:-2,type:"radius"}})}else de.kind==="rectangle"&&de.coordinates.slice(0,4).forEach((ze,Ue)=>{ye.push({type:"Feature",geometry:{type:"Point",coordinates:ze},properties:{entityId:de.id,vertexIndex:Ue}})});re.setData({type:"FeatureCollection",features:ye})},[U,Se,d,l]),ft.useEffect(()=>{const q=s.current;if(!q||!l)return;const re=q.getContainer();be?re.style.filter="brightness(0.6) contrast(1.2)":re.style.filter=""},[be,l]),ge.jsxs(ge.Fragment,{children:[ge.jsx("div",{ref:r,className:"map-container rounded-lg shadow-lg"}),ge.jsx(vI,{map:l?s.current:null}),ge.jsx(bI,{map:l?s.current:null}),ge.jsx("div",{className:"absolute top-20 left-4 z-20",children:ge.jsx(kI,{})}),ge.jsx(xI,{map:l?s.current:null,visible:Pe}),ke&&ge.jsx(wI,{points:K,distances:te,totalDistance:Z})]})},CI=[{id:"select",label:"Select"},{id:"edit",label:"Edit"},{id:"draw_point",label:"Point"},{id:"draw_line",label:"Line"},{id:"draw_polygon",label:"Polygon"},{id:"draw_circle",label:"Circle"},{id:"draw_rectangle",label:"Rect"}],EI=()=>{const r=Wi(),s=sr(l=>l.ui.activeDrawMode);return ge.jsx("div",{className:"absolute left-4 top-20 z-20 flex flex-col gap-2",children:CI.map(l=>ge.jsx("button",{onClick:()=>r(Dr(l.id)),className:`px-3 py-1 text-xs rounded-md border 
            ${s===l.id?"bg-accent text-black border-accent":"bg-slate-800/80 text-slate-200 border-slate-600 hover:bg-slate-700"}`,children:l.label},l.id))})},PI=()=>{const r=Wi(),s=sr(l=>l.entities);return ge.jsxs("div",{className:"w-64 bg-slate-900 border-l border-slate-700 text-slate-100 flex flex-col",children:[ge.jsxs("div",{className:"px-3 py-2 border-b border-slate-700 text-xs font-semibold",children:["Entities (",s.allIds.length,")"]}),ge.jsx("div",{className:"flex-1 overflow-auto text-xs",children:s.allIds.map(l=>{const m=s.byId[l];if(!m)return null;const _=s.selectedId===l;return ge.jsxs("div",{className:`px-3 py-2 flex items-center justify-between border-b border-slate-800 cursor-pointer ${_?"bg-slate-800":"hover:bg-slate-800/60"}`,onClick:()=>r(bw(l)),children:[ge.jsxs("div",{className:"flex flex-col gap-0.5",children:[ge.jsxs("div",{className:"flex items-center gap-1",children:[ge.jsx("span",{className:"inline-block w-2 h-2 rounded-full",style:{backgroundColor:m.color}}),ge.jsx("span",{className:"font-semibold",children:m.name})]}),ge.jsx("div",{className:"text-[10px] text-slate-400",children:m.kind.toUpperCase()})]}),ge.jsxs("div",{className:"flex items-center gap-1",children:[ge.jsx("button",{onClick:k=>{k.stopPropagation(),r(iI(l))},className:"px-1 py-0.5 text-[10px] border border-slate-600 rounded",children:m.visible?"Hide":"Show"}),ge.jsx("button",{onClick:k=>{k.stopPropagation(),r(ww(l))},className:"px-1 py-0.5 text-[10px] border border-red-500 text-red-300 rounded",children:"Del"})]})]},l)})})]})},MI=()=>{const r=Wi(),[s,l]=ft.useState({name:"",email:"",category:"",priority:"medium",description:""}),m=k=>{k.preventDefault(),console.log("Form submitted:",s),alert("Form submitted successfully!")},_=()=>{r(Tw(!1))};return ge.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:_,children:ge.jsxs("div",{className:"bg-slate-800 rounded-lg shadow-2xl w-full max-w-md p-6 border border-slate-700",onClick:k=>k.stopPropagation(),children:[ge.jsxs("div",{className:"flex items-center justify-between mb-6",children:[ge.jsx("h2",{className:"text-xl font-bold text-white",children:"Example Form"}),ge.jsx("button",{onClick:_,className:"text-slate-400 hover:text-white transition-colors",children:ge.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:ge.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),ge.jsxs("form",{onSubmit:m,className:"space-y-4",children:[ge.jsxs("div",{children:[ge.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Name"}),ge.jsx("input",{type:"text",value:s.name,onChange:k=>l({...s,name:k.target.value}),className:"w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-md text-white focus:outline-none focus:border-accent",placeholder:"Enter name"})]}),ge.jsxs("div",{children:[ge.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Email"}),ge.jsx("input",{type:"email",value:s.email,onChange:k=>l({...s,email:k.target.value}),className:"w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-md text-white focus:outline-none focus:border-accent",placeholder:"Enter email"})]}),ge.jsxs("div",{children:[ge.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Category"}),ge.jsxs("select",{value:s.category,onChange:k=>l({...s,category:k.target.value}),className:"w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-md text-white focus:outline-none focus:border-accent",children:[ge.jsx("option",{value:"",children:"Select category"}),ge.jsx("option",{value:"feature",children:"Feature Request"}),ge.jsx("option",{value:"bug",children:"Bug Report"}),ge.jsx("option",{value:"improvement",children:"Improvement"})]})]}),ge.jsxs("div",{children:[ge.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Priority"}),ge.jsx("div",{className:"flex gap-2",children:["low","medium","high"].map(k=>ge.jsx("button",{type:"button",onClick:()=>l({...s,priority:k}),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${s.priority===k?k==="high"?"bg-red-500 text-white":k==="medium"?"bg-yellow-500 text-black":"bg-green-500 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:k.toUpperCase()},k))})]}),ge.jsxs("div",{children:[ge.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),ge.jsx("textarea",{value:s.description,onChange:k=>l({...s,description:k.target.value}),rows:4,className:"w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-md text-white focus:outline-none focus:border-accent resize-none",placeholder:"Enter description"})]}),ge.jsxs("div",{className:"flex gap-3 pt-4",children:[ge.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-accent text-black font-semibold rounded-md hover:bg-accent/90 transition-colors",children:"Submit"}),ge.jsx("button",{type:"button",onClick:_,className:"px-4 py-2 bg-slate-700 text-slate-300 font-semibold rounded-md hover:bg-slate-600 transition-colors",children:"Cancel"})]})]})]})})},zI=()=>{const r=sr(m=>m.ui.rightSidebarOpen),s=sr(m=>m.ui.welcomeScreenClosed),l=sr(m=>m.ui.exampleFormOpen);return s?ge.jsxs("div",{className:"flex flex-col h-full",children:[ge.jsx(pI,{}),ge.jsxs("div",{className:"flex flex-1 overflow-hidden bg-slate-950",children:[ge.jsxs("div",{className:"relative flex-1",children:[ge.jsx(II,{}),ge.jsx(EI,{})]}),r&&ge.jsx(PI,{})]}),l&&ge.jsx(MI,{})]}):ge.jsx(dI,{})};Nm.createRoot(document.getElementById("root")).render(ge.jsx(F2.StrictMode,{children:ge.jsx(pT,{store:hI,children:ge.jsx(zI,{})})}));
